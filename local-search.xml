<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>jottings-3</title>
    <link href="/2024/08/22/jottings-3/"/>
    <url>/2024/08/22/jottings-3/</url>
    
    <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="æœ€è¿‘"><a href="#æœ€è¿‘" class="headerlink" title="æœ€è¿‘"></a>æœ€è¿‘</h1><p>è¿™ä¸¤å¤©æ„Ÿè§‰çŠ¶æ€æå¥½ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œä¼¼å¾ˆå®¹æ˜“è¿›å…¥å¿ƒæµçŠ¶æ€ã€‚<br>æ—©èµ·æ—©ç¡è½å®å¾—å¾ˆåˆ°ä½ï¼Œæ¯å¤©çš„å¥èº«ä¹Ÿæ²¡æœ‰ä¸­æ–­ã€‚<br>ç»ƒäº†äºŒåå¤šå¤©äº†ï¼Œæ˜æ˜¾æ„Ÿè§‰è„¸éƒ¨åˆç˜¦äº†ç‚¹ï¼Œè…¹éƒ¨è‚Œè‚‰ä¹Ÿå‘¼ä¹‹æ¬²å‡ºï¼Œèƒ¸è‚Œä¹Ÿç»ƒå‡ºæ¥äº†ç‚¹ã€‚<br>æ·±æ„Ÿæ¬£æ…°ï¼Œè¿™æ˜¯ä¸ºæ•°ä¸å¤šçš„èƒ½æœ‰å³æ—¶åé¦ˆçš„äº‹æƒ…äº†ï¼Œåº†å¹¸åšæŒäº†ä¸‹æ¥ã€‚<br>å…¶å®21å¹´ç»ƒè¿‡ä¸‰ä¸ªæœˆï¼Œä¸è¿‡æ–­æ–­ç»­ç»­çš„ï¼Œåªæ‰“ä¸‹äº†ä¸€ç‚¹å¾®å¼±çš„åŸºç¡€ã€‚ã€‚ã€‚</p><h1 id="å›å¿†ç¢ç‰‡"><a href="#å›å¿†ç¢ç‰‡" class="headerlink" title="å›å¿†ç¢ç‰‡"></a>å›å¿†ç¢ç‰‡</h1><p>ä»19å¹´åˆšè¿›å¤§å­¦ï¼Œä¼¼ä¹å°±æœ‰æ„çš„é€‰æ‹©ä¸€æ¡å­¤ç‹¬çš„é“è·¯ã€‚<br>åˆšå¼€å§‹åœ¨å­¦æ ¡æŸä¸ªå¤§ç¤¾å›¢äººç¼˜æ¯”è¾ƒå¥½ã€å’Œå­¦é•¿å­¦å§å…³ç³»ä¹Ÿå¾ˆä¸é”™ï¼›åæ¥ï¼Œåˆ»æ„çš„åœ¨æŸä¸€å¤©æ™šä¸Šåˆ é™¤å¤§éƒ¨åˆ†äººï¼Œèµ°å‘ç‹¬å­¤ã€‚ã€‚ã€‚ æˆ–è®¸æ˜¯æ‰€è°“â€œç‰©æå¿…åâ€å§ã€‚<br>ä¸€ç¬é—´å°±åƒå˜äº†ä¸ªäººï¼Œç°åœ¨æƒ³æ¥ï¼Œä¹ŸæŒºæœ‰æ„æ€ã€‚<br>åæ¥ä¹Ÿåˆ»æ„åœ°å»å›é¿ä¸€äº›çƒ­é—¹çš„åœºåˆï¼Œé™¤äº†æœ¬ä¸“ä¸šåŒå­¦ä»¬ä¿æŒç€è‰¯å¥½çš„å…³ç³»ï¼Œä¹Ÿæœ‰å‡ ä½å…³ç³»å¾ˆå¥½çš„æœ‹å‹ï¼Œæ„Ÿè§‰å¤Ÿäº†ï¼Œå…¶ä½™çš„ä¹Ÿä¸æŠ˜è…¾äº†ã€‚</p><p>å¤§äºŒåï¼Œæ¸¸æˆæ‰“çš„ä¹Ÿå°‘äº†ï¼Œçƒ­çˆ±çš„è‹±é›„è”ç›Ÿæ‰“åˆ°é’»ä¸‰å°±æ²¡æ‰“äº†ã€‚<br>å¤§ä¸‰ï¼ŒåŸºæœ¬éƒ½åœ¨å›¾ä¹¦é¦†åº¦è¿‡ï¼Œé€šä¿¡ä¸“ä¸šçš„ä¸œè¥¿åˆéš¾ï¼Œè€å¸ˆè¯´çš„åˆå¬ä¸æ‡‚ï¼›<br>åªèƒ½ä¸‹è¯¾å»å›¾ä¹¦é¦†æ¶è¡¥ï¼Œé€šå¸¸æ˜¯ç½‘è¯¾çœ‹åˆ°æ™šä¸Š10ç‚¹å›å»ï¼Œå–Šå…³ç³»å¥½çš„å®¤å‹æ‰“å‡ æŠŠè‹±é›„è”ç›Ÿç„¶åç¡å¤§è§‰ã€‚<br>æœ€è‡ªåœ¨çš„æ—¶å€™å°±æ˜¯åœ¨å†¬å¤©çš„å›¾ä¹¦é¦†çœ‹çª—å¤–çš„é›ªäº†ï¼›é™è°§ï¼Œåˆæ²¡æœ‰å‹åŠ›ï¼Œå¥½åƒåªéœ€è¦åšé¢˜æ¨å…¬å¼ã€‚</p><p>åˆ°äº†è€ƒç ”çš„æ—¶å€™ï¼Œå…¶å®å‹åŠ›ä¸å¤§ï¼Œå› ä¸ºä¹‹å‰å°±æœ‰å­¦ä¹ çš„ä¹ æƒ¯ã€‚è¿™æ®µæ—¶å…‰å¾ˆç¾å¥½ï¼Œä¹Ÿæ˜¯å•¥éƒ½ä¸æƒ³å°±åšé¢˜ï¼Œåˆ°æ™šä¸Šå°±å»ç»ƒçƒäº†ï¼Œä¹Ÿæ²¡å•¥è´Ÿæ‹…ã€‚<br>ä¸€ä¸ªäººæ—©å‡ºæ™šå½’ï¼Œåæ¥ç©äº†ä¸€ä¸ªæš‘å‡ã€‚å¼€å­¦äº†ç»§ç»­å­¦ï¼Œè¿™ä¼šæœ‰ä¸ªå®¤å‹è¦è€ƒå…¬ï¼Œæ‰€ä»¥æœ‰äº†ä¸ªæ­å­ï¼Œå¤§å®¶ä¸å¤ªå–œæ¬¢ä»–ï¼Œæˆ‘è§‰å¾—å…¶å®è¿˜å¥½ï¼Œåªæ˜¯ä»–å¹´é¾„å¤§ç‚¹æ²Ÿé€šæ–¹å¼æœ‰åŒºåˆ«ã€‚å¥½æ™¯ä¸é•¿ï¼Œä¹Ÿå°±æ˜¯ä¸€èµ·å­¦äº†ä¸€ä¸ªå¤šæœˆï¼Œåæ¥è¿˜æ˜¯å•æ‰“ç‹¬æ–—ï¼Œä¹ŸæŒºå¥½çš„ã€‚<br>å…¥ç§‹äº†å°±æ¬å®¿èˆå­¦äº†ï¼Œæ”¹æˆä¸­åˆèµ·åºŠï¼Œå‡Œæ™¨ç¡è§‰ã€‚æ•ˆç‡å‡ºå¥‡çš„é«˜ã€‚<br>æ™šä¸Šå¹²åˆ°ä¸‰ç‚¹ï¼Œå»éš”å£çœ‹åˆ«äººæ‰“ä¼šæˆ˜åœ°ï¼Œæ‰¯ä¼šè›‹å°±ç¡è§‰ã€‚<br>ä¸­é€”ä¹ŸåŠè¿‡èº«è¾¹çš„å¥½å‡ ä¸ªäººæœ‹å‹ä¸€èµ·è€ƒï¼Œä¸è¿‡éƒ½æ²¡åšæŒä¸‹æ¥ï¼›ç°åœ¨çœ‹æ¥ï¼Œæˆ–è®¸ä»–ä»¬çš„é€‰æ‹©æ˜¯å¥½çš„ã€‚åˆ°è€ƒå‰ï¼Œå¤§å®¶éƒ½é˜³äº†ï¼Œéš¾å—å¾—å¾ˆï¼Œæˆ‘ä¸€åº¦ä»¥ä¸ºæˆ‘åºŸäº†ï¼›æ²¡æƒ³åˆ°ï¼Œåˆ†æ•°é«˜å¾—æƒŠäººï¼Œè‹±è¯­æ›´æ˜¯å¥‡é«˜ã€‚ä¸è¿‡è¿˜æ˜¯ç•™ä¸‹äº†åé—ç—‡ï¼Œä¹‹å‰ä¸€åº¦æ³¨æ„åŠ›å¾ˆéš¾é•¿æ—¶é—´é›†ä¸­ï¼Œç°åœ¨å€’ä¹Ÿå¥½å¤šäº†ã€‚ç»å†è¿™æ®µæ—¶é—´åï¼Œä¹Ÿæ˜ç™½äº†â€œå­¤ç‹¬â€å¹¶ä¸æ˜¯ä¸€ä¸ªè´¬ä¹‰è¯ï¼Œäººå®¶æ¯å¤©æŠ±å›¢ï¼Œææ‰€è°“å­¦ä¹ æ–¹æ³•çš„éœ¸å‡Œï¼Œç»„å›¢å®£ä¼ è‡ªå·±çš„å­¦ä¹ æ–¹æ³•ï¼Œåæ¥é‚£ç¾¤äººåªæœ‰ä¸€ä¸ªåˆ†æ•°æ¯”æˆ‘æç‚¹ï¼Œä»–ä»¬çš„å­¦ä¹ æ—¶é—´éƒ½æ¯”æˆ‘é•¿å¾—å¤šã€‚</p><p>åæ¥ä¸€ç›´ä¿æŒç€â€œå­¤ç‹¬â€çš„å½¢è±¡ç¤ºäººï¼Œä¸æ„¿åˆç¾¤ã€ä¸æƒ³åˆç¾¤ï¼›ç»™è‡ªå·±è‡ªç”±ï¼Œæ„Ÿè§‰ä¹Ÿä¸é”™ã€‚<br>ç°åœ¨æ˜¯ï¼Œåˆ°ä¸€ä¸ªæ–°ç¯å¢ƒï¼Œå°±å’Œæ–°çš„äººä¿æŒå¥½çš„å…³ç³»ï¼Œå‡ºäº†è¿™ä¸ªç¯å¢ƒå°±ä¸è”ç³»ï¼›ä¸‹æ¬¡åˆåˆ°è¿™ä¸ªç¯å¢ƒï¼›åˆç»§ç»­ç¬‘å‘µå‘µçš„ã€‚çœå»äº†å…¶ä½™æ—¶é—´å°´å°¬çš„èŠå¤©ï¼Œåªä¸“æ³¨äºå¤§å®¶å…±åŒçš„é¢†åŸŸä¸è¯é¢˜ï¼Œæ„Ÿè§‰æŒºå¥½çš„ã€‚</p><p>æˆ‘çˆ±å­¤ç‹¬ï¼Œæˆ‘çˆ±æŒæ¡æˆ‘å…¨éƒ¨æ—¶é—´çš„æ„Ÿè§‰ï¼Œæˆ‘çˆ±ä¸è¢«åˆ«äººå¹²æ‰°å†³ç­–çš„æ„Ÿè§‰ã€‚ä¸è¿‡æœ‰åªçŒ«é™ªç€å°±æ›´å¥½äº†ğŸˆ</p><p>å°±å†™è¿™ä¹ˆå¤šå§ï¼Œè¿™æ˜¯ä»Šå¤©æ™šä¸Šååœ¨ä½ç½®ä¸ŠçŠ¯å›°ï¼Œå†™ä¸€ç‚¹è®°å½•ææç¥ï¼Œå¯èƒ½æœ‰ç‚¹å‡Œä¹±ï¼Œå˜´ä¸‹ç•™æƒ…ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç”Ÿæ´»</tag>
      
      <tag>éšç¬”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-7.1 DQNç³»åˆ—æ€»ç»“</title>
    <link href="/2024/08/22/RL-7-1/"/>
    <url>/2024/08/22/RL-7-1/</url>
    
    <content type="html"><![CDATA[<h1 id="1-DQN"><a href="#1-DQN" class="headerlink" title="1 DQN"></a>1 DQN</h1><p>DQNç”¨ç¥ç»ç½‘ç»œæ¥è¿‘ä¼¼Q-learningç®—æ³•ä¸­çš„Qå€¼ã€‚<br>ä¸¤ä¸ªå…³é”®æŠ€å·§;<br><strong>ç»éªŒå›æ”¾</strong>:åœ¨ä¼ ç»Ÿ Q-learning ä¸­ï¼Œæ›´æ–° Q å€¼æ˜¯åŸºäºå½“å‰çŠ¶æ€ã€åŠ¨ä½œã€å¥–åŠ±å’Œä¸‹ä¸€ä¸ªçŠ¶æ€çš„è½¬ç§»ï¼Œè¿™äº›è½¬ç§»å¯èƒ½æ˜¯ç›¸å…³çš„ã€‚è¿™ç§ç›¸å…³æ€§å¯èƒ½å¯¼è‡´ Q ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ä¸ç¨³å®šã€‚ç»éªŒå›æ”¾é€šè¿‡åœ¨è®­ç»ƒæ—¶éšæœºæŠ½å–å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­çš„è¿‡å¾€ç»éªŒæ ·æœ¬æ¥æ‰“ç ´è¿™ç§ç›¸å…³æ€§ï¼Œä»è€Œä½¿è®­ç»ƒè¿‡ç¨‹æ›´åŠ ç¨³å®šã€‚<br><strong>ç›®æ ‡ç½‘ç»œ</strong>ï¼šåœ¨ DQN ä¸­ï¼Œæœ‰ä¸¤ä¸ªç¥ç»ç½‘ç»œï¼Œä¸€ä¸ªæ˜¯ç”¨äºä¼°è®¡å½“å‰ Q å€¼çš„ä¸»ç½‘ç»œï¼ˆQ ç½‘ç»œï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ç”¨äºè®¡ç®—ç›®æ ‡ Q å€¼çš„ç›®æ ‡ç½‘ç»œã€‚ç›®æ ‡ç½‘ç»œçš„å‚æ•°ä¸ä¸»ç½‘ç»œç›¸åŒï¼Œä½†å®ƒä»¬æ¯éš”ä¸€å®šæ­¥æ•°æ‰æ›´æ–°ä¸€æ¬¡ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ç›®æ ‡å€¼å‘ç”Ÿå‰§çƒˆå˜åŒ–ï¼Œä»è€Œæå‡è®­ç»ƒçš„ç¨³å®šæ€§ã€‚<br><strong>æ›´æ–°å…¬å¼</strong><br>$Q(s,a)\leftarrow Q(s,a)+\alpha\left[r+\gamma\max_{a^{\prime}}Q_{\mathrm{target}}(s^{\prime},a^{\prime})-Q(s,a)\right]$<br>å…¶ä¸­ï¼š</p><ul><li>$Q(s,a)$æ˜¯å½“å‰ Q ç½‘ç»œçš„é¢„æµ‹å€¼ã€‚</li><li>$Q_{\text{target}}(sâ€™, aâ€™)$ æ˜¯ç›®æ ‡ç½‘ç»œçš„ Q å€¼ã€‚</li><li>$r$æ˜¯å³æ—¶å¥–åŠ±ã€‚</li><li>$\gamma$æ˜¯æŠ˜æ‰£å› å­ã€‚</li></ul><h1 id="2-Double-DQN"><a href="#2-Double-DQN" class="headerlink" title="2 Double DQN"></a>2 Double DQN</h1><p>DQN åœ¨ä¼°è®¡ç›®æ ‡ Q å€¼æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ç›¸åŒçš„ Q ç½‘ç»œæ¥é€‰æ‹©å’Œè¯„ä¼°åŠ¨ä½œï¼Œè¿™æ ·ä¼šå¯¼è‡´ Q å€¼é«˜ä¼°çš„é—®é¢˜ã€‚ä¸ºäº†å‡è½»è¿™ä¸ªé—®é¢˜ï¼ŒDouble DQN è¢«æå‡ºã€‚<br>Double DQN é€šè¿‡å°†åŠ¨ä½œé€‰æ‹©ä¸åŠ¨ä½œè¯„ä¼°åˆ†ç¦»æ¥è§£å†³è¿™ä¸ªé«˜ä¼°é—®é¢˜ï¼š</p><ul><li>åŠ¨ä½œé€‰æ‹©ä»ç„¶ä½¿ç”¨å½“å‰çš„ Q ç½‘ç»œã€‚</li><li>åŠ¨ä½œè¯„ä¼°åˆ™ä½¿ç”¨ç›®æ ‡ç½‘ç»œã€‚<br>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œåœ¨ä¼°è®¡ç›®æ ‡ Q å€¼æ—¶ä¸ä¼šå› ä¸ºåŠ¨ä½œé€‰æ‹©ä¸åŠ¨ä½œè¯„ä¼°ä½¿ç”¨åŒä¸€ä¸ªç½‘ç»œè€Œå¯¼è‡´é«˜ä¼°ã€‚<br><strong>ç®—æ³•æµç¨‹</strong></li></ul><ol><li><strong>åˆå§‹åŒ–ï¼š</strong> ä¸ DQN ç±»ä¼¼ï¼Œåˆå§‹åŒ– Q ç½‘ç»œã€ç›®æ ‡ç½‘ç»œä»¥åŠç»éªŒå›æ”¾ç¼“å†²åŒºã€‚</li><li><strong>é‡‡é›†ç»éªŒï¼š</strong> åœ¨ç¯å¢ƒä¸­æ‰§è¡ŒåŠ¨ä½œï¼Œå¹¶å°†ç»éªŒå­˜å‚¨åˆ°ç¼“å†²åŒºä¸­ã€‚</li><li><strong>ç»éªŒå›æ”¾ï¼š</strong> ä»ç¼“å†²åŒºä¸­éšæœºæŠ½å–ä¸€ä¸ªå°æ‰¹é‡çš„ç»éªŒæ ·æœ¬ã€‚</li><li><strong>æ›´æ–°ç½‘ç»œï¼š</strong> ä½¿ç”¨å½“å‰ Q ç½‘ç»œé€‰æ‹©åŠ¨ä½œï¼Œç”¨ç›®æ ‡ç½‘ç»œè¯„ä¼°è¯¥åŠ¨ä½œçš„ Q å€¼ï¼Œå¹¶è®¡ç®—æŸå¤±æ›´æ–° Q ç½‘ç»œçš„å‚æ•°ã€‚</li><li><strong>æ›´æ–°ç›®æ ‡ç½‘ç»œï¼š</strong> æ¯éš”å›ºå®šæ­¥æ•°ï¼Œå°† Q ç½‘ç»œçš„å‚æ•°å¤åˆ¶åˆ°ç›®æ ‡ç½‘ç»œã€‚</li><li><strong>é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œç›´åˆ°è®­ç»ƒå®Œæˆã€‚</strong></li></ol><p><strong>æ›´æ–°å…¬å¼</strong><br>$Q(s,a)\leftarrow Q(s,a)+\alpha\left[r+\gamma Q_{\mathrm{target}}(s^{\prime},\arg\max_{a^{\prime}}Q(s^{\prime},a^{\prime}))-Q\right.$<br>å…¶ä¸­ï¼š<br>$\arg\max_{a^\prime}Q(s^\prime,a^\prime)$æ˜¯ç”±å½“å‰ç½‘ç»œQé€‰æ‹©çš„åŠ¨ä½œ<br>$Q_{\mathrm{target}}(s^{\prime},\arg\max_{a^{\prime}}Q(s^{\prime},a^{\prime}))$æ˜¯ç›®æ ‡ç½‘ç»œè¯„ä¼°çš„Qå€¼<br><strong>ç›®æ ‡å€¼çš„è®¡ç®—</strong><br>$\text{target}&#x3D;r+\gamma Q(sâ€™,\arg\max_{aâ€™}Q(sâ€™,aâ€™;\theta);\theta^-)$</p><h1 id="3-Dueling-DQN"><a href="#3-Dueling-DQN" class="headerlink" title="3 Dueling DQN"></a>3 Dueling DQN</h1><p>Dueling DQN æ˜¯å¯¹ DQN çš„è¿›ä¸€æ­¥æ”¹è¿›ï¼Œæ—¨åœ¨æ›´æœ‰æ•ˆåœ°å­¦ä¹ æ¯ä¸ªçŠ¶æ€çš„é‡è¦æ€§ã€‚Dueling DQN å°† Q å€¼åˆ†è§£ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šçŠ¶æ€ä»·å€¼å‡½æ•° V(s) å’Œä¼˜åŠ¿å‡½æ•° A(s,a)ã€‚è¿™ç§åˆ†è§£æ–¹æ³•ä½¿å¾—åœ¨æŸäº›çŠ¶æ€ä¸‹ï¼Œå³ä½¿æ‰€æœ‰åŠ¨ä½œçš„ Q å€¼ç›¸è¿‘ï¼Œä¹Ÿèƒ½å¤Ÿè¾ƒå¥½åœ°è¯„ä¼°è¯¥çŠ¶æ€çš„ä»·å€¼ã€‚<br><strong>Qå€¼</strong><br>$Q(s,a;\theta,\alpha,\beta)&#x3D;V(s;\theta,\beta)+\left(A(s,a;\theta,\alpha)-\frac1{|\mathcal{A}|}\sum_{a^{\prime}}A(s,a^{\prime};\theta,\alpha)\right)$<br>å…¶ä¸­ï¼š</p><ul><li>V(s)æ˜¯çŠ¶æ€å€¼å‡½æ•°ï¼Œç”¨äºè¡¨ç¤ºå½“å‰çŠ¶æ€çš„ä»·å€¼ã€‚</li><li>A(s,a)æ˜¯ä¼˜åŠ¿å‡½æ•°ï¼Œç”¨äºè¡¨ç¤ºåœ¨çŠ¶æ€sä¸‹ï¼Œé‡‡å–åŠ¨ä½œaç›¸å¯¹äºå¹³å‡æ°´å¹³çš„ä¼˜åŠ¿ã€‚</li></ul><p>Dueling DQN çš„ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªå…±äº«ç½‘ç»œï¼Œç”¨äºæå–çŠ¶æ€ç‰¹å¾ã€‚</li><li>ç¬¬äºŒéƒ¨åˆ†åˆ†ä¸ºä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªç”¨äºè®¡ç®— V(s)ï¼Œå¦ä¸€ä¸ªç”¨äºè®¡ç®— A(s,a)</li></ul><h1 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4 æ€»ç»“"></a>4 æ€»ç»“</h1><ul><li><strong>DQN</strong>: åŸºæœ¬çš„ Q-learning ä¸ç¥ç»ç½‘ç»œç»“åˆï¼Œé€šè¿‡ç»éªŒå›æ”¾å’Œç›®æ ‡ç½‘ç»œç¨³å®šè®­ç»ƒã€‚</li><li><strong>Double DQN</strong>: è§£å†³ DQN ä¸­ Q å€¼è¿‡é«˜ä¼°è®¡çš„é—®é¢˜ï¼Œåˆ†ç¦»åŠ¨ä½œé€‰æ‹©å’ŒåŠ¨ä½œå€¼ä¼°è®¡ã€‚</li><li><strong>Dueling DQN</strong>: åˆ†è§£ Q å€¼ä¸ºçŠ¶æ€ä»·å€¼å’Œä¼˜åŠ¿å‡½æ•°ï¼Œæ›´æœ‰æ•ˆåœ°è¯„ä¼°çŠ¶æ€ä»·å€¼ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
      <tag>æ·±åº¦å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-7 DQNæ”¹å‹</title>
    <link href="/2024/08/22/RL-7/"/>
    <url>/2024/08/22/RL-7/</url>
    
    <content type="html"><![CDATA[<p>#å¼ºåŒ–å­¦ä¹  #æ·±åº¦å¼ºåŒ–å­¦ä¹  </p><h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h1><p>åœ¨ DQN ä¹‹åï¼Œå­¦æœ¯ç•Œæ¶Œç°å‡ºäº†éå¸¸å¤šçš„æ”¹è¿›ç®—æ³•ã€‚æœ¬ç« å°†ä»‹ç»å…¶ä¸­ä¸¤ä¸ªéå¸¸è‘—åçš„ç®—æ³•ï¼šDouble DQN å’Œ Dueling DQNï¼Œè¿™ä¸¤ä¸ªç®—æ³•çš„å®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ DQN çš„åŸºç¡€ä¸Šç¨åŠ ä¿®æ”¹ï¼Œå®ƒä»¬èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ”¹å–„ DQN çš„æ•ˆæœã€‚å¦‚æœè¯»è€…æƒ³è¦äº†è§£æ›´å¤šã€æ›´è¯¦ç»†çš„ DQN æ”¹è¿›æ–¹æ³•ï¼Œå¯ä»¥é˜…è¯»Rainbow æ¨¡å‹çš„è®ºæ–‡åŠå…¶å¼•ç”¨æ–‡çŒ®ã€‚</p><h1 id="2-Double-DQN"><a href="#2-Double-DQN" class="headerlink" title="2 Double DQN"></a>2 Double DQN</h1><p>æ™®é€šçš„DQNç®—æ³•é€šå¸¸ä¼šå¯¼è‡´å¯¹Qå€¼çš„è¿‡é«˜ä¼°ç®—ï¼Œä¼ ç»ŸDQNç®—æ³•çš„TDè¯¯å·®ç›®æ ‡ä¸ºï¼š<br>$r+\gamma\max_{a^{\prime}}Q_{\omega^-}\left(s^{\prime},a^{\prime}\right)$<br>å…¶ä¸­$\max_{a^{\prime}}Q_{\omega^-}\left(s^{\prime},a^{\prime}\right)$ç”±ç›®æ ‡ç½‘ç»œè®¡ç®—å¾—å‡ºï¼Œå¯æ”¹å†™ï¼š<br>$Q_{\omega^-}\left(s^\prime,\arg\max_{a^\prime}Q_{\omega^-}\left(s^\prime,a^\prime\right)\right)$<br>maxæ“ä½œå¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šé¦–å…ˆé€‰å–çŠ¶æ€$s^{\prime}$ä¸‹çš„æœ€ä¼˜åŠ¨ä½œ$a^*&#x3D;\arg\max_{a^\prime}Q_{\omega^-}\left(s^\prime,a^\prime\right)$ï¼Œæ¥ç€è®¡ç®—è¯¥åŠ¨ä½œå¯¹åº”çš„ä»·å€¼$Q_{\omega^-}\left(s^{\prime},a^{<em>}\right)$ã€‚<br>å½“è¿™ä¸¤éƒ¨åˆ†é‡‡ç”¨åŒä¸€å¥—Qç½‘ç»œè¿›è¡Œè®¡ç®—æ—¶ï¼Œæ¯æ¬¡å¾—åˆ°çš„éƒ½æ˜¯ç¥ç»ç½‘ç»œå½“å‰ä¼°ç®—çš„æ‰€æœ‰åŠ¨ä½œä»·å€¼ä¸­çš„æœ€å¤§å€¼ã€‚ä½†ç¥ç»ç½‘ç»œä¼°ç®—çš„Qæœ¬èº«ä¼šäº§ç”ŸæŸäº›æ­£&#x2F;è´Ÿè¯¯å·®ï¼Œåœ¨DQNçš„æ›´æ–°æ–¹å¼ä¸‹ç¥ç»ç½‘ç»œä¼šå°†æ­£å‘è¯¯å·®ç§¯ç´¯ã€‚å¦‚ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç‰¹æ®Šæƒ…å½¢ï¼šåœ¨çŠ¶æ€$s^{\prime}$ä¸‹æ‰€æœ‰åŠ¨ä½œçš„å€¼Qå‡ä¸º0ï¼Œå³$Q(s^{\prime},a_i)&#x3D;0,\forall i$,æ­¤æ—¶æ­£ç¡®çš„æ›´æ–°ç›®æ ‡åº”è¯¥ä¸ºr+0&#x3D;rï¼Œä½†æ˜¯ç”±äºç¥ç»ç½‘ç»œæ‹Ÿåˆè¯¯å·®çš„å­˜åœ¨ï¼Œæ€»æœ‰æŸä¸ªåŠ¨ä½œQ&gt;0,ä»è€Œå¯¼è‡´æ›´æ–°ç›®æ ‡å‡ºç°è¿‡é«˜ä¼°è®¡ã€‚Q(s,a)ä¹Ÿä¼šè¢«è¿‡é«˜ä¼°è®¡ã€‚è¿™æ ·ä¸‹å»ï¼Œè¯¯å·®ä¼šé€æ­¥ç§¯ç´¯ï¼Œä½¿è¿‡é«˜ä¼°è®¡çš„é—®é¢˜è¶Šæ¥è¶Šä¸¥é‡ã€‚<br>è§£å†³æ–¹æ³•ï¼šDoubel DQNç®—æ³•æå‡ºåˆ©ç”¨ä¸¤ä¸ªç‹¬ç«‹è®­ç»ƒçš„ç¥ç»ç½‘ä¼°ç®—$\max_{aâ€™}Q_</em>(sâ€™,aâ€™)$ï¼Œå°†åŸæœ‰çš„$\max_{a^{\prime}}Q_{\omega^{-}}\left(s^{\prime},a^{\prime}\right)$æ”¹ä¸º$Q_{\omega^-}\left(s^{\prime},\arg\max_{a^{\prime}}Q_\omega\left(s^{\prime},a^{\prime}\right)\right)$ï¼Œå³åˆ©ç”¨ä¸€å¥—ç¥ç»ç½‘ç»œ$Q_{\omega}$çš„è¾“å‡ºé€‰å–ä»·å€¼æœ€å¤§çš„åŠ¨ä½œï¼Œä½¿ç”¨è¯¥åŠ¨ä½œçš„ä»·å€¼æ—¶ï¼Œç”¨å¦ä¸€å¥—ç¥ç»ç½‘ç»œ$Q_{\omega}^{-}$è®¡ç®—è¯¥åŠ¨ä½œçš„ä»·å€¼ï¼Œç”±äºå¦ä¸€å¥—ç¥ç»ç½‘ç»œçš„å­˜åœ¨ï¼Œè¿™ä¸ªåŠ¨ä½œæœ€ç»ˆä½¿ç”¨çš„Qå€¼ä¸ä¼šå­˜åœ¨å¾ˆå¤§çš„è¿‡é«˜ä¼°è®¡é—®é¢˜ã€‚</p><p>ä¼ ç»Ÿçš„DQNç®—æ³•ä¸­ï¼Œæœ¬æ¥å°±æœ‰ä¸¤å¥—Qå‡½æ•°çš„ç¥ç»ç½‘ç»œï¼Œè®­ç»ƒç½‘ç»œå’Œç›®æ ‡ç½‘ç»œã€‚ä¸è¿‡$\max_{a^{\prime}}Q_{\omega^{-}}\left(s^{\prime},a^{\prime}\right)$çš„è®¡ç®—åªç”¨åˆ°äº†å…¶ä¸­çš„ç›®æ ‡ç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†è®­ç»ƒç½‘ç»œä½œä¸ºDouble DQNç®—æ³•ä¸­çš„ç¬¬ä¸€å¥—ç¥ç»ç½‘ç»œï¼Œç¬¬äºŒå¥—ç¥ç»ç½‘ç»œç”¨ç›®æ ‡ç½‘ç»œï¼›å…¶ä¸­ï¼Œè®­ç»ƒç½‘ç»œçš„å‚æ•°ä¸º$\omega$ç›®æ ‡ç½‘ç»œçš„å‚æ•°ä¸º$\omega^{-}$<br>Double DQNçš„ä¼˜åŒ–ç›®æ ‡ï¼š<br>$r+\gamma Q_{\omega^-}\left(s^{\prime},\underset{a^{\prime}}{\operatorname*{\arg\max}}Q_{\omega}\left(s^{\prime},a^{\prime}\right)\right)$</p><h1 id="3-å®ç°Double-DQN"><a href="#3-å®ç°Double-DQN" class="headerlink" title="3 å®ç°Double DQN"></a>3 å®ç°Double DQN</h1><p>æ˜¾ç„¶ï¼ŒDQNä¸Double DQNçš„å·®åˆ«åªæ˜¯åœ¨äºè®¡ç®—çŠ¶æ€$s^{\prime}$ä¸‹Qå€¼å¦‚ä½•æ—¶é€‰å–åŠ¨ä½œã€‚</p><ul><li>DQN çš„ä¼˜åŒ–ç›®æ ‡å¯ä»¥å†™ä¸º$r+\gamma Q_{\omega^-}\left(s^{\prime},\arg\max_{a^{\prime}}Q_{\omega^-}\left(s^{\prime},a^{\prime}\right)\right)$ï¼ŒåŠ¨ä½œçš„é€‰å–ä¾é ç›®æ ‡ç½‘ç»œ$Q_{\omega^-}$ï¼›</li><li>Double DQN çš„ä¼˜åŒ–ç›®æ ‡ä¸º$r+\gamma Q_{\omega^-}\left(s^{\prime},\arg\max_{a^{\prime}}Q_{\omega}\left(s^{\prime},a^{\prime}\right)\right)$ï¼ŒåŠ¨ä½œçš„é€‰å–ä¾é è®­ç»ƒç½‘ç»œ$Q_{\omega}$ã€‚<br>æ‰€ä»¥ Double DQN çš„ä»£ç å®ç°å¯ä»¥ç›´æ¥åœ¨ DQN çš„åŸºç¡€ä¸Šè¿›è¡Œï¼Œæ— é¡»åšè¿‡å¤šä¿®æ”¹ã€‚<br>ç¯å¢ƒè¿›è¡Œä¿®æ”¹ï¼Œé‡‡ç”¨å€’ç«‹æ‘†ç¯å¢ƒã€‚<br>[Pendulum-v0](<a href="https://github.com/openai/gym/wiki/Pendulum-v0">Pendulum v0 Â· openai&#x2F;gym Wiki (github.com)</a>)ï¼ˆç¯å¢ƒå·²æ”¹åä¸ºv1ï¼Œä»£ç ä¸­å·²ä¿®æ”¹ï¼‰</li></ul><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">@File    :   DQN_æ”¹.ipynb</span><br><span class="hljs-string"></span><br><span class="hljs-string">@Time    :   2024/08/22 15:03:03</span><br><span class="hljs-string"></span><br><span class="hljs-string">@Author  :   Neutrin</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>  <br><br><span class="hljs-comment"># here put the import lib</span><br><br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">import</span> gym<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">import</span> torch<br><br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">import</span> rl_utils<br><br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br>  <br>  <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Qnet</span>(torch.nn.Module):<br><br>    <span class="hljs-string">&#x27;&#x27;&#x27; åªæœ‰ä¸€å±‚éšè—å±‚çš„Qç½‘ç»œ &#x27;&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, state_dim, hidden_dim, action_dim</span>):<br><br>        <span class="hljs-built_in">super</span>(Qnet, <span class="hljs-variable language_">self</span>).__init__()<br><br>        <span class="hljs-variable language_">self</span>.fc1 = torch.nn.Linear(state_dim, hidden_dim)<br><br>        <span class="hljs-variable language_">self</span>.fc2 = torch.nn.Linear(hidden_dim, action_dim)<br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br><br>        x = F.relu(<span class="hljs-variable language_">self</span>.fc1(x))<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.fc2(x)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DQN</span>:<br><br>    <span class="hljs-string">&#x27;&#x27;&#x27; DQNç®—æ³•,åŒ…æ‹¬Double DQN &#x27;&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 state_dim,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 hidden_dim,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 action_dim,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 learning_rate,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 gamma,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 epsilon,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 target_update,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 device,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 dqn_type=<span class="hljs-string">&#x27;VanillaDQN&#x27;</span></span>):<br><br>        <span class="hljs-variable language_">self</span>.action_dim = action_dim<br><br>        <span class="hljs-variable language_">self</span>.q_net = Qnet(state_dim, hidden_dim, <span class="hljs-variable language_">self</span>.action_dim).to(device)<br><br>        <span class="hljs-variable language_">self</span>.target_q_net = Qnet(state_dim, hidden_dim,<br><br>                                 <span class="hljs-variable language_">self</span>.action_dim).to(device)<br><br>        <span class="hljs-variable language_">self</span>.optimizer = torch.optim.Adam(<span class="hljs-variable language_">self</span>.q_net.parameters(),<br><br>                                          lr=learning_rate)<br><br>        <span class="hljs-variable language_">self</span>.gamma = gamma<br><br>        <span class="hljs-variable language_">self</span>.epsilon = epsilon<br><br>        <span class="hljs-variable language_">self</span>.target_update = target_update<br><br>        <span class="hljs-variable language_">self</span>.count = <span class="hljs-number">0</span><br><br>        <span class="hljs-variable language_">self</span>.dqn_type = dqn_type<br><br>        <span class="hljs-variable language_">self</span>.device = device<br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">take_action</span>(<span class="hljs-params">self, state</span>):<br><br>        <span class="hljs-keyword">if</span> np.random.random() &lt; <span class="hljs-variable language_">self</span>.epsilon:<br><br>            action = np.random.randint(<span class="hljs-variable language_">self</span>.action_dim)<br><br>        <span class="hljs-keyword">else</span>:<br><br>            state = torch.tensor([state], dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>            action = <span class="hljs-variable language_">self</span>.q_net(state).argmax().item()<br><br>        <span class="hljs-keyword">return</span> action<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">max_q_value</span>(<span class="hljs-params">self, state</span>):<br><br>        state = torch.tensor([state], dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.q_net(state).<span class="hljs-built_in">max</span>().item()<br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, transition_dict</span>):<br><br>        states = torch.tensor(transition_dict[<span class="hljs-string">&#x27;states&#x27;</span>],<br><br>                              dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>        actions = torch.tensor(transition_dict[<span class="hljs-string">&#x27;actions&#x27;</span>]).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<br><br>            <span class="hljs-variable language_">self</span>.device)<br><br>        rewards = torch.tensor(transition_dict[<span class="hljs-string">&#x27;rewards&#x27;</span>],<br><br>                               dtype=torch.<span class="hljs-built_in">float</span>).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>        next_states = torch.tensor(transition_dict[<span class="hljs-string">&#x27;next_states&#x27;</span>],<br><br>                                   dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>        dones = torch.tensor(transition_dict[<span class="hljs-string">&#x27;dones&#x27;</span>],<br><br>                             dtype=torch.<span class="hljs-built_in">float</span>).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>  <br><br>        q_values = <span class="hljs-variable language_">self</span>.q_net(states).gather(<span class="hljs-number">1</span>, actions)  <span class="hljs-comment"># Qå€¼</span><br><br>        <span class="hljs-comment"># ä¸‹ä¸ªçŠ¶æ€çš„æœ€å¤§Qå€¼</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.dqn_type == <span class="hljs-string">&#x27;DoubleDQN&#x27;</span>: <span class="hljs-comment"># DQNä¸Double DQNçš„åŒºåˆ«</span><br><br>            max_action = <span class="hljs-variable language_">self</span>.q_net(next_states).<span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>].view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><br>            max_next_q_values = <span class="hljs-variable language_">self</span>.target_q_net(next_states).gather(<span class="hljs-number">1</span>, max_action)<br><br>        <span class="hljs-keyword">else</span>: <span class="hljs-comment"># DQNçš„æƒ…å†µ</span><br><br>            max_next_q_values = <span class="hljs-variable language_">self</span>.target_q_net(next_states).<span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>].view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><br>        q_targets = rewards + <span class="hljs-variable language_">self</span>.gamma * max_next_q_values * (<span class="hljs-number">1</span> - dones)  <span class="hljs-comment"># TDè¯¯å·®ç›®æ ‡</span><br><br>        dqn_loss = torch.mean(F.mse_loss(q_values, q_targets))  <span class="hljs-comment"># å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°</span><br><br>        <span class="hljs-variable language_">self</span>.optimizer.zero_grad()  <span class="hljs-comment"># PyTorchä¸­é»˜è®¤æ¢¯åº¦ä¼šç´¯ç§¯,è¿™é‡Œéœ€è¦æ˜¾å¼å°†æ¢¯åº¦ç½®ä¸º0</span><br><br>        dqn_loss.backward()  <span class="hljs-comment"># åå‘ä¼ æ’­æ›´æ–°å‚æ•°</span><br><br>        <span class="hljs-variable language_">self</span>.optimizer.step()<br><br>  <br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.count % <span class="hljs-variable language_">self</span>.target_update == <span class="hljs-number">0</span>:<br><br>            <span class="hljs-variable language_">self</span>.target_q_net.load_state_dict(<br><br>                <span class="hljs-variable language_">self</span>.q_net.state_dict())  <span class="hljs-comment"># æ›´æ–°ç›®æ ‡ç½‘ç»œ</span><br><br>        <span class="hljs-variable language_">self</span>.count += <span class="hljs-number">1</span><br><br>lr = <span class="hljs-number">1e-2</span><br><br>num_episodes = <span class="hljs-number">150</span><br><br>hidden_dim = <span class="hljs-number">128</span><br><br>gamma = <span class="hljs-number">0.98</span><br><br>epsilon = <span class="hljs-number">0.01</span><br><br>target_update = <span class="hljs-number">50</span><br><br>buffer_size = <span class="hljs-number">5000</span><br><br>minimal_size = <span class="hljs-number">1000</span><br><br>batch_size = <span class="hljs-number">32</span><br><br>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span>) <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> torch.device(<br><br>    <span class="hljs-string">&quot;cpu&quot;</span>)<br><br>  <br><br>env_name = <span class="hljs-string">&#x27;Pendulum-v1&#x27;</span><br><br>env = gym.make(env_name)<br><br>state_dim = env.observation_space.shape[<span class="hljs-number">0</span>]<br><br>action_dim = <span class="hljs-number">11</span>  <span class="hljs-comment"># å°†è¿ç»­åŠ¨ä½œåˆ†æˆ11ä¸ªç¦»æ•£åŠ¨ä½œ</span><br><br>  <br>  <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dis_to_con</span>(<span class="hljs-params">discrete_action, env, action_dim</span>):  <span class="hljs-comment"># ç¦»æ•£åŠ¨ä½œè½¬å›è¿ç»­çš„å‡½æ•°</span><br><br>    action_lowbound = env.action_space.low[<span class="hljs-number">0</span>]  <span class="hljs-comment"># è¿ç»­åŠ¨ä½œçš„æœ€å°å€¼</span><br><br>    action_upbound = env.action_space.high[<span class="hljs-number">0</span>]  <span class="hljs-comment"># è¿ç»­åŠ¨ä½œçš„æœ€å¤§å€¼</span><br><br>    <span class="hljs-keyword">return</span> action_lowbound + (discrete_action /<br><br>                              (action_dim - <span class="hljs-number">1</span>)) * (action_upbound -<br><br>                                                   action_lowbound)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_DQN</span>(<span class="hljs-params">agent, env, num_episodes, replay_buffer, minimal_size,</span><br><span class="hljs-params"></span><br><span class="hljs-params">              batch_size</span>):<br><br>    return_list = []<br><br>    max_q_value_list = []<br><br>    max_q_value = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br><br>        <span class="hljs-keyword">with</span> tqdm(total=<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>),<br><br>                  desc=<span class="hljs-string">&#x27;Iteration %d&#x27;</span> % i) <span class="hljs-keyword">as</span> pbar:<br><br>            <span class="hljs-keyword">for</span> i_episode <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>)):<br><br>                episode_return = <span class="hljs-number">0</span><br><br>                state = env.reset()<br><br>                done = <span class="hljs-literal">False</span><br><br>                <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> done:<br><br>                    <span class="hljs-comment"># env.render()</span><br><br>                    action = agent.take_action(state)<br><br>                    max_q_value = agent.max_q_value(<br><br>                        state) * <span class="hljs-number">0.005</span> + max_q_value * <span class="hljs-number">0.995</span>  <span class="hljs-comment"># å¹³æ»‘å¤„ç†</span><br><br>                    max_q_value_list.append(max_q_value)  <span class="hljs-comment"># ä¿å­˜æ¯ä¸ªçŠ¶æ€çš„æœ€å¤§Qå€¼</span><br><br>                    action_continuous = dis_to_con(action, env,<br><br>                                                   agent.action_dim)<br><br>                    next_state, reward, done, _ = env.step([action_continuous])<br><br>                    replay_buffer.add(state, action, reward, next_state, done)<br><br>                    state = next_state<br><br>                    episode_return += reward<br><br>                    <span class="hljs-keyword">if</span> replay_buffer.size() &gt; minimal_size:<br><br>                        b_s, b_a, b_r, b_ns, b_d = replay_buffer.sample(<br><br>                            batch_size)<br><br>                        transition_dict = &#123;<br><br>                            <span class="hljs-string">&#x27;states&#x27;</span>: b_s,<br><br>                            <span class="hljs-string">&#x27;actions&#x27;</span>: b_a,<br><br>                            <span class="hljs-string">&#x27;next_states&#x27;</span>: b_ns,<br><br>                            <span class="hljs-string">&#x27;rewards&#x27;</span>: b_r,<br><br>                            <span class="hljs-string">&#x27;dones&#x27;</span>: b_d<br><br>                        &#125;<br><br>                        agent.update(transition_dict)<br><br>                return_list.append(episode_return)<br><br>                <span class="hljs-keyword">if</span> (i_episode + <span class="hljs-number">1</span>) % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:<br><br>                    pbar.set_postfix(&#123;<br><br>                        <span class="hljs-string">&#x27;episode&#x27;</span>:<br><br>                        <span class="hljs-string">&#x27;%d&#x27;</span> % (num_episodes / <span class="hljs-number">10</span> * i + i_episode + <span class="hljs-number">1</span>),<br><br>                        <span class="hljs-string">&#x27;return&#x27;</span>:<br><br>                        <span class="hljs-string">&#x27;%.3f&#x27;</span> % np.mean(return_list[-<span class="hljs-number">10</span>:])<br><br>                    &#125;)<br><br>                pbar.update(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> return_list, max_q_value_list<br><br><span class="hljs-comment"># env.close()</span><br><br>random.seed(<span class="hljs-number">0</span>)<br><br>np.random.seed(<span class="hljs-number">0</span>)<br><br>env.seed(<span class="hljs-number">0</span>)<br><br>torch.manual_seed(<span class="hljs-number">0</span>)<br><br>replay_buffer = rl_utils.ReplayBuffer(buffer_size)<br><br>agent = DQN(state_dim, hidden_dim, action_dim, lr, gamma, epsilon,<br><br>            target_update, device)<br><br>return_list, max_q_value_list = train_DQN(agent, env, num_episodes,<br><br>                                          replay_buffer, minimal_size,<br><br>                                          batch_size)<br><br>  <br><br>episodes_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(return_list)))<br><br>mv_return = rl_utils.moving_average(return_list, <span class="hljs-number">5</span>)<br><br>plt.plot(episodes_list, mv_return)<br><br>plt.xlabel(<span class="hljs-string">&#x27;Episodes&#x27;</span>)<br><br>plt.ylabel(<span class="hljs-string">&#x27;Returns&#x27;</span>)<br><br>plt.title(<span class="hljs-string">&#x27;DQN on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(env_name))<br><br>plt.show()<br><br>  <br><br>frames_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(max_q_value_list)))<br><br>plt.plot(frames_list, max_q_value_list)<br><br>plt.axhline(<span class="hljs-number">0</span>, c=<span class="hljs-string">&#x27;orange&#x27;</span>, ls=<span class="hljs-string">&#x27;--&#x27;</span>)<br><br>plt.axhline(<span class="hljs-number">10</span>, c=<span class="hljs-string">&#x27;red&#x27;</span>, ls=<span class="hljs-string">&#x27;--&#x27;</span>)<br><br>plt.xlabel(<span class="hljs-string">&#x27;Frames&#x27;</span>)<br><br>plt.ylabel(<span class="hljs-string">&#x27;Q value&#x27;</span>)<br><br>plt.title(<span class="hljs-string">&#x27;DQN on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(env_name))<br><br>plt.show()                            <br><br>random.seed(<span class="hljs-number">0</span>)<br><br>np.random.seed(<span class="hljs-number">0</span>)<br><br>env.seed(<span class="hljs-number">0</span>)<br><br>torch.manual_seed(<span class="hljs-number">0</span>)<br><br>replay_buffer = rl_utils.ReplayBuffer(buffer_size)<br><br>agent = DQN(state_dim, hidden_dim, action_dim, lr, gamma, epsilon,<br><br>            target_update, device, <span class="hljs-string">&#x27;DoubleDQN&#x27;</span>)<br><br>return_list, max_q_value_list = train_DQN(agent, env, num_episodes,<br><br>                                          replay_buffer, minimal_size,<br><br>                                          batch_size)<br><br>  <br><br>episodes_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(return_list)))<br><br>mv_return = rl_utils.moving_average(return_list, <span class="hljs-number">5</span>)<br><br>plt.plot(episodes_list, mv_return)<br><br>plt.xlabel(<span class="hljs-string">&#x27;Episodes&#x27;</span>)<br><br>plt.ylabel(<span class="hljs-string">&#x27;Returns&#x27;</span>)<br><br>plt.title(<span class="hljs-string">&#x27;Double DQN on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(env_name))<br><br>plt.show()<br><br>  <br><br>frames_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(max_q_value_list)))<br><br>plt.plot(frames_list, max_q_value_list)<br><br>plt.axhline(<span class="hljs-number">0</span>, c=<span class="hljs-string">&#x27;orange&#x27;</span>, ls=<span class="hljs-string">&#x27;--&#x27;</span>)<br><br>plt.axhline(<span class="hljs-number">10</span>, c=<span class="hljs-string">&#x27;red&#x27;</span>, ls=<span class="hljs-string">&#x27;--&#x27;</span>)<br><br>plt.xlabel(<span class="hljs-string">&#x27;Frames&#x27;</span>)<br><br>plt.ylabel(<span class="hljs-string">&#x27;Q value&#x27;</span>)<br><br>plt.title(<span class="hljs-string">&#x27;Double DQN on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(env_name))<br><br>plt.show()<br></code></pre></td></tr></table></figure><p>å¦‚å›¾æ‰€ç¤ºï¼ŒDoubleDQNç›¸æ¯”äºDQNæ¯”è¾ƒå°‘å‡ºç°Qå€¼å¤§äº0çš„æƒ…å†µã€‚<br><img src="/image/RL-71.png"></p><p><img src="/image/RL-72.png"></p><h1 id="4-Dueling-DQN"><a href="#4-Dueling-DQN" class="headerlink" title="4 Dueling DQN"></a>4 Dueling DQN</h1><p>Dueling DQN æ˜¯ DQN å¦ä¸€ç§çš„æ”¹è¿›ç®—æ³•ï¼Œå®ƒåœ¨ä¼ ç»Ÿ DQN çš„åŸºç¡€ä¸Šåªè¿›è¡Œäº†å¾®å°çš„æ”¹åŠ¨ï¼Œä½†å´èƒ½å¤§å¹…æå‡ DQN çš„è¡¨ç°ã€‚åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å°†çŠ¶æ€åŠ¨ä½œä»·å€¼å‡½æ•°Qå‡å»çŠ¶æ€ä»·å€¼å‡½æ•°Vçš„ç»“æœå®šä¹‰ä¸ºä¼˜åŠ¿å‡½æ•°Aã€‚å³ï¼š$A(s,a)&#x3D;Q(s,a)-V(s)$<br>åœ¨åŒä¸€ä¸ªçŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰åŠ¨ä½œçš„ä¼˜åŠ¿å€¼ä¹‹å’Œä¸º 0ï¼Œå› ä¸ºæ‰€æœ‰åŠ¨ä½œçš„åŠ¨ä½œä»·å€¼çš„æœŸæœ›å°±æ˜¯è¿™ä¸ªçŠ¶æ€çš„çŠ¶æ€ä»·å€¼ã€‚æ®æ­¤ï¼Œåœ¨ Dueling DQN ä¸­ï¼ŒQ ç½‘ç»œè¢«å»ºæ¨¡ä¸ºï¼š<br>$Q_{\eta,\alpha,\beta}(s,a)&#x3D;V_{\eta,\alpha}(s)+A_{\eta,\beta}(s,a)$<br>å…¶ä¸­ï¼Œ$V_{\eta,\alpha}(s)$ä¸ºçŠ¶æ€ä»·å€¼å‡½æ•°ï¼Œè€Œ$A_{\eta,\beta}(s,a)$åˆ™ä¸ºè¯¥çŠ¶æ€ä¸‹é‡‡å–ä¸åŒåŠ¨ä½œçš„ä¼˜åŠ¿å‡½æ•°ï¼Œè¡¨ç¤ºé‡‡å–ä¸åŒåŠ¨ä½œçš„å·®å¼‚æ€§ï¼›$\eta$æ˜¯çŠ¶æ€ä»·å€¼å‡½æ•°å’Œä¼˜åŠ¿å‡½æ•°å…±äº«çš„ç½‘ç»œå‚æ•°ï¼Œä¸€èˆ¬ç”¨åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œç”¨æ¥æå–ç‰¹å¾çš„å‰å‡ å±‚ï¼›è€Œ$\alpha$å’Œ$\beta$åˆ†åˆ«ä¸ºçŠ¶æ€ä»·å€¼å‡½æ•°å’Œä¼˜åŠ¿å‡½æ•°çš„å‚æ•°ã€‚åœ¨è¿™æ ·çš„æ¨¡å‹ä¸‹ï¼Œæˆ‘ä»¬ä¸å†è®©ç¥ç»ç½‘ç»œç›´æ¥è¾“å‡ºQå€¼ï¼Œè€Œæ˜¯è®­ç»ƒç¥ç»ç½‘ç»œçš„æœ€åå‡ å±‚çš„ä¸¤ä¸ªåˆ†æ”¯ï¼Œåˆ†åˆ«è¾“å‡ºçŠ¶æ€ä»·å€¼å‡½æ•°å’Œä¼˜åŠ¿å‡½æ•°ï¼Œå†æ±‚å’Œå¾—åˆ°Qå€¼ã€‚Dueling DQN çš„ç½‘ç»œç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="/image/RL-73.png"><br>å°†çŠ¶æ€ä»·å€¼å‡½æ•°å’Œä¼˜åŠ¿å‡½æ•°åˆ†åˆ«å»ºæ¨¡çš„å¥½å¤„åœ¨äºï¼šæŸäº›æƒ…å¢ƒä¸‹æ™ºèƒ½ä½“åªä¼šå…³æ³¨çŠ¶æ€çš„ä»·å€¼ï¼Œè€Œå¹¶ä¸å…³å¿ƒä¸åŒåŠ¨ä½œå¯¼è‡´çš„å·®å¼‚ï¼Œæ­¤æ—¶å°†äºŒè€…åˆ†å¼€å»ºæ¨¡èƒ½å¤Ÿä½¿æ™ºèƒ½ä½“æ›´å¥½åœ°å¤„ç†ä¸åŠ¨ä½œå…³è”è¾ƒå°çš„çŠ¶æ€ã€‚<br>åœ¨ä¸‹å›¾æ‰€ç¤ºçš„é©¾é©¶è½¦è¾†æ¸¸æˆä¸­ï¼Œæ™ºèƒ½ä½“æ³¨æ„åŠ›é›†ä¸­çš„éƒ¨ä½è¢«æ˜¾ç¤ºä¸ºæ©™è‰²ï¼Œå½“æ™ºèƒ½ä½“å‰é¢æ²¡æœ‰è½¦æ—¶ï¼Œè½¦è¾†è‡ªèº«åŠ¨ä½œå¹¶æ²¡æœ‰å¤ªå¤§å·®å¼‚ï¼Œæ­¤æ—¶æ™ºèƒ½ä½“æ›´å…³æ³¨çŠ¶æ€ä»·å€¼ï¼Œè€Œå½“æ™ºèƒ½ä½“å‰é¢æœ‰è½¦æ—¶ï¼ˆæ™ºèƒ½ä½“éœ€è¦è¶…è½¦ï¼‰ï¼Œæ™ºèƒ½ä½“å¼€å§‹å…³æ³¨ä¸åŒåŠ¨ä½œä¼˜åŠ¿å€¼çš„å·®å¼‚ã€‚<br><img src="/image/RL-74.png"><br>å¯¹äºå…¬å¼ï¼Œå­˜åœ¨Vå€¼å’ŒAå€¼å»ºæ¨¡ä¸å”¯ä¸€çš„é—®é¢˜ï¼ŒDueling DQNå¼ºåˆ¶æœ€ä¼˜åŠ¨ä½œçš„ä¼˜åŠ¿å‡½æ•°å®é™…è¾“å‡ºä¸º0ï¼Œå³ï¼š<br>$Q_{\eta,\alpha,\beta}(s,a)&#x3D;V_{\eta,\alpha}(s)+A_{\eta,\beta}(s,a)-\max_{aâ€™}A_{\eta,\beta}\left(s,aâ€™\right)$<br>æ­¤æ—¶$V(s)&#x3D;\max_aQ(s,a)$ä¿è¯äº†Vå€¼å»ºæ¨¡çš„å”¯ä¸€æ€§ã€‚åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¹³å‡ä»£æ›¿æœ€å¤§åŒ–æ“ä½œï¼Œå³ï¼š<br>$Q_{\eta,\alpha,\beta}(s,a)&#x3D;V_{\eta,\alpha}(s)+A_{\eta,\beta}(s,a)-\frac{1}{|\mathcal{A}|}\sum_{aâ€™}A_{\eta,\beta}\left(s,aâ€™\right)$<br>æ­¤æ—¶$V(s)&#x3D;\frac{1}{|\mathcal{A}|}\sum_{a^{\prime}}Q(s,a^{\prime})ã€‚$</p><h1 id="5-å®ç°Dueling-DNQ"><a href="#5-å®ç°Dueling-DNQ" class="headerlink" title="5 å®ç°Dueling DNQ"></a>5 å®ç°Dueling DNQ</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VAnet</span>(torch.nn.Module):<br>    <span class="hljs-string">&#x27;&#x27;&#x27; åªæœ‰ä¸€å±‚éšè—å±‚çš„Aç½‘ç»œå’ŒVç½‘ç»œ &#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, state_dim, hidden_dim, action_dim</span>):<br>        <span class="hljs-built_in">super</span>(VAnet, <span class="hljs-variable language_">self</span>).__init__()<br>        <span class="hljs-variable language_">self</span>.fc1 = torch.nn.Linear(state_dim, hidden_dim)  <span class="hljs-comment"># å…±äº«ç½‘ç»œéƒ¨åˆ†</span><br>        <span class="hljs-variable language_">self</span>.fc_A = torch.nn.Linear(hidden_dim, action_dim)<br>        <span class="hljs-variable language_">self</span>.fc_V = torch.nn.Linear(hidden_dim, <span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        A = <span class="hljs-variable language_">self</span>.fc_A(F.relu(<span class="hljs-variable language_">self</span>.fc1(x)))<br>        V = <span class="hljs-variable language_">self</span>.fc_V(F.relu(<span class="hljs-variable language_">self</span>.fc1(x)))<br>        Q = V + A - A.mean(<span class="hljs-number">1</span>).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)  <span class="hljs-comment"># Qå€¼ç”±Vå€¼å’ŒAå€¼è®¡ç®—å¾—åˆ°</span><br>        <span class="hljs-keyword">return</span> Q<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DQN</span>:<br>    <span class="hljs-string">&#x27;&#x27;&#x27; DQNç®—æ³•,åŒ…æ‹¬Double DQNå’ŒDueling DQN &#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,</span><br><span class="hljs-params">                 state_dim,</span><br><span class="hljs-params">                 hidden_dim,</span><br><span class="hljs-params">                 action_dim,</span><br><span class="hljs-params">                 learning_rate,</span><br><span class="hljs-params">                 gamma,</span><br><span class="hljs-params">                 epsilon,</span><br><span class="hljs-params">                 target_update,</span><br><span class="hljs-params">                 device,</span><br><span class="hljs-params">                 dqn_type=<span class="hljs-string">&#x27;VanillaDQN&#x27;</span></span>):<br>        <span class="hljs-variable language_">self</span>.action_dim = action_dim<br>        <span class="hljs-keyword">if</span> dqn_type == <span class="hljs-string">&#x27;DuelingDQN&#x27;</span>:  <span class="hljs-comment"># Dueling DQNé‡‡å–ä¸ä¸€æ ·çš„ç½‘ç»œæ¡†æ¶</span><br>            <span class="hljs-variable language_">self</span>.q_net = VAnet(state_dim, hidden_dim,<br>                               <span class="hljs-variable language_">self</span>.action_dim).to(device)<br>            <span class="hljs-variable language_">self</span>.target_q_net = VAnet(state_dim, hidden_dim,<br>                                      <span class="hljs-variable language_">self</span>.action_dim).to(device)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.q_net = Qnet(state_dim, hidden_dim,<br>                              <span class="hljs-variable language_">self</span>.action_dim).to(device)<br>            <span class="hljs-variable language_">self</span>.target_q_net = Qnet(state_dim, hidden_dim,<br>                                     <span class="hljs-variable language_">self</span>.action_dim).to(device)<br>        <span class="hljs-variable language_">self</span>.optimizer = torch.optim.Adam(<span class="hljs-variable language_">self</span>.q_net.parameters(),<br>                                          lr=learning_rate)<br>        <span class="hljs-variable language_">self</span>.gamma = gamma<br>        <span class="hljs-variable language_">self</span>.epsilon = epsilon<br>        <span class="hljs-variable language_">self</span>.target_update = target_update<br>        <span class="hljs-variable language_">self</span>.count = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>.dqn_type = dqn_type<br>        <span class="hljs-variable language_">self</span>.device = device<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">take_action</span>(<span class="hljs-params">self, state</span>):<br>        <span class="hljs-keyword">if</span> np.random.random() &lt; <span class="hljs-variable language_">self</span>.epsilon:<br>            action = np.random.randint(<span class="hljs-variable language_">self</span>.action_dim)<br>        <span class="hljs-keyword">else</span>:<br>            state = torch.tensor([state], dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br>            action = <span class="hljs-variable language_">self</span>.q_net(state).argmax().item()<br>        <span class="hljs-keyword">return</span> action<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">max_q_value</span>(<span class="hljs-params">self, state</span>):<br>        state = torch.tensor([state], dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.q_net(state).<span class="hljs-built_in">max</span>().item()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, transition_dict</span>):<br>        states = torch.tensor(transition_dict[<span class="hljs-string">&#x27;states&#x27;</span>],<br>                              dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br>        actions = torch.tensor(transition_dict[<span class="hljs-string">&#x27;actions&#x27;</span>]).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<br>            <span class="hljs-variable language_">self</span>.device)<br>        rewards = torch.tensor(transition_dict[<span class="hljs-string">&#x27;rewards&#x27;</span>],<br>                               dtype=torch.<span class="hljs-built_in">float</span>).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<span class="hljs-variable language_">self</span>.device)<br>        next_states = torch.tensor(transition_dict[<span class="hljs-string">&#x27;next_states&#x27;</span>],<br>                                   dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br>        dones = torch.tensor(transition_dict[<span class="hljs-string">&#x27;dones&#x27;</span>],<br>                             dtype=torch.<span class="hljs-built_in">float</span>).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>        q_values = <span class="hljs-variable language_">self</span>.q_net(states).gather(<span class="hljs-number">1</span>, actions)<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.dqn_type == <span class="hljs-string">&#x27;DoubleDQN&#x27;</span>:<br>            max_action = <span class="hljs-variable language_">self</span>.q_net(next_states).<span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>].view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>            max_next_q_values = <span class="hljs-variable language_">self</span>.target_q_net(next_states).gather(<br>                <span class="hljs-number">1</span>, max_action)<br>        <span class="hljs-keyword">else</span>:<br>            max_next_q_values = <span class="hljs-variable language_">self</span>.target_q_net(next_states).<span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>].view(<br>                -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>        q_targets = rewards + <span class="hljs-variable language_">self</span>.gamma * max_next_q_values * (<span class="hljs-number">1</span> - dones)<br>        dqn_loss = torch.mean(F.mse_loss(q_values, q_targets))<br>        <span class="hljs-variable language_">self</span>.optimizer.zero_grad()<br>        dqn_loss.backward()<br>        <span class="hljs-variable language_">self</span>.optimizer.step()<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.count % <span class="hljs-variable language_">self</span>.target_update == <span class="hljs-number">0</span>:<br>            <span class="hljs-variable language_">self</span>.target_q_net.load_state_dict(<span class="hljs-variable language_">self</span>.q_net.state_dict())<br>        <span class="hljs-variable language_">self</span>.count += <span class="hljs-number">1</span><br><br><br>random.seed(<span class="hljs-number">0</span>)<br>np.random.seed(<span class="hljs-number">0</span>)<br>env.seed(<span class="hljs-number">0</span>)<br>torch.manual_seed(<span class="hljs-number">0</span>)<br>replay_buffer = rl_utils.ReplayBuffer(buffer_size)<br>agent = DQN(state_dim, hidden_dim, action_dim, lr, gamma, epsilon,<br>            target_update, device, <span class="hljs-string">&#x27;DuelingDQN&#x27;</span>)<br>return_list, max_q_value_list = train_DQN(agent, env, num_episodes,<br>                                          replay_buffer, minimal_size,<br>                                          batch_size)<br><br>episodes_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(return_list)))<br>mv_return = rl_utils.moving_average(return_list, <span class="hljs-number">5</span>)<br>plt.plot(episodes_list, mv_return)<br>plt.xlabel(<span class="hljs-string">&#x27;Episodes&#x27;</span>)<br>plt.ylabel(<span class="hljs-string">&#x27;Returns&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;Dueling DQN on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(env_name))<br>plt.show()<br><br>frames_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(max_q_value_list)))<br>plt.plot(frames_list, max_q_value_list)<br>plt.axhline(<span class="hljs-number">0</span>, c=<span class="hljs-string">&#x27;orange&#x27;</span>, ls=<span class="hljs-string">&#x27;--&#x27;</span>)<br>plt.axhline(<span class="hljs-number">10</span>, c=<span class="hljs-string">&#x27;red&#x27;</span>, ls=<span class="hljs-string">&#x27;--&#x27;</span>)<br>plt.xlabel(<span class="hljs-string">&#x27;Frames&#x27;</span>)<br>plt.ylabel(<span class="hljs-string">&#x27;Q value&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;Dueling DQN on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(env_name))<br>plt.show()<br></code></pre></td></tr></table></figure><p><img src="/image/RL-75.png"></p><h1 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6 æ€»ç»“"></a>6 æ€»ç»“</h1><p>åœ¨ä¼ ç»Ÿçš„ DQN åŸºç¡€ä¸Šï¼Œæœ‰ä¸¤ç§éå¸¸å®¹æ˜“å®ç°çš„å˜å¼â€”â€”Double DQN å’Œ Dueling DQNï¼ŒDouble DQN è§£å†³äº† DQN ä¸­å¯¹å€¼çš„Qè¿‡é«˜ä¼°è®¡ï¼Œè€Œ Dueling DQN èƒ½å¤Ÿå¾ˆå¥½åœ°å­¦ä¹ åˆ°ä¸åŒåŠ¨ä½œçš„å·®å¼‚æ€§ï¼Œåœ¨åŠ¨ä½œç©ºé—´è¾ƒå¤§çš„ç¯å¢ƒä¸‹éå¸¸æœ‰æ•ˆã€‚ä» Double DQN å’Œ Dueling DQN çš„æ–¹æ³•åŸç†ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ„Ÿå—åˆ°æ·±åº¦å¼ºåŒ–å­¦ä¹ çš„ç ”ç©¶æ˜¯åœ¨å…³æ³¨æ·±åº¦å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ æœ‰æ•ˆç»“åˆï¼šä¸€æ˜¯åœ¨æ·±åº¦å­¦ä¹ çš„æ¨¡å—çš„åŸºç¡€ä¸Šï¼Œå¼ºåŒ–å­¦ä¹ æ–¹æ³•å¦‚ä½•æ›´åŠ æœ‰æ•ˆåœ°å·¥ä½œï¼Œå¹¶é¿å…æ·±åº¦æ¨¡å‹å­¦ä¹ è¡Œä¸ºå¸¦æ¥çš„ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ä½¿ç”¨ Double DQN è§£å†³Qå€¼è¿‡é«˜ä¼°è®¡çš„é—®é¢˜ï¼›äºŒæ˜¯åœ¨å¼ºåŒ–å­¦ä¹ çš„åœºæ™¯ä¸‹ï¼Œæ·±åº¦å­¦ä¹ æ¨¡å‹å¦‚ä½•æœ‰æ•ˆå­¦ä¹ åˆ°æœ‰ç”¨çš„æ¨¡å¼ï¼Œä¾‹å¦‚è®¾è®¡ Dueling DQN ç½‘ç»œæ¶æ„æ¥é«˜æ•ˆåœ°å­¦ä¹ çŠ¶æ€ä»·å€¼å‡½æ•°ä»¥åŠåŠ¨ä½œä¼˜åŠ¿å‡½æ•°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
      <tag>æ·±åº¦å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-6 DQN</title>
    <link href="/2024/08/22/RL-6/"/>
    <url>/2024/08/22/RL-6/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h1><p>åœ¨å‰é¢è®²è§£çš„ Q-learning ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬ä»¥çŸ©é˜µçš„æ–¹å¼å»ºç«‹äº†ä¸€å¼ å­˜å‚¨æ¯ä¸ªçŠ¶æ€ä¸‹æ‰€æœ‰åŠ¨ä½œå€¼çš„è¡¨æ ¼ã€‚è¡¨æ ¼ä¸­çš„æ¯ä¸€ä¸ªåŠ¨ä½œä»·å€¼Q(s,a)è¡¨ç¤ºåœ¨çŠ¶æ€sä¸‹é€‰æ‹©åŠ¨ä½œaç„¶åç»§ç»­éµå¾ªæŸä¸€ç­–ç•¥é¢„æœŸèƒ½å¤Ÿå¾—åˆ°çš„æœŸæœ›å›æŠ¥ã€‚ç„¶è€Œï¼Œè¿™ç§ç”¨è¡¨æ ¼å­˜å‚¨åŠ¨ä½œä»·å€¼çš„åšæ³•åªåœ¨ç¯å¢ƒçš„çŠ¶æ€å’ŒåŠ¨ä½œéƒ½æ˜¯ç¦»æ•£çš„ï¼Œå¹¶ä¸”ç©ºé—´éƒ½æ¯”è¾ƒå°çš„æƒ…å†µä¸‹é€‚ç”¨ï¼Œæˆ‘ä»¬ä¹‹å‰è¿›è¡Œä»£ç å®æˆ˜çš„å‡ ä¸ªç¯å¢ƒéƒ½æ˜¯å¦‚æ­¤ï¼ˆå¦‚æ‚¬å´–æ¼«æ­¥ï¼‰ã€‚å½“çŠ¶æ€æˆ–è€…åŠ¨ä½œæ•°é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œè¿™ç§åšæ³•å°±ä¸é€‚ç”¨äº†ã€‚ä¾‹å¦‚ï¼Œå½“çŠ¶æ€æ˜¯ä¸€å¼  RGB å›¾åƒæ—¶ï¼Œå‡è®¾å›¾åƒå¤§å°æ˜¯210x160x3ï¼Œæ­¤æ—¶ä¸€å…±æœ‰$256^{210<em>60</em>3}$ç§çŠ¶æ€ï¼Œåœ¨è®¡ç®—æœºä¸­å­˜å‚¨è¿™ä¸ªæ•°é‡çº§çš„å€¼è¡¨æ ¼æ˜¯ä¸ç°å®çš„ã€‚æ›´ç”šè€…ï¼Œå½“çŠ¶æ€æˆ–è€…åŠ¨ä½œè¿ç»­çš„æ—¶å€™ï¼Œå°±æœ‰æ— é™ä¸ªçŠ¶æ€åŠ¨ä½œå¯¹ï¼Œæˆ‘ä»¬æ›´åŠ æ— æ³•ä½¿ç”¨è¿™ç§è¡¨æ ¼å½¢å¼æ¥è®°å½•å„ä¸ªçŠ¶æ€åŠ¨ä½œå¯¹çš„Qå€¼ã€‚</p><p>å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ç”¨å‡½æ•°æ‹Ÿåˆçš„æ–¹æ³•æ¥ä¼°Qå€¼ï¼Œå³å°†è¿™ä¸ªå¤æ‚çš„å€¼è¡¨æ ¼è§†ä½œæ•°æ®ï¼Œä½¿ç”¨ä¸€ä¸ªå‚æ•°åŒ–çš„å‡½æ•°$Q_{\theta}$æ¥æ‹Ÿåˆè¿™äº›æ•°æ®ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§å‡½æ•°æ‹Ÿåˆçš„æ–¹æ³•å­˜åœ¨ä¸€å®šçš„ç²¾åº¦æŸå¤±ï¼Œå› æ­¤è¢«ç§°ä¸ºè¿‘ä¼¼æ–¹æ³•ã€‚æˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„ DQN ç®—æ³•ä¾¿å¯ä»¥ç”¨æ¥è§£å†³è¿ç»­çŠ¶æ€ä¸‹ç¦»æ•£åŠ¨ä½œçš„é—®é¢˜ã€‚</p><h1 id="2-CartPoleç¯å¢ƒ"><a href="#2-CartPoleç¯å¢ƒ" class="headerlink" title="2 CartPoleç¯å¢ƒ"></a>2 CartPoleç¯å¢ƒ</h1><p>è¯¦æƒ…è§ï¼š<a href="https://github.com/openai/gym/wiki/CartPole-v0"># CartPole v0</a>(åœ¨gymåº“å‡çº§åç–‘ä¼¼å˜æˆäº†V1ï¼Œæœ¬æ–‡æ²¿ç”¨æ—§çš„gymåº“)<br>åœ¨è½¦æ†ç¯å¢ƒä¸­ï¼Œæœ‰ä¸€è¾†å°è½¦ï¼Œæ™ºèƒ½ä½“çš„ä»»åŠ¡æ˜¯é€šè¿‡å·¦å³ç§»åŠ¨ä¿æŒè½¦ä¸Šçš„æ†ç«–ç›´ï¼Œè‹¥æ†çš„å€¾æ–œåº¦æ•°è¿‡å¤§ï¼Œæˆ–è€…è½¦å­ç¦»åˆå§‹ä½ç½®å·¦å³çš„åç¦»ç¨‹åº¦è¿‡å¤§ï¼Œæˆ–è€…åšæŒæ—¶é—´åˆ°è¾¾ 200 å¸§ï¼Œåˆ™æ¸¸æˆç»“æŸã€‚</p><h1 id="3-DQN"><a href="#3-DQN" class="headerlink" title="3 DQN"></a>3 DQN</h1><p>ç°åœ¨æˆ‘ä»¬æƒ³åœ¨ç±»ä¼¼è½¦æ†çš„ç¯å¢ƒä¸­å¾—åˆ°åŠ¨ä½œä»·å€¼å‡½æ•°Q(s,a)ï¼Œç”±äºçŠ¶æ€æ¯ä¸€ç»´åº¦çš„å€¼éƒ½æ˜¯è¿ç»­çš„ï¼Œæ— æ³•ä½¿ç”¨è¡¨æ ¼è®°å½•ï¼Œå› æ­¤ä¸€ä¸ªå¸¸è§çš„è§£å†³æ–¹æ³•ä¾¿æ˜¯ä½¿ç”¨<strong>å‡½æ•°æ‹Ÿåˆ</strong>ï¼ˆfunction approximationï¼‰çš„æ€æƒ³ã€‚ç”±äºç¥ç»ç½‘ç»œå…·æœ‰å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç¥ç»ç½‘ç»œæ¥è¡¨ç¤ºå‡½æ•°Qã€‚è‹¥åŠ¨ä½œæ˜¯è¿ç»­ï¼ˆæ— é™ï¼‰çš„ï¼Œç¥ç»ç½‘ç»œçš„è¾“å…¥æ˜¯çŠ¶æ€så’ŒåŠ¨ä½œaï¼Œç„¶åè¾“å‡ºä¸€ä¸ªæ ‡é‡ï¼Œè¡¨ç¤ºåœ¨çŠ¶æ€sä¸‹é‡‡å–åŠ¨ä½œaèƒ½è·å¾—çš„ä»·å€¼ã€‚è‹¥åŠ¨ä½œæ˜¯ç¦»æ•£ï¼ˆæœ‰é™ï¼‰çš„ï¼Œé™¤äº†å¯ä»¥é‡‡å–åŠ¨ä½œè¿ç»­æƒ…å†µä¸‹çš„åšæ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åªå°†çŠ¶æ€sè¾“å…¥åˆ°ç¥ç»ç½‘ç»œä¸­ï¼Œä½¿å…¶åŒæ—¶è¾“å‡ºæ¯ä¸€ä¸ªåŠ¨ä½œçš„Qå€¼ã€‚é€šå¸¸ DQNï¼ˆä»¥åŠ Q-learningï¼‰åªèƒ½å¤„ç†åŠ¨ä½œç¦»æ•£çš„æƒ…å†µï¼Œå› ä¸ºåœ¨å‡½æ•°Qçš„æ›´æ–°è¿‡ç¨‹ä¸­æœ‰$max_a$è¿™ä¸€æ“ä½œã€‚å‡è®¾ç¥ç»ç½‘ç»œç”¨æ¥æ‹Ÿåˆå‡½æ•°wçš„å‚æ•°æ˜¯ ï¼Œå³æ¯ä¸€ä¸ªçŠ¶æ€sä¸‹æ‰€æœ‰å¯èƒ½åŠ¨ä½œaçš„Qå€¼æˆ‘ä»¬éƒ½èƒ½è¡¨ç¤ºä¸º$Q_{\omega}(s,a)$ã€‚æˆ‘ä»¬å°†ç”¨äºæ‹Ÿåˆå‡½æ•°Qå‡½æ•°çš„ç¥ç»ç½‘ç»œç§°ä¸º<strong>Q ç½‘ç»œ</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="/image/RL-61.png"><br>Q-learningçš„æ›´æ–°è§„åˆ™ï¼š<br>$Q(s,a)\leftarrow Q(s,a)+\alpha\left[r+\gamma\max_{aâ€™\in\mathcal{A}}Q(sâ€™,aâ€™)-Q(s,a)\right]$<br>ä¸Šè¿°å…¬å¼ç”¨æ—¶åºå·®åˆ†å­¦ä¹ ç›®æ ‡$r+\gamma\max_{a^{\prime}\in\mathcal{A}}Q(s^{\prime},a^{\prime})$æ¥å¢é‡å¼æ›´æ–°Q(s,a)ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä½¿å¾—Q(s,a)å’ŒTDç›®æ ‡$r+\gamma\max_{a^{\prime}\in\mathcal{A}}Q(s^{\prime},a^{\prime})$é è¿‘ã€‚äºæ˜¯ï¼Œå¯¹äºä¸€ç»„æ•°æ®${(s_i,a_i,r_i,s_i^{\prime})}$ï¼Œå¯ä»¥è‡ªç„¶åœ°å°†Qç½‘ç»œçš„æŸå¤±å‡½æ•°æ„é€ ä¸ºå‡æ–¹è¯¯å·®çš„å½¢å¼ï¼š<br>$\omega^*&#x3D;\arg\min_\omega\frac{1}{2N}\sum_{i&#x3D;1}^N\left[Q_\omega\left(s_i,a_i\right)-\left(r_i+\gamma\max_{aâ€™}Q_\omega\left(sâ€™_i,aâ€™\right)\right)\right]^2$<br>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†Q-learingæ‰©å±•åˆ°ç¥ç»ç½‘ç»œå½¢å¼â€”â€”æ·±åº¦Qç½‘ç»œç®—æ³•ã€‚ç”±äº DQN æ˜¯ç¦»çº¿ç­–ç•¥ç®—æ³•ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ”¶é›†æ•°æ®çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ä¸€ä¸ª$\epsilon$-è´ªå©ªç­–ç•¥æ¥å¹³è¡¡æ¢ç´¢ä¸åˆ©ç”¨ï¼Œå°†æ”¶é›†åˆ°çš„æ•°æ®å­˜å‚¨èµ·æ¥ï¼Œåœ¨åç»­çš„è®­ç»ƒä¸­ä½¿ç”¨ã€‚DQN ä¸­è¿˜æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¨¡å—â€”â€”<strong>ç»éªŒå›æ”¾</strong>å’Œ<strong>ç›®æ ‡ç½‘ç»œ</strong>ï¼Œå®ƒä»¬èƒ½å¤Ÿå¸®åŠ© DQN å–å¾—ç¨³å®šã€å‡ºè‰²çš„æ€§èƒ½ã€‚</p><h2 id="3-1ç»éªŒå›æ”¾"><a href="#3-1ç»éªŒå›æ”¾" class="headerlink" title="3.1ç»éªŒå›æ”¾"></a>3.1ç»éªŒå›æ”¾</h2><p>åœ¨ä¸€èˆ¬çš„æœ‰ç›‘ç£å­¦ä¹ ä¸­ï¼Œå‡è®¾è®­ç»ƒæ•°æ®æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„ï¼Œæˆ‘ä»¬æ¯æ¬¡è®­ç»ƒç¥ç»ç½‘ç»œçš„æ—¶å€™ä»è®­ç»ƒæ•°æ®ä¸­éšæœºé‡‡æ ·ä¸€ä¸ªæˆ–è‹¥å¹²ä¸ªæ•°æ®æ¥è¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼Œéšç€å­¦ä¹ çš„ä¸æ–­è¿›è¡Œï¼Œæ¯ä¸€ä¸ªè®­ç»ƒæ•°æ®ä¼šè¢«ä½¿ç”¨å¤šæ¬¡ã€‚åœ¨åŸæ¥çš„ Q-learning ç®—æ³•ä¸­ï¼Œæ¯ä¸€ä¸ªæ•°æ®åªä¼šç”¨æ¥æ›´æ–°ä¸€æ¬¡Qå€¼ã€‚ä¸ºäº†æ›´å¥½åœ°å°† Q-learning å’Œæ·±åº¦ç¥ç»ç½‘ç»œç»“åˆï¼ŒDQN ç®—æ³•é‡‡ç”¨äº†<strong>ç»éªŒå›æ”¾</strong>ï¼ˆexperience replayï¼‰æ–¹æ³•ï¼Œå…·ä½“åšæ³•ä¸ºç»´æŠ¤ä¸€ä¸ª<strong>å›æ”¾ç¼“å†²åŒº</strong>ï¼Œå°†æ¯æ¬¡ä»ç¯å¢ƒä¸­é‡‡æ ·å¾—åˆ°çš„å››å…ƒç»„æ•°æ®ï¼ˆçŠ¶æ€ã€åŠ¨ä½œã€å¥–åŠ±ã€ä¸‹ä¸€çŠ¶æ€ï¼‰å­˜å‚¨åˆ°å›æ”¾ç¼“å†²åŒºä¸­ï¼Œè®­ç»ƒ Q ç½‘ç»œçš„æ—¶å€™å†ä»å›æ”¾ç¼“å†²åŒºä¸­éšæœºé‡‡æ ·è‹¥å¹²æ•°æ®æ¥è¿›è¡Œè®­ç»ƒã€‚è¿™ä¹ˆåšå¯ä»¥èµ·åˆ°ä»¥ä¸‹ä¸¤ä¸ªä½œç”¨ã€‚<br>ï¼ˆ1ï¼‰ä½¿æ ·æœ¬æ»¡è¶³ç‹¬ç«‹å‡è®¾ã€‚åœ¨ MDP ä¸­äº¤äº’é‡‡æ ·å¾—åˆ°çš„æ•°æ®æœ¬èº«ä¸æ»¡è¶³ç‹¬ç«‹å‡è®¾ï¼Œå› ä¸ºè¿™ä¸€æ—¶åˆ»çš„çŠ¶æ€å’Œä¸Šä¸€æ—¶åˆ»çš„çŠ¶æ€æœ‰å…³ã€‚éç‹¬ç«‹åŒåˆ†å¸ƒçš„æ•°æ®å¯¹è®­ç»ƒç¥ç»ç½‘ç»œæœ‰å¾ˆå¤§çš„å½±å“ï¼Œä¼šä½¿ç¥ç»ç½‘ç»œæ‹Ÿåˆåˆ°æœ€è¿‘è®­ç»ƒçš„æ•°æ®ä¸Šã€‚é‡‡ç”¨ç»éªŒå›æ”¾å¯ä»¥æ‰“ç ´æ ·æœ¬ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œè®©å…¶æ»¡è¶³ç‹¬ç«‹å‡è®¾ã€‚<br>ï¼ˆ2ï¼‰æé«˜æ ·æœ¬æ•ˆç‡ã€‚æ¯ä¸€ä¸ªæ ·æœ¬å¯ä»¥è¢«ä½¿ç”¨å¤šæ¬¡ï¼Œååˆ†é€‚åˆæ·±åº¦ç¥ç»ç½‘ç»œçš„æ¢¯åº¦å­¦ä¹ ã€‚</p><h2 id="3-2ç›®æ ‡ç½‘ç»œ"><a href="#3-2ç›®æ ‡ç½‘ç»œ" class="headerlink" title="3.2ç›®æ ‡ç½‘ç»œ"></a>3.2ç›®æ ‡ç½‘ç»œ</h2><p>DQN ç®—æ³•æœ€ç»ˆæ›´æ–°çš„ç›®æ ‡æ˜¯è®©$Q_{\omega}(s,a)$é€¼è¿‘$r+\gamma\max_{a^{\prime}\in\mathcal{A}}Q(s^{\prime},a^{\prime})$ï¼Œç”±äº TD è¯¯å·®ç›®æ ‡æœ¬èº«å°±åŒ…å«ç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼Œå› æ­¤åœ¨æ›´æ–°ç½‘ç»œå‚æ•°çš„åŒæ—¶ç›®æ ‡ä¹Ÿåœ¨ä¸æ–­åœ°æ”¹å˜ï¼Œè¿™éå¸¸å®¹æ˜“é€ æˆç¥ç»ç½‘ç»œè®­ç»ƒçš„ä¸ç¨³å®šæ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒDQN ä¾¿ä½¿ç”¨äº†<strong>ç›®æ ‡ç½‘ç»œ</strong>ï¼ˆtarget networkï¼‰çš„æ€æƒ³ï¼šæ—¢ç„¶è®­ç»ƒè¿‡ç¨‹ä¸­ Q ç½‘ç»œçš„ä¸æ–­æ›´æ–°ä¼šå¯¼è‡´ç›®æ ‡ä¸æ–­å‘ç”Ÿæ”¹å˜ï¼Œä¸å¦‚æš‚æ—¶å…ˆå°† TD ç›®æ ‡ä¸­çš„ Q ç½‘ç»œå›ºå®šä½ã€‚ä¸ºäº†å®ç°è¿™ä¸€æ€æƒ³ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¸¤å¥— Q ç½‘ç»œã€‚</p><p>(1)åŸæ¥çš„è®­ç»ƒç½‘ç»œ$Q_{\omega}(s,a)$ï¼Œç”¨äºè®¡ç®—åŸæ¥çš„æŸå¤±å‡½æ•°$\frac12[Q_\omega\left(s,a\right)-\left(r+\gamma\max_{a^{\prime}}Q_{\omega^-}\left(s^{\prime},a^{\prime}\right)\right)]^2$ä¸­çš„$Q_{\omega}(s,a)$é¡¹ï¼Œå¹¶ä½¿ç”¨æ­£å¸¸æ¢¯åº¦ä¸‹é™æ–¹æ³•æ¥è¿›è¡Œæ›´æ–°ã€‚<br>(2) ç›®æ ‡ç½‘ç»œ$Q_{\omega^-}(s,a)$ï¼Œç”¨äºè®¡ç®—åŸå…ˆæŸå¤±å‡½æ•°$\frac12[Q_\omega\left(s,a\right)-\left(r+\gamma\max_{a^{\prime}}Q_{\omega^-}\left(s^{\prime},a^{\prime}\right)\right)]^2$ä¸­çš„$(r+\gamma\max_{a^{\prime}}Q_{\omega^{-}}(s^{\prime},a^{\prime}))]$é¡¹ï¼Œå…¶ä¸­$w^{-}$è¡¨ç¤ºä¸ºç›®æ ‡ç½‘ç»œä¸­çš„å‚æ•°ã€‚å¦‚æœä¸¤å¥—ç½‘ç»œçš„å‚æ•°éšæ—¶ä¿æŒä¸€è‡´ï¼Œåˆ™ä»ä¸ºåŸå…ˆä¸å¤Ÿç¨³å®šçš„ç®—æ³•ï¼Œä¸ºäº†è®©æ›´æ–°ç›®æ ‡æ›´ç¨³å®šï¼Œç›®æ ‡ç½‘ç»œå¹¶ä¸ä¼šæ¯ä¸€æ­¥éƒ½æ›´æ–°ã€‚ç›®æ ‡ç½‘ç»œä½¿ç”¨è®­ç»ƒç½‘ç»œçš„ä¸€å¥—è¾ƒæ—§çš„å‚æ•°ï¼Œè®­ç»ƒç½‘ç»œ$Q_{\omega}(s,a)$åœ¨è®­ç»ƒçš„æ¯ä¸€æ­¥éƒ½ä¼šæ›´æ–°ï¼Œè€Œç›®æ ‡ç½‘ç»œçš„å‚æ•°æ¯éš”Cæ­¥æ‰ä¼šä¸è®­ç»ƒç½‘ç»œåŒæ­¥ä¸€æ¬¡ï¼Œå³$\omega^{-}\leftarrow\omega$è¿™æ ·ä½¿å¾—ç›®æ ‡å‡½æ•°ç›¸å¯¹äºè®­ç»ƒç½‘ç»œæ›´åŠ ç¨³å®šã€‚<br><img src="/image/RL-62.png"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">@File    :   DQN.ipynb</span><br><span class="hljs-string"></span><br><span class="hljs-string">@Time    :   2024/08/22 09:59:18</span><br><span class="hljs-string"></span><br><span class="hljs-string">@Author  :   Neutrin</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>  <br><br><span class="hljs-comment"># here put the import lib</span><br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">import</span> torch<br><br><span class="hljs-keyword">import</span> gym<br><br><span class="hljs-keyword">import</span> collections<br><br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">import</span> rl_utils<br><br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ReplayBuffer</span>:<br><br>    <span class="hljs-comment">#ç»éªŒå›æ”¾æ± </span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, capacity</span>):<br><br>        <span class="hljs-variable language_">self</span>.buffer = collections.deque(maxlen=capacity) <span class="hljs-comment">#åŒå‘é˜Ÿåˆ—</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, state, action, reward, next_state, done</span>): <span class="hljs-comment">#æŠŠæ•°æ®åŠ å…¥åˆ°bufferä¸­</span><br><br>        <span class="hljs-variable language_">self</span>.buffer.append((state, action, reward, next_state, done))  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sample</span>(<span class="hljs-params">self, batch_size</span>):   <span class="hljs-comment">#ä»bufferä¸­éšæœºé‡‡æ ·batch_sizeä¸ªæ•°æ®</span><br><br>        transitions = random.sample(<span class="hljs-variable language_">self</span>.buffer, batch_size)<br><br>        state, action, reward, next_state, done = <span class="hljs-built_in">zip</span>(*transitions)<br><br>        <span class="hljs-keyword">return</span> np.array(state), action, reward, np.array(next_state), done<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">size</span>(<span class="hljs-params">self</span>):<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.buffer)<br> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Qnet</span>(torch.nn.Module):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,state_dim,hide_dim,action_dim</span>):<br><br>        <span class="hljs-built_in">super</span>(Qnet,<span class="hljs-variable language_">self</span>).__init__()  <br><br>        <span class="hljs-variable language_">self</span>.fc1 = torch.nn.Linear(state_dim,hide_dim)  <span class="hljs-comment">#è¾“å…¥å±‚</span><br><br>        <span class="hljs-variable language_">self</span>.fc2 = torch.nn.Linear(hide_dim,action_dim) <span class="hljs-comment">#è¾“å‡ºå±‚</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self,x</span>): <span class="hljs-comment">#å‰å‘ä¼ æ’­</span><br><br>        x = F.relu(<span class="hljs-variable language_">self</span>.fc1(x))  <span class="hljs-comment">#æ¿€æ´»å‡½æ•°</span><br><br>        x = <span class="hljs-variable language_">self</span>.fc2(x)     <span class="hljs-comment">#è¾“å‡º  </span><br><br>        <span class="hljs-keyword">return</span> x   <br> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DQN</span>:<br><br>    <span class="hljs-string">&#x27;&#x27;&#x27; DQNç®—æ³• &#x27;&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, state_dim, hidden_dim, action_dim, learning_rate, gamma,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 epsilon, target_update, device</span>):<br><br>        <span class="hljs-variable language_">self</span>.action_dim = action_dim<br><br>        <span class="hljs-variable language_">self</span>.q_net = Qnet(state_dim, hidden_dim,<br><br>                          <span class="hljs-variable language_">self</span>.action_dim).to(device)  <span class="hljs-comment"># Qç½‘ç»œ</span><br><br>        <span class="hljs-comment"># ç›®æ ‡ç½‘ç»œ</span><br><br>        <span class="hljs-variable language_">self</span>.target_q_net = Qnet(state_dim, hidden_dim,<br><br>                                 <span class="hljs-variable language_">self</span>.action_dim).to(device)<br><br>        <span class="hljs-comment"># ä½¿ç”¨Adamä¼˜åŒ–å™¨</span><br><br>        <span class="hljs-variable language_">self</span>.optimizer = torch.optim.Adam(<span class="hljs-variable language_">self</span>.q_net.parameters(),<br><br>                                          lr=learning_rate)<br><br>        <span class="hljs-variable language_">self</span>.gamma = gamma  <span class="hljs-comment"># æŠ˜æ‰£å› å­</span><br><br>        <span class="hljs-variable language_">self</span>.epsilon = epsilon  <span class="hljs-comment"># epsilon-è´ªå©ªç­–ç•¥</span><br><br>        <span class="hljs-variable language_">self</span>.target_update = target_update  <span class="hljs-comment"># ç›®æ ‡ç½‘ç»œæ›´æ–°é¢‘ç‡</span><br><br>        <span class="hljs-variable language_">self</span>.count = <span class="hljs-number">0</span>  <span class="hljs-comment"># è®¡æ•°å™¨,è®°å½•æ›´æ–°æ¬¡æ•°</span><br><br>        <span class="hljs-variable language_">self</span>.device = device<br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">take_action</span>(<span class="hljs-params">self, state</span>):  <span class="hljs-comment"># epsilon-è´ªå©ªç­–ç•¥é‡‡å–åŠ¨ä½œ</span><br><br>        <span class="hljs-keyword">if</span> np.random.random() &lt; <span class="hljs-variable language_">self</span>.epsilon:<br><br>            action = np.random.randint(<span class="hljs-variable language_">self</span>.action_dim)<br><br>        <span class="hljs-keyword">else</span>:<br><br>            state = torch.tensor([state], dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>            action = <span class="hljs-variable language_">self</span>.q_net(state).argmax().item()<br><br>        <span class="hljs-keyword">return</span> action<br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, transition_dict</span>):<br><br>        states = torch.tensor(transition_dict[<span class="hljs-string">&#x27;states&#x27;</span>],<br><br>                              dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>        actions = torch.tensor(transition_dict[<span class="hljs-string">&#x27;actions&#x27;</span>]).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<br><br>            <span class="hljs-variable language_">self</span>.device)<br><br>        rewards = torch.tensor(transition_dict[<span class="hljs-string">&#x27;rewards&#x27;</span>],<br><br>                               dtype=torch.<span class="hljs-built_in">float</span>).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>        next_states = torch.tensor(transition_dict[<span class="hljs-string">&#x27;next_states&#x27;</span>],<br><br>                                   dtype=torch.<span class="hljs-built_in">float</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>        dones = torch.tensor(transition_dict[<span class="hljs-string">&#x27;dones&#x27;</span>],<br><br>                             dtype=torch.<span class="hljs-built_in">float</span>).view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).to(<span class="hljs-variable language_">self</span>.device)<br><br>  <br><br>        q_values = <span class="hljs-variable language_">self</span>.q_net(states).gather(<span class="hljs-number">1</span>, actions)  <span class="hljs-comment"># Qå€¼</span><br><br>        <span class="hljs-comment"># ä¸‹ä¸ªçŠ¶æ€çš„æœ€å¤§Qå€¼</span><br><br>        max_next_q_values = <span class="hljs-variable language_">self</span>.target_q_net(next_states).<span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>].view(<br><br>            -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><br>        q_targets = rewards + <span class="hljs-variable language_">self</span>.gamma * max_next_q_values * (<span class="hljs-number">1</span> - dones<br><br>                                                                )  <span class="hljs-comment"># TDè¯¯å·®ç›®æ ‡</span><br><br>        dqn_loss = torch.mean(F.mse_loss(q_values, q_targets))  <span class="hljs-comment"># å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°</span><br><br>        <span class="hljs-variable language_">self</span>.optimizer.zero_grad()  <span class="hljs-comment"># PyTorchä¸­é»˜è®¤æ¢¯åº¦ä¼šç´¯ç§¯,è¿™é‡Œéœ€è¦æ˜¾å¼å°†æ¢¯åº¦ç½®ä¸º0</span><br><br>        dqn_loss.backward()  <span class="hljs-comment"># åå‘ä¼ æ’­æ›´æ–°å‚æ•°</span><br><br>        <span class="hljs-variable language_">self</span>.optimizer.step()<br><br>  <br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.count % <span class="hljs-variable language_">self</span>.target_update == <span class="hljs-number">0</span>:<br><br>            <span class="hljs-variable language_">self</span>.target_q_net.load_state_dict(<br><br>                <span class="hljs-variable language_">self</span>.q_net.state_dict())  <span class="hljs-comment"># æ›´æ–°ç›®æ ‡ç½‘ç»œ</span><br><br>        <span class="hljs-variable language_">self</span>.count += <span class="hljs-number">1</span><br>lr = <span class="hljs-number">0.002</span><br><br>num_episodes = <span class="hljs-number">300</span><br><br>batch_size = <span class="hljs-number">128</span><br><br>gamma = <span class="hljs-number">0.97</span><br><br>epsilon = <span class="hljs-number">0.1</span><br><br>target_update = <span class="hljs-number">10</span><br><br>buffer_size = <span class="hljs-number">10000</span><br><br>minimal_size = <span class="hljs-number">500</span><br><br>device = torch.device(<span class="hljs-string">&#x27;cuda&#x27;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;cpu&#x27;</span>)<br><br>hidden_dim = <span class="hljs-number">128</span><br><br>  <br><br>env_name = <span class="hljs-string">&#x27;CartPole-v0&#x27;</span><br><br>env = gym.make(<span class="hljs-string">&#x27;CartPole-v0&#x27;</span>)<br><br>env = gym.make(env_name)<br><br>random.seed(<span class="hljs-number">0</span>) <span class="hljs-comment">#è®¾ç½®éšæœºç§å­</span><br><br>np.random.seed(<span class="hljs-number">0</span>) <span class="hljs-comment">#è®¾ç½®éšæœºç§å­</span><br><br>env.seed(<span class="hljs-number">0</span>) <span class="hljs-comment">#è®¾ç½®éšæœºç§å­</span><br><br>torch.manual_seed(<span class="hljs-number">0</span>)<br><br>replay_buffer = ReplayBuffer(buffer_size) <span class="hljs-comment">#ç»éªŒå›æ”¾æ±   </span><br><br>state_dim = env.observation_space.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment">#çŠ¶æ€ç»´åº¦</span><br><br>action_dim = env.action_space.n  <span class="hljs-comment">#åŠ¨ä½œç»´åº¦  </span><br><br>agent = DQN(state_dim, hidden_dim, action_dim, lr, gamma, epsilon,<br><br>            target_update, device)  <span class="hljs-comment">#DQNç®—æ³•</span><br><br>  <br><br>return_list = []<br><br>  <br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br><br>    <span class="hljs-keyword">with</span> tqdm(total=<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>), desc=<span class="hljs-string">&#x27;Iteration %d&#x27;</span> % i) <span class="hljs-keyword">as</span> pbar:<br><br>        <span class="hljs-keyword">for</span> i_episode <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>)):<br><br>            episode_return = <span class="hljs-number">0</span><br><br>            state = env.reset()<br><br>            done = <span class="hljs-literal">False</span><br><br>            <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> done:<br><br>                env.render()<br><br>                action = agent.take_action(state)<br><br>                next_state, reward, done, _ = env.step(action)<br><br>                replay_buffer.add(state, action, reward, next_state, done)<br><br>                state = next_state<br><br>                episode_return += reward<br><br>                <span class="hljs-comment"># å½“bufferæ•°æ®çš„æ•°é‡è¶…è¿‡ä¸€å®šå€¼å,æ‰è¿›è¡ŒQç½‘ç»œè®­ç»ƒ</span><br><br>                <span class="hljs-keyword">if</span> replay_buffer.size() &gt; minimal_size:<br><br>                    b_s, b_a, b_r, b_ns, b_d = replay_buffer.sample(batch_size)<br><br>                    transition_dict = &#123;<br><br>                        <span class="hljs-string">&#x27;states&#x27;</span>: b_s,<br><br>                        <span class="hljs-string">&#x27;actions&#x27;</span>: b_a,<br><br>                        <span class="hljs-string">&#x27;next_states&#x27;</span>: b_ns,<br><br>                        <span class="hljs-string">&#x27;rewards&#x27;</span>: b_r,<br><br>                        <span class="hljs-string">&#x27;dones&#x27;</span>: b_d<br><br>                    &#125;<br><br>                    agent.update(transition_dict)<br><br>            return_list.append(episode_return)<br><br>            <span class="hljs-keyword">if</span> (i_episode + <span class="hljs-number">1</span>) % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:<br><br>                pbar.set_postfix(&#123;<br><br>                    <span class="hljs-string">&#x27;episode&#x27;</span>:<br><br>                    <span class="hljs-string">&#x27;%d&#x27;</span> % (num_episodes / <span class="hljs-number">10</span> * i + i_episode + <span class="hljs-number">1</span>),<br><br>                    <span class="hljs-string">&#x27;return&#x27;</span>:<br><br>                    <span class="hljs-string">&#x27;%.3f&#x27;</span> % np.mean(return_list[-<span class="hljs-number">10</span>:])<br><br>                &#125;)<br><br>            pbar.update(<span class="hljs-number">1</span>)<br><br>env.close()            <br><br>episodes_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(return_list)))<br><br>plt.plot(episodes_list, return_list)<br><br>plt.xlabel(<span class="hljs-string">&#x27;Episodes&#x27;</span>)<br><br>plt.ylabel(<span class="hljs-string">&#x27;Returns&#x27;</span>)<br><br>plt.title(<span class="hljs-string">&#x27;DQN on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(env_name))<br><br>plt.show()<br><br>  <br><br>mv_return = rl_utils.moving_average(return_list, <span class="hljs-number">9</span>)<br><br>plt.plot(episodes_list, mv_return)<br><br>plt.xlabel(<span class="hljs-string">&#x27;Episodes&#x27;</span>)<br><br>plt.ylabel(<span class="hljs-string">&#x27;Returns&#x27;</span>)<br><br>plt.title(<span class="hljs-string">&#x27;DQN on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(env_name))<br><br>plt.show()<br></code></pre></td></tr></table></figure><p><img src="/image/RL-63.png"></p><h1 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4 æ€»ç»“"></a>4 æ€»ç»“</h1><p>ç»†çœ‹ä»£ç å®ç°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ·±åº¦å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
      <tag>æ·±åº¦å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-5 Dyan-Q</title>
    <link href="/2024/08/21/RL-5/"/>
    <url>/2024/08/21/RL-5/</url>
    
    <content type="html"><![CDATA[<p>#å¼ºåŒ–å­¦ä¹  </p><h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h1><p>åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œâ€œæ¨¡å‹â€é€šå¸¸æŒ‡ä¸æ™ºèƒ½ä½“äº¤äº’çš„ç¯å¢ƒæ¨¡å‹ï¼Œå³å¯¹ç¯å¢ƒçš„çŠ¶æ€è½¬ç§»æ¦‚ç‡å’Œå¥–åŠ±å‡½æ•°è¿›è¡Œå»ºæ¨¡ã€‚æ ¹æ®æ˜¯å¦å…·æœ‰ç¯å¢ƒæ¨¡å‹ï¼Œå¼ºåŒ–å­¦ä¹ ç®—æ³•åˆ†ä¸ºä¸¤ç§ï¼š<strong>åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ </strong>ï¼ˆmodel-based reinforcement learningï¼‰å’Œ<strong>æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ </strong>ï¼ˆmodel-free reinforcement learningï¼‰ã€‚æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ ¹æ®æ™ºèƒ½ä½“ä¸ç¯å¢ƒäº¤äº’é‡‡æ ·åˆ°çš„æ•°æ®ç›´æ¥è¿›è¡Œç­–ç•¥æå‡æˆ–è€…ä»·å€¼ä¼°è®¡ï¼Œç¬¬ 5 ç« è®¨è®ºçš„ä¸¤ç§æ—¶åºå·®åˆ†ç®—æ³•ï¼Œå³ Sarsa å’Œ Q-learning ç®—æ³•ï¼Œä¾¿æ˜¯ä¸¤ç§æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•ï¼Œæœ¬ä¹¦åœ¨åç»­ç« èŠ‚ä¸­å°†è¦ä»‹ç»çš„æ–¹æ³•ä¹Ÿå¤§å¤šæ˜¯æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚åœ¨åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œæ¨¡å‹å¯ä»¥æ˜¯äº‹å…ˆçŸ¥é“çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ ¹æ®æ™ºèƒ½ä½“ä¸ç¯å¢ƒäº¤äº’é‡‡æ ·åˆ°çš„æ•°æ®å­¦ä¹ å¾—åˆ°çš„ï¼Œç„¶åç”¨è¿™ä¸ªæ¨¡å‹å¸®åŠ©ç­–ç•¥æå‡æˆ–è€…ä»·å€¼ä¼°è®¡ã€‚ç¬¬ 4 ç« è®¨è®ºçš„ä¸¤ç§åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œå³ç­–ç•¥è¿­ä»£å’Œä»·å€¼è¿­ä»£ï¼Œåˆ™æ˜¯åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•ï¼Œåœ¨è¿™ä¸¤ç§ç®—æ³•ä¸­ç¯å¢ƒæ¨¡å‹æ˜¯äº‹å…ˆå·²çŸ¥çš„ã€‚æœ¬ç« å³å°†ä»‹ç»çš„ Dyna-Q ç®—æ³•ä¹Ÿæ˜¯éå¸¸åŸºç¡€çš„åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼Œä¸è¿‡å®ƒçš„ç¯å¢ƒæ¨¡å‹æ˜¯é€šè¿‡é‡‡æ ·æ•°æ®ä¼°è®¡å¾—åˆ°çš„ã€‚</p><p>å¼ºåŒ–å­¦ä¹ ç®—æ³•æœ‰ä¸¤ä¸ªé‡è¦çš„è¯„ä»·æŒ‡æ ‡ï¼šä¸€ä¸ªæ˜¯ç®—æ³•æ”¶æ•›åçš„ç­–ç•¥åœ¨åˆå§‹çŠ¶æ€ä¸‹çš„æœŸæœ›å›æŠ¥ï¼Œå¦ä¸€ä¸ªæ˜¯æ ·æœ¬å¤æ‚åº¦ï¼Œå³ç®—æ³•è¾¾åˆ°æ”¶æ•›ç»“æœéœ€è¦åœ¨çœŸå®ç¯å¢ƒä¸­é‡‡æ ·çš„æ ·æœ¬æ•°é‡ã€‚åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ç”±äºå…·æœ‰ä¸€ä¸ªç¯å¢ƒæ¨¡å‹ï¼Œæ™ºèƒ½ä½“å¯ä»¥é¢å¤–å’Œç¯å¢ƒæ¨¡å‹è¿›è¡Œäº¤äº’ï¼Œå¯¹çœŸå®ç¯å¢ƒä¸­æ ·æœ¬çš„éœ€æ±‚é‡å¾€å¾€å°±ä¼šå‡å°‘ï¼Œå› æ­¤é€šå¸¸ä¼šæ¯”æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•å…·æœ‰æ›´ä½çš„æ ·æœ¬å¤æ‚åº¦ã€‚ä½†æ˜¯ï¼Œç¯å¢ƒæ¨¡å‹å¯èƒ½å¹¶ä¸å‡†ç¡®ï¼Œä¸èƒ½å®Œå…¨ä»£æ›¿çœŸå®ç¯å¢ƒï¼Œå› æ­¤åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•æ”¶æ•›åå…¶ç­–ç•¥çš„æœŸæœ›å›æŠ¥å¯èƒ½ä¸å¦‚æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚</p><h1 id="2-Dyan-Q"><a href="#2-Dyan-Q" class="headerlink" title="2 Dyan-Q"></a>2 Dyan-Q</h1><p>Dyna-Q ç®—æ³•æ˜¯ä¸€ä¸ªç»å…¸çš„åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒDyna-Q ä½¿ç”¨ä¸€ç§å«åš Q-planning çš„æ–¹æ³•æ¥åŸºäºæ¨¡å‹ç”Ÿæˆä¸€äº›æ¨¡æ‹Ÿæ•°æ®ï¼Œç„¶åç”¨æ¨¡æ‹Ÿæ•°æ®å’ŒçœŸå®æ•°æ®ä¸€èµ·æ”¹è¿›ç­–ç•¥ã€‚Q-planning æ¯æ¬¡é€‰å–ä¸€ä¸ªæ›¾ç»è®¿é—®è¿‡çš„çŠ¶æ€sï¼Œé‡‡å–ä¸€ä¸ªæ›¾ç»åœ¨è¯¥çŠ¶æ€ä¸‹æ‰§è¡Œè¿‡çš„åŠ¨ä½œaï¼Œé€šè¿‡æ¨¡å‹å¾—åˆ°è½¬ç§»åçš„çŠ¶æ€sâ€™ä»¥åŠå¥–åŠ±aï¼Œå¹¶æ ¹æ®è¿™ä¸ªæ¨¡æ‹Ÿæ•°æ®$(s,a,r,sâ€™)$ï¼Œç”¨ Q-learning çš„æ›´æ–°æ–¹å¼æ¥æ›´æ–°åŠ¨ä½œä»·å€¼å‡½æ•°ã€‚<br><img src="/image/RL-51.png"><br><img src="/image/RL-52.png"><br>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¯æ¬¡ä¸ç¯å¢ƒè¿›è¡Œäº¤äº’æ‰§è¡Œä¸€æ¬¡ Q-learning ä¹‹åï¼ŒDyna-Q ä¼šåšæ¬¡ Q-planningã€‚å…¶ä¸­ Q-planning çš„æ¬¡æ•°Næ˜¯ä¸€ä¸ªäº‹å…ˆå¯ä»¥é€‰æ‹©çš„è¶…å‚æ•°ï¼Œå½“å…¶ä¸º 0 æ—¶å°±æ˜¯æ™®é€šçš„ Q-learningã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿° Dyna-Q ç®—æ³•æ˜¯æ‰§è¡Œåœ¨ä¸€ä¸ªç¦»æ•£å¹¶ä¸”ç¡®å®šçš„ç¯å¢ƒä¸­ï¼Œæ‰€ä»¥å½“çœ‹åˆ°ä¸€æ¡ç»éªŒæ•°æ®$(s,a,r,sâ€™)$æ—¶ï¼Œå¯ä»¥ç›´æ¥å¯¹æ¨¡å‹åšå‡ºæ›´æ–°ï¼Œå³$M(s,a)\leftarrow r,s^{\prime}$ã€‚</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">import</span> time<br><br>  <br>  <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CliffWalkingEnv</span>:<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, ncol, nrow</span>):<br><br>        <span class="hljs-variable language_">self</span>.nrow = nrow<br><br>        <span class="hljs-variable language_">self</span>.ncol = ncol<br><br>        <span class="hljs-variable language_">self</span>.x = <span class="hljs-number">0</span>  <span class="hljs-comment"># è®°å½•å½“å‰æ™ºèƒ½ä½“ä½ç½®çš„æ¨ªåæ ‡</span><br><br>        <span class="hljs-variable language_">self</span>.y = <span class="hljs-variable language_">self</span>.nrow - <span class="hljs-number">1</span>  <span class="hljs-comment"># è®°å½•å½“å‰æ™ºèƒ½ä½“ä½ç½®çš„çºµåæ ‡</span><br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self, action</span>):  <span class="hljs-comment"># å¤–éƒ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥æ”¹å˜å½“å‰ä½ç½®</span><br><br>        <span class="hljs-comment"># 4ç§åŠ¨ä½œ, change[0]:ä¸Š, change[1]:ä¸‹, change[2]:å·¦, change[3]:å³ã€‚åæ ‡ç³»åŸç‚¹(0,0)</span><br><br>        <span class="hljs-comment"># å®šä¹‰åœ¨å·¦ä¸Šè§’</span><br><br>        change = [[<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]]<br><br>        <span class="hljs-variable language_">self</span>.x = <span class="hljs-built_in">min</span>(<span class="hljs-variable language_">self</span>.ncol - <span class="hljs-number">1</span>, <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.x + change[action][<span class="hljs-number">0</span>]))  <span class="hljs-comment"># é™åˆ¶æ™ºèƒ½ä½“åœ¨åœ°å›¾å†…</span><br><br>        <span class="hljs-variable language_">self</span>.y = <span class="hljs-built_in">min</span>(<span class="hljs-variable language_">self</span>.nrow - <span class="hljs-number">1</span>, <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.y + change[action][<span class="hljs-number">1</span>])) <span class="hljs-comment"># é™åˆ¶æ™ºèƒ½ä½“åœ¨åœ°å›¾å†…</span><br><br>        next_state = <span class="hljs-variable language_">self</span>.y * <span class="hljs-variable language_">self</span>.ncol + <span class="hljs-variable language_">self</span>.x  <span class="hljs-comment"># è¿”å›ä¸‹ä¸€ä¸ªçŠ¶æ€</span><br><br>        reward = -<span class="hljs-number">1</span><br><br>        done = <span class="hljs-literal">False</span> <span class="hljs-comment"># ä»»åŠ¡æ˜¯å¦ç»“æŸ</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.y == <span class="hljs-variable language_">self</span>.nrow - <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-variable language_">self</span>.x &gt; <span class="hljs-number">0</span>:  <span class="hljs-comment"># ä¸‹ä¸€ä¸ªä½ç½®åœ¨æ‚¬å´–æˆ–è€…ç›®æ ‡</span><br><br>            done = <span class="hljs-literal">True</span> <span class="hljs-comment"># ä»»åŠ¡ç»“æŸ</span><br><br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.x != <span class="hljs-variable language_">self</span>.ncol - <span class="hljs-number">1</span>: <span class="hljs-comment"># å¦‚æœä¸‹ä¸€ä¸ªä½ç½®æ˜¯æ‚¬å´–</span><br><br>                reward = -<span class="hljs-number">100</span>  <span class="hljs-comment"># æ‚¬å´–å¤„çš„æƒ©ç½š</span><br><br>        <span class="hljs-keyword">return</span> next_state, reward, done<br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># å›å½’åˆå§‹çŠ¶æ€,èµ·ç‚¹åœ¨å·¦ä¸Šè§’</span><br><br>        <span class="hljs-variable language_">self</span>.x = <span class="hljs-number">0</span><br><br>        <span class="hljs-variable language_">self</span>.y = <span class="hljs-variable language_">self</span>.nrow - <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.y * <span class="hljs-variable language_">self</span>.ncol + <span class="hljs-variable language_">self</span>.x<br><br>  <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DynaQ</span>:<br><br>    <span class="hljs-string">&quot;&quot;&quot; Dyna-Qç®—æ³• &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 ncol,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 nrow,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 epsilon,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 alpha,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 gamma,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 n_planning,</span><br><span class="hljs-params"></span><br><span class="hljs-params">                 n_action=<span class="hljs-number">4</span></span>):<br><br>        <span class="hljs-variable language_">self</span>.Q_table = np.zeros([nrow * ncol, n_action])  <span class="hljs-comment"># åˆå§‹åŒ–Q(s,a)è¡¨æ ¼</span><br><br>        <span class="hljs-variable language_">self</span>.n_action = n_action  <span class="hljs-comment"># åŠ¨ä½œä¸ªæ•°</span><br><br>        <span class="hljs-variable language_">self</span>.alpha = alpha  <span class="hljs-comment"># å­¦ä¹ ç‡</span><br><br>        <span class="hljs-variable language_">self</span>.gamma = gamma  <span class="hljs-comment"># æŠ˜æ‰£å› å­</span><br><br>        <span class="hljs-variable language_">self</span>.epsilon = epsilon  <span class="hljs-comment"># epsilon-è´ªå©ªç­–ç•¥ä¸­çš„å‚æ•°</span><br><br>  <br><br>        <span class="hljs-variable language_">self</span>.n_planning = n_planning  <span class="hljs-comment">#æ‰§è¡ŒQ-planningçš„æ¬¡æ•°, å¯¹åº”1æ¬¡Q-learning</span><br><br>        <span class="hljs-variable language_">self</span>.model = <span class="hljs-built_in">dict</span>()  <span class="hljs-comment"># ç¯å¢ƒæ¨¡å‹</span><br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">take_action</span>(<span class="hljs-params">self, state</span>):  <span class="hljs-comment"># é€‰å–ä¸‹ä¸€æ­¥çš„æ“ä½œ</span><br><br>        <span class="hljs-keyword">if</span> np.random.random() &lt; <span class="hljs-variable language_">self</span>.epsilon:  <span class="hljs-comment"># epsilon-è´ªå©ªç­–ç•¥</span><br><br>            action = np.random.randint(<span class="hljs-variable language_">self</span>.n_action)<br><br>        <span class="hljs-keyword">else</span>:<br><br>            action = np.argmax(<span class="hljs-variable language_">self</span>.Q_table[state])<br><br>        <span class="hljs-keyword">return</span> action<br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">q_learning</span>(<span class="hljs-params">self, s0, a0, r, s1</span>): <span class="hljs-comment"># Q-learningç®—æ³•</span><br><br>        td_error = r + <span class="hljs-variable language_">self</span>.gamma * <span class="hljs-variable language_">self</span>.Q_table[s1].<span class="hljs-built_in">max</span>(<br><br>        ) - <span class="hljs-variable language_">self</span>.Q_table[s0, a0]<br><br>        <span class="hljs-variable language_">self</span>.Q_table[s0, a0] += <span class="hljs-variable language_">self</span>.alpha * td_error<br><br>  <br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, s0, a0, r, s1</span>): <span class="hljs-comment"># æ›´æ–°Qè¡¨æ ¼</span><br><br>        <span class="hljs-variable language_">self</span>.q_learning(s0, a0, r, s1)<br><br>        <span class="hljs-variable language_">self</span>.model[(s0, a0)] = r, s1  <span class="hljs-comment"># å°†æ•°æ®æ·»åŠ åˆ°æ¨¡å‹ä¸­</span><br><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.n_planning):  <span class="hljs-comment"># Q-planningå¾ªç¯</span><br><br>            <span class="hljs-comment"># éšæœºé€‰æ‹©æ›¾ç»é‡åˆ°è¿‡çš„çŠ¶æ€åŠ¨ä½œå¯¹</span><br><br>            (s, a), (r, s_) = random.choice(<span class="hljs-built_in">list</span>(<span class="hljs-variable language_">self</span>.model.items()))<br><br>            <span class="hljs-variable language_">self</span>.q_learning(s, a, r, s_)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">DynaQ_CliffWalking</span>(<span class="hljs-params">n_planning</span>):<br><br>    ncol = <span class="hljs-number">12</span><br><br>    nrow = <span class="hljs-number">4</span><br><br>    env = CliffWalkingEnv(ncol, nrow)<br><br>    epsilon = <span class="hljs-number">0.01</span><br><br>    alpha = <span class="hljs-number">0.1</span><br><br>    gamma = <span class="hljs-number">0.9</span><br><br>    agent = DynaQ(ncol, nrow, epsilon, alpha, gamma, n_planning)<br><br>    num_episodes = <span class="hljs-number">300</span>  <span class="hljs-comment"># æ™ºèƒ½ä½“åœ¨ç¯å¢ƒä¸­è¿è¡Œå¤šå°‘æ¡åºåˆ—</span><br><br>  <br><br>    return_list = []  <span class="hljs-comment"># è®°å½•æ¯ä¸€æ¡åºåˆ—çš„å›æŠ¥</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):  <span class="hljs-comment"># æ˜¾ç¤º10ä¸ªè¿›åº¦æ¡</span><br><br>        <span class="hljs-comment"># tqdmçš„è¿›åº¦æ¡åŠŸèƒ½</span><br><br>        <span class="hljs-keyword">with</span> tqdm(total=<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>),<br><br>                  desc=<span class="hljs-string">&#x27;Iteration %d&#x27;</span> % i) <span class="hljs-keyword">as</span> pbar:<br><br>            <span class="hljs-keyword">for</span> i_episode <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>)):  <span class="hljs-comment"># æ¯ä¸ªè¿›åº¦æ¡çš„åºåˆ—æ•°</span><br><br>                episode_return = <span class="hljs-number">0</span><br><br>                state = env.reset()<br><br>                done = <span class="hljs-literal">False</span><br><br>                <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> done:<br><br>                    action = agent.take_action(state)<br><br>                    next_state, reward, done = env.step(action)<br><br>                    episode_return += reward  <span class="hljs-comment"># è¿™é‡Œå›æŠ¥çš„è®¡ç®—ä¸è¿›è¡ŒæŠ˜æ‰£å› å­è¡°å‡</span><br><br>                    agent.update(state, action, reward, next_state)<br><br>                    state = next_state<br><br>                return_list.append(episode_return)<br><br>                <span class="hljs-keyword">if</span> (i_episode + <span class="hljs-number">1</span>) % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># æ¯10æ¡åºåˆ—æ‰“å°ä¸€ä¸‹è¿™10æ¡åºåˆ—çš„å¹³å‡å›æŠ¥</span><br><br>                    pbar.set_postfix(&#123;<br><br>                        <span class="hljs-string">&#x27;episode&#x27;</span>:<br><br>                        <span class="hljs-string">&#x27;%d&#x27;</span> % (num_episodes / <span class="hljs-number">10</span> * i + i_episode + <span class="hljs-number">1</span>),<br><br>                        <span class="hljs-string">&#x27;return&#x27;</span>:<br><br>                        <span class="hljs-string">&#x27;%.3f&#x27;</span> % np.mean(return_list[-<span class="hljs-number">10</span>:])<br><br>                    &#125;)<br><br>                pbar.update(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> return_list<br><br>  <br><br>np.random.seed(<span class="hljs-number">0</span>)<br><br>random.seed(<span class="hljs-number">0</span>)<br><br>n_planning_list = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">20</span>]<br><br><span class="hljs-keyword">for</span> n_planning <span class="hljs-keyword">in</span> n_planning_list:<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Q-planningæ­¥æ•°ä¸ºï¼š%d&#x27;</span> % n_planning)<br><br>    time.sleep(<span class="hljs-number">0.5</span>)<br><br>    return_list = DynaQ_CliffWalking(n_planning)<br><br>    episodes_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(return_list)))<br><br>    plt.plot(episodes_list,<br><br>             return_list,<br><br>             label=<span class="hljs-built_in">str</span>(n_planning) + <span class="hljs-string">&#x27; planning steps&#x27;</span>)<br><br>plt.legend()<br><br>plt.xlabel(<span class="hljs-string">&#x27;Episodes&#x27;</span>)<br><br>plt.ylabel(<span class="hljs-string">&#x27;Returns&#x27;</span>)<br><br>plt.title(<span class="hljs-string">&#x27;Dyna-Q on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;Cliff Walking&#x27;</span>))<br><br>plt.show()<br></code></pre></td></tr></table></figure><h1 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3 æ€»ç»“"></a>3 æ€»ç»“</h1><p>æœ¬ç« è®²è§£äº†ä¸€ä¸ªç»å…¸çš„åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³• Dyna-Qï¼Œå¹¶ä¸”é€šè¿‡è°ƒæ•´åœ¨æ‚¬å´–æ¼«æ­¥ç¯å¢ƒä¸‹çš„ Q-planning æ­¥æ•°ï¼Œç›´è§‚åœ°å±•ç¤ºäº† Q-planning æ­¥æ•°å¯¹äºæ”¶æ•›é€Ÿåº¦çš„å½±å“ã€‚æˆ‘ä»¬å‘ç°åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³• Dyna-Q åœ¨ä»¥ä¸Šç¯å¢ƒä¸­è·å¾—äº†å¾ˆå¥½çš„æ•ˆæœï¼Œä½†è¿™äº›ç¯å¢ƒæ¯”è¾ƒç®€å•ï¼Œæ¨¡å‹å¯ä»¥ç›´æ¥é€šè¿‡ç»éªŒæ•°æ®å¾—åˆ°ã€‚å¦‚æœç¯å¢ƒæ¯”è¾ƒå¤æ‚ï¼ŒçŠ¶æ€æ˜¯è¿ç»­çš„ï¼Œæˆ–è€…çŠ¶æ€è½¬ç§»æ˜¯éšæœºçš„è€Œä¸æ˜¯å†³å®šæ€§çš„ï¼Œå¦‚ä½•å­¦ä¹ ä¸€ä¸ªæ¯”è¾ƒå‡†ç¡®çš„æ¨¡å‹å°±å˜æˆéå¸¸é‡å¤§çš„æŒ‘æˆ˜ï¼Œè¿™ç›´æ¥å½±å“åˆ°åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•èƒ½å¦åº”ç”¨äºè¿™äº›ç¯å¢ƒå¹¶è·å¾—æ¯”æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ›´å¥½çš„æ•ˆæœã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-4 æ—¶åºå·®åˆ†ç®—æ³•</title>
    <link href="/2024/08/20/RL-4/"/>
    <url>/2024/08/20/RL-4/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h1><p>ä¸Šä¸€ç¯‡ä»‹ç»çš„åŠ¨æ€è§„åˆ’ç®—æ³•è¦æ±‚é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹æ˜¯å·²çŸ¥çš„ï¼Œå³è¦æ±‚ä¸æ™ºèƒ½ä½“äº¤äº’çš„ç¯å¢ƒæ˜¯å®Œå…¨å·²çŸ¥çš„ï¼ˆä¾‹å¦‚è¿·å®«æˆ–è€…ç»™å®šè§„åˆ™çš„ç½‘æ ¼ä¸–ç•Œï¼‰ã€‚åœ¨æ­¤æ¡ä»¶ä¸‹ï¼Œæ™ºèƒ½ä½“å…¶å®å¹¶ä¸éœ€è¦å’Œç¯å¢ƒçœŸæ­£äº¤äº’æ¥é‡‡æ ·æ•°æ®ï¼Œç›´æ¥ç”¨åŠ¨æ€è§„åˆ’ç®—æ³•å°±å¯ä»¥è§£å‡ºæœ€ä¼˜ä»·å€¼æˆ–ç­–ç•¥ã€‚è¿™å°±å¥½æ¯”å¯¹äºæœ‰ç›‘ç£å­¦ä¹ ä»»åŠ¡ï¼Œå¦‚æœç›´æ¥æ˜¾å¼ç»™å‡ºäº†æ•°æ®çš„åˆ†å¸ƒå…¬å¼ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥é€šè¿‡åœ¨æœŸæœ›å±‚é¢ä¸Šç›´æ¥æœ€å°åŒ–æ¨¡å‹çš„æ³›åŒ–è¯¯å·®æ¥æ›´æ–°æ¨¡å‹å‚æ•°ï¼Œå¹¶ä¸éœ€è¦é‡‡æ ·ä»»ä½•æ•°æ®ç‚¹ã€‚ä½†è¿™åœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹å¹¶ä¸ç°å®ï¼Œæœºå™¨å­¦ä¹ çš„ä¸»è¦æ–¹æ³•éƒ½æ˜¯åœ¨æ•°æ®åˆ†å¸ƒæœªçŸ¥çš„æƒ…å†µä¸‹é’ˆå¯¹å…·ä½“çš„æ•°æ®ç‚¹æ¥å¯¹æ¨¡å‹åšå‡ºæ›´æ–°çš„ã€‚å¯¹äºå¤§éƒ¨åˆ†å¼ºåŒ–å­¦ä¹ ç°å®åœºæ™¯ï¼ˆä¾‹å¦‚ç”µå­æ¸¸æˆæˆ–è€…ä¸€äº›å¤æ‚ç‰©ç†ç¯å¢ƒï¼‰ï¼Œå…¶é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹çš„çŠ¶æ€è½¬ç§»æ¦‚ç‡æ˜¯æ— æ³•å†™å‡ºæ¥çš„ï¼Œä¹Ÿå°±æ— æ³•ç›´æ¥è¿›è¡ŒåŠ¨æ€è§„åˆ’ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ™ºèƒ½ä½“åªèƒ½å’Œç¯å¢ƒè¿›è¡Œäº¤äº’ï¼Œé€šè¿‡é‡‡æ ·åˆ°çš„æ•°æ®æ¥å­¦ä¹ ï¼Œè¿™ç±»å­¦ä¹ æ–¹æ³•ç»Ÿç§°ä¸º<strong>æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ </strong>ï¼ˆmodel-free reinforcement learningï¼‰ã€‚<br>ä¸åŒäºåŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œæ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ä¸éœ€è¦äº‹å…ˆçŸ¥é“ç¯å¢ƒçš„å¥–åŠ±å‡½æ•°å’ŒçŠ¶æ€è½¬ç§»å‡½æ•°ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å’Œç¯å¢ƒäº¤äº’çš„è¿‡ç¨‹ä¸­é‡‡æ ·åˆ°çš„æ•°æ®æ¥å­¦ä¹ ï¼Œè¿™ä½¿å¾—å®ƒå¯ä»¥è¢«åº”ç”¨åˆ°ä¸€äº›ç®€å•çš„å®é™…åœºæ™¯ä¸­ã€‚æœ¬ç« å°†è¦è®²è§£æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸­çš„ä¸¤å¤§ç»å…¸ç®—æ³•ï¼šSarsa å’Œ Q-learningï¼Œå®ƒä»¬éƒ½æ˜¯åŸºäº<strong>æ—¶åºå·®åˆ†</strong>ï¼ˆtemporal differenceï¼ŒTDï¼‰çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚åŒæ—¶ï¼Œæœ¬ç« è¿˜ä¼šå¼•å…¥ä¸€ç»„æ¦‚å¿µï¼šåœ¨çº¿ç­–ç•¥å­¦ä¹ å’Œç¦»çº¿ç­–ç•¥å­¦ä¹ ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨çº¿ç­–ç•¥å­¦ä¹ è¦æ±‚ä½¿ç”¨åœ¨å½“å‰ç­–ç•¥ä¸‹é‡‡æ ·å¾—åˆ°çš„æ ·æœ¬è¿›è¡Œå­¦ä¹ ï¼Œä¸€æ—¦ç­–ç•¥è¢«æ›´æ–°ï¼Œå½“å‰çš„æ ·æœ¬å°±è¢«æ”¾å¼ƒäº†ï¼Œå°±å¥½åƒåœ¨æ°´é¾™å¤´ä¸‹ç”¨è‡ªæ¥æ°´æ´—æ‰‹ï¼›è€Œç¦»çº¿ç­–ç•¥å­¦ä¹ ä½¿ç”¨ç»éªŒå›æ”¾æ± å°†ä¹‹å‰é‡‡æ ·å¾—åˆ°çš„æ ·æœ¬æ”¶é›†èµ·æ¥å†æ¬¡åˆ©ç”¨ï¼Œå°±å¥½åƒä½¿ç”¨è„¸ç›†æ¥æ°´åæ´—æ‰‹ã€‚å› æ­¤ï¼Œç¦»çº¿ç­–ç•¥å­¦ä¹ å¾€å¾€èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨å†å²æ•°æ®ï¼Œå¹¶å…·æœ‰æ›´å°çš„æ ·æœ¬å¤æ‚åº¦ï¼ˆç®—æ³•è¾¾åˆ°æ”¶æ•›ç»“æœéœ€è¦åœ¨ç¯å¢ƒä¸­é‡‡æ ·çš„æ ·æœ¬æ•°é‡ï¼‰ï¼Œè¿™ä½¿å…¶è¢«æ›´å¹¿æ³›åœ°åº”ç”¨ã€‚</p><h1 id="2-æ—¶åºå·®åˆ†æ–¹æ³•"><a href="#2-æ—¶åºå·®åˆ†æ–¹æ³•" class="headerlink" title="2 æ—¶åºå·®åˆ†æ–¹æ³•"></a>2 æ—¶åºå·®åˆ†æ–¹æ³•</h1><p>æ—¶åºå·®åˆ†æ˜¯ä¸€ç§ç”¨æ¥ä¼°è®¡ä¸€ä¸ªç­–ç•¥çš„ä»·å€¼å‡½æ•°çš„æ–¹æ³•ï¼Œå®ƒç»“åˆäº†è’™ç‰¹å¡æ´›å’ŒåŠ¨æ€è§„åˆ’ç®—æ³•çš„æ€æƒ³ã€‚æ—¶åºå·®åˆ†æ–¹æ³•å’Œè’™ç‰¹å¡æ´›çš„ç›¸ä¼¼ä¹‹å¤„åœ¨äºå¯ä»¥ä»æ ·æœ¬æ•°æ®ä¸­å­¦ä¹ ï¼Œä¸éœ€è¦äº‹å…ˆçŸ¥é“ç¯å¢ƒï¼›å’ŒåŠ¨æ€è§„åˆ’çš„ç›¸ä¼¼ä¹‹å¤„åœ¨äºæ ¹æ®è´å°”æ›¼æ–¹ç¨‹çš„æ€æƒ³ï¼Œåˆ©ç”¨åç»­çŠ¶æ€çš„ä»·å€¼ä¼°è®¡æ¥æ›´æ–°å½“å‰çŠ¶æ€çš„ä»·å€¼ä¼°è®¡ã€‚å›é¡¾ä¸€ä¸‹è’™ç‰¹å¡æ´›æ–¹æ³•å¯¹ä»·å€¼å‡½æ•°çš„å¢é‡æ›´æ–°æ–¹å¼ï¼š<br>$V(s_t)\leftarrow V(s_t)+\alpha[G_t-V(s_t)]$<br>$\alpha$è¡¨ç¤ºæ›´æ–°çš„æ­¥é•¿ï¼Œå¯ä»¥å–å¸¸æ•°ï¼Œæ›´æ–°æ–¹å¼ä¸å†åƒè’™ç‰¹å¡æ´›æ–¹æ³•ä¸¥æ ¼åœ°å–æœŸæœ›ã€‚è’™ç‰¹å¡æ´›æ–¹æ³•å¿…é¡»è¦ç­‰æ•´ä¸ªåºåˆ—ç»“æŸä¹‹åæ‰èƒ½è®¡ç®—å¾—åˆ°è¿™ä¸€æ¬¡çš„å›æŠ¥$G_t$ï¼Œè€Œæ—¶åºå·®åˆ†æ–¹æ³•åªéœ€è¦å½“å‰æ­¥ç»“æŸå³å¯è¿›è¡Œè®¡ç®—ã€‚å…·ä½“æ¥è¯´ï¼Œæ—¶åºå·®åˆ†ç®—æ³•ç”¨å½“å‰è·å¾—çš„å¥–åŠ±åŠ ä¸Šä¸‹ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼ä¼°è®¡æ¥ä½œä¸ºåœ¨å½“å‰çŠ¶æ€ä¼šè·å¾—çš„å›æŠ¥ï¼Œå³ï¼š<br>$V(s_t)\leftarrow V(s_t)+\alpha[r_t+\gamma V(s_{t+1})-V(s_t)]$<br>$R_t+\gamma V(s_{t+1})-V(s_t)$é€šå¸¸è¢«ç§°ä¸ºæ—¶åºå·®åˆ†è¯¯å·®ï¼Œæ—¶åºå·®åˆ†ç®—æ³•å°†å…¶ä¸æ­¥é•¿çš„ä¹˜ç§¯ä½œä¸ºçŠ¶æ€ä»·å€¼çš„æ›´æ–°é‡ã€‚å¯ä»¥æ›¿ä»£$G_t$çš„åŸå› æ˜¯ï¼š<br>$$\begin{aligned}<br>V_{\pi}(s)&amp; &#x3D;\mathbb{E}<em>\pi[G_t|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}<em>\pi[\sum</em>{k&#x3D;0}^\infty\gamma^kR</em>{t+k}|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}<em>\pi[R_t+\gamma\sum</em>{k&#x3D;0}^\infty\gamma^kR_{t+k+1}|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}<em>\pi[R_t+\gamma V_\pi(S</em>{t+1})|S_t&#x3D;s]<br>\end{aligned}$$<br>å› æ­¤è’™ç‰¹å¡æ´›æ–¹æ³•å°†ä¸Šå¼ç¬¬ä¸€è¡Œä½œä¸ºæ›´æ–°çš„ç›®æ ‡ï¼Œè€Œæ—¶åºå·®åˆ†ç®—æ³•å°†ä¸Šå¼æœ€åä¸€è¡Œä½œä¸ºæ›´æ–°çš„ç›®æ ‡ã€‚äºæ˜¯ï¼Œåœ¨ç”¨ç­–ç•¥å’Œç¯å¢ƒäº¤äº’æ—¶ï¼Œæ¯é‡‡æ ·ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æ—¶åºå·®åˆ†ç®—æ³•æ¥æ›´æ–°çŠ¶æ€ä»·å€¼ä¼°è®¡ã€‚æ—¶åºå·®åˆ†ç®—æ³•ç”¨åˆ°äº†$V(s_{t+1})$çš„ä¼°è®¡å€¼ï¼Œå¯ä»¥è¯æ˜å®ƒæœ€ç»ˆæ”¶æ•›åˆ°ç­–ç•¥$\pi$çš„ä»·å€¼å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨æ­¤ä¸å¯¹æ­¤è¿›è¡Œå±•å¼€è¯´æ˜ã€‚</p><h1 id="3-Sarsaç®—æ³•"><a href="#3-Sarsaç®—æ³•" class="headerlink" title="3 Sarsaç®—æ³•"></a>3 Sarsaç®—æ³•</h1><p>æ—¢ç„¶æˆ‘ä»¬å¯ä»¥ç”¨æ—¶åºå·®åˆ†æ–¹æ³•æ¥ä¼°è®¡ä»·å€¼å‡½æ•°ï¼Œé‚£ä¸€ä¸ªå¾ˆè‡ªç„¶çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬èƒ½å¦ç”¨ç±»ä¼¼ç­–ç•¥è¿­ä»£çš„æ–¹æ³•æ¥è¿›è¡Œå¼ºåŒ–å­¦ä¹ ã€‚ç­–ç•¥è¯„ä¼°å·²ç»å¯ä»¥é€šè¿‡æ—¶åºå·®åˆ†ç®—æ³•å®ç°ï¼Œé‚£ä¹ˆåœ¨ä¸çŸ¥é“å¥–åŠ±å‡½æ•°å’ŒçŠ¶æ€è½¬ç§»å‡½æ•°çš„æƒ…å†µä¸‹è¯¥æ€ä¹ˆè¿›è¡Œç­–ç•¥æå‡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ—¶å¯ä»¥ç›´æ¥ç”¨æ—¶åºå·®åˆ†ç®—æ³•æ¥ä¼°è®¡åŠ¨ä½œä»·å€¼å‡½æ•°Qï¼š<br>$Q(s_t,a_t)\leftarrow Q(s_t,a_t)+\alpha[r_t+\gamma Q(s_{t+1},a_{t+1})-Q(s_t,a_t)]$<br>ç„¶åæˆ‘ä»¬ç”¨è´ªå©ªç®—æ³•æ¥é€‰å–åœ¨æŸä¸ªçŠ¶æ€ä¸‹åŠ¨ä½œä»·å€¼æœ€å¤§çš„é‚£ä¸ªåŠ¨ä½œã€‚è¿™æ ·ä¼¼ä¹å·²ç»å½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼šç”¨è´ªå©ªç®—æ³•æ ¹æ®åŠ¨ä½œä»·å€¼é€‰å–åŠ¨ä½œæ¥å’Œç¯å¢ƒäº¤äº’ï¼Œå†æ ¹æ®å¾—åˆ°çš„æ•°æ®ç”¨æ—¶åºå·®åˆ†ç®—æ³•æ›´æ–°åŠ¨ä½œä»·å€¼ä¼°è®¡ã€‚<br>éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼š<br>1 æ ·æœ¬é‡è¿‡å¤§ï¼Œä½†æ˜¯å¯ä»¥å¿½ç•¥ï¼Œå› ä¸ºç­–ç•¥æå‡å¯ä»¥åœ¨ç­–ç•¥è¯„ä¼°æœªå®Œå…¨è¿›è¡Œçš„æƒ…å†µä¸‹éƒ¨ç½²ã€‚<br>2 åœ¨ç­–ç•¥æå‡ä¸­ä¸€ç›´æ ¹æ®è´ªå©ªç®—æ³•å¾—åˆ°ä¸€ä¸ªç¡®å®šæ€§ç­–ç•¥ï¼Œå¯èƒ½å¯¼è‡´æŸäº›çŠ¶æ€åŠ¨ä½œå¯¹æ°¸è¿œæ²¡æœ‰å‡ºç°ï¼Œå¯¼è‡´æ— æ³•å¯¹å…¶åŠ¨ä½œä»·å€¼è¿›è¡Œä¼°è®¡ã€‚<br>å¦‚ä½•è§£å†³ï¼Ÿä¸ç”¨ç®€å•çš„è´ªå©ªç®—æ³•ï¼Œå°±åƒå‰æ–‡æ‰€è¯´çš„ï¼Œä½¿ç”¨$\epsilon$è´ªå©ªç­–ç•¥ï¼š<br>$$\pi(a|s)&#x3D;\begin{cases}\epsilon&#x2F;|\mathcal{A}|+1-\epsilon&amp;\textit{å¦‚æœ}a&#x3D;\arg\max_{a^{\prime}}Q(s,a^{\prime})\\epsilon&#x2F;|\mathcal{A}|&amp;\textit{å…¶ä»–åŠ¨ä½œ}\end{cases}$$<br>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå®é™…çš„åŸºäºæ—¶åºå·®åˆ†æ–¹æ³•çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚è¿™ä¸ªç®—æ³•è¢«ç§°ä¸º Sarsaï¼Œå®ƒçš„åŠ¨ä½œä»·å€¼æ›´æ–°ç”¨åˆ°äº†s,a,r,ä»¥åŠä¸‹ä¸€ä¸ªçŠ¶æ€så’Œä¸‹ä¸€ä¸ªåŠ¨ä½œaã€‚<br><img src="/image/RL-41.png"><br>ç»§ç»­åœ¨æ‚¬å´–æ¼«æ­¥ç¯å¢ƒä¸‹éƒ¨ç½²ã€‚</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs pf">ncol = <span class="hljs-number">12</span><br>nrow = <span class="hljs-number">4</span><br>env = CliffWalkingEnv(ncol, nrow)<br>np.<span class="hljs-keyword">random</span>.seed(<span class="hljs-number">0</span>)<br>epsilon = <span class="hljs-number">0.1</span><br>alpha = <span class="hljs-number">0.1</span><br>gamma = <span class="hljs-number">0.9</span><br>agent = Sarsa(ncol, nrow, epsilon, alpha, gamma)<br>num_episodes = <span class="hljs-number">500</span>  <span class="hljs-comment"># æ™ºèƒ½ä½“åœ¨ç¯å¢ƒä¸­è¿è¡Œçš„åºåˆ—çš„æ•°é‡</span><br><br>return_list = []  <span class="hljs-comment"># è®°å½•æ¯ä¸€æ¡åºåˆ—çš„å›æŠ¥</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):  <span class="hljs-comment"># æ˜¾ç¤º10ä¸ªè¿›åº¦æ¡</span><br>    <span class="hljs-comment"># tqdmçš„è¿›åº¦æ¡åŠŸèƒ½</span><br>    with tqdm(total=int(num_episodes / <span class="hljs-number">10</span>), desc=&#x27;Iteration %d&#x27; % i) as pbar:<br>        <span class="hljs-keyword">for</span> i_episode <span class="hljs-keyword">in</span> range(int(num_episodes / <span class="hljs-number">10</span>)):  <span class="hljs-comment"># æ¯ä¸ªè¿›åº¦æ¡çš„åºåˆ—æ•°</span><br>            episode_return = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">state</span> = env.reset()<br>            action = agent.take_action(<span class="hljs-keyword">state</span>)<br>            done = False<br>            while not done:<br>                next_state, reward, done = env.step(action)<br>                next_action = agent.take_action(next_state)<br>                episode_return += reward  <span class="hljs-comment"># è¿™é‡Œå›æŠ¥çš„è®¡ç®—ä¸è¿›è¡ŒæŠ˜æ‰£å› å­è¡°å‡</span><br>                agent.update(<span class="hljs-keyword">state</span>, action, reward, next_state, next_action)<br>                <span class="hljs-keyword">state</span> = next_state<br>                action = next_action<br>            return_list.append(episode_return)<br>            if (i_episode + <span class="hljs-number">1</span>) % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># æ¯10æ¡åºåˆ—æ‰“å°ä¸€ä¸‹è¿™10æ¡åºåˆ—çš„å¹³å‡å›æŠ¥</span><br>                pbar.set_postfix(&#123;<br>                    &#x27;episode&#x27;:<br>                    &#x27;%d&#x27; % (num_episodes / <span class="hljs-number">10</span> * i + i_episode + <span class="hljs-number">1</span>),<br>                    &#x27;return&#x27;:<br>                    &#x27;%.<span class="hljs-number">3</span>f&#x27; % np.mean(return_list[-<span class="hljs-number">10</span>:])<br>                &#125;)<br>            pbar.update(<span class="hljs-number">1</span>)<br><br>episodes_list = list(range(len(return_list)))<br>plt.plot(episodes_list, return_list)<br>plt.xlabel(&#x27;Episodes&#x27;)<br>plt.ylabel(&#x27;Returns&#x27;)<br>plt.title(&#x27;Sarsa <span class="hljs-keyword">on</span> &#123;&#125;&#x27;.format(&#x27;Cliff Walking&#x27;))<br>plt.show()<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ï¼Œéšç€è®­ç»ƒçš„è¿›è¡Œï¼ŒSarsa ç®—æ³•è·å¾—çš„å›æŠ¥è¶Šæ¥è¶Šé«˜ã€‚åœ¨è¿›è¡Œ 500 æ¡åºåˆ—çš„å­¦ä¹ åï¼Œå¯ä»¥è·å¾— âˆ’20 å·¦å³çš„å›æŠ¥ï¼Œæ­¤æ—¶å·²ç»éå¸¸æ¥è¿‘æœ€ä¼˜ç­–ç•¥äº†ã€‚ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹ Sarsa ç®—æ³•å¾—åˆ°çš„ç­–ç•¥åœ¨å„ä¸ªçŠ¶æ€ä¸‹ä¼šä½¿æ™ºèƒ½ä½“é‡‡å–ä»€ä¹ˆæ ·çš„åŠ¨ä½œã€‚</p><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs routeros">def print_agent(agent, env, action_meaning, disaster=[], end=[]):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(env.nrow):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(env.ncol):<br>            <span class="hljs-keyword">if</span> (i * env.ncol + j) <span class="hljs-keyword">in</span> disaster:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;****&#x27;</span>, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27; &#x27;</span>)<br>            elif (i * env.ncol + j) <span class="hljs-keyword">in</span> end:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;EEEE&#x27;</span>, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27; &#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                a = agent.best_action(i * env.ncol + j)<br>                pi_str = <span class="hljs-string">&#x27;&#x27;</span><br>                <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> range(len(action_meaning)):<br>                    pi_str += action_meaning[k] <span class="hljs-keyword">if</span> a[k] &gt; 0 <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;o&#x27;</span><br>                <span class="hljs-built_in">print</span>(pi_str, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27; &#x27;</span>)<br>        <span class="hljs-built_in">print</span>()<br><br><br>action_meaning = [<span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Sarsaç®—æ³•æœ€ç»ˆæ”¶æ•›å¾—åˆ°çš„ç­–ç•¥ä¸ºï¼š&#x27;</span>)<br>print_agent(agent, env, action_meaning, list(range(37, 47)), [47])<br></code></pre></td></tr></table></figure><h1 id="4-å¤šæ­¥Sarsaç®—æ³•"><a href="#4-å¤šæ­¥Sarsaç®—æ³•" class="headerlink" title="4 å¤šæ­¥Sarsaç®—æ³•"></a>4 å¤šæ­¥Sarsaç®—æ³•</h1><p>è’™ç‰¹å¡æ´›æ–¹æ³•åˆ©ç”¨å½“å‰çŠ¶æ€ä¹‹åæ¯ä¸€æ­¥çš„å¥–åŠ±è€Œä¸ä½¿ç”¨ä»»ä½•ä»·å€¼ä¼°è®¡ï¼Œæ—¶åºå·®åˆ†ç®—æ³•åªåˆ©ç”¨ä¸€æ­¥å¥–åŠ±å’Œä¸‹ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼ä¼°è®¡ã€‚é‚£å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ€»çš„æ¥è¯´ï¼Œè’™ç‰¹å¡æ´›æ–¹æ³•æ˜¯<strong>æ— å</strong>ï¼ˆunbiasedï¼‰çš„ï¼Œä½†æ˜¯å…·æœ‰æ¯”è¾ƒå¤§çš„æ–¹å·®ï¼Œå› ä¸ºæ¯ä¸€æ­¥çš„çŠ¶æ€è½¬ç§»éƒ½æœ‰ä¸ç¡®å®šæ€§ï¼Œè€Œæ¯ä¸€æ­¥çŠ¶æ€é‡‡å–çš„åŠ¨ä½œæ‰€å¾—åˆ°çš„ä¸ä¸€æ ·çš„å¥–åŠ±æœ€ç»ˆéƒ½ä¼šåŠ èµ·æ¥ï¼Œè¿™ä¼šæå¤§å½±å“æœ€ç»ˆçš„ä»·å€¼ä¼°è®¡ï¼›æ—¶åºå·®åˆ†ç®—æ³•å…·æœ‰éå¸¸å°çš„æ–¹å·®ï¼Œå› ä¸ºåªå…³æ³¨äº†ä¸€æ­¥çŠ¶æ€è½¬ç§»ï¼Œç”¨åˆ°äº†ä¸€æ­¥çš„å¥–åŠ±ï¼Œä½†æ˜¯å®ƒæ˜¯æœ‰åçš„ï¼Œå› ä¸ºç”¨åˆ°äº†ä¸‹ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼ä¼°è®¡è€Œä¸æ˜¯å…¶çœŸå®çš„ä»·å€¼ã€‚é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ç»“åˆäºŒè€…çš„ä¼˜åŠ¿å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>å¤šæ­¥æ—¶åºå·®åˆ†</strong>ï¼å¤šæ­¥æ—¶åºå·®åˆ†çš„æ„æ€æ˜¯ä½¿ç”¨æ­¥çš„å¥–åŠ±ï¼Œç„¶åä½¿ç”¨ä¹‹åçŠ¶æ€çš„ä»·å€¼ä¼°è®¡ã€‚ç”¨å…¬å¼è¡¨ç¤ºï¼Œ<strong>å°†</strong><br>$G_t&#x3D;r_t+\gamma Q(s_{t+1},a_{t+1})$<br>æ¢æˆ<br>$G_t&#x3D;r_t+\gamma r_{t+1}+\cdots+\gamma^nQ(s_{t+n},a_{t+n})$<br>äºæ˜¯ï¼Œç›¸åº”å­˜åœ¨ä¸€ç§å¤šæ­¥ Sarsa ç®—æ³•ï¼Œå®ƒæŠŠ Sarsa ç®—æ³•ä¸­çš„åŠ¨ä½œä»·å€¼å‡½æ•°çš„æ›´æ–°å…¬å¼<br>$Q(s_t,a_t)\leftarrow Q(s_t,a_t)+\alpha[r_t+\gamma Q(s_{t+1},a_{t+1})-Q(s_t,a_t)]$<br>æ›¿æ¢æˆ<br>$Q(s_t,a_t)\leftarrow Q(s_t,a_t)+\alpha[r_t+\gamma r_{t+1}+\cdots+\gamma^nQ(s_{t+n},a_{t+n})-Q(s_t,a_t)]$</p><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">nstep_Sarsa</span>:<br>    <span class="hljs-string">&quot;&quot;&quot; næ­¥Sarsaç®—æ³• &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n, ncol, nrow, epsilon, alpha, gamma, n_action=<span class="hljs-number">4</span></span>):<br>        <span class="hljs-variable language_">self</span>.Q_table = np.zeros([nrow * ncol, n_action])<br>        <span class="hljs-variable language_">self</span>.n_action = n_action<br>        <span class="hljs-variable language_">self</span>.alpha = alpha<br>        <span class="hljs-variable language_">self</span>.gamma = gamma<br>        <span class="hljs-variable language_">self</span>.epsilon = epsilon<br>        <span class="hljs-variable language_">self</span>.n = n  <span class="hljs-comment"># é‡‡ç”¨næ­¥Sarsaç®—æ³•</span><br>        <span class="hljs-variable language_">self</span>.state_list = []  <span class="hljs-comment"># ä¿å­˜ä¹‹å‰çš„çŠ¶æ€</span><br>        <span class="hljs-variable language_">self</span>.action_list = []  <span class="hljs-comment"># ä¿å­˜ä¹‹å‰çš„åŠ¨ä½œ</span><br>        <span class="hljs-variable language_">self</span>.reward_list = []  <span class="hljs-comment"># ä¿å­˜ä¹‹å‰çš„å¥–åŠ±</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">take_action</span>(<span class="hljs-params">self, state</span>):<br>        <span class="hljs-keyword">if</span> np.random.random() &lt; <span class="hljs-variable language_">self</span>.epsilon:<br>            action = np.random.randint(<span class="hljs-variable language_">self</span>.n_action)<br>        <span class="hljs-keyword">else</span>:<br>            action = np.argmax(<span class="hljs-variable language_">self</span>.Q_table[state])<br>        <span class="hljs-keyword">return</span> action<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">best_action</span>(<span class="hljs-params">self, state</span>):  <span class="hljs-comment"># ç”¨äºæ‰“å°ç­–ç•¥</span><br>        Q_max = np.<span class="hljs-built_in">max</span>(<span class="hljs-variable language_">self</span>.Q_table[state])<br>        a = [<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.n_action)]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.n_action):<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.Q_table[state, i] == Q_max:<br>                a[i] = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> a<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, s0, a0, r, s1, a1, done</span>):<br>        <span class="hljs-variable language_">self</span>.state_list.append(s0)<br>        <span class="hljs-variable language_">self</span>.action_list.append(a0)<br>        <span class="hljs-variable language_">self</span>.reward_list.append(r)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.state_list) == <span class="hljs-variable language_">self</span>.n:  <span class="hljs-comment"># è‹¥ä¿å­˜çš„æ•°æ®å¯ä»¥è¿›è¡Œnæ­¥æ›´æ–°</span><br>            G = <span class="hljs-variable language_">self</span>.Q_table[s1, a1]  <span class="hljs-comment"># å¾—åˆ°Q(s_&#123;t+n&#125;, a_&#123;t+n&#125;)</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(<span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.n)):<br>                G = <span class="hljs-variable language_">self</span>.gamma * G + <span class="hljs-variable language_">self</span>.reward_list[i]  <span class="hljs-comment"># ä¸æ–­å‘å‰è®¡ç®—æ¯ä¸€æ­¥çš„å›æŠ¥</span><br>                <span class="hljs-comment"># å¦‚æœåˆ°è¾¾ç»ˆæ­¢çŠ¶æ€,æœ€åå‡ æ­¥è™½ç„¶é•¿åº¦ä¸å¤Ÿnæ­¥,ä¹Ÿå°†å…¶è¿›è¡Œæ›´æ–°</span><br>                <span class="hljs-keyword">if</span> done <span class="hljs-keyword">and</span> i &gt; <span class="hljs-number">0</span>:<br>                    s = <span class="hljs-variable language_">self</span>.state_list[i]<br>                    a = <span class="hljs-variable language_">self</span>.action_list[i]<br>                    <span class="hljs-variable language_">self</span>.Q_table[s, a] += <span class="hljs-variable language_">self</span>.alpha * (G - <span class="hljs-variable language_">self</span>.Q_table[s, a])<br>            s = <span class="hljs-variable language_">self</span>.state_list.pop(<span class="hljs-number">0</span>)  <span class="hljs-comment"># å°†éœ€è¦æ›´æ–°çš„çŠ¶æ€åŠ¨ä½œä»åˆ—è¡¨ä¸­åˆ é™¤,ä¸‹æ¬¡ä¸å¿…æ›´æ–°</span><br>            a = <span class="hljs-variable language_">self</span>.action_list.pop(<span class="hljs-number">0</span>)<br>            <span class="hljs-variable language_">self</span>.reward_list.pop(<span class="hljs-number">0</span>)<br>            <span class="hljs-comment"># næ­¥Sarsaçš„ä¸»è¦æ›´æ–°æ­¥éª¤</span><br>            <span class="hljs-variable language_">self</span>.Q_table[s, a] += <span class="hljs-variable language_">self</span>.alpha * (G - <span class="hljs-variable language_">self</span>.Q_table[s, a])<br>        <span class="hljs-keyword">if</span> done:  <span class="hljs-comment"># å¦‚æœåˆ°è¾¾ç»ˆæ­¢çŠ¶æ€,å³å°†å¼€å§‹ä¸‹ä¸€æ¡åºåˆ—,åˆ™å°†åˆ—è¡¨å…¨æ¸…ç©º</span><br>            <span class="hljs-variable language_">self</span>.state_list = []<br>            <span class="hljs-variable language_">self</span>.action_list = []<br>            <span class="hljs-variable language_">self</span>.reward_list = []<br>np.random.seed(<span class="hljs-number">0</span>)<br>n_step = <span class="hljs-number">5</span>  <span class="hljs-comment"># 5æ­¥Sarsaç®—æ³•</span><br>alpha = <span class="hljs-number">0.1</span><br>epsilon = <span class="hljs-number">0.1</span><br>gamma = <span class="hljs-number">0.9</span><br>agent = nstep_Sarsa(n_step, ncol, nrow, epsilon, alpha, gamma)<br>num_episodes = <span class="hljs-number">500</span>  <span class="hljs-comment"># æ™ºèƒ½ä½“åœ¨ç¯å¢ƒä¸­è¿è¡Œçš„åºåˆ—çš„æ•°é‡</span><br><br>return_list = []  <span class="hljs-comment"># è®°å½•æ¯ä¸€æ¡åºåˆ—çš„å›æŠ¥</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):  <span class="hljs-comment"># æ˜¾ç¤º10ä¸ªè¿›åº¦æ¡</span><br>    <span class="hljs-comment">#tqdmçš„è¿›åº¦æ¡åŠŸèƒ½</span><br>    <span class="hljs-keyword">with</span> tqdm(total=<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>), desc=<span class="hljs-string">&#x27;Iteration %d&#x27;</span> % i) <span class="hljs-keyword">as</span> pbar:<br>        <span class="hljs-keyword">for</span> i_episode <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>)):  <span class="hljs-comment"># æ¯ä¸ªè¿›åº¦æ¡çš„åºåˆ—æ•°</span><br>            episode_return = <span class="hljs-number">0</span><br>            state = env.reset()<br>            action = agent.take_action(state)<br>            done = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> done:<br>                next_state, reward, done = env.step(action)<br>                next_action = agent.take_action(next_state)<br>                episode_return += reward  <span class="hljs-comment"># è¿™é‡Œå›æŠ¥çš„è®¡ç®—ä¸è¿›è¡ŒæŠ˜æ‰£å› å­è¡°å‡</span><br>                agent.update(state, action, reward, next_state, next_action,<br>                             done)<br>                state = next_state<br>                action = next_action<br>            return_list.append(episode_return)<br>            <span class="hljs-keyword">if</span> (i_episode + <span class="hljs-number">1</span>) % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># æ¯10æ¡åºåˆ—æ‰“å°ä¸€ä¸‹è¿™10æ¡åºåˆ—çš„å¹³å‡å›æŠ¥</span><br>                pbar.set_postfix(&#123;<br>                    <span class="hljs-string">&#x27;episode&#x27;</span>:<br>                    <span class="hljs-string">&#x27;%d&#x27;</span> % (num_episodes / <span class="hljs-number">10</span> * i + i_episode + <span class="hljs-number">1</span>),<br>                    <span class="hljs-string">&#x27;return&#x27;</span>:<br>                    <span class="hljs-string">&#x27;%.3f&#x27;</span> % np.mean(return_list[-<span class="hljs-number">10</span>:])<br>                &#125;)<br>            pbar.update(<span class="hljs-number">1</span>)<br><br>episodes_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(return_list)))<br>plt.plot(episodes_list, return_list)<br>plt.xlabel(<span class="hljs-string">&#x27;Episodes&#x27;</span>)<br>plt.ylabel(<span class="hljs-string">&#x27;Returns&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;5-step Sarsa on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;Cliff Walking&#x27;</span>))<br>plt.show()<br></code></pre></td></tr></table></figure><h1 id="5-Q-learningç®—æ³•"><a href="#5-Q-learningç®—æ³•" class="headerlink" title="5 Q-learningç®—æ³•"></a>5 Q-learningç®—æ³•</h1><p>é™¤äº† Sarsaï¼Œè¿˜æœ‰ä¸€ç§éå¸¸è‘—åçš„åŸºäºæ—¶åºå·®åˆ†ç®—æ³•çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•â€”â€”Q-learningã€‚Q-learning å’Œ Sarsa çš„æœ€å¤§åŒºåˆ«åœ¨äº Q-learning çš„æ—¶åºå·®åˆ†æ›´æ–°æ–¹å¼ä¸º<br>$Q(s_t,a_t)\leftarrow Q(s_t,a_t)+\alpha[R_t+\gamma\max_aQ(s_{t+1},a)-Q(s_t,a_t)]$<br>ç®—æ³•æµç¨‹ï¼š<br><img src="/image/RL-42.png"><br>æˆ‘ä»¬å¯ä»¥ç”¨ä»·å€¼è¿­ä»£çš„æ€æƒ³æ¥ç†è§£ Q-learningï¼Œå³ Q-learning æ˜¯ç›´æ¥åœ¨ä¼°è®¡$Q^*$ï¼Œå› ä¸ºåŠ¨ä½œä»·å€¼å‡½æ•°çš„è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹æ˜¯:<br>$Q^*(s,a)&#x3D;r(s,a)+\gamma\sum_{s^{\prime}\in S}P(s^{\prime}|s,a)\max_{a^{\prime}}Q^*(s^{\prime},a^{\prime})$<br>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼ŒQ-learning çš„æ›´æ–°å¹¶éå¿…é¡»ä½¿ç”¨å½“å‰è´ªå¿ƒç­–ç•¥é‡‡æ ·å¾—åˆ°çš„æ•°æ®ï¼Œç»™å®šä»»æ„çš„$(s,a,r,sâ€™)$<br>éƒ½å¯ä»¥ç›´æ¥æ ¹æ®æ›´æ–°å…¬å¼æ¥æ›´æ–°Qã€‚æéƒ¨Sarsaç”¨çš„æ˜¯å½“å‰ç­–ç•¥åœ¨$sâ€™$çš„åŠ¨ä½œï¼Œæ˜¯åœ¨çº¿ç­–ç•¥ç®—æ³•ï¼ŒQ-learningæ˜¯ç¦»çº¿ç­–ç•¥ç®—æ³•ã€‚</p><h2 id="5-1åœ¨çº¿ç­–ç•¥ç®—æ³•ä¸ç¦»çº¿ç­–ç•¥ç®—æ³•"><a href="#5-1åœ¨çº¿ç­–ç•¥ç®—æ³•ä¸ç¦»çº¿ç­–ç•¥ç®—æ³•" class="headerlink" title="5.1åœ¨çº¿ç­–ç•¥ç®—æ³•ä¸ç¦»çº¿ç­–ç•¥ç®—æ³•"></a>5.1åœ¨çº¿ç­–ç•¥ç®—æ³•ä¸ç¦»çº¿ç­–ç•¥ç®—æ³•</h2><p>æˆ‘ä»¬ç§°é‡‡æ ·æ•°æ®çš„ç­–ç•¥ä¸º<strong>è¡Œä¸ºç­–ç•¥</strong>ï¼ˆbehavior policyï¼‰ï¼Œç§°ç”¨è¿™äº›æ•°æ®æ¥æ›´æ–°çš„ç­–ç•¥ä¸º<strong>ç›®æ ‡ç­–ç•¥</strong>ï¼ˆtarget policyï¼‰ã€‚åœ¨çº¿ç­–ç•¥ï¼ˆon-policyï¼‰ç®—æ³•è¡¨ç¤ºè¡Œä¸ºç­–ç•¥å’Œç›®æ ‡ç­–ç•¥æ˜¯åŒä¸€ä¸ªç­–ç•¥ï¼›è€Œç¦»çº¿ç­–ç•¥ï¼ˆoff-policyï¼‰ç®—æ³•è¡¨ç¤ºè¡Œä¸ºç­–ç•¥å’Œç›®æ ‡ç­–ç•¥ä¸æ˜¯åŒä¸€ä¸ªç­–ç•¥ã€‚Sarsa æ˜¯å…¸å‹çš„åœ¨çº¿ç­–ç•¥ç®—æ³•ï¼Œè€Œ Q-learning æ˜¯å…¸å‹çš„ç¦»çº¿ç­–ç•¥ç®—æ³•ã€‚åˆ¤æ–­äºŒè€…ç±»åˆ«çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µæ˜¯çœ‹è®¡ç®—æ—¶åºå·®åˆ†çš„ä»·å€¼ç›®æ ‡çš„æ•°æ®æ˜¯å¦æ¥è‡ªå½“å‰çš„ç­–ç•¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…·ä½“è€Œè¨€ï¼š</p><ul><li>å¯¹äº Sarsaï¼Œå®ƒçš„æ›´æ–°å…¬å¼å¿…é¡»ä½¿ç”¨æ¥è‡ªå½“å‰ç­–ç•¥é‡‡æ ·å¾—åˆ°çš„äº”å…ƒç»„$(s,a,r,sâ€™,aâ€™)$ï¼Œå› æ­¤å®ƒæ˜¯åœ¨çº¿ç­–ç•¥å­¦ä¹ æ–¹æ³•ï¼›</li><li>å¯¹äº Q-learningï¼Œå®ƒçš„æ›´æ–°å…¬å¼ä½¿ç”¨çš„æ˜¯å››å…ƒç»„$(s,a,r,sâ€™)$æ¥æ›´æ–°å½“å‰çŠ¶æ€åŠ¨ä½œå¯¹çš„ä»·å€¼$Q(s,a)$ï¼Œæ•°æ®ä¸­çš„så’Œaæ˜¯ç»™å®šçš„æ¡ä»¶ï¼Œrå’Œsâ€™çš†ç”±ç¯å¢ƒé‡‡æ ·å¾—åˆ°ï¼Œè¯¥å››å…ƒç»„å¹¶ä¸éœ€è¦ä¸€å®šæ˜¯å½“å‰ç­–ç•¥é‡‡æ ·å¾—åˆ°çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ¥è‡ªè¡Œä¸ºç­–ç•¥ï¼Œå› æ­¤å®ƒæ˜¯ç¦»çº¿ç­–ç•¥ç®—æ³•ã€‚<br><img src="/image/RL-43.png"></li></ul><h3 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QLearning</span>:<br>    <span class="hljs-string">&quot;&quot;&quot; Q-learningç®—æ³• &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, ncol, nrow, epsilon, alpha, gamma, n_action=<span class="hljs-number">4</span></span>):<br>        <span class="hljs-variable language_">self</span>.Q_table = np.zeros([nrow * ncol, n_action])  <span class="hljs-comment"># åˆå§‹åŒ–Q(s,a)è¡¨æ ¼</span><br>        <span class="hljs-variable language_">self</span>.n_action = n_action  <span class="hljs-comment"># åŠ¨ä½œä¸ªæ•°</span><br>        <span class="hljs-variable language_">self</span>.alpha = alpha  <span class="hljs-comment"># å­¦ä¹ ç‡</span><br>        <span class="hljs-variable language_">self</span>.gamma = gamma  <span class="hljs-comment"># æŠ˜æ‰£å› å­</span><br>        <span class="hljs-variable language_">self</span>.epsilon = epsilon  <span class="hljs-comment"># epsilon-è´ªå©ªç­–ç•¥ä¸­çš„å‚æ•°</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">take_action</span>(<span class="hljs-params">self, state</span>):  <span class="hljs-comment">#é€‰å–ä¸‹ä¸€æ­¥çš„æ“ä½œ</span><br>        <span class="hljs-keyword">if</span> np.random.random() &lt; <span class="hljs-variable language_">self</span>.epsilon:<br>            action = np.random.randint(<span class="hljs-variable language_">self</span>.n_action)<br>        <span class="hljs-keyword">else</span>:<br>            action = np.argmax(<span class="hljs-variable language_">self</span>.Q_table[state])<br>        <span class="hljs-keyword">return</span> action<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">best_action</span>(<span class="hljs-params">self, state</span>):  <span class="hljs-comment"># ç”¨äºæ‰“å°ç­–ç•¥</span><br>        Q_max = np.<span class="hljs-built_in">max</span>(<span class="hljs-variable language_">self</span>.Q_table[state])<br>        a = [<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.n_action)]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.n_action):<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.Q_table[state, i] == Q_max:<br>                a[i] = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> a<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, s0, a0, r, s1</span>):<br>        td_error = r + <span class="hljs-variable language_">self</span>.gamma * <span class="hljs-variable language_">self</span>.Q_table[s1].<span class="hljs-built_in">max</span>(<br>        ) - <span class="hljs-variable language_">self</span>.Q_table[s0, a0]<br>        <span class="hljs-variable language_">self</span>.Q_table[s0, a0] += <span class="hljs-variable language_">self</span>.alpha * td_error<br>        np.random.seed(<span class="hljs-number">0</span>)<br>epsilon = <span class="hljs-number">0.1</span><br>alpha = <span class="hljs-number">0.1</span><br>gamma = <span class="hljs-number">0.9</span><br>agent = QLearning(ncol, nrow, epsilon, alpha, gamma)<br>num_episodes = <span class="hljs-number">500</span>  <span class="hljs-comment"># æ™ºèƒ½ä½“åœ¨ç¯å¢ƒä¸­è¿è¡Œçš„åºåˆ—çš„æ•°é‡</span><br><br>return_list = []  <span class="hljs-comment"># è®°å½•æ¯ä¸€æ¡åºåˆ—çš„å›æŠ¥</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):  <span class="hljs-comment"># æ˜¾ç¤º10ä¸ªè¿›åº¦æ¡</span><br>    <span class="hljs-comment"># tqdmçš„è¿›åº¦æ¡åŠŸèƒ½</span><br>    <span class="hljs-keyword">with</span> tqdm(total=<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>), desc=<span class="hljs-string">&#x27;Iteration %d&#x27;</span> % i) <span class="hljs-keyword">as</span> pbar:<br>        <span class="hljs-keyword">for</span> i_episode <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(num_episodes / <span class="hljs-number">10</span>)):  <span class="hljs-comment"># æ¯ä¸ªè¿›åº¦æ¡çš„åºåˆ—æ•°</span><br>            episode_return = <span class="hljs-number">0</span><br>            state = env.reset()<br>            done = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> done:<br>                action = agent.take_action(state)<br>                next_state, reward, done = env.step(action)<br>                episode_return += reward  <span class="hljs-comment"># è¿™é‡Œå›æŠ¥çš„è®¡ç®—ä¸è¿›è¡ŒæŠ˜æ‰£å› å­è¡°å‡</span><br>                agent.update(state, action, reward, next_state)<br>                state = next_state<br>            return_list.append(episode_return)<br>            <span class="hljs-keyword">if</span> (i_episode + <span class="hljs-number">1</span>) % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># æ¯10æ¡åºåˆ—æ‰“å°ä¸€ä¸‹è¿™10æ¡åºåˆ—çš„å¹³å‡å›æŠ¥</span><br>                pbar.set_postfix(&#123;<br>                    <span class="hljs-string">&#x27;episode&#x27;</span>:<br>                    <span class="hljs-string">&#x27;%d&#x27;</span> % (num_episodes / <span class="hljs-number">10</span> * i + i_episode + <span class="hljs-number">1</span>),<br>                    <span class="hljs-string">&#x27;return&#x27;</span>:<br>                    <span class="hljs-string">&#x27;%.3f&#x27;</span> % np.mean(return_list[-<span class="hljs-number">10</span>:])<br>                &#125;)<br>            pbar.update(<span class="hljs-number">1</span>)<br><br>episodes_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(return_list)))<br>plt.plot(episodes_list, return_list)<br>plt.xlabel(<span class="hljs-string">&#x27;Episodes&#x27;</span>)<br>plt.ylabel(<span class="hljs-string">&#x27;Returns&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;Q-learning on &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;Cliff Walking&#x27;</span>))<br>plt.show()<br><br>action_meaning = [<span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Q-learningç®—æ³•æœ€ç»ˆæ”¶æ•›å¾—åˆ°çš„ç­–ç•¥ä¸ºï¼š&#x27;</span>)<br>print_agent(agent, env, action_meaning, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">37</span>, <span class="hljs-number">47</span>)), [<span class="hljs-number">47</span>])<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰“å°å‡ºæ¥çš„å›æŠ¥æ˜¯è¡Œä¸ºç­–ç•¥åœ¨ç¯å¢ƒä¸­äº¤äº’å¾—åˆ°çš„ï¼Œè€Œä¸æ˜¯ Q-learning ç®—æ³•åœ¨å­¦ä¹ çš„ç›®æ ‡ç­–ç•¥çš„çœŸå®å›æŠ¥ã€‚æˆ‘ä»¬æŠŠç›®æ ‡ç­–ç•¥çš„è¡Œä¸ºæ‰“å°å‡ºæ¥åï¼Œå‘ç°å…¶æ›´åå‘äºèµ°åœ¨æ‚¬å´–è¾¹ä¸Šï¼Œè¿™ä¸ Sarsa ç®—æ³•å¾—åˆ°çš„æ¯”è¾ƒä¿å®ˆçš„ç­–ç•¥ç›¸æ¯”æ˜¯æ›´ä¼˜çš„ã€‚ ä½†æ˜¯ä»”ç»†è§‚å¯Ÿ Sarsa å’Œ Q-learning åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„å›æŠ¥æ›²çº¿å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨ä¸€ä¸ªåºåˆ—ä¸­ Sarsa è·å¾—çš„æœŸæœ›å›æŠ¥æ˜¯é«˜äº Q-learning çš„ã€‚è¿™æ˜¯å› ä¸ºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ™ºèƒ½ä½“é‡‡å–åŸºäºå½“å‰$Q(s,a)$å‡½æ•°çš„$\epsilon$-è´ªå©ªç­–ç•¥æ¥å¹³è¡¡æ¢ç´¢ä¸åˆ©ç”¨ï¼ŒQ-learning ç®—æ³•ç”±äºæ²¿ç€æ‚¬å´–è¾¹èµ°ï¼Œä¼šä»¥ä¸€å®šæ¦‚ç‡æ¢ç´¢â€œæ‰å…¥æ‚¬å´–â€è¿™ä¸€åŠ¨ä½œï¼Œè€Œ Sarsa ç›¸å¯¹ä¿å®ˆçš„è·¯çº¿ä½¿æ™ºèƒ½ä½“å‡ ä¹ä¸å¯èƒ½æ‰å…¥æ‚¬å´–ã€‚</p><h1 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6 æ€»ç»“"></a>6 æ€»ç»“</h1><p>æœ¬ç« ä»‹ç»äº†æ— æ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸­çš„ä¸€ç§éå¸¸é‡è¦çš„ç®—æ³•â€”â€”æ—¶åºå·®åˆ†ç®—æ³•ã€‚æ—¶åºå·®åˆ†ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç”¨å¯¹æœªæ¥åŠ¨ä½œé€‰æ‹©çš„ä»·å€¼ä¼°è®¡æ¥æ›´æ–°å¯¹å½“å‰åŠ¨ä½œé€‰æ‹©çš„ä»·å€¼ä¼°è®¡ï¼Œè¿™æ˜¯å¼ºåŒ–å­¦ä¹ ä¸­çš„æ ¸å¿ƒæ€æƒ³ä¹‹ä¸€ã€‚æœ¬ç« é‡ç‚¹è®¨è®ºäº† Sarsa å’Œ Q-learning è¿™ä¸¤ä¸ªæœ€å…·æœ‰ä»£è¡¨æ€§çš„æ—¶åºå·®åˆ†ç®—æ³•ã€‚å½“ç¯å¢ƒæ˜¯æœ‰é™çŠ¶æ€é›†åˆå’Œæœ‰é™åŠ¨ä½œé›†åˆæ—¶ï¼Œè¿™ä¸¤ä¸ªç®—æ³•éå¸¸å¥½ç”¨ï¼Œå¯ä»¥æ ¹æ®ä»»åŠ¡æ˜¯å¦å…è®¸åœ¨çº¿ç­–ç•¥å­¦ä¹ æ¥å†³å®šä½¿ç”¨å“ªä¸€ä¸ªç®—æ³•ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡ç¦»çº¿ç­–ç•¥å­¦ä¹ å¯ä»¥è®©æ™ºèƒ½ä½“åŸºäºç»éªŒå›æ”¾æ± ä¸­çš„æ ·æœ¬æ¥å­¦ä¹ ï¼Œä½†éœ€è¦ä¿è¯æ™ºèƒ½ä½“åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å’Œç¯å¢ƒè¿›è¡Œäº¤äº’ï¼Œå°†é‡‡æ ·å¾—åˆ°çš„æœ€æ–°çš„ç»éªŒæ ·æœ¬åŠ å…¥ç»éªŒå›æ”¾æ± ä¸­ï¼Œä»è€Œä½¿ç»éªŒå›æ”¾æ± ä¸­æœ‰ä¸€å®šæ•°é‡çš„æ ·æœ¬å’Œå½“å‰æ™ºèƒ½ä½“ç­–ç•¥å¯¹åº”çš„æ•°æ®åˆ†å¸ƒä¿æŒå¾ˆè¿‘çš„è·ç¦»ã€‚å¦‚æœä¸å…è®¸æ™ºèƒ½ä½“åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å’Œç¯å¢ƒè¿›è¡ŒæŒç»­äº¤äº’ï¼Œè€Œæ˜¯å®Œå…¨åŸºäºä¸€ä¸ªç»™å®šçš„æ ·æœ¬é›†æ¥ç›´æ¥è®­ç»ƒä¸€ä¸ªç­–ç•¥ï¼Œè¿™æ ·çš„å­¦ä¹ èŒƒå¼è¢«ç§°ä¸º<strong>ç¦»çº¿å¼ºåŒ–å­¦ä¹ </strong>ï¼ˆoffline reinforcement learningï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jottings-1</title>
    <link href="/2024/08/20/jottings-1/"/>
    <url>/2024/08/20/jottings-1/</url>
    
    <content type="html"><![CDATA[<h1 id="æœ¬æ–‡å†™äº2024-8-7-23-11"><a href="#æœ¬æ–‡å†™äº2024-8-7-23-11" class="headerlink" title="æœ¬æ–‡å†™äº2024.8.7 23:11"></a>æœ¬æ–‡å†™äº2024.8.7 23:11</h1><p>22å²çš„æˆ‘æ¯”17å²åˆšä¸Šå¤§å­¦çš„æˆ‘å˜äº†å¥½å¤šã€‚<br> é•¿é«˜äº†å‡ å˜ç±³ï¼Œèªæ˜äº†ä¸€ç‚¹ç‚¹ï¼Œä¹Ÿé•¿å¤§äº†ä¸€ç‚¹ç‚¹ã€‚<br> æœ¬æ¥æ˜¯æƒ³å­¦æ–°é—»çš„ï¼Œå–œæ¬¢æ–‡å­—å·¥ä½œã€‚ä½†è«åå…¶å¦™é€‰åˆ°çš„äº†é€šä¿¡å·¥ç¨‹ä¸“ä¸šï¼Œä¸€å¼€å§‹ä¹Ÿä¸å¤ªä¼šä½†æ˜¯æ…¢æ…¢çš„ä¹Ÿå­¦è¿›å»äº†ï¼Œåæ¥åˆç»§ç»­è¯»ç›¸å…³ä¸“ä¸šçš„ç¡•å£«ç ”ç©¶ç”Ÿã€‚<br>æ…¢æ…¢åœ°ä¹Ÿæ˜ç™½äº†ï¼Œåšä»€ä¹ˆéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ‰ç›®æ ‡å°±æœ‰åŠ¨åŠ›ï¼Œæœ‰åŠ¨åŠ›å°±å¾ˆå……å®ï¼Œå……å®äº†å°±ä¸ä¼šä¹±æƒ³ã€‚<br>ä½†æ˜¯å¯¹æ–‡å­—çš„çƒ­çˆ±ä¾æ—§æ²¡æœ‰æ¶ˆå¤±ï¼Œåœ¨æ—¥æ¸å†·æ¼ çš„ç¤¾ä¼šç¯å¢ƒä¸‹é‡Œï¼Œæ–‡å­—ä¾æ—§èƒ½æ¸©æš–äººå¿ƒï¼Œå¸¦æ¥åŠ›é‡ã€‚<br>ç¥çœ‹å®Œè¿™æ®µæ–‡å­—çš„ä½ ä¿æŒå¹³å’Œï¼Œå¼€å¿ƒï¼Œæ˜å¤©çš„ä½ ä¼šæ›´å¥½ã€‚<br>é™„ä¸Šä¸€å¼ å°çŒ«å›¢å›¢çš„ç¾ç…§</p><p><img src="/image/jottings-13.jpg"></p><p>PSï¼šè‡ªä»åƒåƒï¼Œåä¸‰èµ°åæ¯å¤©éƒ½å¾ˆéš¾å—ï¼›å°ç¦ï¼Œåœ†åœ†ä¸¢äº†ï¼›å›¢å›¢å›å»åæ›´éš¾å—äº†ï¼›ä»–ä»¬éƒ½å’Œæˆ‘æœ‰è¿‡ä¸€æ®µæ—¶é—´çš„å…±åŒç”Ÿæ´»ç»å†ï¼Œå°±åƒæˆ‘çš„å­©å­ä¸€æ ·ï¼Œç°åœ¨æ…¢æ…¢çš„ï¼Œä¹Ÿä¸åƒä»¥å‰é‚£æ ·æŠŠçŒ«å®Œå®Œå…¨å…¨çœ‹æˆåŠ¨ç‰©ï¼Œå’Œäººç”Ÿæ´»åœ¨ä¸€èµ·ï¼Œå®ƒä»¬å°±æ˜¯æˆ‘çš„å°å®¶çš„ä¸€ä»½å­ã€‚<br>ä¸ç®¡å®ƒä»¬æ˜¯ä¸æ˜¯è¿˜æ´»ç€ï¼Œæˆ‘è¦è®°ä½å®ƒä»¬ã€‚æ­£å¦‚ã€Šå¯»æ¢¦ç¯æ¸¸è®°ã€‹ä¸­è¯´çš„ï¼ŒçœŸæ­£çš„æ­»äº¡æ˜¯å†æ²¡æœ‰ä¸€ä¸ªäººè®°å¾—ä½ ã€‚<br>æˆ‘å°†å®ƒä»¬æ”¾åœ¨è¿™é‡Œï¼Œæˆ‘æ°¸è¿œè®°å¾—å®ƒä»¬ã€‚<br>è°¨ä»¥æ­¤æ–‡çºªå¿µ â€œ2023&#x2F;09&#x2F;01â€”2024&#x2F;03&#x2F;07â€ </p><p>é™„ä¸Šä¸€å¼ åƒåƒåä¸‰å°ç¦å’Œä¸€å¼ ç¦ç¦åœ†åœ†å›¢å›¢çš„åˆç…§</p><p><img src="/image/jottings-11.jpg"></p><p><img src="/image/jottings-12.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç”Ÿæ´»</tag>
      
      <tag>éšç¬”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-3 åŠ¨æ€è§„åˆ’ç®—æ³•</title>
    <link href="/2024/08/19/RL-3/"/>
    <url>/2024/08/19/RL-3/</url>
    
    <content type="html"><![CDATA[<p>#å¼ºåŒ–å­¦ä¹   </p><h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h1><p><strong>åŠ¨æ€è§„åˆ’</strong>ï¼ˆdynamic programmingï¼‰æ˜¯ç¨‹åºè®¾è®¡ç®—æ³•ä¸­éå¸¸é‡è¦çš„å†…å®¹ï¼Œèƒ½å¤Ÿé«˜æ•ˆè§£å†³ä¸€äº›ç»å…¸é—®é¢˜ï¼Œä¾‹å¦‚èƒŒåŒ…é—®é¢˜å’Œæœ€çŸ­è·¯å¾„è§„åˆ’ã€‚åŠ¨æ€è§„åˆ’çš„åŸºæœ¬æ€æƒ³æ˜¯å°†å¾…æ±‚è§£é—®é¢˜åˆ†è§£æˆè‹¥å¹²ä¸ªå­é—®é¢˜ï¼Œå…ˆæ±‚è§£å­é—®é¢˜ï¼Œç„¶åä»è¿™äº›å­é—®é¢˜çš„è§£å¾—åˆ°ç›®æ ‡é—®é¢˜çš„è§£ã€‚åŠ¨æ€è§„åˆ’ä¼šä¿å­˜å·²è§£å†³çš„å­é—®é¢˜çš„ç­”æ¡ˆï¼Œåœ¨æ±‚è§£ç›®æ ‡é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¿™äº›å­é—®é¢˜ç­”æ¡ˆæ—¶å°±å¯ä»¥ç›´æ¥åˆ©ç”¨ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•ç”¨åŠ¨æ€è§„åˆ’çš„æ€æƒ³æ¥æ±‚è§£åœ¨é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ä¸­çš„æœ€ä¼˜ç­–ç•¥ã€‚<br>åŸºäºåŠ¨æ€è§„åˆ’çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼šä¸€æ˜¯<strong>ç­–ç•¥è¿­ä»£</strong>ï¼ˆpolicy iterationï¼‰ï¼ŒäºŒæ˜¯<strong>ä»·å€¼è¿­ä»£</strong>ï¼ˆvalue iterationï¼‰ã€‚å…¶ä¸­ï¼Œç­–ç•¥è¿­ä»£ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š<strong>ç­–ç•¥è¯„ä¼°</strong>ï¼ˆpolicy evaluationï¼‰å’Œ<strong>ç­–ç•¥æå‡</strong>ï¼ˆpolicy improvementï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œç­–ç•¥è¿­ä»£ä¸­çš„ç­–ç•¥è¯„ä¼°ä½¿ç”¨è´å°”æ›¼æœŸæœ›æ–¹ç¨‹æ¥å¾—åˆ°ä¸€ä¸ªç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€è§„åˆ’çš„è¿‡ç¨‹ï¼›è€Œä»·å€¼è¿­ä»£ç›´æ¥ä½¿ç”¨è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹æ¥è¿›è¡ŒåŠ¨æ€è§„åˆ’ï¼Œå¾—åˆ°æœ€ç»ˆçš„æœ€ä¼˜çŠ¶æ€ä»·å€¼ã€‚</p><p>ä¸åŒäºçš„è’™ç‰¹å¡æ´›æ–¹æ³•å’Œæ—¶åºå·®åˆ†ç®—æ³•ï¼ŒåŸºäºåŠ¨æ€è§„åˆ’çš„è¿™ä¸¤ç§å¼ºåŒ–å­¦ä¹ ç®—æ³•è¦æ±‚äº‹å…ˆçŸ¥é“ç¯å¢ƒçš„çŠ¶æ€è½¬ç§»å‡½æ•°å’Œå¥–åŠ±å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯éœ€è¦çŸ¥é“æ•´ä¸ªé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ã€‚åœ¨è¿™æ ·ä¸€ä¸ªç™½ç›’ç¯å¢ƒä¸­ï¼Œä¸éœ€è¦é€šè¿‡æ™ºèƒ½ä½“å’Œç¯å¢ƒçš„å¤§é‡äº¤äº’æ¥å­¦ä¹ ï¼Œå¯ä»¥ç›´æ¥ç”¨åŠ¨æ€è§„åˆ’æ±‚è§£çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚ä½†æ˜¯ï¼Œç°å®ä¸­çš„ç™½ç›’ç¯å¢ƒå¾ˆå°‘ï¼Œè¿™ä¹Ÿæ˜¯åŠ¨æ€è§„åˆ’ç®—æ³•çš„å±€é™ä¹‹å¤„ï¼Œæˆ‘ä»¬æ— æ³•å°†å…¶è¿ç”¨åˆ°å¾ˆå¤šå®é™…åœºæ™¯ä¸­ã€‚å¦å¤–ï¼Œç­–ç•¥è¿­ä»£å’Œä»·å€¼è¿­ä»£é€šå¸¸åªé€‚ç”¨äºæœ‰é™é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼Œå³çŠ¶æ€ç©ºé—´å’ŒåŠ¨ä½œç©ºé—´æ˜¯ç¦»æ•£ä¸”æœ‰é™çš„ã€‚</p><h1 id="2-ç¤ºä¾‹ï¼šæ‚¬å´–æ¼«æ­¥ç¯å¢ƒ"><a href="#2-ç¤ºä¾‹ï¼šæ‚¬å´–æ¼«æ­¥ç¯å¢ƒ" class="headerlink" title="2 ç¤ºä¾‹ï¼šæ‚¬å´–æ¼«æ­¥ç¯å¢ƒ"></a>2 ç¤ºä¾‹ï¼šæ‚¬å´–æ¼«æ­¥ç¯å¢ƒ</h1><p>æœ¬èŠ‚ä½¿ç”¨ç­–ç•¥è¿­ä»£å’Œä»·å€¼è¿­ä»£æ¥æ±‚è§£<strong>æ‚¬å´–æ¼«æ­¥</strong>ï¼ˆCliff Walkingï¼‰è¿™ä¸ªç¯å¢ƒä¸­çš„æœ€ä¼˜ç­–ç•¥ã€‚æ¥ä¸‹æ¥å…ˆç®€å•ä»‹ç»ä¸€ä¸‹è¯¥ç¯å¢ƒã€‚</p><p>æ‚¬å´–æ¼«æ­¥æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„å¼ºåŒ–å­¦ä¹ ç¯å¢ƒï¼Œå®ƒè¦æ±‚ä¸€ä¸ªæ™ºèƒ½ä½“ä»èµ·ç‚¹å‡ºå‘ï¼Œé¿å¼€æ‚¬å´–è¡Œèµ°ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®æ ‡ä½ç½®ã€‚å¦‚å›¾ 4-1 æ‰€ç¤ºï¼Œæœ‰ä¸€ä¸ª 4Ã—12 çš„ç½‘æ ¼ä¸–ç•Œï¼Œæ¯ä¸€ä¸ªç½‘æ ¼è¡¨ç¤ºä¸€ä¸ªçŠ¶æ€ã€‚æ™ºèƒ½ä½“çš„èµ·ç‚¹æ˜¯å·¦ä¸‹è§’çš„çŠ¶æ€ï¼Œç›®æ ‡æ˜¯å³ä¸‹è§’çš„çŠ¶æ€ï¼Œæ™ºèƒ½ä½“åœ¨æ¯ä¸€ä¸ªçŠ¶æ€éƒ½å¯ä»¥é‡‡å– 4 ç§åŠ¨ä½œï¼šä¸Šã€ä¸‹ã€å·¦ã€å³ã€‚å¦‚æœæ™ºèƒ½ä½“é‡‡å–åŠ¨ä½œåè§¦ç¢°åˆ°è¾¹ç•Œå¢™å£åˆ™çŠ¶æ€ä¸å‘ç”Ÿæ”¹å˜ï¼Œå¦åˆ™å°±ä¼šç›¸åº”åˆ°è¾¾ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ç¯å¢ƒä¸­æœ‰ä¸€æ®µæ‚¬å´–ï¼Œæ™ºèƒ½ä½“æ‰å…¥æ‚¬å´–æˆ–åˆ°è¾¾ç›®æ ‡çŠ¶æ€éƒ½ä¼šç»“æŸåŠ¨ä½œå¹¶å›åˆ°èµ·ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰å…¥æ‚¬å´–æˆ–è€…è¾¾åˆ°ç›®æ ‡çŠ¶æ€æ˜¯ç»ˆæ­¢çŠ¶æ€ã€‚æ™ºèƒ½ä½“æ¯èµ°ä¸€æ­¥çš„å¥–åŠ±æ˜¯ âˆ’1ï¼Œæ‰å…¥æ‚¬å´–çš„å¥–åŠ±æ˜¯ âˆ’100ã€‚<br><img src="/image/RL-31.png"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CliffWalkingEnv</span>:<br>    <span class="hljs-string">&quot;&quot;&quot; æ‚¬å´–æ¼«æ­¥ç¯å¢ƒ&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, ncol=<span class="hljs-number">12</span>, nrow=<span class="hljs-number">4</span></span>):<br>        <span class="hljs-variable language_">self</span>.ncol = ncol  <span class="hljs-comment"># å®šä¹‰ç½‘æ ¼ä¸–ç•Œçš„åˆ—</span><br>        <span class="hljs-variable language_">self</span>.nrow = nrow  <span class="hljs-comment"># å®šä¹‰ç½‘æ ¼ä¸–ç•Œçš„è¡Œ</span><br>        <span class="hljs-comment"># è½¬ç§»çŸ©é˜µP[state][action] = [(p, next_state, reward, done)]åŒ…å«ä¸‹ä¸€ä¸ªçŠ¶æ€å’Œå¥–åŠ±</span><br>        <span class="hljs-variable language_">self</span>.P = <span class="hljs-variable language_">self</span>.createP()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">createP</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># åˆå§‹åŒ–</span><br>        P = [[[] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.nrow * <span class="hljs-variable language_">self</span>.ncol)]<br>        <span class="hljs-comment"># 4ç§åŠ¨ä½œ, change[0]:ä¸Š,change[1]:ä¸‹, change[2]:å·¦, change[3]:å³ã€‚åæ ‡ç³»åŸç‚¹(0,0)</span><br>        <span class="hljs-comment"># å®šä¹‰åœ¨å·¦ä¸Šè§’</span><br>        change = [[<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.nrow):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.ncol):<br>                <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>                    <span class="hljs-comment"># ä½ç½®åœ¨æ‚¬å´–æˆ–è€…ç›®æ ‡çŠ¶æ€,å› ä¸ºæ— æ³•ç»§ç»­äº¤äº’,ä»»ä½•åŠ¨ä½œå¥–åŠ±éƒ½ä¸º0</span><br>                    <span class="hljs-keyword">if</span> i == <span class="hljs-variable language_">self</span>.nrow - <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> j &gt; <span class="hljs-number">0</span>:<br>                        P[i * <span class="hljs-variable language_">self</span>.ncol + j][a] = [(<span class="hljs-number">1</span>, i * <span class="hljs-variable language_">self</span>.ncol + j, <span class="hljs-number">0</span>,<br>                                                    <span class="hljs-literal">True</span>)]<br>                        <span class="hljs-keyword">continue</span><br>                    <span class="hljs-comment"># å…¶ä»–ä½ç½®</span><br>                    next_x = <span class="hljs-built_in">min</span>(<span class="hljs-variable language_">self</span>.ncol - <span class="hljs-number">1</span>, <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, j + change[a][<span class="hljs-number">0</span>]))<br>                    next_y = <span class="hljs-built_in">min</span>(<span class="hljs-variable language_">self</span>.nrow - <span class="hljs-number">1</span>, <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, i + change[a][<span class="hljs-number">1</span>]))<br>                    next_state = next_y * <span class="hljs-variable language_">self</span>.ncol + next_x<br>                    reward = -<span class="hljs-number">1</span><br>                    done = <span class="hljs-literal">False</span><br>                    <span class="hljs-comment"># ä¸‹ä¸€ä¸ªä½ç½®åœ¨æ‚¬å´–æˆ–è€…ç»ˆç‚¹</span><br>                    <span class="hljs-keyword">if</span> next_y == <span class="hljs-variable language_">self</span>.nrow - <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> next_x &gt; <span class="hljs-number">0</span>:<br>                        done = <span class="hljs-literal">True</span><br>                        <span class="hljs-keyword">if</span> next_x != <span class="hljs-variable language_">self</span>.ncol - <span class="hljs-number">1</span>:  <span class="hljs-comment"># ä¸‹ä¸€ä¸ªä½ç½®åœ¨æ‚¬å´–</span><br>                            reward = -<span class="hljs-number">100</span><br>                    P[i * <span class="hljs-variable language_">self</span>.ncol + j][a] = [(<span class="hljs-number">1</span>, next_state, reward, done)]<br>        <span class="hljs-keyword">return</span> P<br></code></pre></td></tr></table></figure><h1 id="3-ç­–ç•¥è¿­ä»£ç®—æ³•"><a href="#3-ç­–ç•¥è¿­ä»£ç®—æ³•" class="headerlink" title="3 ç­–ç•¥è¿­ä»£ç®—æ³•"></a>3 ç­–ç•¥è¿­ä»£ç®—æ³•</h1><p>ç­–ç•¥è¿­ä»£æ˜¯ç­–ç•¥è¯„ä¼°å’Œç­–ç•¥æå‡ä¸æ–­å¾ªç¯äº¤æ›¿ï¼Œç›´è‡³æœ€åå¾—åˆ°æœ€ä¼˜ç­–ç•¥çš„è¿‡ç¨‹ã€‚æœ¬èŠ‚åˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªè¿‡ç¨‹è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p><h2 id="3-1ç­–ç•¥è¯„ä¼°"><a href="#3-1ç­–ç•¥è¯„ä¼°" class="headerlink" title="3.1ç­–ç•¥è¯„ä¼°"></a>3.1ç­–ç•¥è¯„ä¼°</h2><p>ç­–ç•¥è¯„ä¼°è¿™ä¸€è¿‡ç¨‹ç”¨æ¥è®¡ç®—ä¸€ä¸ªç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚å›é¡¾ä¸€ä¸‹ä¹‹å‰å­¦ä¹ çš„è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ï¼š<br>$V^\pi(s)&#x3D;\sum_{a\in A}\pi(a|s)\left(r(s,a)+\gamma\sum_{s^{\prime}\in S}p(s^{\prime}|s,a)V^\pi(s^{\prime})\right)$<br>å…¶ä¸­ï¼Œ$\pi(a|s)$æ˜¯ç­–ç•¥$\pi$åœ¨çŠ¶æ€sä¸‹é‡‡å–åŠ¨ä½œçš„æ¦‚ç‡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå½“çŸ¥é“å¥–åŠ±å‡½æ•°å’ŒçŠ¶æ€è½¬ç§»å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸‹ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼æ¥è®¡ç®—å½“å‰çŠ¶æ€çš„ä»·å€¼ã€‚å› æ­¤ï¼Œæ ¹æ®åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œå¯ä»¥æŠŠè®¡ç®—ä¸‹ä¸€ä¸ªå¯èƒ½çŠ¶æ€çš„ä»·å€¼å½“æˆä¸€ä¸ªå­é—®é¢˜ï¼ŒæŠŠè®¡ç®—å½“å‰çŠ¶æ€çš„ä»·å€¼çœ‹ä½œå½“å‰é—®é¢˜ã€‚åœ¨å¾—çŸ¥å­é—®é¢˜çš„è§£åï¼Œå°±å¯ä»¥æ±‚è§£å½“å‰é—®é¢˜ã€‚æ›´ä¸€èˆ¬çš„ï¼Œè€ƒè™‘æ‰€æœ‰çš„çŠ¶æ€ï¼Œå°±å˜æˆäº†ç”¨ä¸Šä¸€è½®çš„çŠ¶æ€ä»·å€¼å‡½æ•°æ¥è®¡ç®—å½“å‰è¿™ä¸€è½®çš„çŠ¶æ€ä»·å€¼å‡½æ•°ï¼Œå³<br>$V^{k+1}(s)&#x3D;\sum_{a\in A}\pi(a|s)\left(r(s,a)+\gamma\sum_{sâ€™\in S}P(sâ€™|s,a)V^k(sâ€™)\right)$</p><h2 id="3-2ç­–ç•¥æå‡"><a href="#3-2ç­–ç•¥æå‡" class="headerlink" title="3.2ç­–ç•¥æå‡"></a>3.2ç­–ç•¥æå‡</h2><p>ä½¿ç”¨ç­–ç•¥è¯„ä¼°è®¡ç®—å¾—åˆ°å½“å‰ç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æ®æ­¤æ¥æ”¹è¿›è¯¥ç­–ç•¥ã€‚å‡è®¾æ­¤æ—¶å¯¹äºç­–ç•¥$\pi$ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å…¶ä»·å€¼$V^{\pi}$ï¼Œä¹Ÿå°±æ˜¯çŸ¥é“äº†åœ¨ç­–ç•¥$\pi$ä¸‹ä»æ¯ä¸€ä¸ªçŠ¶æ€så‡ºå‘æœ€ç»ˆå¾—åˆ°çš„æœŸæœ›å›æŠ¥ã€‚æˆ‘ä»¬è¦å¦‚ä½•æ”¹å˜ç­–ç•¥æ¥è·å¾—åœ¨çŠ¶æ€sä¸‹æ›´é«˜çš„æœŸæœ›å›æŠ¥å‘¢ï¼Ÿå‡è®¾æ™ºèƒ½ä½“åœ¨çŠ¶æ€sä¸‹é‡‡å–åŠ¨ä½œaï¼Œä¹‹åçš„åŠ¨ä½œä¾æ—§éµå¾ªç­–ç•¥$\pi$ï¼Œæ­¤æ—¶å¾—åˆ°çš„æœŸæœ›å›æŠ¥å…¶å®å°±æ˜¯åŠ¨ä½œä»·å€¼$Q^{\pi}(s,a)$ã€‚å¦‚æœæˆ‘ä»¬æœ‰$Q^{\pi}(s,a)&gt;$V^\pi(s)ï¼Œåˆ™è¯´æ˜åœ¨çŠ¶æ€sä¸‹é‡‡å–åŠ¨ä½œaä¼šæ¯”åŸæ¥çš„ç­–ç•¥$\pi(a|s)$å¾—åˆ°æ›´é«˜çš„æœŸæœ›å›æŠ¥ã€‚</p><p>æˆ‘ä»¬å‘ç°æ„é€ çš„è´ªå¿ƒç­–ç•¥æ»¡è¶³ç­–ç•¥æå‡å®šç†çš„æ¡ä»¶ï¼Œæ‰€ä»¥ç­–ç•¥èƒ½å¤Ÿæ¯”ç­–ç•¥æ›´å¥½æˆ–è€…è‡³å°‘ä¸å…¶ä¸€æ ·å¥½ã€‚è¿™ä¸ªæ ¹æ®è´ªå¿ƒæ³•é€‰å–åŠ¨ä½œä»è€Œå¾—åˆ°æ–°çš„ç­–ç•¥çš„è¿‡ç¨‹ç§°ä¸ºç­–ç•¥æå‡ã€‚å½“ç­–ç•¥æå‡ä¹‹åå¾—åˆ°çš„ç­–ç•¥å’Œä¹‹å‰çš„ç­–ç•¥ä¸€æ ·æ—¶ï¼Œè¯´æ˜ç­–ç•¥è¿­ä»£è¾¾åˆ°äº†æ”¶æ•›ï¼Œæ­¤æ—¶$\pi^{\prime}$å’Œ$\pi$å°±æ˜¯æœ€ä¼˜ç­–ç•¥ã€‚</p><p>$\begin{aligned}<br>V^{\pi}(s)&amp; \leq Q^\pi(s,\piâ€™(s)) \<br>&amp;&#x3D;\mathbb{E}<em>{\piâ€™}[R_t+\gamma V^{\pi}(S</em>{t+1})|S_t&#x3D;s] \<br>&amp;\leq\mathbb{E}<em>{\pi^{\prime}}[R_t+\gamma Q^\pi(S</em>{t+1},\pi^{\prime}(S_{t+1}))|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}<em>{\pi^{\prime}}[R_t+\gamma R</em>{t+1}+\gamma^2V^\pi(S_{t+2})|S_t&#x3D;s] \<br>&amp;\leq\mathbb{E}<em>{\pi^{\prime}}[R_t+\gamma R</em>{t+1}+\gamma^2R_{t+2}+\gamma^3V^\pi(S_{t+3})|S_t&#x3D;s] \<br>&amp;: \<br>&amp;\leq\mathbb{E}<em>{\pi^{\prime}}[R_t+\gamma R</em>{t+1}+\gamma^2R_{t+2}+\gamma^3R_{t+3}+\cdots|S_t&#x3D;s] \<br>&amp;&#x3D;V^{\pi^{\prime}}(s)<br>\end{aligned}$</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¨å¯¼è¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªæ—¶é—´æ­¥éƒ½ç”¨åˆ°å±€éƒ¨åŠ¨ä½œä»·å€¼ä¼˜åŠ¿</p><h2 id="3-3ç­–ç•¥è¿­ä»£ç®—æ³•"><a href="#3-3ç­–ç•¥è¿­ä»£ç®—æ³•" class="headerlink" title="3.3ç­–ç•¥è¿­ä»£ç®—æ³•"></a>3.3ç­–ç•¥è¿­ä»£ç®—æ³•</h2><p>æ€»ä½“æ¥è¯´ï¼Œç­–ç•¥è¿­ä»£ç®—æ³•çš„è¿‡ç¨‹å¦‚ä¸‹ï¼šå¯¹å½“å‰çš„ç­–ç•¥è¿›è¡Œç­–ç•¥è¯„ä¼°ï¼Œå¾—åˆ°å…¶çŠ¶æ€ä»·å€¼å‡½æ•°ï¼Œç„¶åæ ¹æ®è¯¥çŠ¶æ€ä»·å€¼å‡½æ•°è¿›è¡Œç­–ç•¥æå‡ä»¥å¾—åˆ°ä¸€ä¸ªæ›´å¥½çš„æ–°ç­–ç•¥ï¼Œæ¥ç€ç»§ç»­è¯„ä¼°æ–°ç­–ç•¥ã€æå‡ç­–ç•¥â€¦â€¦ç›´è‡³æœ€åæ”¶æ•›åˆ°æœ€ä¼˜ç­–ç•¥<br>$$\pi^0\overset{\textit{ç­–ç•¥è¯„ä¼°}}{\operatorname*{\longrightarrow}}V^{\pi^0}\overset{\textit{ç­–ç•¥æå‡}}{\operatorname*{\longrightarrow}}\pi^1\overset{\textit{ç­–ç•¥è¯„ä¼°}}{\operatorname*{\longrightarrow}}V^{\pi^1}\overset{\textit{ç­–ç•¥æå‡}}{\operatorname*{\longrightarrow}}\pi^2\overset{\textit{ç­–ç•¥è¯„ä¼°}}{\operatorname*{\longrightarrow}}\ldots\overset{\textit{ç­–ç•¥æå‡}}{\operatorname*{\longrightarrow}}\pi^*$$<br>ç»“åˆç­–ç•¥è¯„ä¼°å’Œç­–ç•¥æå‡ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹ç­–ç•¥è¿­ä»£ç®—æ³•ï¼š<br><img src="/image/RL-32.png"></p><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PolicyIteration</span>:<br>    <span class="hljs-string">&quot;&quot;&quot; ç­–ç•¥è¿­ä»£ç®—æ³• &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, env, theta, gamma</span>):<br>        <span class="hljs-variable language_">self</span>.env = env<br>        <span class="hljs-variable language_">self</span>.v = [<span class="hljs-number">0</span>] * <span class="hljs-variable language_">self</span>.env.ncol * <span class="hljs-variable language_">self</span>.env.nrow  <span class="hljs-comment"># åˆå§‹åŒ–ä»·å€¼ä¸º0</span><br>        <span class="hljs-variable language_">self</span>.pi = [[<span class="hljs-number">0.25</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0.25</span>]<br>                   <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.env.ncol * <span class="hljs-variable language_">self</span>.env.nrow)]  <span class="hljs-comment"># åˆå§‹åŒ–ä¸ºå‡åŒ€éšæœºç­–ç•¥</span><br>        <span class="hljs-variable language_">self</span>.theta = theta  <span class="hljs-comment"># ç­–ç•¥è¯„ä¼°æ”¶æ•›é˜ˆå€¼</span><br>        <span class="hljs-variable language_">self</span>.gamma = gamma  <span class="hljs-comment"># æŠ˜æ‰£å› å­</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">policy_evaluation</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># ç­–ç•¥è¯„ä¼°</span><br>        cnt = <span class="hljs-number">1</span>  <span class="hljs-comment"># è®¡æ•°å™¨</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>            max_diff = <span class="hljs-number">0</span><br>            new_v = [<span class="hljs-number">0</span>] * <span class="hljs-variable language_">self</span>.env.ncol * <span class="hljs-variable language_">self</span>.env.nrow<br>            <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.env.ncol * <span class="hljs-variable language_">self</span>.env.nrow):<br>                qsa_list = []  <span class="hljs-comment"># å¼€å§‹è®¡ç®—çŠ¶æ€sä¸‹çš„æ‰€æœ‰Q(s,a)ä»·å€¼</span><br>                <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>                    qsa = <span class="hljs-number">0</span><br>                    <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.env.P[s][a]:<br>                        p, next_state, r, done = res<br>                        qsa += p * (r + <span class="hljs-variable language_">self</span>.gamma * <span class="hljs-variable language_">self</span>.v[next_state] * (<span class="hljs-number">1</span> - done))<br>                        <span class="hljs-comment"># æœ¬ç« ç¯å¢ƒæ¯”è¾ƒç‰¹æ®Š,å¥–åŠ±å’Œä¸‹ä¸€ä¸ªçŠ¶æ€æœ‰å…³,æ‰€ä»¥éœ€è¦å’ŒçŠ¶æ€è½¬ç§»æ¦‚ç‡ç›¸ä¹˜</span><br>                    qsa_list.append(<span class="hljs-variable language_">self</span>.pi[s][a] * qsa)<br>                new_v[s] = <span class="hljs-built_in">sum</span>(qsa_list)  <span class="hljs-comment"># çŠ¶æ€ä»·å€¼å‡½æ•°å’ŒåŠ¨ä½œä»·å€¼å‡½æ•°ä¹‹é—´çš„å…³ç³»</span><br>                max_diff = <span class="hljs-built_in">max</span>(max_diff, <span class="hljs-built_in">abs</span>(new_v[s] - <span class="hljs-variable language_">self</span>.v[s]))<br>            <span class="hljs-variable language_">self</span>.v = new_v<br>            <span class="hljs-keyword">if</span> max_diff &lt; <span class="hljs-variable language_">self</span>.theta: <span class="hljs-keyword">break</span>  <span class="hljs-comment"># æ»¡è¶³æ”¶æ•›æ¡ä»¶,é€€å‡ºè¯„ä¼°è¿­ä»£</span><br>            cnt += <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç­–ç•¥è¯„ä¼°è¿›è¡Œ%dè½®åå®Œæˆ&quot;</span> % cnt)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">policy_improvement</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># ç­–ç•¥æå‡</span><br>        <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.env.nrow * <span class="hljs-variable language_">self</span>.env.ncol):<br>            qsa_list = []<br>            <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>                qsa = <span class="hljs-number">0</span><br>                <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.env.P[s][a]:<br>                    p, next_state, r, done = res<br>                    qsa += p * (r + <span class="hljs-variable language_">self</span>.gamma * <span class="hljs-variable language_">self</span>.v[next_state] * (<span class="hljs-number">1</span> - done))<br>                qsa_list.append(qsa)<br>            maxq = <span class="hljs-built_in">max</span>(qsa_list)<br>            cntq = qsa_list.count(maxq)  <span class="hljs-comment"># è®¡ç®—æœ‰å‡ ä¸ªåŠ¨ä½œå¾—åˆ°äº†æœ€å¤§çš„Qå€¼</span><br>            <span class="hljs-comment"># è®©è¿™äº›åŠ¨ä½œå‡åˆ†æ¦‚ç‡</span><br>            <span class="hljs-variable language_">self</span>.pi[s] = [<span class="hljs-number">1</span> / cntq <span class="hljs-keyword">if</span> q == maxq <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> qsa_list]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç­–ç•¥æå‡å®Œæˆ&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.pi<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">policy_iteration</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># ç­–ç•¥è¿­ä»£</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-variable language_">self</span>.policy_evaluation()<br>            old_pi = copy.deepcopy(<span class="hljs-variable language_">self</span>.pi)  <span class="hljs-comment"># å°†åˆ—è¡¨è¿›è¡Œæ·±æ‹·è´,æ–¹ä¾¿æ¥ä¸‹æ¥è¿›è¡Œæ¯”è¾ƒ</span><br>            new_pi = <span class="hljs-variable language_">self</span>.policy_improvement()<br>            <span class="hljs-keyword">if</span> old_pi == new_pi: <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å·²ç»å†™å¥½äº†ç¯å¢ƒä»£ç å’Œç­–ç•¥è¿­ä»£ä»£ç ã€‚ä¸ºäº†æ›´å¥½åœ°å±•ç°æœ€ç»ˆçš„ç­–ç•¥ï¼Œæ¥ä¸‹æ¥å¢åŠ ä¸€ä¸ªæ‰“å°ç­–ç•¥çš„å‡½æ•°ï¼Œç”¨äºæ‰“å°å½“å‰ç­–ç•¥åœ¨æ¯ä¸ªçŠ¶æ€ä¸‹çš„ä»·å€¼ä»¥åŠæ™ºèƒ½ä½“ä¼šé‡‡å–çš„åŠ¨ä½œã€‚å¯¹äºæ‰“å°å‡ºæ¥çš„åŠ¨ä½œï¼Œæˆ‘ä»¬ç”¨<code>^o&lt;o</code>è¡¨ç¤ºç­‰æ¦‚ç‡é‡‡å–å‘å·¦å’Œå‘ä¸Šä¸¤ç§åŠ¨ä½œï¼Œ<code>ooo&gt;</code>è¡¨ç¤ºåœ¨å½“å‰çŠ¶æ€åªé‡‡å–å‘å³åŠ¨ä½œã€‚</p><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs routeros">def print_agent(agent, action_meaning, disaster=[], end=[]):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çŠ¶æ€ä»·å€¼ï¼š&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(agent.env.nrow):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(agent.env.ncol):<br>            # ä¸ºäº†è¾“å‡ºç¾è§‚,ä¿æŒè¾“å‡º6ä¸ªå­—ç¬¦<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%6.6s&#x27;</span> % (<span class="hljs-string">&#x27;%.3f&#x27;</span> % agent.v[i * agent.env.ncol + j]), <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27; &#x27;</span>)<br>        <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç­–ç•¥ï¼š&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(agent.env.nrow):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(agent.env.ncol):<br>            # ä¸€äº›ç‰¹æ®Šçš„çŠ¶æ€,ä¾‹å¦‚æ‚¬å´–æ¼«æ­¥ä¸­çš„æ‚¬å´–<br>            <span class="hljs-keyword">if</span> (i * agent.env.ncol + j) <span class="hljs-keyword">in</span> disaster:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;****&#x27;</span>, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27; &#x27;</span>)<br>            elif (i * agent.env.ncol + j) <span class="hljs-keyword">in</span> end:  # ç›®æ ‡çŠ¶æ€<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;EEEE&#x27;</span>, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27; &#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                a = agent.pi[i * agent.env.ncol + j]<br>                pi_str = <span class="hljs-string">&#x27;&#x27;</span><br>                <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> range(len(action_meaning)):<br>                    pi_str += action_meaning[k] <span class="hljs-keyword">if</span> a[k] &gt; 0 <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;o&#x27;</span><br>                <span class="hljs-built_in">print</span>(pi_str, <span class="hljs-attribute">end</span>=<span class="hljs-string">&#x27; &#x27;</span>)<br>        <span class="hljs-built_in">print</span>()<br><br><br>env = CliffWalkingEnv()<br>action_meaning = [<span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>]<br>theta = 0.001<br>gamma = 0.9<br>agent = PolicyIteration(env, theta, gamma)<br>agent.policy_iteration()<br>print_agent(agent, action_meaning, list(range(37, 47)), [47])<br></code></pre></td></tr></table></figure><p><img src="/image/RL-33.png"><br>ç»è¿‡ 5 æ¬¡ç­–ç•¥è¯„ä¼°å’Œç­–ç•¥æå‡çš„å¾ªç¯è¿­ä»£ï¼Œç­–ç•¥æ”¶æ•›äº†ï¼Œæ­¤æ—¶å°†è·å¾—çš„ç­–ç•¥æ‰“å°å‡ºæ¥ã€‚ç”¨è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹å»æ£€éªŒå…¶ä¸­æ¯ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼ï¼Œå¯ä»¥å‘ç°æœ€ç»ˆè¾“å‡ºçš„ç­–ç•¥çš„ç¡®æ˜¯æœ€ä¼˜ç­–ç•¥ã€‚</p><h2 id="3-4ä»·å€¼è¿­ä»£ç®—æ³•"><a href="#3-4ä»·å€¼è¿­ä»£ç®—æ³•" class="headerlink" title="3.4ä»·å€¼è¿­ä»£ç®—æ³•"></a>3.4ä»·å€¼è¿­ä»£ç®—æ³•</h2><p>ä»ä¸Šé¢çš„ä»£ç è¿è¡Œç»“æœä¸­æˆ‘ä»¬èƒ½å‘ç°ï¼Œç­–ç•¥è¿­ä»£ä¸­çš„ç­–ç•¥è¯„ä¼°éœ€è¦è¿›è¡Œå¾ˆå¤šè½®æ‰èƒ½æ”¶æ•›å¾—åˆ°æŸä¸€ç­–ç•¥çš„çŠ¶æ€å‡½æ•°ï¼Œè¿™éœ€è¦å¾ˆå¤§çš„è®¡ç®—é‡ï¼Œå°¤å…¶æ˜¯åœ¨çŠ¶æ€å’ŒåŠ¨ä½œç©ºé—´æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ã€‚æˆ‘ä»¬æ˜¯å¦å¿…é¡»è¦å®Œå…¨ç­‰åˆ°ç­–ç•¥è¯„ä¼°å®Œæˆåå†è¿›è¡Œç­–ç•¥æå‡å‘¢ï¼Ÿè¯•æƒ³ä¸€ä¸‹ï¼Œå¯èƒ½å‡ºç°è¿™æ ·çš„æƒ…å†µï¼šè™½ç„¶çŠ¶æ€ä»·å€¼å‡½æ•°è¿˜æ²¡æœ‰æ”¶æ•›ï¼Œä½†æ˜¯ä¸è®ºæ¥ä¸‹æ¥æ€ä¹ˆæ›´æ–°çŠ¶æ€ä»·å€¼ï¼Œç­–ç•¥æå‡å¾—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªç­–ç•¥ã€‚å¦‚æœåªåœ¨ç­–ç•¥è¯„ä¼°ä¸­è¿›è¡Œä¸€è½®ä»·å€¼æ›´æ–°ï¼Œç„¶åç›´æ¥æ ¹æ®æ›´æ–°åçš„ä»·å€¼è¿›è¡Œç­–ç•¥æå‡ï¼Œè¿™æ ·æ˜¯å¦å¯ä»¥å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™å…¶å®å°±æ˜¯æœ¬èŠ‚å°†è¦è®²è§£çš„ä»·å€¼è¿­ä»£ç®—æ³•ï¼Œå®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç§ç­–ç•¥è¯„ä¼°åªè¿›è¡Œäº†ä¸€è½®æ›´æ–°çš„ç­–ç•¥è¿­ä»£ç®—æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»·å€¼è¿­ä»£ä¸­ä¸å­˜åœ¨æ˜¾å¼çš„ç­–ç•¥ï¼Œæˆ‘ä»¬åªç»´æŠ¤ä¸€ä¸ªçŠ¶æ€ä»·å€¼å‡½æ•°ã€‚<br>ç¡®åˆ‡æ¥è¯´ï¼Œä»·å€¼è¿­ä»£å¯ä»¥çœ‹æˆä¸€ç§åŠ¨æ€è§„åˆ’è¿‡ç¨‹ï¼Œå®ƒåˆ©ç”¨çš„æ˜¯è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ï¼š<br>$V^{k+1}(s)&#x3D;\max_{a\in\mathcal{A}}{r(s,a)+\gamma\sum_{sâ€™\in\mathcal{S}}P(sâ€™|s,a)V^k(sâ€™)}$<br><img src="/image/RL-34.png"></p><h3 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ValueIteration</span>:<br>    <span class="hljs-string">&quot;&quot;&quot; ä»·å€¼è¿­ä»£ç®—æ³• &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, env, theta, gamma</span>):<br>        <span class="hljs-variable language_">self</span>.env = env<br>        <span class="hljs-variable language_">self</span>.v = [<span class="hljs-number">0</span>] * <span class="hljs-variable language_">self</span>.env.ncol * <span class="hljs-variable language_">self</span>.env.nrow  <span class="hljs-comment"># åˆå§‹åŒ–ä»·å€¼ä¸º0</span><br>        <span class="hljs-variable language_">self</span>.theta = theta  <span class="hljs-comment"># ä»·å€¼æ”¶æ•›é˜ˆå€¼</span><br>        <span class="hljs-variable language_">self</span>.gamma = gamma<br>        <span class="hljs-comment"># ä»·å€¼è¿­ä»£ç»“æŸåå¾—åˆ°çš„ç­–ç•¥</span><br>        <span class="hljs-variable language_">self</span>.pi = [<span class="hljs-literal">None</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.env.ncol * <span class="hljs-variable language_">self</span>.env.nrow)]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">value_iteration</span>(<span class="hljs-params">self</span>):<br>        cnt = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>            max_diff = <span class="hljs-number">0</span><br>            new_v = [<span class="hljs-number">0</span>] * <span class="hljs-variable language_">self</span>.env.ncol * <span class="hljs-variable language_">self</span>.env.nrow<br>            <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.env.ncol * <span class="hljs-variable language_">self</span>.env.nrow):<br>                qsa_list = []  <span class="hljs-comment"># å¼€å§‹è®¡ç®—çŠ¶æ€sä¸‹çš„æ‰€æœ‰Q(s,a)ä»·å€¼</span><br>                <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>                    qsa = <span class="hljs-number">0</span><br>                    <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.env.P[s][a]:<br>                        p, next_state, r, done = res<br>                        qsa += p * (r + <span class="hljs-variable language_">self</span>.gamma * <span class="hljs-variable language_">self</span>.v[next_state] * (<span class="hljs-number">1</span> - done))<br>                    qsa_list.append(qsa)  <span class="hljs-comment"># è¿™ä¸€è¡Œå’Œä¸‹ä¸€è¡Œä»£ç æ˜¯ä»·å€¼è¿­ä»£å’Œç­–ç•¥è¿­ä»£çš„ä¸»è¦åŒºåˆ«</span><br>                new_v[s] = <span class="hljs-built_in">max</span>(qsa_list)<br>                max_diff = <span class="hljs-built_in">max</span>(max_diff, <span class="hljs-built_in">abs</span>(new_v[s] - <span class="hljs-variable language_">self</span>.v[s]))<br>            <span class="hljs-variable language_">self</span>.v = new_v<br>            <span class="hljs-keyword">if</span> max_diff &lt; <span class="hljs-variable language_">self</span>.theta: <span class="hljs-keyword">break</span>  <span class="hljs-comment"># æ»¡è¶³æ”¶æ•›æ¡ä»¶,é€€å‡ºè¯„ä¼°è¿­ä»£</span><br>            cnt += <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä»·å€¼è¿­ä»£ä¸€å…±è¿›è¡Œ%dè½®&quot;</span> % cnt)<br>        <span class="hljs-variable language_">self</span>.get_policy()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_policy</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># æ ¹æ®ä»·å€¼å‡½æ•°å¯¼å‡ºä¸€ä¸ªè´ªå©ªç­–ç•¥</span><br>        <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.env.nrow * <span class="hljs-variable language_">self</span>.env.ncol):<br>            qsa_list = []<br>            <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>                qsa = <span class="hljs-number">0</span><br>                <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.env.P[s][a]:<br>                    p, next_state, r, done = res<br>                    qsa += p * (r + <span class="hljs-variable language_">self</span>.gamma * <span class="hljs-variable language_">self</span>.v[next_state] * (<span class="hljs-number">1</span> - done))<br>                qsa_list.append(qsa)<br>            maxq = <span class="hljs-built_in">max</span>(qsa_list)<br>            cntq = qsa_list.count(maxq)  <span class="hljs-comment"># è®¡ç®—æœ‰å‡ ä¸ªåŠ¨ä½œå¾—åˆ°äº†æœ€å¤§çš„Qå€¼</span><br>            <span class="hljs-comment"># è®©è¿™äº›åŠ¨ä½œå‡åˆ†æ¦‚ç‡</span><br>            <span class="hljs-variable language_">self</span>.pi[s] = [<span class="hljs-number">1</span> / cntq <span class="hljs-keyword">if</span> q == maxq <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> qsa_list]<br><br><br>env = CliffWalkingEnv()<br>action_meaning = [<span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>]<br>theta = <span class="hljs-number">0.001</span><br>gamma = <span class="hljs-number">0.9</span><br>agent = ValueIteration(env, theta, gamma)<br>agent.value_iteration()<br>print_agent(agent, action_meaning, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">37</span>, <span class="hljs-number">47</span>)), [<span class="hljs-number">47</span>])<br></code></pre></td></tr></table></figure><h1 id="4-å†°æ¹–ç¯å¢ƒ"><a href="#4-å†°æ¹–ç¯å¢ƒ" class="headerlink" title="4 å†°æ¹–ç¯å¢ƒ"></a>4 å†°æ¹–ç¯å¢ƒ</h1><p>é™¤äº†æ‚¬å´–æ¼«æ­¥ç¯å¢ƒï¼Œæœ¬ç« è¿˜å‡†å¤‡äº†å¦ä¸€ä¸ªç¯å¢ƒâ€”â€”<strong>å†°æ¹–</strong>ï¼ˆFrozen Lakeï¼‰ã€‚å†°æ¹–ç¯å¢ƒçš„çŠ¶æ€ç©ºé—´å’ŒåŠ¨ä½œç©ºé—´æ˜¯æœ‰é™çš„ï¼Œæˆ‘ä»¬åœ¨è¯¥ç¯å¢ƒä¸­ä¹Ÿå°è¯•ä¸€ä¸‹ç­–ç•¥è¿­ä»£ç®—æ³•å’Œä»·å€¼è¿­ä»£ç®—æ³•ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£è¿™ä¸¤ä¸ªç®—æ³•ã€‚<br><img src="/image/RL-35.png"></p><h3 id="ä»£ç -åŸºäºgymnasium"><a href="#ä»£ç -åŸºäºgymnasium" class="headerlink" title="ä»£ç (åŸºäºgymnasium)"></a>ä»£ç (åŸºäºgymnasium)</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">import gymnasium <span class="hljs-keyword">as</span> gym<br><br>env = gym.make(<span class="hljs-string">&quot;FrozenLake-v1&quot;</span>)  <span class="hljs-comment"># åˆ›å»ºç¯å¢ƒ</span><br>env = env.unwrapped  <span class="hljs-comment"># è§£å°è£…æ‰èƒ½è®¿é—®çŠ¶æ€è½¬ç§»çŸ©é˜µP</span><br>env.render()  <span class="hljs-comment"># ç¯å¢ƒæ¸²æŸ“,é€šå¸¸æ˜¯å¼¹çª—æ˜¾ç¤ºæˆ–æ‰“å°å‡ºå¯è§†åŒ–çš„ç¯å¢ƒ</span><br>holes = <span class="hljs-built_in">set</span>()<br><span class="hljs-keyword">ends</span> = <span class="hljs-built_in">set</span>()<br><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> env.P:<br>    <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span> <span class="hljs-keyword">in</span> env.P[s]:<br>        <span class="hljs-keyword">for</span> s_ <span class="hljs-keyword">in</span> env.P[s][<span class="hljs-keyword">a</span>]:<br>            <span class="hljs-keyword">if</span> s_[<span class="hljs-number">2</span>] == <span class="hljs-number">1.0</span>:  <span class="hljs-comment"># è·å¾—å¥–åŠ±ä¸º1,ä»£è¡¨æ˜¯ç›®æ ‡</span><br>                <span class="hljs-keyword">ends</span>.<span class="hljs-built_in">add</span>(s_[<span class="hljs-number">1</span>])<br>            <span class="hljs-keyword">if</span> s_[<span class="hljs-number">3</span>] == True:<br>                holes.<span class="hljs-built_in">add</span>(s_[<span class="hljs-number">1</span>])<br>holes = holes - <span class="hljs-keyword">ends</span><br>print(<span class="hljs-string">&quot;å†°æ´çš„ç´¢å¼•:&quot;</span>, holes)<br>print(<span class="hljs-string">&quot;ç›®æ ‡çš„ç´¢å¼•:&quot;</span>, <span class="hljs-keyword">ends</span>)<br><br><span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span> <span class="hljs-keyword">in</span> env.P[<span class="hljs-number">14</span>]:  <span class="hljs-comment"># æŸ¥çœ‹ç›®æ ‡å·¦è¾¹ä¸€æ ¼çš„çŠ¶æ€è½¬ç§»ä¿¡æ¯</span><br>    print(env.P[<span class="hljs-number">14</span>][<span class="hljs-keyword">a</span>])<br><span class="hljs-comment"># è¿™ä¸ªåŠ¨ä½œæ„ä¹‰æ˜¯Gymåº“é’ˆå¯¹å†°æ¹–ç¯å¢ƒäº‹å…ˆè§„å®šå¥½çš„</span><br>action_meaning = [<span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-string">&#x27;^&#x27;</span>]<br>theta = <span class="hljs-number">1e-5</span><br>gamma = <span class="hljs-number">0.9</span><br>agent = PolicyIteration(env, theta, gamma)<br>agent.policy_iteration()<br>print_agent(agent, action_meaning, [<span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>], [<span class="hljs-number">15</span>])<br>action_meaning = [<span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-string">&#x27;^&#x27;</span>]<br>theta = <span class="hljs-number">1e-5</span><br>gamma = <span class="hljs-number">0.9</span><br>agent = ValueIteration(env, theta, gamma)<br>agent.value_iteration()<br>print_agent(agent, action_meaning, [<span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>], [<span class="hljs-number">15</span>])<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæœ€ä¼˜ç­–ç•¥å¾ˆçœ‹ä¸Šå»æ¯”è¾ƒåç›´è§‰ï¼Œå…¶åŸå› æ˜¯è¿™æ˜¯ä¸€ä¸ªæ™ºèƒ½ä½“ä¼šéšæœºæ»‘å‘å…¶ä»–çŠ¶æ€çš„å†°å†»æ¹–é¢ã€‚ä¾‹å¦‚ï¼Œåœ¨ç›®æ ‡å·¦è¾¹ä¸€æ ¼çš„çŠ¶æ€ï¼Œé‡‡å–å‘å³çš„åŠ¨ä½œæ—¶ï¼Œå®ƒæœ‰å¯èƒ½ä¼šæ»‘åˆ°ç›®æ ‡å·¦ä¸Šè§’çš„ä½ç½®ï¼Œä»è¯¥ä½ç½®å†æ¬¡åˆ°è¾¾ç›®æ ‡ä¼šæ›´åŠ å›°éš¾ï¼Œæ‰€ä»¥æ­¤æ—¶é‡‡å–å‘ä¸‹çš„åŠ¨ä½œæ˜¯æ›´ä¸ºä¿é™©çš„ï¼Œå¹¶ä¸”æœ‰ä¸€å®šæ¦‚ç‡èƒ½å¤Ÿæ»‘åˆ°ç›®æ ‡ã€‚æˆ‘ä»¬å†æ¥å°è¯•ä¸€ä¸‹ä»·å€¼è¿­ä»£ç®—æ³•ã€‚</p><h1 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6 æ€»ç»“"></a>6 æ€»ç»“</h1><p>æœ¬ç« è®²è§£äº†å¼ºåŒ–å­¦ä¹ ä¸­ä¸¤ä¸ªç»å…¸çš„åŠ¨æ€è§„åˆ’ç®—æ³•ï¼šç­–ç•¥è¿­ä»£ç®—æ³•å’Œä»·å€¼è¿­ä»£ç®—æ³•ï¼Œå®ƒä»¬éƒ½èƒ½ç”¨äºæ±‚è§£æœ€ä¼˜ä»·å€¼å’Œæœ€ä¼˜ç­–ç•¥ã€‚åŠ¨æ€è§„åˆ’çš„ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨è´å°”æ›¼æ–¹ç¨‹å¯¹æ‰€æœ‰çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆ©ç”¨è´å°”æ›¼æ–¹ç¨‹è¿›è¡ŒçŠ¶æ€æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ä¸­çš„å¥–åŠ±å‡½æ•°å’ŒçŠ¶æ€è½¬ç§»å‡½æ•°ã€‚å¦‚æœæ™ºèƒ½ä½“æ— æ³•äº‹å…ˆå¾—çŸ¥å¥–åŠ±å‡½æ•°å’ŒçŠ¶æ€è½¬ç§»å‡½æ•°ï¼Œå°±åªèƒ½é€šè¿‡å’Œç¯å¢ƒè¿›è¡Œäº¤äº’æ¥é‡‡æ ·ï¼ˆçŠ¶æ€-åŠ¨ä½œ-å¥–åŠ±-ä¸‹ä¸€çŠ¶æ€ï¼‰è¿™æ ·çš„æ•°æ®ï¼Œæˆ‘ä»¬å°†åœ¨ä¹‹åçš„ç« èŠ‚ä¸­è®²è§£å¦‚ä½•æ±‚è§£è¿™ç§æƒ…å†µä¸‹çš„æœ€ä¼˜ç­–ç•¥ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-2.1 å…³äºé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹çš„è¡¥å……è¯´æ˜</title>
    <link href="/2024/08/19/RL-2-1/"/>
    <url>/2024/08/19/RL-2-1/</url>
    
    <content type="html"><![CDATA[<p>#å¼ºåŒ–å­¦ä¹  </p><h1 id="1-å‰æƒ…æè¦"><a href="#1-å‰æƒ…æè¦" class="headerlink" title="1 å‰æƒ…æè¦"></a>1 å‰æƒ…æè¦</h1><p>æœ¬ç« æ˜¯å¼ºåŒ–å­¦ä¹ è¿‡ç¨‹çš„é‡è¦æ¦‚å¿µï¼Œé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹åŒ…å«äº†çŠ¶æ€ä¿¡æ¯ä»¥åŠçŠ¶æ€ä¹‹é—´çš„è½¬ç§»æœºåˆ¶ï¼Œå¼ºåŒ–å­¦ä¹ è§£å†³é—®é¢˜çš„æœ¬è´¨å°±æ˜¯æŠŠé—®é¢˜æŠ½è±¡ä¸ºä¸€ä¸ªé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ã€‚</p><h1 id="2-é‡ç‚¹å†…å®¹"><a href="#2-é‡ç‚¹å†…å®¹" class="headerlink" title="2 é‡ç‚¹å†…å®¹"></a>2 é‡ç‚¹å†…å®¹</h1><h2 id="2-1é©¬å°”å¯å¤«æ€§è´¨"><a href="#2-1é©¬å°”å¯å¤«æ€§è´¨" class="headerlink" title="2.1é©¬å°”å¯å¤«æ€§è´¨"></a>2.1é©¬å°”å¯å¤«æ€§è´¨</h2><p>æŒ‡å½“ä¸”ä»…å½“æŸæ—¶åˆ»çš„çŠ¶æ€åªå–å†³äºä¸Šä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚<br>çœ‹ä¼¼æ˜¯ä¸‹ä¸€ä¸ªçŠ¶æ€åªå–å†³äºå½“å‰çŠ¶æ€ï¼›<br>äº‹å®ä¸Šï¼Œå…·æœ‰é©¬å°”å¯å¤«æ€§å¹¶ä¸ä»£è¡¨è¿™ä¸ªéšæœºè¿‡ç¨‹å°±å’Œå†å²å®Œå…¨æ²¡æœ‰å…³ç³»ã€‚<br>t+1æ—¶åˆ»åªä¸tæœ‰å…³ï¼Œç”±äºé©¬å°”å¯å¤«æ€§çš„é“¾å¼å…³ç³»ï¼Œtæ—¶åˆ»åŒ…å«äº†t-1æ—¶åˆ»çŠ¶æ€çš„ä¿¡æ¯ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><h2 id="2-2é©¬å°”å¯å¤«è¿‡ç¨‹"><a href="#2-2é©¬å°”å¯å¤«è¿‡ç¨‹" class="headerlink" title="2.2é©¬å°”å¯å¤«è¿‡ç¨‹"></a>2.2é©¬å°”å¯å¤«è¿‡ç¨‹</h2><p>å…ƒç»„&lt;S,P&gt;å¯ä»¥æè¿°ä¸€ä¸ªé©¬å°”å¯å¤«è¿‡ç¨‹ï¼ŒSæ˜¯æœ‰é™æ•°é‡çš„çŠ¶æ€é›†åˆï¼ŒPæ˜¯çŠ¶æ€è½¬ç§»çŸ©é˜µã€‚<br>PåŒ…å«æ‰€æœ‰çŠ¶æ€ï¼Œ$n*n$çš„çŸ©é˜µï¼Œ$P_{i,j}$è¡¨ç¤ºäº†ä»çŠ¶æ€$s_i$è½¬ç§»åˆ°çŠ¶æ€$s_j$çš„æ¦‚ç‡ï¼Œ$P(s^{\prime}|s)$ç§°çŠ¶æ€è½¬ç§»å‡½æ•°ï¼Œè½¬å‡ºæ¦‚ç‡å’Œå¿…é¡»ä¸º1ã€‚<br>æ ¹æ®çŠ¶æ€è½¬ç§»çŸ©é˜µç”Ÿæˆä¸€ä¸ªçŠ¶æ€åºåˆ—çš„è¿‡ç¨‹å«åšé‡‡æ ·ã€‚</p><h2 id="2-3é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹"><a href="#2-3é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹" class="headerlink" title="2.3é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹"></a>2.3é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹</h2><p>åœ¨é©¬å°”å¯å¤«è¿‡ç¨‹çš„å…ƒç»„ä¸Šï¼ŒåŠ å…¥$r,\gamma$;æ„æˆ$&lt;S,P,r,\gamma&gt;$<br>æ–°åŠ å…¥çš„åˆ†åˆ«æ˜¯å¥–åŠ±å‡½æ•°å’ŒæŠ˜æ‰£å› å­ã€‚<br>ræ˜¯æŒ‡è½¬ç§»åˆ°çŠ¶æ€så¯ä»¥è·å¾—å¥–åŠ±çš„æœŸæœ›r(s)ã€‚<br>$\gamma$æ˜¯æŠ˜æ‰£å› å­ï¼Œè¿œæœŸåˆ©ç›Šå…·æœ‰ä¸ç¡®å®šæ€§ï¼Œå› æ­¤å¯¹è¿œæœŸåˆ©ç›Šæ‰“æŠ˜æ‰£ã€‚<br>åœ¨ä¸€ä¸ªé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ä¸­ï¼Œä»ç¬¬tæ—¶åˆ»çš„çŠ¶æ€$S_t$å¼€å§‹ï¼Œæ‰€æœ‰å¥–åŠ±çš„è¡°å‡ä¹‹å’Œç§°ä¸º$G_t$:<br>$G_t&#x3D;R_t+\gamma R_{t+1}+\gamma^2R_{t+2}+\cdots&#x3D;\sum_{k&#x3D;0}^\infty\gamma^kR_{t+k}$<br>å›æŠ¥æ˜¯åŸºäºæœªæ¥æ—¶é—´æ­¥çš„å›æŠ¥,æ‰€ä»¥è¦å…ˆç®—æœªæ¥æ­¥æ•°çš„å›æŠ¥ã€‚<br>ä»·å€¼å‡½æ•°ï¼šä¸€ä¸ªçŠ¶æ€çš„æœŸæœ›å›æŠ¥ç§°ä¸ºè¿™ä¸ªçŠ¶æ€çš„ä»·å€¼ï¼Œæ‰€æœ‰çŠ¶æ€çš„ä»·å€¼ç»„æˆäº†ä»·å€¼å‡½æ•°ã€‚<br>$$\begin{aligned}<br>V(s)&amp; &#x3D;\mathbb{E}[G_t|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}[R_t+\gamma R_{t+1}+\gamma^2R_{t+2}+\ldots|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}[R_t+\gamma(R_{t+1}+\gamma R_{t+2}+\ldots)|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}[R_t+\gamma G_{t+1}|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}[R_t+\gamma V(S_{t+1})|S_t&#x3D;s]<br>\end{aligned}$$<br>ä»·å€¼å‡½æ•°åŒ…å«ï¼šå½“å‰çš„å¥–åŠ±+æŠ˜æ‰£å› å­ä¸ä¸‹ä¸€æ—¶åˆ»ä»·å€¼å‡½æ•°çš„ç§¯ã€‚<br>$V(s)&#x3D;r(s)+\gamma\sum_{sâ€™\in S}p(sâ€™|s)V(sâ€™)$<br>å…¶ä¸­ï¼Œ$s^{\prime}$æ˜¯ä¸‹ä¸€æ—¶åˆ»çš„çŠ¶æ€ï¼Œä¸Šé¢å°±æ˜¯æ‰€è°“è´å°”æ›¼æ–¹ç¨‹ã€‚<br>å†™æˆçŸ©é˜µå½¢å¼ï¼š<br>$$\begin{bmatrix}V(s_1)\V(s_2)\\cdots\V(s_n)\end{bmatrix}&#x3D;\begin{bmatrix}r(s_1)\r(s_2)\\cdots\r(s_n)\end{bmatrix}+\gamma\begin{bmatrix}P(s_1|s_1)&amp;p(s_2|s_1)&amp;\ldots&amp;P(s_n|s_1)\P(s_1|s_2)&amp;P(s_2|s_2)&amp;\ldots&amp;P(s_n|s_2)\\cdots\P(s_1|s_n)&amp;P(s_2|s_n)&amp;\ldots&amp;P(s_n|s_n)\end{bmatrix}\begin{bmatrix}V(s_1)\V(s_2)\\ldots\V(s_n)\end{bmatrix}$$<br>æ±‚è§£ï¼š<br>$$\begin{aligned}<br>\mathcal{V}&amp; &#x3D;\mathcal{R}+\gamma\mathcal{PV} \<br>(I-\gamma\mathcal{P})\mathcal{V}&amp; &#x3D;\mathcal{R} \<br>\mathcal{V}&amp; &#x3D;(I-\gamma\mathcal{P})^{-1}\mathcal{R}<br>\end{aligned}$$<br>ä»·å€¼å‡½æ•°çš„è§£æè§£ã€‚</p><h1 id="3-é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹"><a href="#3-é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹" class="headerlink" title="3 é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹"></a>3 é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹</h1><p>å°†é©¬å°”å¯å¤«å¥–åŠ±(MRP)è¿‡ç¨‹+A,å³æ™ºèƒ½ä½“çš„åŠ¨ä½œã€‚<br>åŒºåˆ«åœ¨äºï¼šéè‡ªå‘ï¼Œæœ‰å¤–ç•Œåˆºæ¿€æ”¹å˜ã€‚<br>çŠ¶æ€è½¬ç§»çŸ©é˜µå˜æˆä¸‰ç»´ã€‚<br>ç­–ç•¥ï¼šé€šå¸¸ç”¨$\pi$è¡¨ç¤ºã€‚<br>çŠ¶æ€ä»·å€¼å‡½æ•°ï¼š$V^{\pi}(s)$è¡¨ç¤ºï¼šä»s + $\pi$ â€“&gt; v<br>åŠ¨ä½œä»·å€¼å‡½æ•°ï¼š$Q^{\pi}(s,a)$è¡¨ç¤ºï¼šä»s + $\pi$ + a â€“&gt; v<br>ä»–ä»¬çš„å¯¹åº”å…³ç³»ï¼š<br>$V^\pi(s)&#x3D;\sum_{a\in A}\pi(a|s)Q^\pi(s,a)$<br>ä½¿ç”¨ç­–ç•¥$\pi$æ—¶ï¼š<br>$Q^\pi(s,a)&#x3D;r(s,a)+\gamma\sum_{s^{\prime}\in S}P(s^{\prime}|s,a)V^\pi(s^{\prime})$<br>è´å°”æ›¼æœŸæœ›æ–¹ç¨‹<br>$$\begin{aligned}<br>V^{\pi}(s)&amp; &#x3D;\mathbb{E}<em>\pi[R_t+\gamma V^\pi(S</em>{t+1})|S_t&#x3D;s] \<br>&amp;&#x3D;\sum_{a\in A}\pi(a|s)\left(r(s,a)+\gamma\sum_{s^{\prime}\in S}p(s^{\prime}|s,a)V^\pi(s^{\prime})\right) \<br>Q^\pi(s,a)&amp; &#x3D;\mathbb{E}<em>\pi[R_t+\gamma Q^\pi(S</em>{t+1},A_{t+1})|S_t&#x3D;s,A_t&#x3D;a] \<br>&amp;&#x3D;r(s,a)+\gamma\sum_{s^{\prime}\in S}p(s^{\prime}|s,a)\sum_{a^{\prime}\in A}\pi(a^{\prime}|s^{\prime})Q^\pi(s^{\prime},a^{\prime})<br>\end{aligned}$$<br>è®¡ç®—MDPä¸‹ç­–ç•¥$\pi$çš„çŠ¶æ€ä»·å€¼å‡½æ•°â€”â€”&gt;MDP+$\pi$&#x3D;MRP<br>æŠŠç­–ç•¥çš„åŠ¨ä½œé€‰æ‹©è¿›è¡Œè¾¹ç¼˜åŒ–ï¼Œå¾—åˆ°çš„æ˜¯æ²¡æœ‰åŠ¨ä½œçš„MRPã€‚<br>æŸä¸€ä¸ªçŠ¶æ€ï¼šæ ¹æ®ç­–ç•¥å°†æ‰€æœ‰åŠ¨ä½œçš„æ¦‚ç‡è¿›è¡ŒåŠ æƒï¼Œå¾—åˆ°çš„å¥–åŠ±å°±å¯çœ‹ä½œMRPåœ¨è¯¥çŠ¶æ€ä¸‹çš„å¥–åŠ±ï¼š<br>$râ€™(s)&#x3D;\sum_{a\in\mathcal{A}}\pi(a|s)r(s,a)$<br>çŠ¶æ€è½¬ç§»æ¦‚ç‡ï¼š<br>$Pâ€™(sâ€™|s)&#x3D;\sum_{a\in\mathcal{A}}\pi(a|s)P(sâ€™|s,a)$</p><h1 id="4-æœ€ä¼˜ç­–ç•¥"><a href="#4-æœ€ä¼˜ç­–ç•¥" class="headerlink" title="4 æœ€ä¼˜ç­–ç•¥"></a>4 æœ€ä¼˜ç­–ç•¥</h1><p>äºæ˜¯åœ¨æœ‰é™çŠ¶æ€å’ŒåŠ¨ä½œé›†åˆçš„ MDP ä¸­ï¼Œè‡³å°‘å­˜åœ¨ä¸€ä¸ªç­–ç•¥æ¯”å…¶ä»–æ‰€æœ‰ç­–ç•¥éƒ½å¥½æˆ–è€…è‡³å°‘å­˜åœ¨ä¸€ä¸ªç­–ç•¥ä¸å·®äºå…¶ä»–æ‰€æœ‰ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥å°±æ˜¯<strong>æœ€ä¼˜ç­–ç•¥</strong>ï¼ˆoptimal policyï¼‰ã€‚<br>æœ€ä¼˜è´å°”æ›¼æ–¹ç¨‹ï¼š<br>$$V^*(s)&#x3D;\max_{a\in\mathcal{A}}{r(s,a)+\gamma\sum_{s^{\prime}\in\mathcal{S}}p(s^{\prime}|s,a)V^*(s^{\prime})}\Q^*(s,a)&#x3D;r(s,a)+\gamma\sum_{s^{\prime}\in\mathcal{S}}p(s^{\prime}|s,a)\max_{a^{\prime}\in\mathcal{A}}Q^*(s^{\prime},a^{\prime})$$</p>]]></content>
    
    
    <categories>
      
      <category>å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
      <tag>è¡¥å……è¯´æ˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jottings-0</title>
    <link href="/2024/08/18/jottings-0/"/>
    <url>/2024/08/18/jottings-0/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ç‚¹è¿·èŒ«ï¼Œä¸çŸ¥é“åœ¨å¹²å•¥ã€‚<br>å¥½åœ¨èƒŒå•è¯ã€å­¦æ—¥è¯­ã€å­¦è‹±è¯­å£è¯­ã€å¥èº«åšæŒäº†ä¸‹æ¥ï¼›<br>å°è®ºæ–‡çŠ¶æ€è¿›å»äº†äº›ï¼Œç‚¹å­ä¹Ÿæœ‰äº†ï¼Œè¿˜åœ¨è½å®ï¼›<br>æŠ€æœ¯å¥½ä¹…æ²¡å­¦äº†ï¼Œä¸‹å‘¨è¦éƒ¨ç½²æ–°æŠ€æœ¯ï¼›<br>æ˜å¤©èµ·è¿˜æ˜¯æ­£å¸¸æ—©èµ·å§ï¼Œæ™šä¸Šå­¦æ˜¯å®‰é™ã€å°±æ˜¯æœ‰ç‚¹åºŸèº«ä½“ã€‚<br>ç¥æˆ‘å¥½è¿~  ğŸˆ</p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç”Ÿæ´»</tag>
      
      <tag>éšç¬”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-2 é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹</title>
    <link href="/2024/08/18/RL-2/"/>
    <url>/2024/08/18/RL-2/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h1><p><strong>é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹</strong>ï¼ˆMarkov decision processï¼ŒMDPï¼‰æ˜¯å¼ºåŒ–å­¦ä¹ çš„é‡è¦æ¦‚å¿µã€‚è¦å­¦å¥½å¼ºåŒ–å­¦ä¹ ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æŒæ¡é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹çš„åŸºç¡€çŸ¥è¯†ã€‚å‰ä¸¤ç« æ‰€è¯´çš„å¼ºåŒ–å­¦ä¹ ä¸­çš„ç¯å¢ƒä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ã€‚ä¸å¤šè‡‚è€è™æœºé—®é¢˜ä¸åŒï¼Œé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹åŒ…å«çŠ¶æ€ä¿¡æ¯ä»¥åŠçŠ¶æ€ä¹‹é—´çš„è½¬ç§»æœºåˆ¶ã€‚å¦‚æœè¦ç”¨å¼ºåŒ–å­¦ä¹ å»è§£å†³ä¸€ä¸ªå®é™…é—®é¢˜ï¼Œç¬¬ä¸€æ­¥è¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠè¿™ä¸ªå®é™…é—®é¢˜æŠ½è±¡ä¸ºä¸€ä¸ªé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯æ˜ç¡®é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹çš„å„ä¸ªç»„æˆè¦ç´ ã€‚æœ¬ç« å°†ä»é©¬å°”å¯å¤«è¿‡ç¨‹å‡ºå‘ï¼Œä¸€æ­¥ä¸€æ­¥åœ°è¿›è¡Œä»‹ç»ï¼Œæœ€åå¼•å‡ºé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ã€‚</p><h1 id="2-é©¬å°”å¯å¤«è¿‡ç¨‹"><a href="#2-é©¬å°”å¯å¤«è¿‡ç¨‹" class="headerlink" title="2 é©¬å°”å¯å¤«è¿‡ç¨‹"></a>2 é©¬å°”å¯å¤«è¿‡ç¨‹</h1><h2 id="2-1éšæœºè¿‡ç¨‹"><a href="#2-1éšæœºè¿‡ç¨‹" class="headerlink" title="2.1éšæœºè¿‡ç¨‹"></a>2.1éšæœºè¿‡ç¨‹</h2><p><strong>éšæœºè¿‡ç¨‹</strong>ï¼ˆstochastic processï¼‰æ˜¯æ¦‚ç‡è®ºçš„â€œåŠ¨åŠ›å­¦â€éƒ¨åˆ†ã€‚æ¦‚ç‡è®ºçš„ç ”ç©¶å¯¹è±¡æ˜¯é™æ€çš„éšæœºç°è±¡ï¼Œè€Œéšæœºè¿‡ç¨‹çš„ç ”ç©¶å¯¹è±¡æ˜¯éšæ—¶é—´æ¼”å˜çš„éšæœºç°è±¡ï¼ˆä¾‹å¦‚å¤©æ°”éšæ—¶é—´çš„å˜åŒ–ã€åŸå¸‚äº¤é€šéšæ—¶é—´çš„å˜åŒ–ï¼‰ã€‚åœ¨éšæœºè¿‡ç¨‹ä¸­ï¼Œéšæœºç°è±¡åœ¨æŸæ—¶åˆ»çš„å–å€¼æ˜¯ä¸€ä¸ªå‘é‡éšæœºå˜é‡ï¼Œç”¨$S_t$è¡¨ç¤ºï¼Œæ‰€æœ‰å¯èƒ½çš„çŠ¶æ€ç»„æˆçŠ¶æ€é›†åˆSã€‚éšæœºç°è±¡ä¾¿æ˜¯çŠ¶æ€çš„å˜åŒ–è¿‡ç¨‹ã€‚åœ¨æŸæ—¶åˆ»tçš„çŠ¶æ€$S_t$é€šå¸¸å–å†³äºtæ—¶åˆ»ä¹‹å‰çš„çŠ¶æ€ã€‚æˆ‘ä»¬å°†å·²çŸ¥å†å²ä¿¡æ¯$(S_1,\dots,S_t)$æ—¶ä¸‹ä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€ä¸º$S_{t+1}$çš„æ¦‚ç‡è¡¨ç¤ºæˆ$P(S_{t+1}|S_1,\ldots,S_t)$</p><h2 id="2-2é©¬å°”å¯å¤«æ€§è´¨"><a href="#2-2é©¬å°”å¯å¤«æ€§è´¨" class="headerlink" title="2.2é©¬å°”å¯å¤«æ€§è´¨"></a>2.2é©¬å°”å¯å¤«æ€§è´¨</h2><p>å½“ä¸”ä»…å½“æŸæ—¶åˆ»çš„çŠ¶æ€åªå–å†³äºä¸Šä¸€æ—¶åˆ»çš„çŠ¶æ€æ—¶ï¼Œä¸€ä¸ªéšæœºè¿‡ç¨‹è¢«ç§°ä¸ºå…·æœ‰<strong>é©¬å°”å¯å¤«æ€§è´¨</strong>ï¼ˆMarkov propertyï¼‰ï¼Œç”¨å…¬å¼è¡¨ç¤ºä¸º$P(S_{t+1}|S_t)&#x3D;P(S_{t+1}|S_1,\ldots,S_t)$<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰çŠ¶æ€æ˜¯æœªæ¥çš„å……åˆ†ç»Ÿè®¡é‡ï¼Œå³ä¸‹ä¸€ä¸ªçŠ¶æ€åªå–å†³äºå½“å‰çŠ¶æ€ï¼Œè€Œä¸ä¼šå—åˆ°è¿‡å»çŠ¶æ€çš„å½±å“ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œå…·æœ‰é©¬å°”å¯å¤«æ€§å¹¶ä¸ä»£è¡¨è¿™ä¸ªéšæœºè¿‡ç¨‹å°±å’Œå†å²å®Œå…¨æ²¡æœ‰å…³ç³»ã€‚å› ä¸ºè™½ç„¶t+1æ—¶åˆ»çš„çŠ¶æ€åªä¸tæ—¶åˆ»çš„çŠ¶æ€æœ‰å…³ï¼Œä½†æ˜¯tæ—¶åˆ»çš„çŠ¶æ€å…¶å®åŒ…å«äº†t-1æ—¶åˆ»çš„çŠ¶æ€çš„ä¿¡æ¯ï¼Œé€šè¿‡è¿™ç§é“¾å¼çš„å…³ç³»ï¼Œå†å²çš„ä¿¡æ¯è¢«ä¼ é€’åˆ°äº†ç°åœ¨ã€‚é©¬å°”å¯å¤«æ€§å¯ä»¥å¤§å¤§ç®€åŒ–è¿ç®—ï¼Œå› ä¸ºåªè¦å½“å‰çŠ¶æ€å¯çŸ¥ï¼Œæ‰€æœ‰çš„å†å²ä¿¡æ¯éƒ½ä¸å†éœ€è¦äº†ï¼Œåˆ©ç”¨å½“å‰çŠ¶æ€ä¿¡æ¯å°±å¯ä»¥å†³å®šæœªæ¥ã€‚</p><h2 id="2-3é©¬å°”å¯å¤«è¿‡ç¨‹"><a href="#2-3é©¬å°”å¯å¤«è¿‡ç¨‹" class="headerlink" title="2.3é©¬å°”å¯å¤«è¿‡ç¨‹"></a>2.3é©¬å°”å¯å¤«è¿‡ç¨‹</h2><p><strong>é©¬å°”å¯å¤«è¿‡ç¨‹</strong>ï¼ˆMarkov processï¼‰æŒ‡å…·æœ‰é©¬å°”å¯å¤«æ€§è´¨çš„éšæœºè¿‡ç¨‹ï¼Œä¹Ÿè¢«ç§°ä¸º<strong>é©¬å°”å¯å¤«é“¾</strong>ï¼ˆMarkov chainï¼‰ã€‚æˆ‘ä»¬é€šå¸¸ç”¨å…ƒç»„$\langle\mathcal{S},\mathcal{P}\rangle$æè¿°ä¸€ä¸ªé©¬å°”å¯å¤«è¿‡ç¨‹ï¼Œå…¶ä¸­Sæ˜¯æœ‰é™æ•°é‡çš„çŠ¶æ€é›†åˆï¼ŒPæ˜¯<strong>çŠ¶æ€è½¬ç§»çŸ©é˜µ</strong>ï¼ˆstate transition matrixï¼‰ã€‚å‡è®¾ä¸€å…±nä¸ªçŠ¶æ€ï¼Œæ­¤æ—¶$\mathcal{S}&#x3D;{s_1,s_2,\ldots,s_n}$<br>çŠ¶æ€è½¬ç§»çŸ©é˜µPå®šä¹‰äº†æ‰€æœ‰çŠ¶æ€å¯¹ä¹‹é—´çš„çŠ¶æ€è½¬ç§»æ¦‚ç‡ï¼Œå³ï¼š<br>$\mathcal{P}&#x3D;\begin{bmatrix}P(s_1|s_1)&amp;\cdots&amp;P(s_n|s_1)\\vdots&amp;\ddots&amp;\vdots\P(s_1|s_n)&amp;\cdots&amp;P(s_n|s_n)\end{bmatrix}$<br>çŸ©é˜µPä¸­ç¬¬è¡Œç¬¬jåˆ—å…ƒç´ $P(s_j|s_i)&#x3D;P(S_{t+1}&#x3D;s_j|S_t&#x3D;s_i)$è¡¨ç¤ºä»çŠ¶æ€$s_i$è½¬ç§»åˆ°çŠ¶æ€$s_j$çš„æ¦‚ç‡ï¼Œæˆ‘ä»¬ç§°ä¸º$P(s^{\prime}|s)$çŠ¶æ€è½¬ç§»å‡½æ•°ã€‚ä»æŸä¸ªçŠ¶æ€å‡ºå‘ï¼Œåˆ°è¾¾å…¶ä»–çŠ¶æ€çš„æ¦‚ç‡å’Œå¿…é¡»ä¸º 1ï¼Œå³çŠ¶æ€è½¬ç§»çŸ©é˜µPçš„æ¯ä¸€è¡Œçš„å’Œä¸º 1ã€‚<br>ä¸‹å›¾æ˜¯ä¸€ä¸ªå…·æœ‰æ˜¯ä¸€ä¸ªå…·æœ‰ 6 ä¸ªçŠ¶æ€çš„é©¬å°”å¯å¤«è¿‡ç¨‹çš„ç®€å•ä¾‹å­ã€‚å…¶ä¸­æ¯ä¸ªç»¿è‰²åœ†åœˆè¡¨ç¤ºä¸€ä¸ªçŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€éƒ½æœ‰ä¸€å®šæ¦‚ç‡ï¼ˆåŒ…æ‹¬æ¦‚ç‡ä¸º 0ï¼‰è½¬ç§»åˆ°å…¶ä»–çŠ¶æ€ï¼Œå…¶ä¸­$s_6$é€šå¸¸è¢«ç§°ä¸º<strong>ç»ˆæ­¢çŠ¶æ€</strong>ï¼ˆterminal stateï¼‰ï¼Œå› ä¸ºå®ƒä¸ä¼šå†è½¬ç§»åˆ°å…¶ä»–çŠ¶æ€ï¼Œå¯ä»¥ç†è§£ä¸ºå®ƒæ°¸è¿œä»¥æ¦‚ç‡ 1 è½¬ç§»åˆ°è‡ªå·±ã€‚çŠ¶æ€ä¹‹é—´çš„è™šçº¿ç®­å¤´è¡¨ç¤ºçŠ¶æ€çš„è½¬ç§»ï¼Œç®­å¤´æ—çš„æ•°å­—è¡¨ç¤ºè¯¥çŠ¶æ€è½¬ç§»å‘ç”Ÿçš„æ¦‚ç‡ã€‚ä»æ¯ä¸ªçŠ¶æ€å‡ºå‘è½¬ç§»åˆ°å…¶ä»–çŠ¶æ€çš„æ¦‚ç‡æ€»å’Œä¸º 1ã€‚ä¾‹å¦‚ï¼Œ$s_1$æœ‰90%æ¦‚ç‡ä¿æŒä¸å˜ï¼Œæœ‰10%æ¦‚ç‡è½¬ç§»åˆ°$s_2$ï¼Œè€Œåœ¨$s_2$åˆæœ‰50%æ¦‚ç‡å›åˆ°$s_3$ï¼Œæœ‰50%æ¦‚ç‡è½¬ç§»åˆ°$s_3$ã€‚</p><p><img src="/image/RL-21.png"></p><p>è½¬ç§»çŸ©é˜µå¦‚ä¸‹ï¼š<br>$$\begin{gathered}\mathcal{P}&#x3D;\begin{bmatrix}0.9&amp;0.1&amp;0&amp;0&amp;0&amp;0\0.5&amp;0&amp;0.5&amp;0&amp;0&amp;0\0&amp;0&amp;0&amp;0.6&amp;0&amp;0.4\0&amp;0&amp;0&amp;0&amp;0.3&amp;0.7\0&amp;0.2&amp;0.3&amp;0.5&amp;0&amp;0\0&amp;0&amp;0&amp;0&amp;0&amp;1\end{bmatrix}\end{gathered}$$<br>å…¶ä¸­ç¬¬iè¡Œjåˆ—çš„å€¼åˆ™ä»£è¡¨ä»çŠ¶æ€$s_i$è½¬ç§»åˆ°$s_j$çš„æ¦‚ç‡ã€‚<br>ç»™å®šä¸€ä¸ªé©¬å°”å¯å¤«è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»æŸä¸ªçŠ¶æ€å‡ºå‘ï¼Œæ ¹æ®å®ƒçš„çŠ¶æ€è½¬ç§»çŸ©é˜µç”Ÿæˆä¸€ä¸ªçŠ¶æ€<strong>åºåˆ—</strong>ï¼ˆepisodeï¼‰ï¼Œè¿™ä¸ªæ­¥éª¤ä¹Ÿè¢«å«åš<strong>é‡‡æ ·</strong>ï¼ˆsamplingï¼‰ã€‚ä¾‹å¦‚ï¼Œä»$s_1$å‡ºå‘ï¼Œå¯ä»¥ç”Ÿæˆåºåˆ—<br>$s_1\to s_2\to s_3\to s_6$æˆ–<br>$s_1\to s_1\to s_2\to s_3\to s_4\to s_5\to s_3\to s_6$ç­‰</p><h1 id="3-é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹"><a href="#3-é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹" class="headerlink" title="3 é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹"></a>3 é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹</h1><p>åœ¨é©¬å°”å¯å¤«è¿‡ç¨‹çš„åŸºç¡€ä¸ŠåŠ å…¥å¥–åŠ±å‡½æ•°rå’ŒæŠ˜æ‰£å› å­$\gamma$,å°±å¯ä»¥å¾—åˆ°<strong>é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹</strong>ï¼ˆMarkov reward processï¼‰ã€‚ä¸€ä¸ªé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ç”±$\langle\mathcal{S},\mathcal{P},r,\gamma\rangle$æ„æˆï¼Œå„ä¸ªç»„æˆå…ƒç´ çš„å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚</p><ul><li>Sæ˜¯æœ‰é™çŠ¶æ€çš„é›†åˆã€‚</li><li>Pæ˜¯çŠ¶æ€è½¬ç§»çŸ©é˜µã€‚</li><li>ræ˜¯å¥–åŠ±å‡½æ•°ï¼ŒæŸä¸ªçŠ¶æ€çš„å¥–åŠ± æŒ‡è½¬ç§»åˆ°è¯¥çŠ¶æ€æ—¶å¯ä»¥è·å¾—å¥–åŠ±çš„æœŸæœ›ã€‚</li><li>$\gamma$æ˜¯æŠ˜æ‰£å› å­ï¼ˆdiscount factorï¼‰ï¼Œ$\gamma$çš„å–å€¼èŒƒå›´ä¸º[0,1]ã€‚å¼•å…¥æŠ˜æ‰£å› å­çš„ç†ç”±ä¸ºè¿œæœŸåˆ©ç›Šå…·æœ‰ä¸€å®šä¸ç¡®å®šæ€§ï¼Œæœ‰æ—¶æˆ‘ä»¬æ›´å¸Œæœ›èƒ½å¤Ÿå°½å¿«è·å¾—ä¸€äº›å¥–åŠ±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è¿œæœŸåˆ©ç›Šæ‰“ä¸€äº›æŠ˜æ‰£ã€‚æ¥è¿‘ 1 çš„$\gamma$æ›´å…³æ³¨é•¿æœŸçš„ç´¯è®¡å¥–åŠ±ï¼Œæ¥è¿‘0çš„$\gamma$æ›´è€ƒè™‘çŸ­æœŸå¥–åŠ±ã€‚</li></ul><h2 id="3-1å›æŠ¥"><a href="#3-1å›æŠ¥" class="headerlink" title="3.1å›æŠ¥"></a>3.1å›æŠ¥</h2><p>åœ¨ä¸€ä¸ªé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ä¸­ï¼Œä»ç¬¬tæ—¶åˆ»çŠ¶æ€$S_t$å¼€å§‹ï¼Œç›´åˆ°ç»ˆæ­¢çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰å¥–åŠ±çš„è¡°å‡ä¹‹å’Œç§°ä¸º<strong>å›æŠ¥</strong>$G_t$ï¼ˆReturnï¼‰ï¼Œå…¬å¼å¦‚ä¸‹ï¼š<br>$G_t&#x3D;R_t+\gamma R_{t+1}+\gamma^2R_{t+2}+\cdots&#x3D;\sum_{k&#x3D;0}^\infty\gamma^kR_{t+k}$<br>å…¶ä¸­ï¼Œè¡¨ç¤ºåœ¨æ—¶åˆ»è·å¾—çš„å¥–åŠ±ã€‚<br>å¦‚ä¸‹å›¾ï¼Œæ„å»ºä¸€ä¸ªé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ã€‚<br><img src="/image/RL-22.png"><br>æ¯”å¦‚é€‰å–$s_1$ä¸ºèµ·å§‹çŠ¶æ€ï¼Œè®¾ç½®$\gamma&#x3D;0.5$ï¼Œé‡‡æ ·åˆ°ä¸€æ¡çŠ¶æ€åºåˆ—ä¸º$s_1\to s_2\to s_3\to s_6$ï¼Œå°±å¯ä»¥è®¡ç®—$s_1$çš„å›æŠ¥$G_1$ï¼Œå¾—åˆ°$G_1&#x3D;-1+0.5\times(-2)+0.5^2\times(-2)&#x3D;-2.5$</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">@File    :   é©¬å°”ç§‘å¤«é“¾.ipynb</span><br><span class="hljs-string">@Time    :   2024/08/17 01:54:00</span><br><span class="hljs-string">@Author  :   Neutrin</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># here put the import lib</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>np.random.seed(<span class="hljs-number">0</span>)<br><span class="hljs-comment"># å®šä¹‰çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µP</span><br>P = [<br>    [<span class="hljs-number">0.9</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],<br>    [<span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],<br>    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.4</span>],<br>    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.7</span>],<br>    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],<br>    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>],<br>]<br>P = np.array(P)<br><br>rewards = [-<span class="hljs-number">1</span>, -<span class="hljs-number">2</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]  <span class="hljs-comment"># å®šä¹‰å¥–åŠ±å‡½æ•°</span><br>gamma = <span class="hljs-number">0.5</span>  <span class="hljs-comment"># å®šä¹‰æŠ˜æ‰£å› å­</span><br><br><br><span class="hljs-comment"># ç»™å®šä¸€æ¡åºåˆ—,è®¡ç®—ä»æŸä¸ªç´¢å¼•ï¼ˆèµ·å§‹çŠ¶æ€ï¼‰å¼€å§‹åˆ°åºåˆ—æœ€åï¼ˆç»ˆæ­¢çŠ¶æ€ï¼‰å¾—åˆ°çš„å›æŠ¥</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_return</span>(<span class="hljs-params">start_index, chain, gamma</span>):<br>    G = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(<span class="hljs-built_in">range</span>(start_index, <span class="hljs-built_in">len</span>(chain))):<br>        G = gamma * G + rewards[chain[i] - <span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">return</span> G<br><br><br><span class="hljs-comment"># ä¸€ä¸ªçŠ¶æ€åºåˆ—,s1-s2-s3-s6</span><br>chain = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>]<br>start_index = <span class="hljs-number">0</span><br>G = compute_return(start_index, chain, gamma)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ ¹æ®æœ¬åºåˆ—è®¡ç®—å¾—åˆ°å›æŠ¥ä¸ºï¼š%sã€‚&quot;</span> % G)<br></code></pre></td></tr></table></figure><h2 id="3-2ä»·å€¼å‡½æ•°"><a href="#3-2ä»·å€¼å‡½æ•°" class="headerlink" title="3.2ä»·å€¼å‡½æ•°"></a>3.2ä»·å€¼å‡½æ•°</h2><p>åœ¨é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªçŠ¶æ€çš„æœŸæœ›å›æŠ¥ï¼ˆå³ä»è¿™ä¸ªçŠ¶æ€å‡ºå‘çš„æœªæ¥ç´¯ç§¯å¥–åŠ±çš„æœŸæœ›ï¼‰è¢«ç§°ä¸ºè¿™ä¸ªçŠ¶æ€çš„<strong>ä»·å€¼</strong>ï¼ˆvalueï¼‰ã€‚æ‰€æœ‰çŠ¶æ€çš„ä»·å€¼å°±ç»„æˆäº†<strong>ä»·å€¼å‡½æ•°</strong>ï¼ˆvalue functionï¼‰ï¼Œä»·å€¼å‡½æ•°çš„è¾“å…¥ä¸ºæŸä¸ªçŠ¶æ€ï¼Œè¾“å‡ºä¸ºè¿™ä¸ªçŠ¶æ€çš„ä»·å€¼ã€‚æˆ‘ä»¬å°†ä»·å€¼å‡½æ•°å†™æˆ<br>$V(s)&#x3D;\mathbb{E}[G_t|S_t&#x3D;s]$å±•å¼€ï¼š<br>$$\begin{aligned}<br>V(s)&amp; &#x3D;\mathbb{E}[G_t|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}[R_t+\gamma R_{t+1}+\gamma^2R_{t+2}+\ldots|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}[R_t+\gamma(R_{t+1}+\gamma R_{t+2}+\ldots)|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}[R_t+\gamma G_{t+1}|S_t&#x3D;s] \<br>&amp;&#x3D;\mathbb{E}[R_t+\gamma V(S_{t+1})|S_t&#x3D;s]<br>\end{aligned}$$<br>åœ¨ä¸Šå¼çš„æœ€åä¸€ä¸ªç­‰å·ä¸­ï¼Œä¸€æ–¹é¢ï¼Œå³æ—¶å¥–åŠ±çš„æœŸæœ›æ­£æ˜¯å¥–åŠ±å‡½æ•°çš„è¾“å‡ºï¼Œå³$\mathbb{E}[R_t|S_t&#x3D;s]&#x3D;r(s)$;å¦ä¸€æ–¹é¢ï¼Œç­‰å¼ä¸­å‰©ä½™éƒ¨åˆ†$\mathbb{E}[\gamma V(S_{t+1})|S_t&#x3D;s]$å¯ä»¥æ ¹æ®ä»çŠ¶æ€så‡ºå‘çš„è½¬ç§»æ¦‚ç‡å¾—åˆ°ï¼Œå³ï¼š<br>$V(s)&#x3D;r(s)+\gamma\sum_{s^{\prime}\in S}p(s^{\prime}|s)V(s^{\prime})$<br>è¿™å°±æ˜¯è´å°”æ›¼æ–¹ç¨‹ï¼Œå¯¹æ¯ä¸€ä¸ªçŠ¶æ€éƒ½æˆç«‹ã€‚è‹¥ä¸€ä¸ªé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ä¸€å…±æœ‰nä¸ªçŠ¶æ€ï¼Œå³$S&#x3D;{s_1,s_2,\dots,s_n}$,æˆ‘ä»¬å°†æ‰€æœ‰çŠ¶æ€çš„ä»·å€¼è¡¨ç¤ºé¢æˆä¸€ä¸ªåˆ—å‘é‡$\mathcal{V}&#x3D;[V(s_1),V(s_2),\ldots,V(s_n)]^T$<br>åŒç†ï¼Œå°†å¥–åŠ±å‡½æ•°å†™æˆä¸€ä¸ªåˆ—å‘é‡$\mathcal{R}&#x3D;[r(s_1),r(s_2),\ldots,r(s_n)]^T$<br>äºæ˜¯æˆ‘ä»¬å¯ä»¥å°†è´å°”æ›¼æ–¹ç¨‹å†™æˆçŸ©é˜µçš„å½¢å¼ï¼š<br>$$\begin{bmatrix}V(s_1)\V(s_2)\\cdots\V(s_n)\end{bmatrix}&#x3D;\begin{bmatrix}r(s_1)\r(s_2)\\cdots\r(s_n)\end{bmatrix}+\gamma\begin{bmatrix}P(s_1|s_1)&amp;p(s_2|s_1)&amp;\ldots&amp;P(s_n|s_1)\P(s_1|s_2)&amp;P(s_2|s_2)&amp;\ldots&amp;P(s_n|s_2)\\cdots\P(s_1|s_n)&amp;P(s_2|s_n)&amp;\ldots&amp;P(s_n|s_n)\end{bmatrix}$$<br>æ±‚è§£çŸ©é˜µè¿ç®—å¾—ï¼š<br>$\mathcal{V}&#x3D;\mathcal{R}+\gamma\mathcal{PV}$<br>ä»¥ä¸Šè§£æè§£çš„è®¡ç®—å¤æ‚åº¦æ˜¯$O(n^3)$ï¼Œå…¶ä¸­æ˜¯çŠ¶æ€ä¸ªæ•°ï¼Œå› æ­¤è¿™ç§æ–¹æ³•åªé€‚ç”¨å¾ˆå°çš„é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ã€‚æ±‚è§£è¾ƒå¤§è§„æ¨¡çš„é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ä¸­çš„ä»·å€¼å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>ï¼ˆdynamic programmingï¼‰ç®—æ³•ã€<strong>è’™ç‰¹å¡æ´›æ–¹æ³•</strong>ï¼ˆMonte-Carlo methodï¼‰å’Œ<strong>æ—¶åºå·®åˆ†</strong>ï¼ˆtemporal differenceï¼‰.</p><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">compute</span>(<span class="hljs-params">P, rewards, gamma, states_num</span>):<br><br>    <span class="hljs-string">&#x27;&#x27;&#x27; åˆ©ç”¨è´å°”æ›¼æ–¹ç¨‹çš„çŸ©é˜µå½¢å¼è®¡ç®—è§£æè§£,states_numæ˜¯MRPçš„çŠ¶æ€æ•° &#x27;&#x27;&#x27;</span><br>    rewards = np.array(rewards).reshape((-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))  <span class="hljs-comment">#å°†rewardså†™æˆåˆ—å‘é‡å½¢å¼</span><br>    value = np.dot(np.linalg.inv(np.eye(states_num, states_num) - gamma * P),<br><br>                   rewards)<br><br>    <span class="hljs-keyword">return</span> value<br><br>V = compute(P, rewards, gamma, <span class="hljs-number">6</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;MRPä¸­æ¯ä¸ªçŠ¶æ€ä»·å€¼åˆ†åˆ«ä¸º\n&quot;</span>, V)<br></code></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šè¿°ä»£ç æ±‚è§£å¾—åˆ°å„ä¸ªçŠ¶æ€çš„ä»·å€¼V(s),å…·ä½“å¦‚ä¸‹ï¼š<br><img src="/image/RL-23.png"><br>æˆ‘ä»¬ç°åœ¨ç”¨è´å°”æ›¼æ–¹ç¨‹æ¥è¿›è¡Œç®€å•çš„éªŒè¯ã€‚ä¾‹å¦‚ï¼Œå¯¹äºçŠ¶æ€æ¥è¯´ï¼Œå½“$\gamma$&#x3D;0.5æ—¶ï¼š<br>$\begin{aligned}&amp;V(s_4)&#x3D;r(s_4)+\gamma\sum_{s^{\prime}\in\mathcal{S}}P(s^{\prime}|s_4)V(s^{\prime})\&amp;10.54&#x3D;10+0.5\times(0.7\times0+0.3\times3.59)\end{aligned}$<br>å¯ä»¥å‘ç°å·¦å³ä¸¤è¾¹çš„å€¼å‡ ä¹æ˜¯ç›¸ç­‰çš„ï¼Œè¯´æ˜æˆ‘ä»¬æ±‚è§£å¾—åˆ°çš„ä»·å€¼å‡½æ•°æ˜¯æ»¡è¶³çŠ¶æ€ä¸º$s_4$æ—¶çš„è´å°”æ›¼æ–¹ç¨‹ã€‚è¯»è€…å¯ä»¥è‡ªè¡ŒéªŒè¯åœ¨å…¶ä»–çŠ¶æ€æ—¶è´å°”æ›¼æ–¹ç¨‹æ˜¯å¦ä¹Ÿæˆç«‹ã€‚è‹¥è´å°”æ›¼æ–¹ç¨‹å¯¹äºæ‰€æœ‰çŠ¶æ€éƒ½æˆç«‹ï¼Œå°±å¯ä»¥è¯´æ˜æˆ‘ä»¬æ±‚è§£å¾—åˆ°çš„ä»·å€¼å‡½æ•°æ˜¯æ­£ç¡®çš„ã€‚é™¤äº†ä½¿ç”¨åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ä¸­çš„ä»·å€¼å‡½æ•°ä¹Ÿå¯ä»¥é€šè¿‡è’™ç‰¹å¡æ´›æ–¹æ³•ä¼°è®¡å¾—åˆ°ï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬5èŠ‚ä¸­ä»‹ç»è¯¥æ–¹æ³•ã€‚</p><h1 id="4-é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹"><a href="#4-é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹" class="headerlink" title="4 é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹"></a>4 é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹</h1><p>å‰ä¸¤èŠ‚æåˆ°çš„é©¬å°”å¯å¤«è¿‡ç¨‹å’Œé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹éƒ½æ˜¯è‡ªå‘æ”¹å˜çš„éšæœºè¿‡ç¨‹ï¼›è€Œå¦‚æœæœ‰ä¸€ä¸ªå¤–ç•Œçš„â€œåˆºæ¿€â€æ¥å…±åŒæ”¹å˜è¿™ä¸ªéšæœºè¿‡ç¨‹ï¼Œå°±æœ‰äº†<strong>é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹</strong>ï¼ˆMarkov decision processï¼ŒMDPï¼‰ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæ¥è‡ªå¤–ç•Œçš„åˆºæ¿€ç§°ä¸º<strong>æ™ºèƒ½ä½“</strong>ï¼ˆagentï¼‰çš„åŠ¨ä½œï¼Œåœ¨é©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ï¼ˆMRPï¼‰çš„åŸºç¡€ä¸ŠåŠ å…¥åŠ¨ä½œï¼Œå°±å¾—åˆ°äº†é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMDPï¼‰ã€‚é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ç”±å…ƒç»„$\langle\mathcal{S},\mathcal{A},P,r,\gamma\rangle$æ„æˆï¼Œå…¶ä¸­ï¼š</p><ul><li>$\mathcal{S}$æ˜¯çŠ¶æ€çš„é›†åˆï¼›</li><li>$\mathcal{A}$æ˜¯åŠ¨ä½œçš„é›†åˆï¼›</li><li>$\mathcal{\gamma}$æ˜¯æŠ˜æ‰£å› å­ï¼›</li><li>$\mathcal{r(s,a)}$æ˜¯å¥–åŠ±å‡½æ•°ï¼Œæ­¤æ—¶å¥–åŠ±å¯ä»¥åŒæ—¶å–å†³äºçŠ¶æ€å’ŒåŠ¨ä½œï¼Œåœ¨å¥–åŠ±å‡½æ•°åªå–å†³äºçŠ¶æ€æ—¶ï¼Œåˆ™é€€åŒ–ä¸ºï¼›</li><li>$P(s^{\prime}|s,a)$æ˜¯çŠ¶æ€è½¬ç§»å‡½æ•°ï¼Œè¡¨ç¤ºåœ¨çŠ¶æ€sæ‰§è¡ŒåŠ¨ä½œaä¹‹ååˆ°è¾¾çŠ¶æ€$s^{\prime}$çš„æ¦‚ç‡ã€‚<br>æˆ‘ä»¬å‘ç° MDP ä¸ MRP éå¸¸ç›¸åƒï¼Œä¸»è¦åŒºåˆ«ä¸º MDP ä¸­çš„çŠ¶æ€è½¬ç§»å‡½æ•°å’Œå¥–åŠ±å‡½æ•°éƒ½æ¯” MRP å¤šäº†åŠ¨ä½œaä½œä¸ºè‡ªå˜é‡ã€‚æ³¨æ„ï¼Œåœ¨ä¸Šé¢ MDP çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä¸å†ä½¿ç”¨ç±»ä¼¼ MRP å®šä¹‰ä¸­çš„çŠ¶æ€è½¬ç§»çŸ©é˜µæ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥è¡¨ç¤ºæˆäº†çŠ¶æ€è½¬ç§»å‡½æ•°ã€‚è¿™æ ·åšä¸€æ˜¯å› ä¸ºæ­¤æ—¶çŠ¶æ€è½¬ç§»ä¸åŠ¨ä½œä¹Ÿæœ‰å…³ï¼Œå˜æˆäº†ä¸€ä¸ªä¸‰ç»´æ•°ç»„ï¼Œè€Œä¸å†æ˜¯ä¸€ä¸ªçŸ©é˜µï¼ˆäºŒç»´æ•°ç»„ï¼‰ï¼›äºŒæ˜¯å› ä¸ºçŠ¶æ€è½¬ç§»å‡½æ•°æ›´å…·æœ‰ä¸€èˆ¬æ„ä¹‰ï¼Œä¾‹å¦‚ï¼Œå¦‚æœçŠ¶æ€é›†åˆä¸æ˜¯æœ‰é™çš„ï¼Œå°±æ— æ³•ç”¨æ•°ç»„è¡¨ç¤ºï¼Œä½†ä»ç„¶å¯ä»¥ç”¨çŠ¶æ€è½¬ç§»å‡½æ•°è¡¨ç¤ºã€‚æˆ‘ä»¬åœ¨ä¹‹åçš„è¯¾ç¨‹å­¦ä¹ ä¸­ä¼šé‡åˆ°è¿ç»­çŠ¶æ€çš„ MDP ç¯å¢ƒï¼Œé‚£æ—¶çŠ¶æ€é›†åˆéƒ½ä¸æ˜¯æœ‰é™çš„ã€‚ç°åœ¨æˆ‘ä»¬ä¸»è¦å…³æ³¨äºç¦»æ•£çŠ¶æ€çš„ MDP ç¯å¢ƒï¼Œæ­¤æ—¶çŠ¶æ€é›†åˆæ˜¯æœ‰é™çš„ã€‚<br>ä¸åŒäºé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ï¼Œåœ¨é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸å­˜åœ¨ä¸€ä¸ªæ™ºèƒ½ä½“æ¥æ‰§è¡ŒåŠ¨ä½œã€‚ä¾‹å¦‚ï¼Œä¸€è‰˜å°èˆ¹åœ¨å¤§æµ·ä¸­éšç€æ°´æµè‡ªç”±é£˜è¡çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªé©¬å°”å¯å¤«å¥–åŠ±è¿‡ç¨‹ï¼Œå®ƒå¦‚æœå‡­å€Ÿè¿æ°”æ¼‚åˆ°äº†ä¸€ä¸ªç›®çš„åœ°ï¼Œå°±èƒ½è·å¾—æ¯”è¾ƒå¤§çš„å¥–åŠ±ï¼›å¦‚æœæœ‰ä¸ªæ°´æ‰‹åœ¨æ§åˆ¶ç€è¿™æ¡èˆ¹å¾€å“ªä¸ªæ–¹å‘å‰è¿›ï¼Œå°±å¯ä»¥ä¸»åŠ¨é€‰æ‹©å‰å¾€ç›®çš„åœ°è·å¾—æ¯”è¾ƒå¤§çš„å¥–åŠ±ã€‚é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹æ˜¯ä¸€ä¸ªä¸æ—¶é—´ç›¸å…³çš„ä¸æ–­è¿›è¡Œçš„è¿‡ç¨‹ï¼Œåœ¨æ™ºèƒ½ä½“å’Œç¯å¢ƒ MDP ä¹‹é—´å­˜åœ¨ä¸€ä¸ªä¸æ–­äº¤äº’çš„è¿‡ç¨‹ã€‚<br>ä¸€èˆ¬è€Œè¨€ï¼Œå®ƒä»¬ä¹‹é—´çš„äº¤äº’æ˜¯å¦‚ä¸‹å›¾å¾ªç¯è¿‡ç¨‹ï¼šæ™ºèƒ½ä½“æ ¹æ®å½“å‰çŠ¶æ€$S_t$é€‰æ‹©åŠ¨ä½œ$A_t$ï¼›å¯¹äºçŠ¶æ€$S_t$å’ŒåŠ¨ä½œ$A_t$ï¼ŒMDP æ ¹æ®å¥–åŠ±å‡½æ•°å’ŒçŠ¶æ€è½¬ç§»å‡½æ•°å¾—åˆ°$S_{t+1}$å’Œ$R_t$å¹¶åé¦ˆç»™æ™ºèƒ½ä½“ã€‚æ™ºèƒ½ä½“çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–å¾—åˆ°çš„ç´¯è®¡å¥–åŠ±ã€‚æ™ºèƒ½ä½“æ ¹æ®å½“å‰çŠ¶æ€ä»åŠ¨ä½œçš„é›†åˆAä¸­é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œçš„å‡½æ•°ï¼Œè¢«ç§°ä¸ºç­–ç•¥ã€‚<br><img src="/image/RL-24.png"></li></ul><h2 id="4-1ç­–ç•¥"><a href="#4-1ç­–ç•¥" class="headerlink" title="4.1ç­–ç•¥"></a>4.1ç­–ç•¥</h2><p>æ™ºèƒ½ä½“çš„<strong>ç­–ç•¥</strong>ï¼ˆPolicyï¼‰é€šå¸¸ç”¨å­—æ¯$\pi$è¡¨ç¤ºã€‚ç­–ç•¥$\pi(a|s)&#x3D;P(A_t&#x3D;a|S_t&#x3D;s)$æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¡¨ç¤ºåœ¨è¾“å…¥çŠ¶æ€æƒ…å†µä¸‹é‡‡å–åŠ¨ä½œçš„æ¦‚ç‡ã€‚å½“ä¸€ä¸ªç­–ç•¥æ˜¯<strong>ç¡®å®šæ€§ç­–ç•¥</strong>ï¼ˆdeterministic policyï¼‰æ—¶ï¼Œå®ƒåœ¨æ¯ä¸ªçŠ¶æ€æ—¶åªè¾“å‡ºä¸€ä¸ªç¡®å®šæ€§çš„åŠ¨ä½œï¼Œå³åªæœ‰è¯¥åŠ¨ä½œçš„æ¦‚ç‡ä¸º 1ï¼Œå…¶ä»–åŠ¨ä½œçš„æ¦‚ç‡ä¸º 0ï¼›å½“ä¸€ä¸ªç­–ç•¥æ˜¯<strong>éšæœºæ€§ç­–ç•¥</strong>ï¼ˆstochastic policyï¼‰æ—¶ï¼Œå®ƒåœ¨æ¯ä¸ªçŠ¶æ€æ—¶è¾“å‡ºçš„æ˜¯å…³äºåŠ¨ä½œçš„æ¦‚ç‡åˆ†å¸ƒï¼Œç„¶åæ ¹æ®è¯¥åˆ†å¸ƒè¿›è¡Œé‡‡æ ·å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåŠ¨ä½œã€‚åœ¨ MDP ä¸­ï¼Œç”±äºé©¬å°”å¯å¤«æ€§è´¨çš„å­˜åœ¨ï¼Œç­–ç•¥åªéœ€è¦ä¸å½“å‰çŠ¶æ€æœ‰å…³ï¼Œä¸éœ€è¦è€ƒè™‘å†å²çŠ¶æ€ã€‚å›é¡¾ä¸€ä¸‹åœ¨ MRP ä¸­çš„ä»·å€¼å‡½æ•°ï¼Œåœ¨ MDP ä¸­ä¹ŸåŒæ ·å¯ä»¥å®šä¹‰ç±»ä¼¼çš„ä»·å€¼å‡½æ•°ã€‚ä½†æ­¤æ—¶çš„ä»·å€¼å‡½æ•°ä¸ç­–ç•¥æœ‰å…³ï¼Œè¿™æ„ä¸ºç€å¯¹äºä¸¤ä¸ªä¸åŒçš„ç­–ç•¥æ¥è¯´ï¼Œå®ƒä»¬åœ¨åŒä¸€ä¸ªçŠ¶æ€ä¸‹çš„ä»·å€¼ä¹Ÿå¾ˆå¯èƒ½æ˜¯ä¸åŒçš„ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºä¸åŒçš„ç­–ç•¥ä¼šé‡‡å–ä¸åŒçš„åŠ¨ä½œï¼Œä»è€Œä¹‹åä¼šé‡åˆ°ä¸åŒçš„çŠ¶æ€ï¼Œä»¥åŠè·å¾—ä¸åŒçš„å¥–åŠ±ï¼Œæ‰€ä»¥å®ƒä»¬çš„ç´¯ç§¯å¥–åŠ±çš„æœŸæœ›ä¹Ÿå°±ä¸åŒï¼Œå³çŠ¶æ€ä»·å€¼ä¸åŒã€‚</p><h2 id="4-2çŠ¶æ€ä»·å€¼å‡½æ•°"><a href="#4-2çŠ¶æ€ä»·å€¼å‡½æ•°" class="headerlink" title="4.2çŠ¶æ€ä»·å€¼å‡½æ•°"></a>4.2çŠ¶æ€ä»·å€¼å‡½æ•°</h2><p>æˆ‘ä»¬ç”¨$V^{\pi}(s)$è¡¨ç¤ºåœ¨ MDP ä¸­åŸºäºç­–ç•¥$\pi$çš„çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆstate-value functionï¼‰ï¼Œå®šä¹‰ä¸ºä»çŠ¶æ€så‡ºå‘éµå¾ªç­–ç•¥$\pi$èƒ½è·å¾—çš„æœŸæœ›å›æŠ¥ï¼Œæ•°å­¦è¡¨è¾¾ä¸ºï¼š<br>$V^\pi(s)&#x3D;\mathbb{E}_\pi[G_t|S_t&#x3D;s]$</p><h2 id="4-3åŠ¨ä½œä»·å€¼å‡½æ•°"><a href="#4-3åŠ¨ä½œä»·å€¼å‡½æ•°" class="headerlink" title="4.3åŠ¨ä½œä»·å€¼å‡½æ•°"></a>4.3åŠ¨ä½œä»·å€¼å‡½æ•°</h2><p>ä¸åŒäº MRPï¼Œåœ¨ MDP ä¸­ï¼Œç”±äºåŠ¨ä½œçš„å­˜åœ¨ï¼Œæˆ‘ä»¬é¢å¤–å®šä¹‰ä¸€ä¸ª<strong>åŠ¨ä½œä»·å€¼å‡½æ•°</strong>ï¼ˆaction-value functionï¼‰ã€‚æˆ‘ä»¬ç”¨$Q^\pi(s,a)$è¡¨ç¤ºåœ¨ MDP éµå¾ªç­–ç•¥$\pi$æ—¶ï¼Œå¯¹å½“å‰çŠ¶æ€sæ‰§è¡ŒåŠ¨ä½œå¾—åˆ°çš„æœŸæœ›å›æŠ¥ï¼š<br>$Q^\pi(s,a)&#x3D;\mathbb{E}<em>\pi[G_t|S_t&#x3D;s,A_t&#x3D;a]$<br>çŠ¶æ€ä»·å€¼å‡½æ•°å’ŒåŠ¨ä½œä»·å€¼å‡½æ•°ä¹‹é—´çš„å…³ç³»ï¼šåœ¨ä½¿ç”¨ç­–ç•¥$\pi$ä¸­ï¼ŒçŠ¶æ€sçš„ä»·å€¼ç­‰äºåœ¨è¯¥çŠ¶æ€ä¸‹åŸºäºç­–ç•¥$\pi$é‡‡å–æ‰€æœ‰åŠ¨ä½œçš„æ¦‚ç‡ä¸ç›¸åº”çš„ä»·å€¼ç›¸ä¹˜å†æ±‚å’Œçš„ç»“æœï¼š<br>$V^\pi(s)&#x3D;\sum</em>{a\in A}\pi(a|s)Q^\pi(s,a)$<br>ä½¿ç”¨ç­–ç•¥$\pi$æ—¶ï¼ŒçŠ¶æ€sä¸‹é‡‡å–åŠ¨ä½œaçš„ä»·å€¼ç­‰äºå³æ—¶å¥–åŠ±åŠ ä¸Šç»è¿‡è¡°å‡åçš„æ‰€æœ‰å¯èƒ½çš„ä¸‹ä¸€ä¸ªçŠ¶æ€çš„çŠ¶æ€è½¬ç§»æ¦‚ç‡ä¸ç›¸åº”çš„ä»·å€¼çš„ä¹˜ç§¯ï¼š<br>$Q^\pi(s,a)&#x3D;r(s,a)+\gamma\sum_{s^{\prime}\in S}P(s^{\prime}|s,a)V^\pi(s^{\prime})$</p><h2 id="4-4è´å°”æ›¼æœŸæœ›æ–¹ç¨‹"><a href="#4-4è´å°”æ›¼æœŸæœ›æ–¹ç¨‹" class="headerlink" title="4.4è´å°”æ›¼æœŸæœ›æ–¹ç¨‹"></a>4.4è´å°”æ›¼æœŸæœ›æ–¹ç¨‹</h2><p>åœ¨è´å°”æ›¼æ–¹ç¨‹ä¸­åŠ ä¸Šâ€œæœŸæœ›â€äºŒå­—æ˜¯ä¸ºäº†ä¸æ¥ä¸‹æ¥çš„è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹è¿›è¡ŒåŒºåˆ†ã€‚æˆ‘ä»¬é€šè¿‡ç®€å•æ¨å¯¼å°±å¯ä»¥åˆ†åˆ«å¾—åˆ°ä¸¤ä¸ªä»·å€¼å‡½æ•°çš„<strong>è´å°”æ›¼æœŸæœ›æ–¹ç¨‹</strong>ï¼ˆBellman Expectation Equationï¼‰ï¼š<br>$$\begin{aligned}<br>V^{\pi}(s)&amp; &#x3D;\mathbb{E}<em>\pi[R_t+\gamma V^\pi(S</em>{t+1})|S_t&#x3D;s] \<br>&amp;&#x3D;\sum_{a\in A}\pi(a|s)\left(r(s,a)+\gamma\sum_{s^{\prime}\in S}p(s^{\prime}|s,a)V^\pi(s^{\prime})\right) \<br>Q^{\pi}(s,a)&amp; &#x3D;\mathbb{E}<em>\pi[R_t+\gamma Q^\pi(S</em>{t+1},A_{t+1})|S_t&#x3D;s,A_t&#x3D;a] \<br>&amp;&#x3D;r(s,a)+\gamma\sum_{s^{\prime}\in S}p(s^{\prime}|s,a)\sum_{a^{\prime}\in A}\pi(a^{\prime}|s^{\prime})Q^\pi(s^{\prime},a^{\prime})<br>\end{aligned}$$<br>ä»·å€¼å‡½æ•°å’Œè´å°”æ›¼æ–¹ç¨‹æ˜¯å¼ºåŒ–å­¦ä¹ éå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œä¹‹åçš„ä¸€äº›å¼ºåŒ–å­¦ä¹ ç®—æ³•éƒ½æ˜¯æ®æ­¤æ¨å¯¼å‡ºæ¥çš„ï¼Œè¯»è€…éœ€è¦æ˜ç¡®æŒæ¡ï¼<br>ä¸‹å›¾æ˜¯ä¸€ä¸ªé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹çš„ç®€å•ä¾‹å­ï¼Œå…¶ä¸­æ¯ä¸ªæ·±è‰²åœ†åœˆä»£è¡¨ä¸€ä¸ªçŠ¶æ€ï¼Œä¸€å…±æœ‰5ä¸ªçŠ¶æ€ã€‚é»‘è‰²å®çº¿ç®­å¤´ä»£è¡¨å¯ä»¥é‡‡å–çš„åŠ¨ä½œï¼Œæµ…è‰²å°åœ†åœˆä»£è¡¨åŠ¨ä½œï¼Œéœ€è¦æ³¨æ„ï¼Œå¹¶éåœ¨æ¯ä¸ªçŠ¶æ€éƒ½èƒ½é‡‡å–æ‰€æœ‰åŠ¨ä½œã€‚<br><img src="/image/RL-25.png"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™ä»£ç æ¥è¡¨ç¤ºå›¾ 3-4 ä¸­çš„é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼Œå¹¶å®šä¹‰ä¸¤ä¸ªç­–ç•¥ã€‚ç¬¬ä¸€ä¸ªç­–ç•¥æ˜¯ä¸€ä¸ªå®Œå…¨éšæœºç­–ç•¥ï¼Œå³åœ¨æ¯ä¸ªçŠ¶æ€ä¸‹ï¼Œæ™ºèƒ½ä½“ä¼šä»¥åŒæ ·çš„æ¦‚ç‡é€‰å–å®ƒå¯èƒ½é‡‡å–çš„åŠ¨ä½œã€‚</p><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs makefile">S = [<span class="hljs-string">&quot;s1&quot;</span>, <span class="hljs-string">&quot;s2&quot;</span>, <span class="hljs-string">&quot;s3&quot;</span>, <span class="hljs-string">&quot;s4&quot;</span>, <span class="hljs-string">&quot;s5&quot;</span>]  <span class="hljs-comment"># çŠ¶æ€é›†åˆ</span><br>A = [<span class="hljs-string">&quot;ä¿æŒs1&quot;</span>, <span class="hljs-string">&quot;å‰å¾€s1&quot;</span>, <span class="hljs-string">&quot;å‰å¾€s2&quot;</span>, <span class="hljs-string">&quot;å‰å¾€s3&quot;</span>, <span class="hljs-string">&quot;å‰å¾€s4&quot;</span>, <span class="hljs-string">&quot;å‰å¾€s5&quot;</span>, <span class="hljs-string">&quot;æ¦‚ç‡å‰å¾€&quot;</span>]  <span class="hljs-comment"># åŠ¨ä½œé›†åˆ</span><br><span class="hljs-comment"># çŠ¶æ€è½¬ç§»å‡½æ•°</span><br>P = &#123;<br>    <span class="hljs-string">&quot;s1-ä¿æŒs1-s1&quot;</span>: 1.0,<br>    <span class="hljs-string">&quot;s1-å‰å¾€s2-s2&quot;</span>: 1.0,<br>    <span class="hljs-string">&quot;s2-å‰å¾€s1-s1&quot;</span>: 1.0,<br>    <span class="hljs-string">&quot;s2-å‰å¾€s3-s3&quot;</span>: 1.0,<br>    <span class="hljs-string">&quot;s3-å‰å¾€s4-s4&quot;</span>: 1.0,<br>    <span class="hljs-string">&quot;s3-å‰å¾€s5-s5&quot;</span>: 1.0,<br>    <span class="hljs-string">&quot;s4-å‰å¾€s5-s5&quot;</span>: 1.0,<br>    <span class="hljs-string">&quot;s4-æ¦‚ç‡å‰å¾€-s2&quot;</span>: 0.2,<br>    <span class="hljs-string">&quot;s4-æ¦‚ç‡å‰å¾€-s3&quot;</span>: 0.4,<br>    <span class="hljs-string">&quot;s4-æ¦‚ç‡å‰å¾€-s4&quot;</span>: 0.4,<br>&#125;<br><span class="hljs-comment"># å¥–åŠ±å‡½æ•°</span><br>R = &#123;<br>    <span class="hljs-string">&quot;s1-ä¿æŒs1&quot;</span>: -1,<br>    <span class="hljs-string">&quot;s1-å‰å¾€s2&quot;</span>: 0,<br>    <span class="hljs-string">&quot;s2-å‰å¾€s1&quot;</span>: -1,<br>    <span class="hljs-string">&quot;s2-å‰å¾€s3&quot;</span>: -2,<br>    <span class="hljs-string">&quot;s3-å‰å¾€s4&quot;</span>: -2,<br>    <span class="hljs-string">&quot;s3-å‰å¾€s5&quot;</span>: 0,<br>    <span class="hljs-string">&quot;s4-å‰å¾€s5&quot;</span>: 10,<br>    <span class="hljs-string">&quot;s4-æ¦‚ç‡å‰å¾€&quot;</span>: 1,<br>&#125;<br>gamma = 0.5  <span class="hljs-comment"># æŠ˜æ‰£å› å­</span><br>MDP = (S, A, P, R, gamma)<br><br><span class="hljs-comment"># ç­–ç•¥1,éšæœºç­–ç•¥</span><br>Pi_1 = &#123;<br>    <span class="hljs-string">&quot;s1-ä¿æŒs1&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s1-å‰å¾€s2&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s2-å‰å¾€s1&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s2-å‰å¾€s3&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s3-å‰å¾€s4&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s3-å‰å¾€s5&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s4-å‰å¾€s5&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s4-æ¦‚ç‡å‰å¾€&quot;</span>: 0.5,<br>&#125;<br><span class="hljs-comment"># ç­–ç•¥2</span><br>Pi_2 = &#123;<br>    <span class="hljs-string">&quot;s1-ä¿æŒs1&quot;</span>: 0.6,<br>    <span class="hljs-string">&quot;s1-å‰å¾€s2&quot;</span>: 0.4,<br>    <span class="hljs-string">&quot;s2-å‰å¾€s1&quot;</span>: 0.3,<br>    <span class="hljs-string">&quot;s2-å‰å¾€s3&quot;</span>: 0.7,<br>    <span class="hljs-string">&quot;s3-å‰å¾€s4&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s3-å‰å¾€s5&quot;</span>: 0.5,<br>    <span class="hljs-string">&quot;s4-å‰å¾€s5&quot;</span>: 0.1,<br>    <span class="hljs-string">&quot;s4-æ¦‚ç‡å‰å¾€&quot;</span>: 0.9,<br>&#125;<br><br><br><span class="hljs-comment"># æŠŠè¾“å…¥çš„ä¸¤ä¸ªå­—ç¬¦ä¸²é€šè¿‡â€œ-â€è¿æ¥,ä¾¿äºä½¿ç”¨ä¸Šè¿°å®šä¹‰çš„Pã€Rå˜é‡</span><br>def join(str1, str2):<br>    return str1 + &#x27;-&#x27; + str2<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æƒ³è¦è®¡ç®—è¯¥ MDP ä¸‹ï¼Œä¸€ä¸ªç­–ç•¥$\pi$çš„çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚æˆ‘ä»¬ç°åœ¨æœ‰çš„å·¥å…·æ˜¯ MRP çš„è§£æè§£æ–¹æ³•ã€‚äºæ˜¯ï¼Œä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯ï¼šç»™å®šä¸€ä¸ª MDP å’Œä¸€ä¸ªç­–ç•¥$\pi$ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†å…¶è½¬åŒ–ä¸ºä¸€ä¸ª MRPï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚æˆ‘ä»¬å¯ä»¥å°†ç­–ç•¥çš„åŠ¨ä½œé€‰æ‹©è¿›è¡Œ<strong>è¾¹ç¼˜åŒ–</strong>ï¼ˆmarginalization)ï¼Œå°±å¯ä»¥å¾—åˆ°æ²¡æœ‰åŠ¨ä½œçš„ MRP äº†ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºæŸä¸€ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬æ ¹æ®ç­–ç•¥æ‰€æœ‰åŠ¨ä½œçš„æ¦‚ç‡è¿›è¡ŒåŠ æƒï¼Œå¾—åˆ°çš„å¥–åŠ±å’Œå°±å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ª MRP åœ¨è¯¥çŠ¶æ€ä¸‹çš„å¥–åŠ±ï¼Œå³ï¼š<br>$râ€™(s)&#x3D;\sum_{a\in\mathcal{A}}\pi(a|s)r(s,a)$<br>åŒç†ï¼Œæˆ‘ä»¬è®¡ç®—é‡‡å–åŠ¨ä½œçš„æ¦‚ç‡ä¸ä½¿sè½¬ç§»åˆ°çš„æ¦‚ç‡$s^{\prime}$çš„ä¹˜ç§¯ï¼Œå†å°†è¿™äº›ä¹˜ç§¯ç›¸åŠ ï¼Œå…¶å’Œå°±æ˜¯ä¸€ä¸ª MRP çš„çŠ¶æ€ä»sè½¬ç§»$s^{\prime}$è‡³çš„æ¦‚ç‡ï¼š<br>$Pâ€™(sâ€™|s)&#x3D;\sum_{a\in\mathcal{A}}\pi(a|s)P(sâ€™|s,a)$<br>äºæ˜¯ï¼Œæˆ‘ä»¬æ„å»ºå¾—åˆ°äº†ä¸€ä¸ª MRP:$\langle\mathcal{S},P^{\prime},r^{\prime},\gamma\rangle$ã€‚æ ¹æ®ä»·å€¼å‡½æ•°çš„å®šä¹‰å¯ä»¥å‘ç°ï¼Œè½¬åŒ–å‰çš„ MDP çš„çŠ¶æ€ä»·å€¼å‡½æ•°å’Œè½¬åŒ–åçš„ MRP çš„ä»·å€¼å‡½æ•°æ˜¯ä¸€æ ·çš„ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ MRP ä¸­è®¡ç®—ä»·å€¼å‡½æ•°çš„è§£æè§£æ¥è®¡ç®—è¿™ä¸ª MDP ä¸­è¯¥ç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚<br>æˆ‘ä»¬æ¥ä¸‹æ¥å°±ç¼–å†™ä»£ç æ¥å®ç°è¯¥æ–¹æ³•ï¼Œè®¡ç®—ç”¨éšæœºç­–ç•¥ï¼ˆä¹Ÿå°±æ˜¯ä»£ç ä¸­çš„<code>Pi_1</code>ï¼‰æ—¶çš„çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç›´æ¥ç»™å‡ºè½¬åŒ–åçš„ MRP çš„çŠ¶æ€è½¬ç§»çŸ©é˜µå’Œå¥–åŠ±å‡½æ•°ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡ŒéªŒè¯ã€‚</p><h3 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs prolog">gamma = <span class="hljs-number">0.5</span><br># è½¬åŒ–åçš„<span class="hljs-symbol">MRP</span>çš„çŠ¶æ€è½¬ç§»çŸ©é˜µ<br><span class="hljs-symbol">P_from_mdp_to_mrp</span> = [<br>    [<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],<br>    [<span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],<br>    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>],<br>    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>],<br>    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>],<br>]<br><span class="hljs-symbol">P_from_mdp_to_mrp</span> = np.array(<span class="hljs-symbol">P_from_mdp_to_mrp</span>)<br><span class="hljs-symbol">R_from_mdp_to_mrp</span> = [<span class="hljs-number">-0.5</span>, <span class="hljs-number">-1.5</span>, <span class="hljs-number">-1.0</span>, <span class="hljs-number">5.5</span>, <span class="hljs-number">0</span>]<br><br><span class="hljs-symbol">V</span> = compute(<span class="hljs-symbol">P_from_mdp_to_mrp</span>, <span class="hljs-symbol">R_from_mdp_to_mrp</span>, gamma, <span class="hljs-number">5</span>)<br>print(<span class="hljs-string">&quot;MDPä¸­æ¯ä¸ªçŠ¶æ€ä»·å€¼åˆ†åˆ«ä¸º\n&quot;</span>, <span class="hljs-symbol">V</span>)<br></code></pre></td></tr></table></figure><p><img src="/image/RL-26.png"></p><p>çŸ¥é“äº†çŠ¶æ€ä»·å€¼å‡½æ•°$V^{\pi}(S)$åï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—åŠ¨ä½œä»·å€¼å‡½æ•°$Q^{\pi}(s,a)$ã€‚<br>è¿™ä¸ª MRP è§£æè§£çš„æ–¹æ³•åœ¨çŠ¶æ€åŠ¨ä½œé›†åˆæ¯”è¾ƒå¤§çš„æ—¶å€™ä¸æ˜¯å¾ˆé€‚ç”¨ï¼Œé‚£æœ‰æ²¡æœ‰å…¶ä»–çš„æ–¹æ³•å‘¢ï¼Ÿä¸‹ä¸€èŠ‚å°†ä»‹ç»ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•æ¥è¿‘ä¼¼ä¼°è®¡è¿™ä¸ªä»·å€¼å‡½æ•°ï¼Œç”¨è’™ç‰¹å¡æ´›æ–¹æ³•çš„å¥½å¤„åœ¨äºæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ MDP çš„çŠ¶æ€è½¬ç§»å‡½æ•°å’Œå¥–åŠ±å‡½æ•°ï¼Œå®ƒå¯ä»¥å¾—åˆ°ä¸€ä¸ªè¿‘ä¼¼å€¼ï¼Œå¹¶ä¸”é‡‡æ ·æ•°è¶Šå¤šè¶Šå‡†ç¡®ã€‚</p><h1 id="5-è’™ç‰¹å¡æ´›æ–¹æ³•"><a href="#5-è’™ç‰¹å¡æ´›æ–¹æ³•" class="headerlink" title="5 è’™ç‰¹å¡æ´›æ–¹æ³•"></a>5 è’™ç‰¹å¡æ´›æ–¹æ³•</h1><p><strong>è’™ç‰¹å¡æ´›æ–¹æ³•</strong>ï¼ˆMonte-Carlo methodsï¼‰ä¹Ÿè¢«ç§°ä¸ºç»Ÿè®¡æ¨¡æ‹Ÿæ–¹æ³•ï¼Œæ˜¯ä¸€ç§åŸºäºæ¦‚ç‡ç»Ÿè®¡çš„æ•°å€¼è®¡ç®—æ–¹æ³•ã€‚è¿ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨é‡å¤éšæœºæŠ½æ ·ï¼Œç„¶åè¿ç”¨æ¦‚ç‡ç»Ÿè®¡æ–¹æ³•æ¥ä»æŠ½æ ·ç»“æœä¸­å½’çº³å‡ºæˆ‘ä»¬æƒ³æ±‚çš„ç›®æ ‡çš„æ•°å€¼ä¼°è®¡ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•æ¥è®¡ç®—åœ†çš„é¢ç§¯ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾ 3-5 æ‰€ç¤ºçš„æ­£æ–¹å½¢å†…éƒ¨éšæœºäº§ç”Ÿè‹¥å¹²ä¸ªç‚¹ï¼Œç»†æ•°è½åœ¨åœ†ä¸­ç‚¹çš„ä¸ªæ•°ï¼Œåœ†çš„é¢ç§¯ä¸æ­£æ–¹å½¢é¢ç§¯ä¹‹æ¯”å°±ç­‰äºåœ†ä¸­ç‚¹çš„ä¸ªæ•°ä¸æ­£æ–¹å½¢ä¸­ç‚¹çš„ä¸ªæ•°ä¹‹æ¯”ã€‚å¦‚æœæˆ‘ä»¬éšæœºäº§ç”Ÿçš„ç‚¹çš„ä¸ªæ•°è¶Šå¤šï¼Œè®¡ç®—å¾—åˆ°åœ†çš„é¢ç§¯å°±è¶Šæ¥è¿‘äºçœŸå®çš„åœ†çš„é¢ç§¯ã€‚<br><img src="/image/RL-27.png"><br>æˆ‘ä»¬ç°åœ¨ä»‹ç»å¦‚ä½•ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•æ¥ä¼°è®¡ä¸€ä¸ªç­–ç•¥åœ¨ä¸€ä¸ªé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ä¸­çš„çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚å›å¿†ä¸€ä¸‹ï¼Œä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼æ˜¯å®ƒçš„æœŸæœ›å›æŠ¥ï¼Œé‚£ä¹ˆä¸€ä¸ªå¾ˆç›´è§‚çš„æƒ³æ³•å°±æ˜¯ç”¨ç­–ç•¥åœ¨ MDP ä¸Šé‡‡æ ·å¾ˆå¤šæ¡åºåˆ—ï¼Œè®¡ç®—ä»è¿™ä¸ªçŠ¶æ€å‡ºå‘çš„å›æŠ¥å†æ±‚å…¶æœŸæœ›å°±å¯ä»¥äº†ï¼Œå…¬å¼å¦‚ä¸‹ï¼š<br>$V^\pi(s)&#x3D;\mathbb{E}<em>\pi[G_t|S_t&#x3D;s]\approx\frac{1}{N}\sum</em>{i&#x3D;1}^NG_i^{(i)}$<br>åœ¨ä¸€æ¡åºåˆ—ä¸­ï¼Œå¯èƒ½æ²¡æœ‰å‡ºç°è¿‡è¿™ä¸ªçŠ¶æ€ï¼Œå¯èƒ½åªå‡ºç°è¿‡ä¸€æ¬¡è¿™ä¸ªçŠ¶æ€ï¼Œä¹Ÿå¯èƒ½å‡ºç°è¿‡å¾ˆå¤šæ¬¡è¿™ä¸ªçŠ¶æ€ã€‚æˆ‘ä»¬ä»‹ç»çš„è’™ç‰¹å¡æ´›ä»·å€¼ä¼°è®¡æ–¹æ³•ä¼šåœ¨è¯¥çŠ¶æ€æ¯ä¸€æ¬¡å‡ºç°æ—¶è®¡ç®—å®ƒçš„å›æŠ¥ã€‚è¿˜æœ‰ä¸€ç§é€‰æ‹©æ˜¯ä¸€æ¡åºåˆ—åªè®¡ç®—ä¸€æ¬¡å›æŠ¥ï¼Œä¹Ÿå°±æ˜¯è¿™æ¡åºåˆ—ç¬¬ä¸€æ¬¡å‡ºç°è¯¥çŠ¶æ€æ—¶è®¡ç®—åé¢çš„ç´¯ç§¯å¥–åŠ±ï¼Œè€Œåé¢å†æ¬¡å‡ºç°è¯¥çŠ¶æ€æ—¶ï¼Œè¯¥çŠ¶æ€å°±è¢«å¿½ç•¥äº†ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨ç”¨ç­–ç•¥$\pi$ä»çŠ¶æ€så¼€å§‹é‡‡æ ·åºåˆ—ï¼Œæ®æ­¤æ¥è®¡ç®—çŠ¶æ€ä»·å€¼ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªçŠ¶æ€ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨å’Œæ€»å›æŠ¥ï¼Œè®¡ç®—çŠ¶æ€ä»·å€¼çš„å…·ä½“è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚<br>(1) ä½¿ç”¨ç­–ç•¥é‡‡æ ·è‹¥å¹²æ¡åºåˆ—ï¼š<br>$s_0^{(i)}\xrightarrow{a_0^{(i)}}r_0^{(i)},s_1^{(i)}\xrightarrow{a_1^{(i)}}r_1^{(i)},s_2^{(i)}\xrightarrow{a_2^{(i)}}\cdots\xrightarrow{a_{T-1}^{(i)}}r_{T-1}^{(i)},s_T^{(i)}$<br>(2) å¯¹æ¯ä¸€æ¡åºåˆ—ä¸­çš„æ¯ä¸€æ—¶é—´æ­¥çš„çŠ¶æ€è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>æ›´æ–°çŠ¶æ€sçš„è®¡æ•°å™¨$N(s)\leftarrow N(s)+1$</li><li>æ›´æ–°çŠ¶æ€sçš„æ€»å›æŠ¥$N(s)\leftarrow N(s)+G_t$<br>(3) æ¯ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼è¢«ä¼°è®¡ä¸ºå›æŠ¥çš„å¹³å‡å€¼$V(s)&#x3D;M(s)&#x2F;N(s)$<br>æ ¹æ®å¤§æ•°å®šå¾‹ï¼Œå½“$N(s)\to\infty$,æœ‰$V(s)\to V^\pi(s)$<br>è®¡ç®—å›æŠ¥çš„æœŸæœ›æ—¶ï¼Œé™¤äº†å¯ä»¥æŠŠæ‰€æœ‰çš„å›æŠ¥åŠ èµ·æ¥é™¤ä»¥æ¬¡æ•°ï¼Œè¿˜æœ‰ä¸€ç§å¢é‡æ›´æ–°çš„æ–¹æ³•ã€‚å¯¹äºæ¯ä¸ªçŠ¶æ€så’Œå¯¹åº”å›æŠ¥Gï¼Œè¿›è¡Œå¦‚ä¸‹è®¡ç®—ï¼š<br>$$\begin{aligned}<br>&amp;N(s)\leftarrow N(s)+1 \<br>&amp;V(s)\leftarrow V(s)+\frac{1}{N(s)}(G-V(S))<br>\end{aligned}$$<br>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ä»£ç å®šä¹‰ä¸€ä¸ªé‡‡æ ·å‡½æ•°ã€‚é‡‡æ ·å‡½æ•°éœ€è¦éµå®ˆçŠ¶æ€è½¬ç§»çŸ©é˜µå’Œç›¸åº”çš„ç­–ç•¥ï¼Œæ¯æ¬¡å°†<code>(s,a,r,s_next)</code>å…ƒç»„æ”¾å…¥åºåˆ—ä¸­ï¼Œç›´åˆ°åˆ°è¾¾ç»ˆæ­¢åºåˆ—ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡è¯¥å‡½æ•°ï¼Œç”¨éšæœºç­–ç•¥åœ¨ä¸‹å›¾çš„ MDP ä¸­éšæœºé‡‡æ ·å‡ æ¡åºåˆ—ã€‚</li></ul><h3 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">sample</span>(<span class="hljs-params">MDP, Pi, timestep_max, number</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27; é‡‡æ ·å‡½æ•°,ç­–ç•¥Pi,é™åˆ¶æœ€é•¿æ—¶é—´æ­¥timestep_max,æ€»å…±é‡‡æ ·åºåˆ—æ•°number &#x27;&#x27;&#x27;</span><br>    S, A, P, R, gamma = MDP<br>    episodes = []<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(number):<br>        episode = []<br>        timestep = <span class="hljs-number">0</span><br>        s = S[np.random.randint(<span class="hljs-number">4</span>)]  <span class="hljs-comment"># éšæœºé€‰æ‹©ä¸€ä¸ªé™¤s5ä»¥å¤–çš„çŠ¶æ€sä½œä¸ºèµ·ç‚¹</span><br>        <span class="hljs-comment"># å½“å‰çŠ¶æ€ä¸ºç»ˆæ­¢çŠ¶æ€æˆ–è€…æ—¶é—´æ­¥å¤ªé•¿æ—¶,ä¸€æ¬¡é‡‡æ ·ç»“æŸ</span><br>        <span class="hljs-keyword">while</span> s != <span class="hljs-string">&quot;s5&quot;</span> <span class="hljs-keyword">and</span> timestep &lt;= timestep_max:<br>            timestep += <span class="hljs-number">1</span><br>            rand, temp = np.random.rand(), <span class="hljs-number">0</span><br>            <span class="hljs-comment"># åœ¨çŠ¶æ€sä¸‹æ ¹æ®ç­–ç•¥é€‰æ‹©åŠ¨ä½œ</span><br>            <span class="hljs-keyword">for</span> a_opt <span class="hljs-keyword">in</span> A:<br>                temp += Pi.get(join(s, a_opt), <span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">if</span> temp &gt; rand:<br>                    a = a_opt<br>                    r = R.get(join(s, a), <span class="hljs-number">0</span>)<br>                    <span class="hljs-keyword">break</span><br>            rand, temp = np.random.rand(), <span class="hljs-number">0</span><br>            <span class="hljs-comment"># æ ¹æ®çŠ¶æ€è½¬ç§»æ¦‚ç‡å¾—åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€s_next</span><br>            <span class="hljs-keyword">for</span> s_opt <span class="hljs-keyword">in</span> S:<br>                temp += P.get(join(join(s, a), s_opt), <span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">if</span> temp &gt; rand:<br>                    s_next = s_opt<br>                    <span class="hljs-keyword">break</span><br>            episode.append((s, a, r, s_next))  <span class="hljs-comment"># æŠŠï¼ˆs,a,r,s_nextï¼‰å…ƒç»„æ”¾å…¥åºåˆ—ä¸­</span><br>            s = s_next  <span class="hljs-comment"># s_nextå˜æˆå½“å‰çŠ¶æ€,å¼€å§‹æ¥ä¸‹æ¥çš„å¾ªç¯</span><br>        episodes.append(episode)<br>    <span class="hljs-keyword">return</span> episodes<br><br><br><span class="hljs-comment"># é‡‡æ ·5æ¬¡,æ¯ä¸ªåºåˆ—æœ€é•¿ä¸è¶…è¿‡20æ­¥</span><br>episodes = sample(MDP, Pi_1, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç¬¬ä¸€æ¡åºåˆ—\n&#x27;</span>, episodes[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç¬¬äºŒæ¡åºåˆ—\n&#x27;</span>, episodes[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç¬¬äº”æ¡åºåˆ—\n&#x27;</span>, episodes[<span class="hljs-number">4</span>])<br><span class="hljs-comment"># å¯¹æ‰€æœ‰é‡‡æ ·åºåˆ—è®¡ç®—æ‰€æœ‰çŠ¶æ€çš„ä»·å€¼</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">MC</span>(<span class="hljs-params">episodes, V, N, gamma</span>):<br>    <span class="hljs-keyword">for</span> episode <span class="hljs-keyword">in</span> episodes:<br>        G = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(episode) - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):  <span class="hljs-comment">#ä¸€ä¸ªåºåˆ—ä»åå¾€å‰è®¡ç®—</span><br>            (s, a, r, s_next) = episode[i]<br>            G = r + gamma * G<br>            N[s] = N[s] + <span class="hljs-number">1</span><br>            V[s] = V[s] + (G - V[s]) / N[s]<br><br><br>timestep_max = <span class="hljs-number">20</span><br><span class="hljs-comment"># é‡‡æ ·1000æ¬¡,å¯ä»¥è‡ªè¡Œä¿®æ”¹</span><br>episodes = sample(MDP, Pi_1, timestep_max, <span class="hljs-number">1000</span>)<br>gamma = <span class="hljs-number">0.5</span><br>V = &#123;<span class="hljs-string">&quot;s1&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;s2&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;s3&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;s4&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;s5&quot;</span>: <span class="hljs-number">0</span>&#125;<br>N = &#123;<span class="hljs-string">&quot;s1&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;s2&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;s3&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;s4&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;s5&quot;</span>: <span class="hljs-number">0</span>&#125;<br>MC(episodes, V, N, gamma)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä½¿ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•è®¡ç®—MDPçš„çŠ¶æ€ä»·å€¼ä¸º\n&quot;</span>, V)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•ä¼°è®¡å¾—åˆ°çš„çŠ¶æ€ä»·å€¼å’Œæˆ‘ä»¬ç”¨ MRP è§£æè§£å¾—åˆ°çš„çŠ¶æ€ä»·å€¼æ˜¯å¾ˆæ¥è¿‘çš„ã€‚è¿™å¾—ç›Šäºæˆ‘ä»¬é‡‡æ ·äº†æ¯”è¾ƒå¤šçš„åºåˆ—ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å°è¯•ä¿®æ”¹é‡‡æ ·æ¬¡æ•°ï¼Œç„¶åè§‚å¯Ÿè’™ç‰¹å¡æ´›æ–¹æ³•çš„ç»“æœã€‚</p><h1 id="6-å ç”¨åº¦é‡"><a href="#6-å ç”¨åº¦é‡" class="headerlink" title="6 å ç”¨åº¦é‡"></a>6 å ç”¨åº¦é‡</h1><p>ç¬¬å››èŠ‚æåˆ°ï¼Œä¸åŒç­–ç•¥çš„ä»·å€¼å‡½æ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºåŒä¸€ä¸ª MDPï¼Œä¸åŒç­–ç•¥ä¼šè®¿é—®åˆ°çš„çŠ¶æ€çš„æ¦‚ç‡åˆ†å¸ƒæ˜¯ä¸åŒçš„ã€‚<br>æˆ‘ä»¬éœ€è¦ç†è§£ä¸åŒç­–ç•¥ä¼šä½¿æ™ºèƒ½ä½“è®¿é—®åˆ°ä¸åŒæ¦‚ç‡åˆ†å¸ƒçš„çŠ¶æ€è¿™ä¸ªäº‹å®ï¼Œè¿™ä¼šå½±å“åˆ°ç­–ç•¥çš„ä»·å€¼å‡½æ•°ã€‚<br>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ MDP çš„åˆå§‹çŠ¶æ€åˆ†å¸ƒä¸º$\nu_0(s)$ï¼Œåœ¨æœ‰äº›èµ„æ–™ä¸­ï¼Œåˆå§‹çŠ¶æ€åˆ†å¸ƒä¼šè¢«å®šä¹‰è¿› MDP çš„ç»„æˆå…ƒç´ ä¸­ã€‚æˆ‘ä»¬ç”¨$P_t^{\pi}(s)$è¡¨ç¤ºé‡‡å–ç­–ç•¥ä½¿å¾—æ™ºèƒ½ä½“åœ¨æ—¶åˆ»çŠ¶æ€ä¸ºçš„æ¦‚ç‡ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰$P_0^\pi(s)&#x3D;\nu_0(s)$ï¼Œç„¶åå°±å¯ä»¥å®šä¹‰ä¸€ä¸ªç­–ç•¥çš„<strong>çŠ¶æ€è®¿é—®åˆ†å¸ƒ</strong>ï¼ˆstate visitation distributionï¼‰ï¼š<br>$\nu^\pi(s)&#x3D;(1-\gamma)\sum_{t&#x3D;0}^\infty\gamma^tP_t^\pi(s)$<br>å…¶ä¸­ï¼Œ$1-\gamma$æ˜¯ç”¨æ¥ä½¿å¾—æ¦‚ç‡åŠ å’Œä¸º 1 çš„å½’ä¸€åŒ–å› å­ã€‚çŠ¶æ€è®¿é—®æ¦‚ç‡è¡¨ç¤ºä¸€ä¸ªç­–ç•¥å’Œ MDP äº¤äº’ä¼šè®¿é—®åˆ°çš„çŠ¶æ€çš„åˆ†å¸ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç†è®ºä¸Šåœ¨è®¡ç®—è¯¥åˆ†å¸ƒæ—¶éœ€è¦äº¤äº’åˆ°æ— ç©·æ­¥ä¹‹åï¼Œä½†å®é™…ä¸Šæ™ºèƒ½ä½“å’Œ MDP çš„äº¤äº’åœ¨ä¸€ä¸ªåºåˆ—ä¸­æ˜¯æœ‰é™çš„ã€‚ä¸è¿‡æˆ‘ä»¬ä»ç„¶å¯ä»¥ç”¨ä»¥ä¸Šå…¬å¼æ¥è¡¨è¾¾çŠ¶æ€è®¿é—®æ¦‚ç‡çš„æ€æƒ³ï¼ŒçŠ¶æ€è®¿é—®æ¦‚ç‡æœ‰å¦‚ä¸‹æ€§è´¨ï¼š<br>$\nu^\pi(sâ€™)&#x3D;(1-\gamma)\nu_0(sâ€™)+\gamma\int P(sâ€™|s,a)\pi(a|s)\nu^\pi(s)dsda$<br>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ç­–ç•¥çš„<strong>å ç”¨åº¦é‡</strong>ï¼ˆoccupancy measureï¼‰ï¼š<br>$\rho^\pi(s,a)&#x3D;(1-\gamma)\sum_{t&#x3D;0}^\infty\gamma^tP_t^\pi(s)\pi(a|s)$<br>å®ƒè¡¨ç¤ºåŠ¨ä½œçŠ¶æ€(s,a)å¯¹è¢«è®¿é—®åˆ°çš„æ¦‚ç‡ã€‚äºŒè€…ä¹‹é—´å­˜åœ¨å¦‚ä¸‹å…³ç³»ï¼š<br>$\rho^\pi(s,a)&#x3D;\nu^\pi(s)\pi(a|s)$<br>è¿›ä¸€æ­¥å¾—å‡ºå¦‚ä¸‹ä¸¤ä¸ªå®šç†ã€‚<strong>å®šç† 1</strong>ï¼šæ™ºèƒ½ä½“åˆ†åˆ«ä»¥ç­–ç•¥$\pi_1$å’Œ$\pi_2$å’ŒåŒä¸€ä¸ª MDP äº¤äº’å¾—åˆ°çš„å ç”¨åº¦é‡$\rho^{\pi_1}$å’Œ$\rho^{\pi_2}$æ»¡è¶³<br>$\rho^{\pi_1}&#x3D;\rho^{\pi_2}\iff\pi_1&#x3D;\pi_2$<br><strong>å®šç† 2</strong>ï¼šç»™å®šä¸€åˆæ³•å ç”¨åº¦é‡$\rho$ï¼Œå¯ç”Ÿæˆè¯¥å ç”¨åº¦é‡çš„å”¯ä¸€ç­–ç•¥æ˜¯<br>$\pi_\rho&#x3D;\frac{\rho(s,a)}{\sum_{aâ€™}\rho(s,aâ€™)}$<br>æ³¨æ„ï¼šä»¥ä¸Šæåˆ°çš„â€œåˆæ³•â€å ç”¨åº¦é‡æ˜¯æŒ‡å­˜åœ¨ä¸€ä¸ªç­–ç•¥ä½¿æ™ºèƒ½ä½“ä¸ MDP äº¤äº’äº§ç”Ÿçš„çŠ¶æ€åŠ¨ä½œå¯¹è¢«è®¿é—®åˆ°çš„æ¦‚ç‡ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™ä»£ç æ¥è¿‘ä¼¼ä¼°è®¡å ç”¨åº¦é‡ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨è¿‘ä¼¼ä¼°è®¡ï¼Œå³è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„é‡‡æ ·è½¨è¿¹é•¿åº¦çš„æœ€å¤§å€¼ï¼Œç„¶åé‡‡æ ·å¾ˆå¤šæ¬¡ï¼Œç”¨çŠ¶æ€åŠ¨ä½œå¯¹å‡ºç°çš„é¢‘ç‡ä¼°è®¡å®é™…æ¦‚ç‡ã€‚</p><h3 id="ä»£ç -5"><a href="#ä»£ç -5" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">occupancy</span>(<span class="hljs-params">episodes, s, a, timestep_max, gamma</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27; è®¡ç®—çŠ¶æ€åŠ¨ä½œå¯¹ï¼ˆs,aï¼‰å‡ºç°çš„é¢‘ç‡,ä»¥æ­¤æ¥ä¼°ç®—ç­–ç•¥çš„å ç”¨åº¦é‡ &#x27;&#x27;&#x27;</span><br>    rho = <span class="hljs-number">0</span><br>    total_times = np.zeros(timestep_max)  <span class="hljs-comment"># è®°å½•æ¯ä¸ªæ—¶é—´æ­¥tå„è¢«ç»å†è¿‡å‡ æ¬¡</span><br>    occur_times = np.zeros(timestep_max)  <span class="hljs-comment"># è®°å½•(s_t,a_t)=(s,a)çš„æ¬¡æ•°</span><br>    <span class="hljs-keyword">for</span> episode <span class="hljs-keyword">in</span> episodes:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(episode)):<br>            (s_opt, a_opt, r, s_next) = episode[i]<br>            total_times[i] += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> s == s_opt <span class="hljs-keyword">and</span> a == a_opt:<br>                occur_times[i] += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(<span class="hljs-built_in">range</span>(timestep_max)):<br>        <span class="hljs-keyword">if</span> total_times[i]:<br>            rho += gamma**i * occur_times[i] / total_times[i]<br>    <span class="hljs-keyword">return</span> (<span class="hljs-number">1</span> - gamma) * rho<br><br><br>gamma = <span class="hljs-number">0.5</span><br>timestep_max = <span class="hljs-number">1000</span><br><br>episodes_1 = sample(MDP, Pi_1, timestep_max, <span class="hljs-number">1000</span>)<br>episodes_2 = sample(MDP, Pi_2, timestep_max, <span class="hljs-number">1000</span>)<br>rho_1 = occupancy(episodes_1, <span class="hljs-string">&quot;s4&quot;</span>, <span class="hljs-string">&quot;æ¦‚ç‡å‰å¾€&quot;</span>, timestep_max, gamma)<br>rho_2 = occupancy(episodes_2, <span class="hljs-string">&quot;s4&quot;</span>, <span class="hljs-string">&quot;æ¦‚ç‡å‰å¾€&quot;</span>, timestep_max, gamma)<br><span class="hljs-built_in">print</span>(rho_1, rho_2)<br></code></pre></td></tr></table></figure><h1 id="7-æœ€ä¼˜ç­–ç•¥"><a href="#7-æœ€ä¼˜ç­–ç•¥" class="headerlink" title="7 æœ€ä¼˜ç­–ç•¥"></a>7 æœ€ä¼˜ç­–ç•¥</h1><p>å¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡é€šå¸¸æ˜¯æ‰¾åˆ°ä¸€ä¸ªç­–ç•¥ï¼Œä½¿å¾—æ™ºèƒ½ä½“ä»åˆå§‹çŠ¶æ€å‡ºå‘èƒ½è·å¾—æœ€å¤šçš„æœŸæœ›å›æŠ¥ã€‚æˆ‘ä»¬é¦–å…ˆå®šä¹‰ç­–ç•¥ä¹‹é—´çš„ååºå…³ç³»ï¼šå½“ä¸”ä»…å½“å¯¹äºä»»æ„çš„çŠ¶æ€séƒ½æœ‰$V^\pi(s)\geq V^{\pi^{\prime}}(s)$,è®°$\pi&gt;\pi^{\prime}$ï¼Œäºæ˜¯åœ¨æœ‰é™çŠ¶æ€å’ŒåŠ¨ä½œé›†åˆçš„ MDP ä¸­ï¼Œè‡³å°‘å­˜åœ¨ä¸€ä¸ªç­–ç•¥æ¯”å…¶ä»–æ‰€æœ‰ç­–ç•¥éƒ½å¥½æˆ–è€…è‡³å°‘å­˜åœ¨ä¸€ä¸ªç­–ç•¥ä¸å·®äºå…¶ä»–æ‰€æœ‰ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥å°±æ˜¯<strong>æœ€ä¼˜ç­–ç•¥</strong>ï¼ˆoptimal policyï¼‰ã€‚æœ€ä¼˜ç­–ç•¥å¯èƒ½æœ‰å¾ˆå¤šä¸ªï¼Œæˆ‘ä»¬éƒ½å°†å…¶è¡¨ç¤ºä¸º$\pi^{<em>}(s)$ã€‚<br>æœ€ä¼˜ç­–ç•¥éƒ½æœ‰ç›¸åŒçš„çŠ¶æ€ä»·å€¼å‡½æ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°</strong>ï¼Œè¡¨ç¤ºä¸ºï¼š<br>$V^</em>(s)&#x3D;\max_\pi V^\pi(s),\quad\forall s\in\mathcal{S}$<br>åŒç†ï¼Œæˆ‘ä»¬å®šä¹‰<strong>æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°</strong>:<br>$Q^*(s,a)&#x3D;\max_\pi Q^\pi(s,a),\quad\forall s\in\mathcal{S},a\in\mathcal{A}$<br>ä¸ºäº†ä½¿$Q^\pi(s,a)$æœ€å¤§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å½“å‰çš„çŠ¶æ€åŠ¨ä½œå¯¹(s,a)ä¹‹åéƒ½æ‰§è¡Œæœ€ä¼˜ç­–ç•¥ã€‚äºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°å’Œæœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ä¹‹é—´çš„å…³ç³»ï¼š<br>$Q^*(s,a)&#x3D;r(s,a)+\gamma\sum_{s^\prime\in S}P(s^\prime|s,a)V^*(s^\prime)$<br>è¿™ä¸åœ¨æ™®é€šç­–ç•¥ä¸‹çš„çŠ¶æ€ä»·å€¼å‡½æ•°å’ŒåŠ¨ä½œä»·å€¼å‡½æ•°ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€æ ·çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œæœ€ä¼˜çŠ¶æ€ä»·å€¼æ˜¯é€‰æ‹©æ­¤æ—¶ä½¿æœ€ä¼˜åŠ¨ä½œä»·å€¼æœ€å¤§çš„é‚£ä¸€ä¸ªåŠ¨ä½œæ—¶çš„çŠ¶æ€ä»·å€¼ï¼š<br>$V^*(s)&#x3D;\max_{a\in\mathcal{A}}Q^*(s,a)$</p><h2 id="7-1è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹"><a href="#7-1è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹" class="headerlink" title="7.1è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹"></a>7.1è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹</h2><p>$$V^*(s)&#x3D;\max_{a\in\mathcal{A}}{r(s,a)+\gamma\sum_{s^{\prime}\in\mathcal{S}}p(s^{\prime}|s,a)V^*(s^{\prime})}\Q^*(s,a)&#x3D;r(s,a)+\gamma\sum_{s^{\prime}\in\mathcal{S}}p(s^{\prime}|s,a)\max_{a^{\prime}\in\mathcal{A}}Q^*(s^{\prime},a^{\prime})$$</p><h1 id="8æ€»ç»“"><a href="#8æ€»ç»“" class="headerlink" title="8æ€»ç»“"></a>8æ€»ç»“</h1><p>æœ¬ç« ä»é›¶å¼€å§‹ä»‹ç»äº†é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹çš„åŸºç¡€æ¦‚å¿µçŸ¥è¯†ï¼Œå¹¶è®²è§£äº†å¦‚ä½•é€šè¿‡æ±‚è§£è´å°”æ›¼æ–¹ç¨‹å¾—åˆ°çŠ¶æ€ä»·å€¼çš„è§£æè§£ä»¥åŠå¦‚ä½•ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•ä¼°è®¡å„ä¸ªçŠ¶æ€çš„ä»·å€¼ã€‚é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹æ˜¯å¼ºåŒ–å­¦ä¹ ä¸­çš„åŸºç¡€æ¦‚å¿µï¼Œå¼ºåŒ–å­¦ä¹ ä¸­çš„ç¯å¢ƒå°±æ˜¯ä¸€ä¸ªé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°†è¦ä»‹ç»çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•é€šå¸¸éƒ½æ˜¯åœ¨æ±‚è§£é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ä¸­çš„æœ€ä¼˜ç­–ç•¥ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-1 å¤šè‡‚è€è™æœº</title>
    <link href="/2024/08/16/RL-1/"/>
    <url>/2024/08/16/RL-1/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h1><p>æˆ‘ä»¬åœ¨ç¬¬ 1 ç« ä¸­äº†è§£åˆ°ï¼Œå¼ºåŒ–å­¦ä¹ å…³æ³¨æ™ºèƒ½ä½“å’Œç¯å¢ƒäº¤äº’è¿‡ç¨‹ä¸­çš„å­¦ä¹ ï¼Œè¿™æ˜¯ä¸€ç§<strong>è¯•é”™å‹å­¦ä¹ </strong>ï¼ˆtrial-and-error learningï¼‰èŒƒå¼ã€‚åœ¨æ­£å¼å­¦ä¹ å¼ºåŒ–å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å¤šè‡‚è€è™æœºé—®é¢˜ï¼Œå®ƒå¯ä»¥è¢«çœ‹ä½œç®€åŒ–ç‰ˆçš„å¼ºåŒ–å­¦ä¹ é—®é¢˜ã€‚ä¸å¼ºåŒ–å­¦ä¹ ä¸åŒï¼Œå¤šè‡‚è€è™æœºä¸å­˜åœ¨çŠ¶æ€ä¿¡æ¯ï¼Œåªæœ‰åŠ¨ä½œå’Œå¥–åŠ±ï¼Œç®—æ˜¯æœ€ç®€å•çš„â€œå’Œç¯å¢ƒäº¤äº’ä¸­çš„å­¦ä¹ â€çš„ä¸€ç§å½¢å¼ã€‚å¤šè‡‚è€è™æœºä¸­çš„<strong>æ¢ç´¢ä¸åˆ©ç”¨</strong>ï¼ˆexploration vs. exploitationï¼‰é—®é¢˜ä¸€ç›´ä»¥æ¥éƒ½æ˜¯ä¸€ä¸ªç‰¹åˆ«ç»å…¸çš„é—®é¢˜ï¼Œç†è§£å®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å­¦ä¹ å¼ºåŒ–å­¦ä¹ ã€‚</p><h1 id="2-é—®é¢˜ä»‹ç»"><a href="#2-é—®é¢˜ä»‹ç»" class="headerlink" title="2 é—®é¢˜ä»‹ç»"></a>2 é—®é¢˜ä»‹ç»</h1><h2 id="2-1å®šä¹‰"><a href="#2-1å®šä¹‰" class="headerlink" title="2.1å®šä¹‰"></a>2.1å®šä¹‰</h2><p>åœ¨å¤šè‡‚è€è™æœºï¼ˆmulti-armed banditï¼ŒMABï¼‰é—®é¢˜ï¼ˆè§å›¾ 2-1ï¼‰ä¸­ï¼Œæœ‰ä¸€ä¸ªæ‹¥æœ‰  æ ¹æ‹‰æ†çš„è€è™æœºï¼Œæ‹‰åŠ¨æ¯ä¸€æ ¹æ‹‰æ†éƒ½å¯¹åº”ä¸€ä¸ªå…³äºå¥–åŠ±çš„æ¦‚ç‡åˆ†å¸ƒ ã€‚æˆ‘ä»¬æ¯æ¬¡æ‹‰åŠ¨å…¶ä¸­ä¸€æ ¹æ‹‰æ†ï¼Œå°±å¯ä»¥ä»è¯¥æ‹‰æ†å¯¹åº”çš„å¥–åŠ±æ¦‚ç‡åˆ†å¸ƒä¸­è·å¾—ä¸€ä¸ªå¥–åŠ± ã€‚æˆ‘ä»¬åœ¨å„æ ¹æ‹‰æ†çš„å¥–åŠ±æ¦‚ç‡åˆ†å¸ƒæœªçŸ¥çš„æƒ…å†µä¸‹ï¼Œä»å¤´å¼€å§‹å°è¯•ï¼Œç›®æ ‡æ˜¯åœ¨æ“ä½œ  æ¬¡æ‹‰æ†åè·å¾—å°½å¯èƒ½é«˜çš„ç´¯ç§¯å¥–åŠ±ã€‚ç”±äºå¥–åŠ±çš„æ¦‚ç‡åˆ†å¸ƒæ˜¯æœªçŸ¥çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨â€œæ¢ç´¢æ‹‰æ†çš„è·å¥–æ¦‚ç‡â€å’Œâ€œæ ¹æ®ç»éªŒé€‰æ‹©è·å¥–æœ€å¤šçš„æ‹‰æ†â€ä¸­è¿›è¡Œæƒè¡¡ã€‚â€œé‡‡ç”¨æ€æ ·çš„æ“ä½œç­–ç•¥æ‰èƒ½ä½¿è·å¾—çš„ç´¯ç§¯å¥–åŠ±æœ€é«˜â€ä¾¿æ˜¯å¤šè‡‚è€è™æœºé—®é¢˜ã€‚å¦‚æœæ˜¯ä½ ï¼Œä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ<br><img src="/image/RL-11.png"></p><h2 id="2-2å½¢å¼åŒ–æè¿°"><a href="#2-2å½¢å¼åŒ–æè¿°" class="headerlink" title="2.2å½¢å¼åŒ–æè¿°"></a>2.2å½¢å¼åŒ–æè¿°</h2><p>èº²é¿è€è™æœºå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå…ƒç»„$&lt;A,R&gt;$,å…¶ä¸­ï¼š</p><ul><li>Aä¸ºåŠ¨ä½œé›†åˆï¼Œå…¶ä¸­ä¸€ä¸ªåŠ¨ä½œè¡¨ç¤ºæ‹‰åŠ¨ä¸€ä¸ªæ‹‰æ†ã€‚è‹¥å¤šè‡‚è€è™æœºä¸€å…±æœ‰Kæ ¹æ‹‰æ†ï¼Œé‚£åŠ¨ä½œç©ºé—´å°±æ˜¯é›†åˆ${a_1,\dots,a_k}$ï¼Œæˆ‘ä»¬ç”¨$a_t\in\mathcal{A}$è¡¨ç¤ºä»»æ„ä¸€ä¸ªåŠ¨ä½œï¼›</li><li>Rä¸ºå¥–åŠ±æ¦‚ç‡åˆ†å¸ƒï¼Œæ‹‰åŠ¨æ¯ä¸€æ ¹æ‹‰æ†çš„åŠ¨ä½œaéƒ½å¯¹åº”ä¸€ä¸ªå¥–åŠ±æ¦‚ç‡åˆ†å¸ƒ$\mathcal{R}(r|a)$ï¼Œä¸åŒæ‹‰æ†çš„å¥–åŠ±åˆ†å¸ƒé€šå¸¸æ˜¯ä¸åŒçš„ã€‚<br>å‡è®¾æ¯ä¸ªæ—¶é—´æ­¥åªèƒ½æ‹‰åŠ¨ä¸€ä¸ªæ‹‰æ†ï¼Œå¤šè‡‚è€è™æœºçš„ç›®æ ‡ä¸ºæœ€å¤§åŒ–ä¸€æ®µæ—¶é—´æ­¥Tå†…ç´¯ç§¯çš„å¥–åŠ±:<br>$\max\sum_{t&#x3D;1}^{T}r_{t}, r_{t}\sim\mathcal{R}\left(\cdot|a_{t}\right)$<br>å…¶ä¸­$a_t$è¡¨ç¤ºåœ¨ç¬¬æ—¶é—´æ­¥æ‹‰åŠ¨æŸä¸€æ‹‰æ†çš„åŠ¨ä½œï¼Œ$r_t$è¡¨ç¤ºåŠ¨ä½œ$a_t$è·å¾—çš„å¥–åŠ±ã€‚</li></ul><h2 id="2-3ç´¯ç§¯æ‡Šæ‚”"><a href="#2-3ç´¯ç§¯æ‡Šæ‚”" class="headerlink" title="2.3ç´¯ç§¯æ‡Šæ‚”"></a>2.3ç´¯ç§¯æ‡Šæ‚”</h2><p>å¯¹äºæ¯ä¸€ä¸ªåŠ¨ä½œaï¼Œæˆ‘ä»¬å®šä¹‰å…¶æœŸæœ›å¥–åŠ±ä¸º$Q(a)&#x3D;\mathbb{E}<em>{r\sim\mathcal{R}(\cdot|a)} [r]$<br>äºæ˜¯ï¼Œè‡³å°‘å­˜åœ¨ä¸€æ ¹æ‹‰æ†ï¼Œå®ƒçš„æœŸæœ›å¥–åŠ±ä¸å°äºæ‹‰åŠ¨å…¶ä»–ä»»æ„ä¸€æ ¹æ‹‰æ†ï¼Œæˆ‘ä»¬å°†è¯¥æœ€ä¼˜æœŸæœ›å¥–åŠ±è¡¨ç¤ºä¸º$Q^*&#x3D;\max</em>{a\in\mathcal{A}}Q(a)$<br>ä¸ºäº†æ›´åŠ ç›´è§‚ã€æ–¹ä¾¿åœ°è§‚å¯Ÿä»»æ„ä¸€æ ¹æ‹‰æ†çš„æœŸæœ›å¥–åŠ±ç¦»æœ€ä¼˜æ‹‰æ†æœŸæœ›å¥–åŠ±çš„å·®è·ï¼Œæˆ‘ä»¬å¼•å…¥<strong>æ‡Šæ‚”</strong>ï¼ˆregretï¼‰æ¦‚å¿µã€‚æ‡Šæ‚”å®šä¹‰ä¸ºæ‹‰åŠ¨å½“å‰æ‹‰æ†çš„åŠ¨ä½œaä¸æœ€ä¼˜æ‹‰æ†çš„æœŸæœ›å¥–åŠ±å·®ï¼Œå³$R(a)&#x3D;Q^*-Q(a)$<br>ç´¯ç§¯æ‡Šæ‚”å³æ“ä½œTæ¬¡æ‹‰æ†åç´¯ç§¯çš„æ‡Šæ‚”æ€»é‡ï¼Œå¯¹äºä¸€æ¬¡å®Œæ•´çš„Tæ­¥å†³ç­–${a_1,a_2,\dots,a_T}$,ç§¯ç´¯æ‡Šæ‚”ä¸º$\sigma_R&#x3D;\sum_{t&#x3D;1}^TR(a_t)$<br>MAB é—®é¢˜çš„ç›®æ ‡ä¸ºæœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±ï¼Œç­‰ä»·äºæœ€å°åŒ–ç´¯ç§¯æ‡Šæ‚”ã€‚</p><h2 id="2-4ä¼°è®¡æœŸæœ›å¥–åŠ±"><a href="#2-4ä¼°è®¡æœŸæœ›å¥–åŠ±" class="headerlink" title="2.4ä¼°è®¡æœŸæœ›å¥–åŠ±"></a>2.4ä¼°è®¡æœŸæœ›å¥–åŠ±</h2><p>ä¸ºäº†çŸ¥é“æ‹‰åŠ¨å“ªä¸€æ ¹æ‹‰æ†èƒ½è·å¾—æ›´é«˜çš„å¥–åŠ±ï¼Œæˆ‘ä»¬éœ€è¦ä¼°è®¡æ‹‰åŠ¨è¿™æ ¹æ‹‰æ†çš„æœŸæœ›å¥–åŠ±ã€‚ç”±äºåªæ‹‰åŠ¨ä¸€æ¬¡æ‹‰æ†è·å¾—çš„å¥–åŠ±å­˜åœ¨éšæœºæ€§ï¼Œæ‰€ä»¥éœ€è¦å¤šæ¬¡æ‹‰åŠ¨ä¸€æ ¹æ‹‰æ†ï¼Œç„¶åè®¡ç®—å¾—åˆ°çš„å¤šæ¬¡å¥–åŠ±çš„æœŸæœ›ï¼Œå…¶ç®—æ³•æµç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><ul><li>å¯¹äº$\forall a\in\mathcal{A}$ï¼Œåˆå§‹åŒ–è®¡æ•°å™¨$N(a)&#x3D;0$å’ŒæœŸæœ›å¥–åŠ±ä¼°å€¼$\hat{Q}(a)&#x3D;0$</li><li><strong>for</strong> t &#x3D; 1-&gt;T do<ul><li>é€‰å–æŸæ ¹æ‹‰æ†ï¼Œè¯¥åŠ¨ä½œè®°ä¸º$a_t$</li><li>å¾—åˆ°å¥–åŠ±$r_t$ </li><li>æ›´æ–°è®¡æ•°å™¨$N(a_t)&#x3D;N(a_t)+1$: </li><li>æ›´æ–°æœŸæœ›å¥–åŠ±ä¼°å€¼ï¼š$\hat{Q}(a_t)&#x3D;\hat{Q}(a_t)+\frac{1}{N(a_t)}\Big[r_t-\hat{Q}(a_t)\Big]$</li></ul></li><li><strong>end for</strong><br>ä»¥ä¸Š for å¾ªç¯ä¸­çš„ç¬¬å››æ­¥å¦‚æ­¤æ›´æ–°ä¼°å€¼ï¼Œæ˜¯å› ä¸ºè¿™æ ·å¯ä»¥è¿›è¡Œå¢é‡å¼çš„æœŸæœ›æ›´æ–°ï¼Œå…¬å¼å¦‚ä¸‹ã€‚<br>$$\begin{aligned}<br>Q_{k}&amp; &#x3D;\frac1k\sum_{i&#x3D;1}^kr_i \<br>&amp;&#x3D;\frac{1}{k}\left(r_k+\sum_{i&#x3D;1}^{k-1}r_i\right) \<br>&amp;&#x3D;\frac1k(r_k+(k-1)Q_{k-1}) \<br>&amp;&#x3D;\frac1k(r_k+kQ_{k-1}-Q_{k-1}) \<br>&amp;&#x3D;Q_{k-1}+\frac1k[r_k-Q_{k-1}]<br>\end{aligned}$$<br>å¼ä¸­ï¼Œ$Q_{k-1}$ä¸ºk-1ä¸ªå¥–åŠ±çš„æœŸæœ›å€¼ã€‚<br>ä»¥ä¸‹ç”¨pythonéƒ¨ç½²ä¸€ä¸ªç®€å•çš„å¤šè‡‚è€è™æœºã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">@File    :   å¤šè‡‚è€è™æœº.ipynb</span><br><span class="hljs-string"></span><br><span class="hljs-string">@Time    :   2024/08/16 21:30:45</span><br><span class="hljs-string"></span><br><span class="hljs-string">@Author  :   Neutrin</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># here put the import lib</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BernoulliBandit</span>:<br><br>    <span class="hljs-string">&quot;&quot;&quot; ä¼¯åŠªåˆ©å¤šè‡‚è€è™æœº,è¾“å…¥Kè¡¨ç¤ºæ‹‰æ†ä¸ªæ•° &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, K</span>):<br><br>        <span class="hljs-variable language_">self</span>.probs = np.random.uniform(size=K)  <span class="hljs-comment"># éšæœºç”ŸæˆKä¸ª0ï½1çš„æ•°,ä½œä¸ºæ‹‰åŠ¨æ¯æ ¹æ‹‰æ†çš„è·å¥–</span><br>        <span class="hljs-comment"># æ¦‚ç‡</span><br>        <span class="hljs-variable language_">self</span>.best_idx = np.argmax(<span class="hljs-variable language_">self</span>.probs)  <span class="hljs-comment"># è·å¥–æ¦‚ç‡æœ€å¤§çš„æ‹‰æ†</span><br>        <span class="hljs-variable language_">self</span>.best_prob = <span class="hljs-variable language_">self</span>.probs[<span class="hljs-variable language_">self</span>.best_idx]  <span class="hljs-comment"># æœ€å¤§çš„è·å¥–æ¦‚ç‡</span><br>        <span class="hljs-variable language_">self</span>.K = K<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self, k</span>):<br><br>        <span class="hljs-comment"># å½“ç©å®¶é€‰æ‹©äº†kå·æ‹‰æ†å,æ ¹æ®æ‹‰åŠ¨è¯¥è€è™æœºçš„kå·æ‹‰æ†è·å¾—å¥–åŠ±çš„æ¦‚ç‡è¿”å›1ï¼ˆè·å¥–ï¼‰æˆ–0ï¼ˆæœª</span><br>        <span class="hljs-comment"># è·å¥–ï¼‰</span><br>        <span class="hljs-keyword">if</span> np.random.rand() &lt; <span class="hljs-variable language_">self</span>.probs[k]:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br>np.random.seed(<span class="hljs-number">1</span>)  <span class="hljs-comment"># è®¾å®šéšæœºç§å­,ä½¿å®éªŒå…·æœ‰å¯é‡å¤æ€§</span><br>K = <span class="hljs-number">10</span><br>bandit_10_arm = BernoulliBandit(K)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;éšæœºç”Ÿæˆäº†ä¸€ä¸ª%dè‡‚ä¼¯åŠªåˆ©è€è™æœº&quot;</span> % K)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è·å¥–æ¦‚ç‡æœ€å¤§çš„æ‹‰æ†ä¸º%då·,å…¶è·å¥–æ¦‚ç‡ä¸º%.4f&quot;</span> %<br>      (bandit_10_arm.best_idx, bandit_10_arm.best_prob))<br></code></pre></td></tr></table></figure>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ä¸€ä¸ª Solver åŸºç¡€ç±»æ¥å®ç°ä¸Šè¿°çš„å¤šè‡‚è€è™æœºçš„æ±‚è§£æ–¹æ¡ˆã€‚æ ¹æ®å‰æ–‡çš„ç®—æ³•æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸‹åˆ—å‡½æ•°åŠŸèƒ½ï¼šæ ¹æ®ç­–ç•¥é€‰æ‹©åŠ¨ä½œã€æ ¹æ®åŠ¨ä½œè·å–å¥–åŠ±ã€æ›´æ–°æœŸæœ›å¥–åŠ±ä¼°å€¼ã€æ›´æ–°ç´¯ç§¯æ‡Šæ‚”å’Œè®¡æ•°ã€‚åœ¨ä¸‹é¢çš„ MAB ç®—æ³•åŸºæœ¬æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬å°†<strong>æ ¹æ®ç­–ç•¥é€‰æ‹©åŠ¨ä½œ</strong>ã€<strong>æ ¹æ®åŠ¨ä½œè·å–å¥–åŠ±</strong>å’Œ<strong>æ›´æ–°æœŸæœ›å¥–åŠ±ä¼°å€¼</strong>æ”¾åœ¨ <code>run_one_step()</code> å‡½æ•°ä¸­ï¼Œç”±æ¯ä¸ªç»§æ‰¿ Solver ç±»çš„ç­–ç•¥å…·ä½“å®ç°ã€‚è€Œ<strong>æ›´æ–°ç´¯ç§¯æ‡Šæ‚”å’Œè®¡æ•°</strong>åˆ™ç›´æ¥æ”¾åœ¨ä¸»å¾ªç¯ <code>run()</code> ä¸­ã€‚</li></ul><h1 id="3-æ¢ç´¢ä¸åˆ©ç”¨çš„å¹³è¡¡"><a href="#3-æ¢ç´¢ä¸åˆ©ç”¨çš„å¹³è¡¡" class="headerlink" title="3 æ¢ç´¢ä¸åˆ©ç”¨çš„å¹³è¡¡"></a>3 æ¢ç´¢ä¸åˆ©ç”¨çš„å¹³è¡¡</h1><p>åœ¨ç¬¬2èŠ‚çš„ç®—æ³•æ¡†æ¶ä¸­ï¼Œè¿˜æ²¡æœ‰ä¸€ä¸ªç­–ç•¥å‘Šè¯‰æˆ‘ä»¬åº”è¯¥é‡‡å–å“ªä¸ªåŠ¨ä½œï¼Œå³æ‹‰åŠ¨å“ªæ ¹æ‹‰æ†ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è®¾è®¡ä¸€ä¸ªç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæœ€ç®€å•çš„ç­–ç•¥å°±æ˜¯ä¸€ç›´é‡‡å–ç¬¬ä¸€ä¸ªåŠ¨ä½œï¼Œä½†è¿™å°±éå¸¸ä¾èµ–è¿æ°”çš„å¥½åã€‚å¦‚æœè¿æ°”ç»ä½³ï¼Œå¯èƒ½æ‹‰åŠ¨çš„åˆšå¥½æ˜¯èƒ½è·å¾—æœ€å¤§æœŸæœ›å¥–åŠ±çš„æ‹‰æ†ï¼Œå³æœ€ä¼˜æ‹‰æ†ï¼›ä½†å¦‚æœè¿æ°”å¾ˆç³Ÿç³•ï¼Œè·å¾—çš„å°±æœ‰å¯èƒ½æ˜¯æœ€å°çš„æœŸæœ›å¥–åŠ±ã€‚åœ¨å¤šè‡‚è€è™æœºé—®é¢˜ä¸­ï¼Œä¸€ä¸ªç»å…¸çš„é—®é¢˜å°±æ˜¯æ¢ç´¢ä¸åˆ©ç”¨çš„å¹³è¡¡é—®é¢˜ã€‚<strong>æ¢ç´¢</strong>ï¼ˆexplorationï¼‰æ˜¯æŒ‡å°è¯•æ‹‰åŠ¨æ›´å¤šå¯èƒ½çš„æ‹‰æ†ï¼Œè¿™æ ¹æ‹‰æ†ä¸ä¸€å®šä¼šè·å¾—æœ€å¤§çš„å¥–åŠ±ï¼Œä½†è¿™ç§æ–¹æ¡ˆèƒ½å¤Ÿæ‘¸æ¸…æ¥šæ‰€æœ‰æ‹‰æ†çš„è·å¥–æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª 10 è‡‚è€è™æœºï¼Œæˆ‘ä»¬è¦æŠŠæ‰€æœ‰çš„æ‹‰æ†éƒ½æ‹‰åŠ¨ä¸€ä¸‹æ‰çŸ¥é“å“ªæ ¹æ‹‰æ†å¯èƒ½è·å¾—æœ€å¤§çš„å¥–åŠ±ã€‚<strong>åˆ©ç”¨</strong>ï¼ˆexploitationï¼‰æ˜¯æŒ‡æ‹‰åŠ¨å·²çŸ¥æœŸæœ›å¥–åŠ±æœ€å¤§çš„é‚£æ ¹æ‹‰æ†ï¼Œç”±äºå·²çŸ¥çš„ä¿¡æ¯ä»…ä»…æ¥è‡ªæœ‰é™æ¬¡çš„äº¤äº’è§‚æµ‹ï¼Œæ‰€ä»¥å½“å‰çš„æœ€ä¼˜æ‹‰æ†ä¸ä¸€å®šæ˜¯å…¨å±€æœ€ä¼˜çš„ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª 10 è‡‚è€è™æœºï¼Œæˆ‘ä»¬åªæ‹‰åŠ¨è¿‡å…¶ä¸­ 3 æ ¹æ‹‰æ†ï¼Œæ¥ä¸‹æ¥å°±ä¸€ç›´æ‹‰åŠ¨è¿™ 3 æ ¹æ‹‰æ†ä¸­æœŸæœ›å¥–åŠ±æœ€å¤§çš„é‚£æ ¹æ‹‰æ†ï¼Œä½†å¾ˆæœ‰å¯èƒ½æœŸæœ›å¥–åŠ±æœ€å¤§çš„æ‹‰æ†åœ¨å‰©ä¸‹çš„ 7 æ ¹å½“ä¸­ï¼Œå³ä½¿æˆ‘ä»¬å¯¹ 10 æ ¹æ‹‰æ†å„è‡ªéƒ½å°è¯•äº† 20 æ¬¡ï¼Œå‘ç° 5 å·æ‹‰æ†çš„ç»éªŒæœŸæœ›å¥–åŠ±æ˜¯æœ€é«˜çš„ï¼Œä½†ä»ç„¶å­˜åœ¨ç€å¾®å°çš„æ¦‚ç‡â€”å¦ä¸€æ ¹ 6 å·æ‹‰æ†çš„çœŸå®æœŸæœ›å¥–åŠ±æ˜¯æ¯” 5 å·æ‹‰æ†æ›´é«˜çš„ã€‚<br>äºæ˜¯åœ¨å¤šè‡‚è€è™æœºé—®é¢˜ä¸­ï¼Œè®¾è®¡ç­–ç•¥æ—¶å°±éœ€è¦å¹³è¡¡æ¢ç´¢å’Œåˆ©ç”¨çš„æ¬¡æ•°ï¼Œä½¿å¾—ç´¯ç§¯å¥–åŠ±æœ€å¤§åŒ–ã€‚ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æ€è·¯æ˜¯åœ¨å¼€å§‹æ—¶åšæ¯”è¾ƒå¤šçš„æ¢ç´¢ï¼Œåœ¨å¯¹æ¯æ ¹æ‹‰æ†éƒ½æœ‰æ¯”è¾ƒå‡†ç¡®çš„ä¼°è®¡åï¼Œå†è¿›è¡Œåˆ©ç”¨ã€‚ç›®å‰å·²æœ‰ä¸€äº›æ¯”è¾ƒç»å…¸çš„ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚$\epsilon-$è´ªå©ªç®—æ³•ã€ä¸Šç½®ä¿¡ç•Œç®—æ³•å’Œæ±¤æ™®æ£®é‡‡æ ·ç®—æ³•ç­‰ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°†åˆ†åˆ«ä»‹ç»è¿™å‡ ç§ç®—æ³•ã€‚</p><h1 id="4-epsilon-è´ªå©ªç®—æ³•"><a href="#4-epsilon-è´ªå©ªç®—æ³•" class="headerlink" title="4 $\epsilon-$è´ªå©ªç®—æ³•"></a>4 $\epsilon-$è´ªå©ªç®—æ³•</h1><p>å®Œå…¨è´ªå©ªç®—æ³•å³åœ¨æ¯ä¸€æ—¶åˆ»é‡‡å–æœŸæœ›å¥–åŠ±ä¼°å€¼æœ€å¤§çš„åŠ¨ä½œï¼ˆæ‹‰åŠ¨æ‹‰æ†ï¼‰ï¼Œè¿™å°±æ˜¯çº¯ç²¹çš„åˆ©ç”¨ï¼Œè€Œæ²¡æœ‰æ¢ç´¢ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸éœ€è¦å¯¹å®Œå…¨è´ªå©ªç®—æ³•è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œå…¶ä¸­æ¯”è¾ƒç»å…¸çš„ä¸€ç§æ–¹æ³•ä¸º$\epsilon-$è´ªå©ªç®—æ³•ã€‚$\epsilon-$è´ªå©ªåœ¨å®Œå…¨è´ªå©ªç®—æ³•çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†å™ªå£°ï¼Œæ¯æ¬¡ä»¥æ¦‚ç‡$1-\epsilon$é€‰æ‹©ä»¥å¾€ç»éªŒä¸­æœŸæœ›å¥–åŠ±ä¼°å€¼æœ€å¤§çš„é‚£æ ¹æ†(åˆ©ç”¨),ä»¥æ¦‚ç‡$\epsilon$éšæœºé€‰æ‹©ä¸€æ ¹æ‹‰æ†(æ¢ç´¢)ï¼Œå…¬å¼å¦‚ä¸‹ï¼š<br>$a_t&#x3D;\begin{cases}\arg\max_{a\in A}\hat{Q}(a),&amp;\text{é‡‡æ ·æ¦‚ç‡:1-}\epsilon\\text{ä» }\mathcal{A}\text{ä¸­éšæœºé€‰æ‹©},&amp;\text{é‡‡æ ·æ¦‚ç‡:}\epsilon\end{cases}$<br>éšç€æ¢ç´¢æ¬¡æ•°çš„ä¸æ–­å¢åŠ ï¼Œæˆ‘ä»¬å¯¹å„ä¸ªåŠ¨ä½œçš„å¥–åŠ±ä¼°è®¡å¾—è¶Šæ¥è¶Šå‡†ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±æ²¡å¿…è¦ç»§ç»­èŠ±å¤§åŠ›æ°”è¿›è¡Œæ¢ç´¢ã€‚ æ‰€ä»¥$\epsilon-$è´ªå©ªç®—æ³•åœ¨å…·ä½“çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»¤$\epsilon$éšæ—¶é—´è¡°å‡ï¼Œå³æ¢ç´¢çš„æ¦‚ç‡å°†ä¼šä¸æ–­é™ä½ï¼Œä½†æ˜¯ä¸ä¼šåœ¨æœ‰é™çš„æ­¥æ•°å†…è¡°å‡è‡³0ï¼Œå› ä¸ºåŸºäºæœ‰é™æ­¥æ•°è§‚æµ‹çš„å®Œå…¨è´ªå©ªç®—æ³•ä»ç„¶æ˜¯ä¸€ä¸ªå±€éƒ¨ä¿¡æ¯çš„è´ªå©ªç®—æ³•ï¼Œæ°¸è¿œè·ç¦»æœ€ä¼˜è§£æœ‰ä¸€ä¸ªå›ºå®šçš„å·®è·ã€‚</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EpsilonGreedy</span>(<span class="hljs-title class_ inherited__">Solver</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; epsilonè´ªå©ªç®—æ³•,ç»§æ‰¿Solverç±» &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bandit, epsilon=<span class="hljs-number">0.01</span>, init_prob=<span class="hljs-number">1.0</span></span>):<br>        <span class="hljs-built_in">super</span>(EpsilonGreedy, <span class="hljs-variable language_">self</span>).__init__(bandit)<br>        <span class="hljs-variable language_">self</span>.epsilon = epsilon<br>        <span class="hljs-comment">#åˆå§‹åŒ–æ‹‰åŠ¨æ‰€æœ‰æ‹‰æ†çš„æœŸæœ›å¥–åŠ±ä¼°å€¼</span><br>        <span class="hljs-variable language_">self</span>.estimates = np.array([init_prob] * <span class="hljs-variable language_">self</span>.bandit.K)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_one_step</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> np.random.random() &lt; <span class="hljs-variable language_">self</span>.epsilon:<br>            k = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.bandit.K)  <span class="hljs-comment"># éšæœºé€‰æ‹©ä¸€æ ¹æ‹‰æ†</span><br>        <span class="hljs-keyword">else</span>:<br>            k = np.argmax(<span class="hljs-variable language_">self</span>.estimates)  <span class="hljs-comment"># é€‰æ‹©æœŸæœ›å¥–åŠ±ä¼°å€¼æœ€å¤§çš„æ‹‰æ†</span><br>        r = <span class="hljs-variable language_">self</span>.bandit.step(k)  <span class="hljs-comment"># å¾—åˆ°æœ¬æ¬¡åŠ¨ä½œçš„å¥–åŠ±</span><br>        <span class="hljs-variable language_">self</span>.estimates[k] += <span class="hljs-number">1.</span> / (<span class="hljs-variable language_">self</span>.counts[k] + <span class="hljs-number">1</span>) * (r - <span class="hljs-variable language_">self</span>.estimates[k])<br>        <span class="hljs-keyword">return</span> k<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_results</span>(<span class="hljs-params">solvers, solver_names</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ç”Ÿæˆç´¯ç§¯æ‡Šæ‚”éšæ—¶é—´å˜åŒ–çš„å›¾åƒã€‚è¾“å…¥solversæ˜¯ä¸€ä¸ªåˆ—è¡¨,åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ç§ç‰¹å®šçš„ç­–ç•¥ã€‚</span><br><span class="hljs-string">    è€Œsolver_namesä¹Ÿæ˜¯ä¸€ä¸ªåˆ—è¡¨,å­˜å‚¨æ¯ä¸ªç­–ç•¥çš„åç§°&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> idx, solver <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(solvers):<br>        time_list = <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(solver.regrets))<br>        plt.plot(time_list, solver.regrets, label=solver_names[idx])<br>    plt.xlabel(<span class="hljs-string">&#x27;Time steps&#x27;</span>)<br>    plt.ylabel(<span class="hljs-string">&#x27;Cumulative regrets&#x27;</span>)<br>    plt.title(<span class="hljs-string">&#x27;%d-armed bandit&#x27;</span> % solvers[<span class="hljs-number">0</span>].bandit.K)<br>    plt.legend()<br>    plt.show()<br><br>np.random.seed(<span class="hljs-number">1</span>)<br>epsilon_greedy_solver = EpsilonGreedy(bandit_10_arm, epsilon=<span class="hljs-number">0.01</span>)<br>epsilon_greedy_solver.run(<span class="hljs-number">5000</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;epsilon-è´ªå©ªç®—æ³•çš„ç´¯ç§¯æ‡Šæ‚”ä¸ºï¼š&#x27;</span>, epsilon_greedy_solver.regret)<br>plot_results([epsilon_greedy_solver], [<span class="hljs-string">&quot;EpsilonGreedy&quot;</span>])<br></code></pre></td></tr></table></figure><p>ç»“æœ<br><img src="/image/RL-12.png"><br>åœ¨ç»å†ä¸€æ®µæ—¶é—´åï¼Œ$\epsilon-$è´ªå©ªç®—æ³•çš„ç´¯ç§¯æ‡Šæ‚”å‡ ä¹æ˜¯çº¿æ€§å¢é•¿çš„ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨ä¸åŒçš„å‚æ•°å€¼è¿›è¡Œéƒ¨ç½²ï¼Œ</p><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">np</span>.random.seed(<span class="hljs-number">0</span>)<br><span class="hljs-attribute">epsilons</span> =<span class="hljs-meta"> [1e-4, 0.01, 0.1, 0.25, 0.5]</span><br><span class="hljs-attribute">epsilon_greedy_solver_list</span> =<span class="hljs-meta"> [</span><br><span class="hljs-meta">    EpsilonGreedy(bandit_10_arm, epsilon=e) for e in epsilons</span><br><span class="hljs-meta">]</span><br><span class="hljs-attribute">epsilon_greedy_solver_names</span> =<span class="hljs-meta"> [&quot;epsilon=&#123;&#125;&quot;.format(e) for e in epsilons]</span><br><span class="hljs-attribute">for</span> solver in epsilon_greedy_solver_list:<br>    <span class="hljs-attribute">solver</span>.run(<span class="hljs-number">5000</span>)<br><br><span class="hljs-attribute">plot_results</span>(epsilon_greedy_solver_list, epsilon_greedy_solver_names)<br></code></pre></td></tr></table></figure><p><img src="/image/RL-13.png"><br>æ— è®ºå–å€¼å¤šå°‘ï¼Œç´¯ç§¯æ‡Šæ‚”éƒ½æ˜¯çº¿æ€§å¢é•¿çš„ï¼Œæ¥ä¸‹æ¥éƒ¨ç½²éšæ—¶é—´è¡°å‡çš„$\epsilon-$è´ªå©ªç®—æ³•ï¼Œé‡‡å–å…·ä½“çš„å½¢å¼æ˜¯åæ¯”ä¾‹ï¼Œ<br>$\epsilon_t&#x3D;\frac{1}{t}$</p><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DecayingEpsilonGreedy</span>(<span class="hljs-title class_ inherited__">Solver</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; epsilonå€¼éšæ—¶é—´è¡°å‡çš„epsilon-è´ªå©ªç®—æ³•,ç»§æ‰¿Solverç±» &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bandit, init_prob=<span class="hljs-number">1.0</span></span>):<br>        <span class="hljs-built_in">super</span>(DecayingEpsilonGreedy, <span class="hljs-variable language_">self</span>).__init__(bandit)<br>        <span class="hljs-variable language_">self</span>.estimates = np.array([init_prob] * <span class="hljs-variable language_">self</span>.bandit.K)<br>        <span class="hljs-variable language_">self</span>.total_count = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_one_step</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.total_count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> np.random.random() &lt; <span class="hljs-number">1</span> / <span class="hljs-variable language_">self</span>.total_count:  <span class="hljs-comment"># epsilonå€¼éšæ—¶é—´è¡°å‡</span><br>            k = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.bandit.K)<br>        <span class="hljs-keyword">else</span>:<br>            k = np.argmax(<span class="hljs-variable language_">self</span>.estimates)<br><br>        r = <span class="hljs-variable language_">self</span>.bandit.step(k)<br>        <span class="hljs-variable language_">self</span>.estimates[k] += <span class="hljs-number">1.</span> / (<span class="hljs-variable language_">self</span>.counts[k] + <span class="hljs-number">1</span>) * (r - <span class="hljs-variable language_">self</span>.estimates[k])<br><br>        <span class="hljs-keyword">return</span> k<br><br><br>np.random.seed(<span class="hljs-number">1</span>)<br>decaying_epsilon_greedy_solver = DecayingEpsilonGreedy(bandit_10_arm)<br>decaying_epsilon_greedy_solver.run(<span class="hljs-number">5000</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;epsilonå€¼è¡°å‡çš„è´ªå©ªç®—æ³•çš„ç´¯ç§¯æ‡Šæ‚”ä¸ºï¼š&#x27;</span>, decaying_epsilon_greedy_solver.regret)<br>plot_results([decaying_epsilon_greedy_solver], [<span class="hljs-string">&quot;DecayingEpsilonGreedy&quot;</span>])<br></code></pre></td></tr></table></figure><p><img src="/image/RL-14.png"><br>éšæ—¶é—´åšåæ¯”ä¾‹è¡°å‡çš„$\epsilon-$è´ªå©ªç®—æ³•æ˜æ˜¾ä¼˜äºå›ºå®šå€¼çš„$\epsilon-$è´ªå©ªç®—æ³•</p><h1 id="5-ä¸Šç½®ä¿¡ç•Œç®—æ³•"><a href="#5-ä¸Šç½®ä¿¡ç•Œç®—æ³•" class="headerlink" title="5 ä¸Šç½®ä¿¡ç•Œç®—æ³•"></a>5 ä¸Šç½®ä¿¡ç•Œç®—æ³•</h1><p>è®¾æƒ³è¿™æ ·ä¸€ç§æƒ…å†µï¼šå¯¹äºä¸€å°åŒè‡‚è€è™æœºï¼Œå…¶ä¸­ç¬¬ä¸€æ ¹æ‹‰æ†åªè¢«æ‹‰åŠ¨è¿‡ä¸€æ¬¡ï¼Œå¾—åˆ°çš„å¥–åŠ±ä¸º0ï¼›ç¬¬äºŒæ ¹æ‹‰æ†è¢«æ‹‰åŠ¨è¿‡å¾ˆå¤šæ¬¡ï¼Œæˆ‘ä»¬å¯¹å®ƒçš„å¥–åŠ±åˆ†å¸ƒå·²ç»æœ‰äº†å¤§è‡´çš„æŠŠæ¡ã€‚è¿™æ—¶ä½ ä¼šæ€ä¹ˆåšï¼Ÿæˆ–è®¸ä½ ä¼šè¿›ä¸€æ­¥å°è¯•æ‹‰åŠ¨ç¬¬ä¸€æ ¹æ‹‰æ†ï¼Œä»è€Œæ›´åŠ ç¡®å®šå…¶å¥–åŠ±åˆ†å¸ƒã€‚è¿™ç§æ€è·¯ä¸»è¦æ˜¯åŸºäºä¸ç¡®å®šæ€§ï¼Œå› ä¸ºæ­¤æ—¶ç¬¬ä¸€æ ¹æ‹‰æ†åªè¢«æ‹‰åŠ¨è¿‡ä¸€æ¬¡ï¼Œå®ƒçš„ä¸ç¡®å®šæ€§å¾ˆé«˜ã€‚ä¸€æ ¹æ‹‰æ†çš„ä¸ç¡®å®šæ€§è¶Šå¤§ï¼Œå®ƒå°±è¶Šå…·æœ‰æ¢ç´¢çš„ä»·å€¼ï¼Œå› ä¸ºæ¢ç´¢ä¹‹åæˆ‘ä»¬å¯èƒ½å‘ç°å®ƒçš„æœŸæœ›å¥–åŠ±å¾ˆå¤§ã€‚æˆ‘ä»¬åœ¨æ­¤å¼•å…¥ä¸ç¡®å®šæ€§åº¦é‡U(a)ï¼Œå®ƒä¼šéšç€ä¸€ä¸ªåŠ¨ä½œè¢«å°è¯•æ¬¡æ•°çš„å¢åŠ è€Œå‡å°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§åŸºäºä¸ç¡®å®šæ€§çš„ç­–ç•¥æ¥ç»¼åˆè€ƒè™‘ç°æœ‰çš„æœŸæœ›å¥–åŠ±ä¼°å€¼å’Œä¸ç¡®å®šæ€§ï¼Œå…¶æ ¸å¿ƒé—®é¢˜æ˜¯å¦‚ä½•ä¼°è®¡ä¸ç¡®å®šæ€§ã€‚<br><strong>ä¸Šç½®ä¿¡ç•Œ</strong>ï¼ˆupper confidence boundï¼ŒUCBï¼‰ç®—æ³•æ˜¯ä¸€ç§ç»å…¸çš„åŸºäºä¸ç¡®å®šæ€§çš„ç­–ç•¥ç®—æ³•ï¼Œå®ƒçš„æ€æƒ³ç”¨åˆ°äº†ä¸€ä¸ªéå¸¸è‘—åçš„æ•°å­¦åŸç†ï¼š<strong>éœå¤«ä¸ä¸ç­‰å¼</strong>ï¼ˆHoeffdingâ€™s inequalityï¼‰ã€‚åœ¨éœå¤«ä¸ä¸ç­‰å¼ä¸­ï¼Œä»¤$X_1,\ldots,X_n$ä¸ºnä¸ªç‹¬ç«‹åŒåˆ†å¸ƒçš„éšæœºå˜é‡ï¼Œå–å€¼èŒƒå›´ä¸º[0ï¼Œ1]å…¶ç»éªŒæœŸæœ›ä¸º$\bar{x}<em>{n}&#x3D;\frac{1}{n}\sum</em>{j&#x3D;1}^{n}X_{j}$ï¼Œåˆ™æœ‰ï¼š<br>$\mathbb{P}\left{\mathbb{E}\left[X\right]\geq\bar{x}_n+u\right}\leq e^{-2nu^2}$<br>ç°åœ¨æˆ‘ä»¬å°†éœå¤«ä¸ä¸ç­‰å¼è¿ç”¨äºå¤šè‡‚è€è™æœºé—®é¢˜ä¸­ã€‚<br>è¿‡äºå¤æ‚ï¼ŒåŸç†ä¸åšèµ˜è¿°ï¼Œæ„Ÿå…´è¶£çš„è¯·è‡ªè¡Œæœç´¢ã€‚</p><h3 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UCB</span>(<span class="hljs-title class_ inherited__">Solver</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; UCBç®—æ³•,ç»§æ‰¿Solverç±» &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bandit, coef, init_prob=<span class="hljs-number">1.0</span></span>):<br>        <span class="hljs-built_in">super</span>(UCB, <span class="hljs-variable language_">self</span>).__init__(bandit)<br>        <span class="hljs-variable language_">self</span>.total_count = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>.estimates = np.array([init_prob] * <span class="hljs-variable language_">self</span>.bandit.K)<br>        <span class="hljs-variable language_">self</span>.coef = coef<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_one_step</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.total_count += <span class="hljs-number">1</span><br>        ucb = <span class="hljs-variable language_">self</span>.estimates + <span class="hljs-variable language_">self</span>.coef * np.sqrt(<br>            np.log(<span class="hljs-variable language_">self</span>.total_count) / (<span class="hljs-number">2</span> * (<span class="hljs-variable language_">self</span>.counts + <span class="hljs-number">1</span>)))  <span class="hljs-comment"># è®¡ç®—ä¸Šç½®ä¿¡ç•Œ</span><br>        k = np.argmax(ucb)  <span class="hljs-comment"># é€‰å‡ºä¸Šç½®ä¿¡ç•Œæœ€å¤§çš„æ‹‰æ†</span><br>        r = <span class="hljs-variable language_">self</span>.bandit.step(k)<br>        <span class="hljs-variable language_">self</span>.estimates[k] += <span class="hljs-number">1.</span> / (<span class="hljs-variable language_">self</span>.counts[k] + <span class="hljs-number">1</span>) * (r - <span class="hljs-variable language_">self</span>.estimates[k])<br>        <span class="hljs-keyword">return</span> k<br><br><br>np.random.seed(<span class="hljs-number">1</span>)<br>coef = <span class="hljs-number">1</span>  <span class="hljs-comment"># æ§åˆ¶ä¸ç¡®å®šæ€§æ¯”é‡çš„ç³»æ•°</span><br>UCB_solver = UCB(bandit_10_arm, coef)<br>UCB_solver.run(<span class="hljs-number">5000</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸Šç½®ä¿¡ç•Œç®—æ³•çš„ç´¯ç§¯æ‡Šæ‚”ä¸ºï¼š&#x27;</span>, UCB_solver.regret)<br>plot_results([UCB_solver], [<span class="hljs-string">&quot;UCB&quot;</span>])<br></code></pre></td></tr></table></figure><p><img src="/image/RL-15.png"></p><h1 id="6-æ±¤æ™®æ£®é‡‡æ ·æ³•"><a href="#6-æ±¤æ™®æ£®é‡‡æ ·æ³•" class="headerlink" title="6 æ±¤æ™®æ£®é‡‡æ ·æ³•"></a>6 æ±¤æ™®æ£®é‡‡æ ·æ³•</h1><p>MAB ä¸­è¿˜æœ‰ä¸€ç§ç»å…¸ç®—æ³•â€”â€”<strong>æ±¤æ™®æ£®é‡‡æ ·</strong>ï¼ˆThompson samplingï¼‰ï¼Œå…ˆå‡è®¾æ‹‰åŠ¨æ¯æ ¹æ‹‰æ†çš„å¥–åŠ±æœä»ä¸€ä¸ªç‰¹å®šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œç„¶åæ ¹æ®æ‹‰åŠ¨æ¯æ ¹æ‹‰æ†çš„æœŸæœ›å¥–åŠ±æ¥è¿›è¡Œé€‰æ‹©ã€‚ä½†æ˜¯ç”±äºè®¡ç®—æ‰€æœ‰æ‹‰æ†çš„æœŸæœ›å¥–åŠ±çš„ä»£ä»·æ¯”è¾ƒé«˜ï¼Œæ±¤æ™®æ£®é‡‡æ ·ç®—æ³•ä½¿ç”¨é‡‡æ ·çš„æ–¹å¼ï¼Œå³æ ¹æ®å½“å‰æ¯ä¸ªåŠ¨ä½œaçš„å¥–åŠ±æ¦‚ç‡åˆ†å¸ƒè¿›è¡Œä¸€è½®é‡‡æ ·ï¼Œå¾—åˆ°ä¸€ç»„å„æ ¹æ‹‰æ†çš„å¥–åŠ±æ ·æœ¬ï¼Œå†é€‰æ‹©æ ·æœ¬ä¸­å¥–åŠ±æœ€å¤§çš„åŠ¨ä½œã€‚å¯ä»¥çœ‹å‡ºï¼Œæ±¤æ™®æ£®é‡‡æ ·æ˜¯ä¸€ç§è®¡ç®—æ‰€æœ‰æ‹‰æ†çš„æœ€é«˜å¥–åŠ±æ¦‚ç‡çš„è’™ç‰¹å¡æ´›é‡‡æ ·æ–¹æ³•ã€‚<br>äº†è§£äº†æ±¤æ™®æ£®é‡‡æ ·ç®—æ³•çš„åŸºæœ¬æ€è·¯åï¼Œæˆ‘ä»¬éœ€è¦è§£å†³å¦ä¸€ä¸ªé—®é¢˜ï¼šæ€æ ·å¾—åˆ°å½“å‰æ¯ä¸ªåŠ¨ä½œaçš„å¥–åŠ±æ¦‚ç‡åˆ†å¸ƒå¹¶ä¸”åœ¨è¿‡ç¨‹ä¸­è¿›è¡Œæ›´æ–°ï¼Ÿåœ¨å®é™…æƒ…å†µä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨ Beta åˆ†å¸ƒå¯¹å½“å‰æ¯ä¸ªåŠ¨ä½œçš„å¥–åŠ±æ¦‚ç‡åˆ†å¸ƒè¿›è¡Œå»ºæ¨¡ã€‚å…·ä½“æ¥è¯´ï¼Œè‹¥æŸæ‹‰æ†è¢«é€‰æ‹©äº†kæ¬¡ï¼Œå…¶ä¸­$m_1$æ¬¡å¥–åŠ±ä¸º1ï¼Œ $m_2$æ¬¡å¥–åŠ±ä¸º0ï¼Œåˆ™è¯¥æ‹‰æ†çš„å¥–åŠ±æœä»å‚æ•°ä¸º çš„ Betaåˆ†å¸ƒã€‚ä¸‹å›¾æ˜¯æ±¤æ™®æ£®é‡‡æ ·çš„ä¸€ä¸ªç¤ºä¾‹ã€‚<br><img src="/image/RL-16.png"></p><h3 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThompsonSampling</span>(<span class="hljs-title class_ inherited__">Solver</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; æ±¤æ™®æ£®é‡‡æ ·ç®—æ³•,ç»§æ‰¿Solverç±» &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bandit</span>):<br>        <span class="hljs-built_in">super</span>(ThompsonSampling, <span class="hljs-variable language_">self</span>).__init__(bandit)<br>        <span class="hljs-variable language_">self</span>._a = np.ones(<span class="hljs-variable language_">self</span>.bandit.K)  <span class="hljs-comment"># åˆ—è¡¨,è¡¨ç¤ºæ¯æ ¹æ‹‰æ†å¥–åŠ±ä¸º1çš„æ¬¡æ•°</span><br>        <span class="hljs-variable language_">self</span>._b = np.ones(<span class="hljs-variable language_">self</span>.bandit.K)  <span class="hljs-comment"># åˆ—è¡¨,è¡¨ç¤ºæ¯æ ¹æ‹‰æ†å¥–åŠ±ä¸º0çš„æ¬¡æ•°</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_one_step</span>(<span class="hljs-params">self</span>):<br>        samples = np.random.beta(<span class="hljs-variable language_">self</span>._a, <span class="hljs-variable language_">self</span>._b)  <span class="hljs-comment"># æŒ‰ç…§Betaåˆ†å¸ƒé‡‡æ ·ä¸€ç»„å¥–åŠ±æ ·æœ¬</span><br>        k = np.argmax(samples)  <span class="hljs-comment"># é€‰å‡ºé‡‡æ ·å¥–åŠ±æœ€å¤§çš„æ‹‰æ†</span><br>        r = <span class="hljs-variable language_">self</span>.bandit.step(k)<br><br>        <span class="hljs-variable language_">self</span>._a[k] += r  <span class="hljs-comment"># æ›´æ–°Betaåˆ†å¸ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°</span><br>        <span class="hljs-variable language_">self</span>._b[k] += (<span class="hljs-number">1</span> - r)  <span class="hljs-comment"># æ›´æ–°Betaåˆ†å¸ƒçš„ç¬¬äºŒä¸ªå‚æ•°</span><br>        <span class="hljs-keyword">return</span> k<br><br><br>np.random.seed(<span class="hljs-number">1</span>)<br>thompson_sampling_solver = ThompsonSampling(bandit_10_arm)<br>thompson_sampling_solver.run(<span class="hljs-number">5000</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ±¤æ™®æ£®é‡‡æ ·ç®—æ³•çš„ç´¯ç§¯æ‡Šæ‚”ä¸ºï¼š&#x27;</span>, thompson_sampling_solver.regret)<br>plot_results([thompson_sampling_solver], [<span class="hljs-string">&quot;ThompsonSampling&quot;</span>])<br></code></pre></td></tr></table></figure><p><img src="/image/RL-17.png"><br>$\epsilon-$è´ªå©ªç®—æ³•æ˜¯çº¿æ€§å¢é•¿çš„ï¼Œå…¶ä½™éƒ½æ˜¯æ¬¡çº¿æ€§å¢é•¿ã€‚</p><h1 id="7-æ€»ç»“ä¸å¿ƒå¾—"><a href="#7-æ€»ç»“ä¸å¿ƒå¾—" class="headerlink" title="7 æ€»ç»“ä¸å¿ƒå¾—"></a>7 æ€»ç»“ä¸å¿ƒå¾—</h1><p>æœ¬æ–‡ç€é‡ä¸æ¢ç´¢ä¸åˆ©ç”¨ä¸¤ä¸ªç¯èŠ‚ï¼Œä¸ç¯å¢ƒè¿›è¡Œäº¤äº’ï¼Œè·å¾—ç´¯ç§¯å¥–åŠ±ä¸æ‡Šæ‚”ï¼Œè¿™æ˜¯å¼ºåŒ–å­¦ä¹ æ˜¯é”™æ³•ä¸­çš„å¿…å¤‡æŠ€æœ¯ï¼Œå¤šè‡‚è€è™æœºé—®é¢˜æ­£æ˜¯ç ”ç©¶æ¢ç´¢ä¸åˆ©ç”¨çš„æœ€ä½³ç¯å¢ƒã€‚<br>$\epsilon-$è´ªå©ªç®—æ³•ç­‰å‡ ç§æ–¹æ³•åœ¨å¤šè‡‚è€è™æœºä¸­éå¸¸å¸¸è§ï¼Œä¸Šç½®ä¿¡ç•Œç®—æ³•å’Œæ±¤æ™®æ£®é‡‡æ ·æ–¹æ³•å‡èƒ½ä¿è¯å¯¹æ•°çš„æ¸è¿›æœ€ä¼˜ç´¯ç§¯æ‡Šæ‚”ã€‚<br>å¤šè‡‚è€è™æœºé—®é¢˜ä¸å¼ºåŒ–å­¦ä¹ çš„ä¸€å¤§åŒºåˆ«åœ¨äºå…¶ä¸ç¯å¢ƒçš„äº¤äº’å¹¶ä¸ä¼šæ”¹å˜ç¯å¢ƒï¼Œå³å¤šè‡‚è€è™æœºçš„æ¯æ¬¡äº¤äº’çš„ç»“æœå’Œä»¥å¾€çš„åŠ¨ä½œæ— å…³ï¼Œæ‰€ä»¥å¯çœ‹ä½œ<strong>æ— çŠ¶æ€çš„å¼ºåŒ–å­¦ä¹ </strong>ï¼ˆstateless reinforcement learningï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RL-0 å¼ºåŒ–å­¦ä¹ æ¦‚è¿°</title>
    <link href="/2024/08/16/RL-0/"/>
    <url>/2024/08/16/RL-0/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ä»€ä¹ˆæ˜¯å¼ºåŒ–å­¦ä¹ ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯å¼ºåŒ–å­¦ä¹ ï¼Ÿ" class="headerlink" title="1 ä»€ä¹ˆæ˜¯å¼ºåŒ–å­¦ä¹ ï¼Ÿ"></a>1 ä»€ä¹ˆæ˜¯å¼ºåŒ–å­¦ä¹ ï¼Ÿ</h1><p>å¹¿æ³›åœ°è®²ï¼Œå¼ºåŒ–å­¦ä¹ æ˜¯æœºå™¨é€šè¿‡ä¸ç¯å¢ƒäº¤äº’æ¥å®ç°ç›®æ ‡çš„ä¸€ç§è®¡ç®—æ–¹æ³•ã€‚æœºå™¨å’Œç¯å¢ƒçš„ä¸€è½®äº¤äº’æ˜¯æŒ‡ï¼Œæœºå™¨åœ¨ç¯å¢ƒçš„ä¸€ä¸ªçŠ¶æ€ä¸‹åšä¸€ä¸ªåŠ¨ä½œå†³ç­–ï¼ŒæŠŠè¿™ä¸ªåŠ¨ä½œä½œç”¨åˆ°ç¯å¢ƒå½“ä¸­ï¼Œè¿™ä¸ªç¯å¢ƒå‘ç”Ÿç›¸åº”çš„æ”¹å˜å¹¶ä¸”å°†ç›¸åº”çš„å¥–åŠ±åé¦ˆå’Œä¸‹ä¸€è½®çŠ¶æ€ä¼ å›æœºå™¨ã€‚è¿™ç§äº¤äº’æ˜¯è¿­ä»£è¿›è¡Œçš„ï¼Œæœºå™¨çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–åœ¨å¤šè½®äº¤äº’è¿‡ç¨‹ä¸­è·å¾—çš„ç´¯ç§¯å¥–åŠ±çš„æœŸæœ›ã€‚å¼ºåŒ–å­¦ä¹ ç”¨æ™ºèƒ½ä½“ï¼ˆagentï¼‰è¿™ä¸ªæ¦‚å¿µæ¥è¡¨ç¤ºåšå†³ç­–çš„æœºå™¨ã€‚ç›¸æ¯”äºæœ‰ç›‘ç£å­¦ä¹ ä¸­çš„â€œæ¨¡å‹â€ï¼Œå¼ºåŒ–å­¦ä¹ ä¸­çš„â€œæ™ºèƒ½ä½“â€å¼ºè°ƒæœºå™¨ä¸ä½†å¯ä»¥æ„ŸçŸ¥å‘¨å›´çš„ç¯å¢ƒä¿¡æ¯ï¼Œè¿˜å¯ä»¥é€šè¿‡åšå†³ç­–æ¥ç›´æ¥æ”¹å˜è¿™ä¸ªç¯å¢ƒï¼Œè€Œä¸åªæ˜¯ç»™å‡ºä¸€äº›é¢„æµ‹ä¿¡å·ã€‚<br>æ™ºèƒ½ä½“å’Œç¯å¢ƒä¹‹é—´å…·ä½“çš„äº¤äº’æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨æ¯ä¸€è½®äº¤äº’ä¸­ï¼Œæ™ºèƒ½ä½“æ„ŸçŸ¥åˆ°ç¯å¢ƒç›®å‰æ‰€å¤„çš„çŠ¶æ€ï¼Œç»è¿‡è‡ªèº«çš„è®¡ç®—ç»™å‡ºæœ¬è½®çš„åŠ¨ä½œï¼Œå°†å…¶ä½œç”¨åˆ°ç¯å¢ƒä¸­ï¼›ç¯å¢ƒå¾—åˆ°æ™ºèƒ½ä½“çš„åŠ¨ä½œåï¼Œäº§ç”Ÿç›¸åº”çš„å³æ—¶å¥–åŠ±ä¿¡å·å¹¶å‘ç”Ÿç›¸åº”çš„çŠ¶æ€è½¬ç§»ã€‚æ™ºèƒ½ä½“åˆ™åœ¨ä¸‹ä¸€è½®äº¤äº’ä¸­æ„ŸçŸ¥åˆ°æ–°çš„ç¯å¢ƒçŠ¶æ€ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p><p><img src="/image/RL-01.png"></p><p>è¿™é‡Œï¼Œæ™ºèƒ½ä½“æœ‰3ç§å…³é”®è¦ç´ ï¼Œå³æ„ŸçŸ¥ã€å†³ç­–å’Œå¥–åŠ±ã€‚</p><ul><li>æ„ŸçŸ¥ã€‚æ™ºèƒ½ä½“åœ¨æŸç§ç¨‹åº¦ä¸Šæ„ŸçŸ¥ç¯å¢ƒçš„çŠ¶æ€ï¼Œä»è€ŒçŸ¥é“è‡ªå·±æ‰€å¤„çš„ç°çŠ¶ã€‚ä¾‹å¦‚ï¼Œä¸‹å›´æ£‹çš„æ™ºèƒ½ä½“æ„ŸçŸ¥å½“å‰çš„æ£‹ç›˜æƒ…å†µï¼›æ— äººè½¦æ„ŸçŸ¥å‘¨å›´é“è·¯çš„è½¦è¾†ã€è¡Œäººå’Œçº¢ç»¿ç¯ç­‰æƒ…å†µï¼›æœºå™¨ç‹—é€šè¿‡æ‘„åƒå¤´æ„ŸçŸ¥é¢å‰çš„å›¾åƒï¼Œé€šè¿‡è„šåº•çš„åŠ›å­¦ä¼ æ„Ÿå™¨æ¥æ„ŸçŸ¥åœ°é¢çš„æ‘©æ“¦åŠŸç‡å’Œå€¾æ–œåº¦ç­‰æƒ…å†µã€‚</li><li>æ™ºèƒ½ä½“æ ¹æ®å½“å‰çš„çŠ¶æ€è®¡ç®—å‡ºè¾¾åˆ°ç›®æ ‡éœ€è¦é‡‡å–çš„åŠ¨ä½œçš„è¿‡ç¨‹å«ä½œå†³ç­–ã€‚ä¾‹å¦‚ï¼Œé’ˆå¯¹å½“å‰çš„æ£‹ç›˜å†³å®šä¸‹ä¸€é¢—è½å­çš„ä½ç½®ï¼›é’ˆå¯¹å½“å‰çš„è·¯å†µï¼Œæ— äººè½¦è®¡ç®—å‡ºæ–¹å‘ç›˜çš„è§’åº¦å’Œåˆ¹è½¦ã€æ²¹é—¨çš„åŠ›åº¦ï¼›é’ˆå¯¹å½“å‰æ”¶é›†åˆ°çš„è§†è§‰å’ŒåŠ›è§‰ä¿¡å·ï¼Œæœºå™¨ç‹—ç»™å‡º4æ¡è…¿çš„é½¿è½®çš„è§’é€Ÿåº¦ã€‚ç­–ç•¥æ˜¯æ™ºèƒ½ä½“æœ€ç»ˆä½“ç°å‡ºçš„æ™ºèƒ½å½¢å¼ï¼Œæ˜¯ä¸åŒæ™ºèƒ½ä½“ä¹‹é—´çš„æ ¸å¿ƒåŒºåˆ«ã€‚</li><li>å¥–åŠ±ã€‚ç¯å¢ƒæ ¹æ®çŠ¶æ€å’Œæ™ºèƒ½ä½“é‡‡å–çš„åŠ¨ä½œï¼Œäº§ç”Ÿä¸€ä¸ªæ ‡é‡ä¿¡å·ä½œä¸ºå¥–åŠ±åé¦ˆã€‚è¿™ä¸ªæ ‡é‡ä¿¡å·è¡¡é‡æ™ºèƒ½ä½“è¿™ä¸€è½®åŠ¨ä½œçš„å¥½åã€‚ä¾‹å¦‚ï¼Œå›´æ£‹åšå¼ˆæ˜¯å¦èƒœåˆ©ï¼›æ— äººè½¦æ˜¯å¦å®‰å…¨ã€å¹³ç¨³ä¸”å¿«é€Ÿåœ°è¡Œé©¶ï¼›æœºå™¨ç‹—æ˜¯å¦åœ¨å‰è¿›è€Œæ²¡æœ‰æ‘”å€’ã€‚æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±æœŸæœ›æ˜¯æ™ºèƒ½ä½“æå‡ç­–ç•¥çš„ç›®æ ‡ï¼Œä¹Ÿæ˜¯è¡¡é‡æ™ºèƒ½ä½“ç­–ç•¥å¥½åçš„å…³é”®æŒ‡æ ‡ã€‚<br>ä»ä»¥ä¸Šåˆ†æå¯ä»¥çœ‹å‡ºï¼Œé¢å‘å†³ç­–ä»»åŠ¡çš„å¼ºåŒ–å­¦ä¹ å’Œé¢å‘é¢„æµ‹ä»»åŠ¡çš„æœ‰ç›‘ç£å­¦ä¹ åœ¨å½¢å¼ä¸Šæ˜¯æœ‰ä¸å°‘åŒºåˆ«çš„ã€‚é¦–å…ˆï¼Œå†³ç­–ä»»åŠ¡å¾€å¾€æ¶‰åŠå¤šè½®äº¤äº’ï¼Œå³åºè´¯å†³ç­–ï¼›è€Œé¢„æµ‹ä»»åŠ¡æ€»æ˜¯å•è½®çš„ç‹¬ç«‹ä»»åŠ¡ã€‚å¦‚æœå†³ç­–ä¹Ÿæ˜¯å•è½®çš„ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è½¬åŒ–ä¸ºâ€œåˆ¤åˆ«æœ€ä¼˜åŠ¨ä½œâ€çš„é¢„æµ‹ä»»åŠ¡ã€‚å…¶æ¬¡ï¼Œå› ä¸ºå†³ç­–ä»»åŠ¡æ˜¯å¤šè½®çš„ï¼Œæ™ºèƒ½ä½“å°±éœ€è¦åœ¨æ¯è½®åšå†³ç­–æ—¶è€ƒè™‘æœªæ¥ç¯å¢ƒç›¸åº”çš„æ”¹å˜ï¼Œæ‰€ä»¥å½“å‰è½®å¸¦æ¥æœ€å¤§å¥–åŠ±åé¦ˆçš„åŠ¨ä½œï¼Œåœ¨é•¿æœŸæ¥çœ‹å¹¶ä¸ä¸€å®šæ˜¯æœ€ä¼˜çš„ã€‚</li></ul><h1 id="2-å¼ºåŒ–å­¦ä¹ çš„ç¯å¢ƒ"><a href="#2-å¼ºåŒ–å­¦ä¹ çš„ç¯å¢ƒ" class="headerlink" title="2 å¼ºåŒ–å­¦ä¹ çš„ç¯å¢ƒ"></a>2 å¼ºåŒ–å­¦ä¹ çš„ç¯å¢ƒ</h1><p>å¼ºåŒ–å­¦ä¹ çš„æ™ºèƒ½ä½“æ˜¯åœ¨å’Œä¸€ä¸ªåŠ¨æ€ç¯å¢ƒçš„äº¤äº’ä¸­å®Œæˆåºè´¯å†³ç­–çš„ã€‚æˆ‘ä»¬è¯´ä¸€ä¸ªç¯å¢ƒæ˜¯åŠ¨æ€çš„ï¼Œæ„æ€å°±æ˜¯å®ƒä¼šéšç€æŸäº›å› ç´ çš„å˜åŒ–è€Œä¸æ–­æ¼”å˜ï¼Œè¿™åœ¨æ•°å­¦å’Œç‰©ç†ä¸­å¾€å¾€ç”¨éšæœºè¿‡ç¨‹æ¥åˆ»ç”»ã€‚å…¶å®ï¼Œç”Ÿæ´»ä¸­å‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½åœ¨è¿›è¡Œæ¼”å˜ï¼Œä¾‹å¦‚ä¸€åº§åŸå¸‚çš„äº¤é€šã€ä¸€ç‰‡æ¹–ä¸­çš„ç”Ÿæ€ã€ä¸€åœºè¶³çƒæ¯”èµ›ã€ä¸€ä¸ªæ˜Ÿç³»ç­‰ã€‚å¯¹äºä¸€ä¸ªéšæœºè¿‡ç¨‹ï¼Œå…¶æœ€å…³é”®çš„è¦ç´ å°±æ˜¯çŠ¶æ€ä»¥åŠçŠ¶æ€è½¬ç§»çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒã€‚è¿™å°±å¥½æ¯”ä¸€ä¸ªå¾®ç²’åœ¨æ°´ä¸­çš„å¸ƒæœ—è¿åŠ¨å¯ä»¥ç”±å®ƒçš„èµ·å§‹ä½ç½®ä»¥åŠä¸‹ä¸€åˆ»çš„ä½ç½®ç›¸å¯¹å½“å‰ä½ç½®çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒæ¥åˆ»ç”»ã€‚<br>å¦‚æœåœ¨ç¯å¢ƒè¿™æ ·ä¸€ä¸ªè‡ªèº«æ¼”å˜çš„éšæœºè¿‡ç¨‹ä¸­åŠ å…¥ä¸€ä¸ªå¤–æ¥çš„å¹²æ‰°å› ç´ ï¼Œå³æ™ºèƒ½ä½“çš„åŠ¨ä½œï¼Œé‚£ä¹ˆç¯å¢ƒçš„ä¸‹ä¸€åˆ»çŠ¶æ€çš„æ¦‚ç‡åˆ†å¸ƒå°†ç”±å½“å‰çŠ¶æ€å’Œæ™ºèƒ½ä½“çš„åŠ¨ä½œæ¥å…±åŒå†³å®šï¼Œç”¨æœ€ç®€å•çš„æ•°å­¦å…¬å¼è¡¨ç¤ºåˆ™æ˜¯<br>$ä¸‹ä¸€çŠ¶æ€~P(Â·|å½“å‰çŠ¶æ€ï¼Œæ™ºèƒ½ä½“çš„åŠ¨ä½œ)$<br>æ ¹æ®ä¸Šå¼å¯çŸ¥ï¼Œæ™ºèƒ½ä½“å†³ç­–çš„åŠ¨ä½œä½œç”¨åˆ°ç¯å¢ƒä¸­ï¼Œä½¿å¾—ç¯å¢ƒå‘ç”Ÿç›¸åº”çš„çŠ¶æ€æ”¹å˜ï¼Œè€Œæ™ºèƒ½ä½“æ¥ä¸‹æ¥åˆ™éœ€è¦åœ¨æ–°çš„çŠ¶æ€ä¸‹è¿›ä¸€æ­¥ç»™å‡ºå†³ç­–ã€‚<br>ç”±æ­¤æˆ‘ä»¬çœ‹åˆ°ï¼Œä¸é¢å‘å†³ç­–ä»»åŠ¡çš„æ™ºèƒ½ä½“è¿›è¡Œäº¤äº’çš„ç¯å¢ƒæ˜¯ä¸€ä¸ªåŠ¨æ€çš„éšæœºè¿‡ç¨‹ï¼Œå…¶æœªæ¥çŠ¶æ€çš„åˆ†å¸ƒç”±å½“å‰çŠ¶æ€å’Œæ™ºèƒ½ä½“å†³ç­–çš„åŠ¨ä½œæ¥å…±åŒå†³å®šï¼Œå¹¶ä¸”æ¯ä¸€è½®çŠ¶æ€è½¬ç§»éƒ½ä¼´éšç€ä¸¤æ–¹é¢çš„éšæœºæ€§ï¼šä¸€æ˜¯æ™ºèƒ½ä½“å†³ç­–çš„åŠ¨ä½œçš„éšæœºæ€§ï¼ŒäºŒæ˜¯ç¯å¢ƒåŸºäºå½“å‰çŠ¶æ€å’Œæ™ºèƒ½ä½“åŠ¨ä½œæ¥é‡‡æ ·ä¸‹ä¸€åˆ»çŠ¶æ€çš„éšæœºæ€§ã€‚é€šè¿‡å¯¹ç¯å¢ƒçš„åŠ¨æ€éšæœºè¿‡ç¨‹çš„åˆ»ç”»ï¼Œæˆ‘ä»¬èƒ½æ¸…æ¥šåœ°æ„Ÿå—åˆ°ï¼Œåœ¨åŠ¨æ€éšæœºè¿‡ç¨‹ä¸­å­¦ä¹ å’Œåœ¨ä¸€ä¸ªå›ºå®šçš„æ•°æ®åˆ†å¸ƒä¸‹å­¦ä¹ æ˜¯éå¸¸ä¸åŒçš„ã€‚</p><h1 id="3-å¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡"><a href="#3-å¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡" class="headerlink" title="3 å¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡"></a>3 å¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡</h1><p>åœ¨ä¸Šè¿°åŠ¨æ€ç¯å¢ƒä¸‹ï¼Œæ™ºèƒ½ä½“å’Œç¯å¢ƒæ¯æ¬¡è¿›è¡Œäº¤äº’æ—¶ï¼Œç¯å¢ƒä¼šäº§ç”Ÿç›¸åº”çš„å¥–åŠ±ä¿¡å·ï¼Œå…¶å¾€å¾€ç”±å®æ•°æ ‡é‡æ¥è¡¨ç¤ºã€‚è¿™ä¸ªå¥–åŠ±ä¿¡å·ä¸€èˆ¬æ˜¯è¯ é‡Šå½“å‰çŠ¶æ€æˆ–åŠ¨ä½œçš„å¥½åçš„åŠæ—¶åé¦ˆä¿¡å·ï¼Œå¥½æ¯”åœ¨ç©æ¸¸æˆçš„è¿‡ç¨‹ä¸­æŸä¸€ä¸ªæ“ä½œè·å¾—çš„åˆ†æ•°å€¼ã€‚æ•´ä¸ªäº¤äº’è¿‡ç¨‹çš„æ¯ä¸€è½®è·å¾—çš„å¥–åŠ±ä¿¡å·å¯ä»¥è¿›è¡Œç´¯åŠ ï¼Œå½¢æˆæ™ºèƒ½ä½“çš„æ•´ä½“å›æŠ¥ï¼ˆreturnï¼‰ï¼Œå¥½æ¯”ä¸€ç›˜æ¸¸æˆæœ€åçš„åˆ†æ•°å€¼ã€‚æ ¹æ®ç¯å¢ƒçš„åŠ¨æ€æ€§æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå³ä½¿ç¯å¢ƒå’Œæ™ºèƒ½ä½“ç­–ç•¥ä¸å˜ï¼Œæ™ºèƒ½ä½“çš„åˆå§‹çŠ¶æ€ä¹Ÿä¸å˜ï¼Œæ™ºèƒ½ä½“å’Œç¯å¢ƒäº¤äº’äº§ç”Ÿçš„ç»“æœä¹Ÿå¾ˆå¯èƒ½æ˜¯ä¸åŒçš„ï¼Œå¯¹åº”è·å¾—çš„å›æŠ¥ä¹Ÿä¼šä¸åŒã€‚å› æ­¤ï¼Œåœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨å›æŠ¥çš„æœŸæœ›ï¼Œå¹¶å°†å…¶å®šä¹‰ä¸ºä»·å€¼ï¼ˆvalueï¼‰ï¼Œè¿™å°±æ˜¯å¼ºåŒ–å­¦ä¹ ä¸­æ™ºèƒ½ä½“å­¦ä¹ çš„ä¼˜åŒ–ç›®æ ‡ã€‚<br>ä»·å€¼çš„è®¡ç®—æœ‰äº›å¤æ‚ï¼Œå› ä¸ºéœ€è¦å¯¹äº¤äº’è¿‡ç¨‹ä¸­æ¯ä¸€è½®æ™ºèƒ½ä½“é‡‡å–åŠ¨ä½œçš„æ¦‚ç‡åˆ†å¸ƒå’Œç¯å¢ƒç›¸åº”çš„çŠ¶æ€è½¬ç§»çš„æ¦‚ç‡åˆ†å¸ƒåšç§¯åˆ†è¿ç®—ã€‚å¼ºåŒ–å­¦ä¹ å’Œæœ‰ç›‘ç£å­¦ä¹ çš„å­¦ä¹ ç›®æ ‡å…¶å®æ˜¯ä¸€è‡´çš„ï¼Œå³åœ¨æŸä¸ªæ•°æ®åˆ†å¸ƒä¸‹ä¼˜åŒ–ä¸€ä¸ªåˆ†æ•°å€¼çš„æœŸæœ›ã€‚ä¸è¿‡ï¼Œç»è¿‡åé¢çš„åˆ†ææˆ‘ä»¬ä¼šå‘ç°ï¼Œå¼ºåŒ–å­¦ä¹ å’Œæœ‰ç›‘ç£å­¦ä¹ çš„ä¼˜åŒ–é€”å¾„æ˜¯ä¸åŒçš„ã€‚</p><h1 id="4-å¼ºåŒ–å­¦ä¹ ä¸­çš„æ•°æ®"><a href="#4-å¼ºåŒ–å­¦ä¹ ä¸­çš„æ•°æ®" class="headerlink" title="4 å¼ºåŒ–å­¦ä¹ ä¸­çš„æ•°æ®"></a>4 å¼ºåŒ–å­¦ä¹ ä¸­çš„æ•°æ®</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»æ•°æ®å±‚é¢è°ˆè°ˆæœ‰ç›‘ç£å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ çš„åŒºåˆ«ã€‚<br>æœ‰ç›‘ç£å­¦ä¹ çš„ä»»åŠ¡å»ºç«‹åœ¨ä»ç»™å®šçš„æ•°æ®åˆ†å¸ƒä¸­é‡‡æ ·å¾—åˆ°çš„è®­ç»ƒæ•°æ®é›†ä¸Šï¼Œé€šè¿‡ä¼˜åŒ–åœ¨è®­ç»ƒæ•°æ®é›†ä¸­è®¾å®šçš„ç›®æ ‡å‡½æ•°ï¼ˆå¦‚æœ€å°åŒ–é¢„æµ‹è¯¯å·®ï¼‰æ¥æ‰¾åˆ°æ¨¡å‹çš„æœ€ä¼˜å‚æ•°ã€‚è¿™é‡Œï¼Œè®­ç»ƒæ•°æ®é›†èƒŒåçš„æ•°æ®åˆ†å¸ƒæ˜¯å®Œå…¨ä¸å˜çš„ã€‚<br>åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œæ•°æ®æ˜¯åœ¨æ™ºèƒ½ä½“ä¸ç¯å¢ƒäº¤äº’çš„è¿‡ç¨‹ä¸­å¾—åˆ°çš„ã€‚å¦‚æœæ™ºèƒ½ä½“ä¸é‡‡å–æŸä¸ªå†³ç­–åŠ¨ä½œï¼Œé‚£ä¹ˆè¯¥åŠ¨ä½œå¯¹åº”çš„æ•°æ®å°±æ°¸è¿œæ— æ³•è¢«è§‚æµ‹åˆ°ï¼Œæ‰€ä»¥å½“å‰æ™ºèƒ½ä½“çš„è®­ç»ƒæ•°æ®æ¥è‡ªä¹‹å‰æ™ºèƒ½ä½“çš„å†³ç­–ç»“æœã€‚å› æ­¤ï¼Œæ™ºèƒ½ä½“çš„ç­–ç•¥ä¸åŒï¼Œä¸ç¯å¢ƒäº¤äº’æ‰€äº§ç”Ÿçš„æ•°æ®åˆ†å¸ƒå°±ä¸åŒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="/image/RL-02.png"><br>å…·ä½“è€Œè¨€ï¼Œå¼ºåŒ–å­¦ä¹ ä¸­æœ‰ä¸€ä¸ªå…³äºæ•°æ®åˆ†å¸ƒçš„æ¦‚å¿µï¼Œå«ä½œå ç”¨åº¦é‡ï¼ˆoccupancy measureï¼‰ï¼Œå…¶å…·ä½“çš„æ•°å­¦å®šä¹‰å’Œæ€§è´¨ä¼šåœ¨ç¬¬3ç« è®¨è®ºï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªåšç®€è¦çš„é™ˆè¿°ï¼šå½’ä¸€åŒ–çš„å ç”¨åº¦é‡ç”¨äºè¡¡é‡åœ¨ä¸€ä¸ªæ™ºèƒ½ä½“å†³ç­–ä¸ä¸€ä¸ªåŠ¨æ€ç¯å¢ƒçš„äº¤äº’è¿‡ç¨‹ä¸­ï¼Œé‡‡æ ·åˆ°ä¸€ä¸ªå…·ä½“çš„çŠ¶æ€åŠ¨ä½œå¯¹ï¼ˆstate-action pair)çš„æ¦‚ç‡åˆ†å¸ƒã€‚<br>å ç”¨åº¦é‡æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ€§è´¨ï¼šç»™å®šä¸¤ä¸ªç­–ç•¥åŠå…¶ä¸ä¸€ä¸ªåŠ¨æ€ç¯å¢ƒäº¤äº’å¾—åˆ°çš„ä¸¤ä¸ªå ç”¨åº¦é‡ï¼Œé‚£ä¹ˆå½“ä¸”ä»…å½“è¿™ä¸¤ä¸ªå ç”¨åº¦é‡ç›¸åŒæ—¶ï¼Œè¿™ä¸¤ä¸ªç­–ç•¥ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ™ºèƒ½ä½“çš„ç­–ç•¥æœ‰æ‰€æ”¹å˜ï¼Œé‚£ä¹ˆå®ƒå’Œç¯å¢ƒäº¤äº’å¾—åˆ°çš„å ç”¨åº¦é‡ä¹Ÿä¼šç›¸åº”æ”¹å˜ã€‚<br>æ ¹æ®å ç”¨åº¦é‡è¿™ä¸€é‡è¦çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥é¢†æ‚Ÿåˆ°å¼ºåŒ–å­¦ä¹ æœ¬è´¨çš„æ€ç»´æ–¹å¼ã€‚</p><ul><li>å¼ºåŒ–å­¦ä¹ çš„ç­–ç•¥åœ¨è®­ç»ƒä¸­ä¼šä¸æ–­æ›´æ–°ï¼Œå…¶å¯¹åº”çš„æ•°æ®åˆ†å¸ƒï¼ˆå³å ç”¨åº¦é‡ï¼‰ä¹Ÿä¼šç›¸åº”åœ°æ”¹å˜ã€‚å› æ­¤ï¼Œå¼ºåŒ–å­¦ä¹ çš„ä¸€å¤§éš¾ç‚¹å°±åœ¨äºï¼Œæ™ºèƒ½ä½“çœ‹åˆ°çš„æ•°æ®åˆ†å¸ƒæ˜¯éšç€æ™ºèƒ½ä½“çš„å­¦ä¹ è€Œä¸æ–­å‘ç”Ÿæ”¹å˜çš„ã€‚</li><li>ç”±äºå¥–åŠ±å»ºç«‹åœ¨çŠ¶æ€åŠ¨ä½œå¯¹ä¹‹ä¸Šï¼Œä¸€ä¸ªç­–ç•¥å¯¹åº”çš„ä»·å€¼å…¶å®å°±æ˜¯ä¸€ä¸ªå ç”¨åº¦é‡ä¸‹å¯¹åº”çš„å¥–åŠ±çš„æœŸæœ›ï¼Œå› æ­¤å¯»æ‰¾æœ€ä¼˜ç­–ç•¥å¯¹åº”ç€å¯»æ‰¾æœ€ä¼˜å ç”¨åº¦é‡ã€‚</li></ul><h1 id="5-å¼ºåŒ–å­¦ä¹ çš„ç‹¬ç‰¹æ€§"><a href="#5-å¼ºåŒ–å­¦ä¹ çš„ç‹¬ç‰¹æ€§" class="headerlink" title="5 å¼ºåŒ–å­¦ä¹ çš„ç‹¬ç‰¹æ€§"></a>5 å¼ºåŒ–å­¦ä¹ çš„ç‹¬ç‰¹æ€§</h1><p>é€šè¿‡å‰é¢5èŠ‚çš„è®²è§£ï¼Œè¯»è€…ç°åœ¨åº”è¯¥å·²ç»å¯¹å¼ºåŒ–å­¦ä¹ çš„åŸºæœ¬æ•°å­¦æ¦‚å¿µæœ‰äº†ä¸€å®šçš„äº†è§£ã€‚è¿™é‡Œæˆ‘ä»¬å›è¿‡å¤´æ¥å†çœ‹çœ‹ä¸€èˆ¬çš„æœ‰ç›‘ç£å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ çš„åŒºåˆ«ã€‚<br>å¯¹äºä¸€èˆ¬çš„æœ‰ç›‘ç£å­¦ä¹ ä»»åŠ¡ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜çš„æ¨¡å‹å‡½æ•°ï¼Œä½¿å…¶åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šæœ€å°åŒ–ä¸€ä¸ªç»™å®šçš„æŸå¤±å‡½æ•°ã€‚åœ¨è®­ç»ƒæ•°æ®ç‹¬ç«‹åŒåˆ†å¸ƒçš„å‡è®¾ä¸‹ï¼Œè¿™ä¸ªä¼˜åŒ–ç›®æ ‡è¡¨ç¤ºæœ€å°åŒ–æ¨¡å‹åœ¨æ•´ä¸ªæ•°æ®åˆ†å¸ƒä¸Šçš„æ³›åŒ–è¯¯å·®ï¼ˆgeneralization errorï¼‰ï¼Œç”¨ç®€è¦çš„å…¬å¼å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š<br>æœ€ä¼˜æ¨¡å‹$&#x3D;\arg\min_\text{æ¨¡å‹}\mathbb{E}_($ç‰¹å¾ï¼Œæ ‡ç­¾$)\sim$æ•°æ®åˆ†å¸ƒ[æŸå¤±å‡½æ•°(æ ‡ç­¾ï¼Œæ¨¡å‹(ç‰¹å¾))]<br>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¼ºåŒ–å­¦ä¹ ä»»åŠ¡çš„æœ€ç»ˆä¼˜åŒ–ç›®æ ‡æ˜¯æœ€å¤§åŒ–æ™ºèƒ½ä½“ç­–ç•¥åœ¨å’ŒåŠ¨æ€ç¯å¢ƒäº¤äº’è¿‡ç¨‹ä¸­çš„ä»·å€¼ã€‚æ ¹æ®ç¬¬4èŠ‚çš„åˆ†æï¼Œç­–ç•¥çš„ä»·å€¼å¯ä»¥ç­‰ä»·è½¬æ¢æˆå¥–åŠ±å‡½æ•°åœ¨ç­–ç•¥çš„å ç”¨åº¦é‡ä¸Šçš„æœŸæœ›ï¼Œå³ï¼š</p><p>$\text{æœ€ä¼˜ç­–ç•¥}&#x3D;\arg\max_\text{ç­–ç•¥}\mathbb{E}_{(\text{çŠ¶æ€,åŠ¨ä½œ})\sim\text{ç­–ç•¥çš„å ç”¨åº¦é‡Œ}}[\text{å¥–åŠ±å‡½æ•°}(\text{çŠ¶æ€,åŠ¨ä½œ})]$</p><p>è§‚å¯Ÿä»¥ä¸Šä¸¤ä¸ªä¼˜åŒ–å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å›é¡¾ç¬¬3èŠ‚ï¼Œæ€»ç»“å‡ºä¸¤è€…çš„ç›¸ä¼¼ç‚¹å’Œä¸åŒç‚¹ã€‚</p><ul><li>æœ‰ç›‘ç£å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ çš„ä¼˜åŒ–ç›®æ ‡ç›¸ä¼¼ï¼Œå³éƒ½æ˜¯åœ¨ä¼˜åŒ–æŸä¸ªæ•°æ®åˆ†å¸ƒä¸‹çš„ä¸€ä¸ªåˆ†æ•°å€¼çš„æœŸæœ›ã€‚</li><li>äºŒè€…ä¼˜åŒ–çš„é€”å¾„æ˜¯ä¸åŒçš„ï¼Œæœ‰ç›‘ç£å­¦ä¹ ç›´æ¥é€šè¿‡ä¼˜åŒ–æ¨¡å‹å¯¹äºæ•°æ®ç‰¹å¾çš„è¾“å‡ºæ¥ä¼˜åŒ–ç›®æ ‡ï¼Œå³ä¿®æ”¹ç›®æ ‡å‡½æ•°è€Œæ•°æ®åˆ†å¸ƒä¸å˜ï¼›å¼ºåŒ–å­¦ä¹ åˆ™é€šè¿‡æ”¹å˜ç­–ç•¥æ¥è°ƒæ•´æ™ºèƒ½ä½“å’Œç¯å¢ƒäº¤äº’æ•°æ®çš„åˆ†å¸ƒï¼Œè¿›è€Œä¼˜åŒ–ç›®æ ‡ï¼Œå³ä¿®æ”¹æ•°æ®åˆ†å¸ƒè€Œç›®æ ‡å‡½æ•°ä¸å˜ã€‚<br>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€èˆ¬æœ‰ç›‘ç£å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ çš„èŒƒå¼ä¹‹é—´çš„åŒºåˆ«ä¸ºï¼š</li><li>ä¸€èˆ¬çš„æœ‰ç›‘ç£å­¦ä¹ å…³æ³¨å¯»æ‰¾ä¸€ä¸ªæ¨¡å‹ï¼Œä½¿å…¶åœ¨ç»™å®šæ•°æ®åˆ†å¸ƒä¸‹å¾—åˆ°çš„æŸå¤±å‡½æ•°çš„æœŸæœ›æœ€å°ï¼›</li><li>å¼ºåŒ–å­¦ä¹ å…³æ³¨å¯»æ‰¾ä¸€ä¸ªæ™ºèƒ½ä½“ç­–ç•¥ï¼Œä½¿å…¶åœ¨ä¸åŠ¨æ€ç¯å¢ƒäº¤äº’çš„è¿‡ç¨‹ä¸­äº§ç”Ÿæœ€ä¼˜çš„æ•°æ®åˆ†å¸ƒï¼Œå³æœ€å¤§åŒ–è¯¥åˆ†å¸ƒä¸‹ä¸€ä¸ªç»™å®šå¥–åŠ±å‡½æ•°çš„æœŸæœ›ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
      <tag>å¼ºåŒ–å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ML-0 çº¿æ€§å›å½’</title>
    <link href="/2024/08/16/ML-01/"/>
    <url>/2024/08/16/ML-01/</url>
    
    <content type="html"><![CDATA[<h1 id="1-åŸºæœ¬å½¢å¼"><a href="#1-åŸºæœ¬å½¢å¼" class="headerlink" title="1 åŸºæœ¬å½¢å¼"></a>1 åŸºæœ¬å½¢å¼</h1><p>çº¿æ€§æ¨¡å‹å°è¯•ç”¨ä¸€ä¸ªå¤šä¸ªå±æ€§çš„çº¿æ€§ç»„åˆæ¥è¿›è¡Œé¢„æµ‹ï¼š<br>$f(\boldsymbol{x})&#x3D;w_1x_1+w_2x_2+\ldots+w_dx_d+b$<br>å†™æˆï¼š<br>$f(\boldsymbol{x})&#x3D;\boldsymbol{w}^\mathrm{T}\boldsymbol{x}+b$<br>æ¨¡å‹çš„ç¡®å®šå–å†³äº$w,b$æ˜¯å¦è¢«ç¡®å®š.</p><h1 id="2-çº¿æ€§å›å½’"><a href="#2-çº¿æ€§å›å½’" class="headerlink" title="2 çº¿æ€§å›å½’"></a>2 çº¿æ€§å›å½’</h1><h2 id="2-1å•è¾“å…¥"><a href="#2-1å•è¾“å…¥" class="headerlink" title="2.1å•è¾“å…¥"></a>2.1å•è¾“å…¥</h2><p>çº¿æ€§å›å½’è¦æ±‚é¢„æµ‹å€¼å°½å¯èƒ½çš„æ¥è¿‘çœŸå®å€¼.<br>å¯¹äºç¦»æ•£å±æ€§ï¼Œè‹¥è¾“å…¥åœ¨æ—¶åŸŸå…·æœ‰å…ˆåå…³ç³»ï¼Œå¯ä»¥å°†å…¶è¿›è¡Œç¼–ç ï¼Œè½¬åŒ–ä¸ºè¿ç»­å€¼ï¼š<br>å°†$n$ä¸ªå±æ€§ä½¿ç”¨$n$ç»´å‘é‡è¿›è¡Œçƒ­ç¼–ç ï¼Œä¾‹ï¼šâ€œé«˜ï¼Œä¸­ï¼Œä½â€å¯ç¼–ç ä¸ºâ€œ(100),(010),(001)â€<br>çº¿æ€§å›å½’æœŸæœ›è·å¾—å¦‚ä¸‹ï¼š<br>$f(x_i)&#x3D;wx_i+b,  f(x_i)\simeq y_i$<br>æ­£å¦‚ç¬¬1èŠ‚æ‰€è¯´ï¼Œç¡®å®š$w,b$å°±èƒ½å¾—åˆ°é¢„æµ‹å€¼ï¼›ç¡®å®šå®ƒä»¬çš„å…³é”®åœ¨äºåº¦é‡é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„å·®è·.<br>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°è¯•ç”¨å‡æ–¹è¯¯å·®(MSE)æ¥å¯¹å…¶è¿›è¡Œåº¦é‡ï¼Œå³ï¼š<br>$(w^*,b^*)&#x3D;\arg\min_{(w,b)}\sum_{i&#x3D;1}^m\left(f\left(x_i\right)-y_i\right)^2$<br>åŸºäºå‡æ–¹è¯¯å·®æ¥è¿›è¡Œæ¨¡å‹æ±‚è§£çš„æ–¹æ³•ç§°ä¸ºâ€œæœ€å°äºŒä¹˜æ³•â€ï¼Œå®ƒæ„å‘³ç€æ‰¾åˆ°ä¸€æ¡ç›´çº¿ï¼Œä½¿æ ·æœ¬åˆ°ç›´çº¿ä¸Šçš„æ¬§å¼è·ç¦»ä¹‹å’Œæœ€å°.<br>æ±‚è§£å‡ºæœ€å°å€¼çš„è¿‡ç¨‹ç§°ä¸ºæ¨¡å‹çš„æœ€å°äºŒä¹˜â€œå‚æ•°ä¼°è®¡â€.å¯¹ä¸Šå¼æ±‚åå¯¼ï¼š<br>$\frac{\partial E_{(w,b)}}{\partial w}&#x3D;2\left(w\sum_{i&#x3D;1}^mx_i^2-\sum_{i&#x3D;1}^m\left(y_i-b\right)x_i\right)$<br>$\frac{\partial E_{(w,b)}}{\partial b}&#x3D;2\left(mb-\sum_{i&#x3D;1}^m\left(y_i-wx_i\right)\right)$<br>ä»¤åå¯¼ä¸º0å¯å¾—$w,b$æœ€ä¼˜è§£çš„é—­å¼è§£ï¼š<br>$w&#x3D;\frac{\sum_{i&#x3D;1}^my_i(x_i-\bar{x})}{\sum_{i&#x3D;1}^mx_i^2-\frac1m\left(\sum_{i&#x3D;1}^mx_i\right)^2}$<br>$b&#x3D;\frac1m\sum_{i&#x3D;1}^m(y_i-wx_i)$</p><h2 id="2-2å¤šè¾“å…¥"><a href="#2-2å¤šè¾“å…¥" class="headerlink" title="2.2å¤šè¾“å…¥"></a>2.2å¤šè¾“å…¥</h2><p>æ›´ä¸€èˆ¬çš„æƒ…å½¢æ˜¯ï¼Œè¾“å…¥æ ·æœ¬ç”±å¤šä¸ªå±æ€§.<br>æ­¤æ—¶æœŸæœ›è·å¾—ï¼š<br>$f(x_i)&#x3D;w^{T}x_i+b,  f(x_i)\simeq y_i$<br>ç§°å¤šå…ƒçº¿æ€§å›å½’.<br>åŒæ ·çš„ï¼Œåˆ©ç”¨æœ€å°äºŒä¹˜æ³•å¯¹å‚æ•°è¿›è¡Œä¼°è®¡.<br>å°†xæ‰©å……ä¸º</p><p>$\mathbf{X}&#x3D;\begin{pmatrix}x_{11}&amp;x_{12}&amp;\ldots&amp;x_{1d}&amp;1\x_{21}&amp;x_{22}&amp;\ldots&amp;x_{2d}&amp;1\\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots\x_{m1}&amp;x_{m2}&amp;\ldots&amp;x_{md}&amp;1\end{pmatrix}&#x3D;\begin{pmatrix}\boldsymbol{x}_1^\mathrm{T}&amp;1\\boldsymbol{x}_2^\mathrm{T}&amp;1\\vdots&amp;\vdots\\boldsymbol{x}_m^\mathrm{T}&amp;1\end{pmatrix}$</p><p>å°†è¾“å…¥å†™æˆå‘é‡å½¢å¼ï¼Œåˆ™å¯¹äº$w$,æœ‰ï¼š<br>$\hat{\boldsymbol{w}}^{*}&#x3D;\arg\min_{\hat{\boldsymbol{w}}}\left(\boldsymbol{y}-\mathbf{X}\hat{\boldsymbol{w}}\right)^{\mathrm{T}}\left(\boldsymbol{y}-\mathbf{X}\hat{\boldsymbol{w}}\right)$<br>æ±‚åå¯¼å¾—ï¼š<br>$\frac{\partial E_{\hat{\boldsymbol{w}}}}{\partial\hat{\boldsymbol{w}}}&#x3D;2 \mathbf{X}^{\mathrm{T}}\left(\mathbf{X}\hat{\boldsymbol{w}}-\boldsymbol{y}\right)$<br>ä»¤ä¸Šå¼ä¸º0å³å¯å¾—åˆ°.</p><p>çº¿æ€§å‡½æ•°è™½ç„¶ç®€å•ï¼Œä½†å˜åŒ–ä¸°å¯Œï¼Œæˆ‘ä»¬å¯ä»¥è®©é¢„æµ‹å‡½æ•°ä¸ä¸€ä¸ªå¯å¾®è°ƒå‡½æ•°$g(Â·)$ç›¸ä¹˜ï¼Œä½¿å…¶å¯ä»¥æ‹Ÿåˆæ›´å¤šç±»å‹çš„æ•°å€¼ï¼š<br>$y&#x3D;g^{-1}(w^Tx+b)$<br>ä¸Šè¿°æ¨¡å‹ç§°å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œ</p><h1 id="3-å¯¹æ•°å‡ ç‡å›å½’"><a href="#3-å¯¹æ•°å‡ ç‡å›å½’" class="headerlink" title="3 å¯¹æ•°å‡ ç‡å›å½’"></a>3 å¯¹æ•°å‡ ç‡å›å½’</h1><p>å¯¹äºäºŒåˆ†ç±»ä»»åŠ¡ï¼Œå°†å¾—åˆ°çš„é¢„æµ‹å€¼è½¬ä¸º0&#x2F;1å€¼ï¼Œæœ€ç†æƒ³çš„æ˜¯â€œå•ä½é˜¶è·ƒå‡½æ•°â€ï¼Œä½†æ˜¯å®ƒä¸è¿ç»­ï¼Œä¸èƒ½ä½œä¸ºå¯å¾®è°ƒå‡½æ•°.ä½œä¸ºæ›¿ä»£ï¼Œä½¿ç”¨ï¼š<br>$y&#x3D;\frac{1}{1+e^{-z}}$<br>è‹¥ä»¤zç­‰äº$(w^Tx+b)$,å†è¿›è¡Œå˜åŒ–ï¼Œå¾—ï¼š<br>$ln\frac{y}{1-y}&#x3D;(w^Tx+b)$<br>yå’Œ1-yåˆ†åˆ«æ˜¯æ­£ä¾‹å’Œåä¾‹çš„å¯èƒ½æ€§.<br>å®é™…ä¸Šæ˜¯ä½¿ç”¨çº¿æ€§å›å½’æ¨¡å‹å»é€¼è¿‘çœŸå®æ ‡è®°çš„å¯¹æ•°å‡ ç‡.</p><h1 id="4-ä»£ç "><a href="#4-ä»£ç " class="headerlink" title="4 ä»£ç "></a>4 ä»£ç </h1><p>(åŸºäºsklearnåº“)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">@File    :   linear regression.ipynb</span><br><span class="hljs-string"></span><br><span class="hljs-string">@Time    :   2024/08/15 15:59:55</span><br><span class="hljs-string"></span><br><span class="hljs-string">@Author  :   Neutrin</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment">#this is a simple of linear regression models</span><br><span class="hljs-comment"># here put the import lib</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LogisticRegression<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> confusion_matrix, ConfusionMatrixDisplay<br><br><span class="hljs-comment">#è¯»å–æ•°æ®</span><br>data = pd.read_csv(<span class="hljs-string">&#x27;watermelon3_0_Ch.csv&#x27;</span>)<br><br><span class="hljs-comment">#çƒ­ç¼–ç </span><br>data = pd.get_dummies(data)<br><span class="hljs-built_in">print</span>(data.shape)<br><br><span class="hljs-comment">#åˆ’åˆ†æ•°æ®é›†</span><br><br>x_train, x_test, y_train, y_test = train_test_split(data.iloc[:,<span class="hljs-number">0</span>:<span class="hljs-number">20</span>],data.iloc[:,<span class="hljs-number">21</span>],test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">0</span>)<br><br><span class="hljs-comment">#å»ºç«‹æ¨¡å‹</span><br>model = LogisticRegression(max_iter=<span class="hljs-number">1000</span>)<br>model.fit(x_train, y_train)<br><br><span class="hljs-comment">#é¢„æµ‹</span><br>y_pred = model.predict(x_test)<br><br><span class="hljs-comment">#è¯„ä¼°</span><br>score = model.score(x_test, y_test)<br><span class="hljs-built_in">print</span>(score)<br>cm = confusion_matrix(y_test, y_pred)<br><br><span class="hljs-comment"># å½’ä¸€åŒ–æ··æ·†çŸ©é˜µ</span><br><br>cm_normalized = cm.astype(<span class="hljs-string">&#x27;float&#x27;</span>) / cm.<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">1</span>)[:, np.newaxis]<br><br><span class="hljs-comment"># ç»˜åˆ¶å½’ä¸€åŒ–æ··æ·†çŸ©é˜µ</span><br><br>disp = ConfusionMatrixDisplay(confusion_matrix=cm_normalized, display_labels=model.classes_)<br><br>disp.plot(cmap=plt.cm.Blues)<br><span class="hljs-comment"># æ˜¾ç¤ºå›¾åƒ</span><br>plt.title(<span class="hljs-string">&#x27;Normalized Confusion Matrix&#x27;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š<br><img src="/image/LR.png"></p>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>æœºå™¨å­¦ä¹ </tag>
      
      <tag>ä»¿çœŸ</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
